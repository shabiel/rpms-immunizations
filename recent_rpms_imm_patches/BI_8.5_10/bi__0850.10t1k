KIDS Distribution saved on Apr 22, 2015@11:34:13
Immunization v8.510, 04/22/2015, CIM/ER/Mike Remillard
**KIDS**:BI*8.5*10^

**INSTALL NAME**
BI*8.5*10
"BLD",1179,0)
BI*8.5*10^IMMUNIZATION^0^3150422^y
"BLD",1179,4,0)
^9.64PA^9000010.12^1
"BLD",1179,4,9000010.12,0)
9000010.12
"BLD",1179,4,9000010.12,2,0)
^9.641^9000010.12^1
"BLD",1179,4,9000010.12,2,9000010.12,0)
V SKIN TEST  (File-top level)
"BLD",1179,4,9000010.12,2,9000010.12,1,0)
^9.6411^.14^1
"BLD",1179,4,9000010.12,2,9000010.12,1,.14,0)
LOT NUMBER
"BLD",1179,4,9000010.12,222)
y^n^p^^^^n^^n
"BLD",1179,4,9000010.12,224)

"BLD",1179,4,"APDD",9000010.12,9000010.12)

"BLD",1179,4,"APDD",9000010.12,9000010.12,.14)

"BLD",1179,4,"B",9000010.12,9000010.12)

"BLD",1179,"INIT")
BIPOST
"BLD",1179,"KRN",0)
^9.67PA^8989.52^19
"BLD",1179,"KRN",.4,0)
.4
"BLD",1179,"KRN",.401,0)
.401
"BLD",1179,"KRN",.402,0)
.402
"BLD",1179,"KRN",.403,0)
.403
"BLD",1179,"KRN",.403,"NM",0)
^9.68A^1^1
"BLD",1179,"KRN",.403,"NM",1,0)
BI FORM-SKIN VISIT ADD/EDIT    FILE #9000001^9000001^0
"BLD",1179,"KRN",.403,"NM","B","BI FORM-SKIN VISIT ADD/EDIT    FILE #9000001",1)

"BLD",1179,"KRN",.5,0)
.5
"BLD",1179,"KRN",.84,0)
.84
"BLD",1179,"KRN",3.6,0)
3.6
"BLD",1179,"KRN",3.8,0)
3.8
"BLD",1179,"KRN",9.2,0)
9.2
"BLD",1179,"KRN",9.8,0)
9.8
"BLD",1179,"KRN",9.8,"NM",0)
^9.68A^18^18
"BLD",1179,"KRN",9.8,"NM",1,0)
BIPATUP1^^0^B52457054
"BLD",1179,"KRN",9.8,"NM",2,0)
BIPATUP2^^0^B15773691
"BLD",1179,"KRN",9.8,"NM",3,0)
BITN^^0^B170868012
"BLD",1179,"KRN",9.8,"NM",4,0)
BITN2^^0^B126145453
"BLD",1179,"KRN",9.8,"NM",5,0)
BILETPR1^^0^B124280634
"BLD",1179,"KRN",9.8,"NM",6,0)
BILETPR3^^0^B29535293
"BLD",1179,"KRN",9.8,"NM",7,0)
BIPATVW2^^0^B84034422
"BLD",1179,"KRN",9.8,"NM",8,0)
BIRPC1^^0^B7323216
"BLD",1179,"KRN",9.8,"NM",9,0)
BIUTL7^^0^B140935805
"BLD",1179,"KRN",9.8,"NM",10,0)
BIRPC3^^0^B47888701
"BLD",1179,"KRN",9.8,"NM",11,0)
BIVISIT^^0^B113888353
"BLD",1179,"KRN",9.8,"NM",12,0)
BIUTL8^^0^B65993934
"BLD",1179,"KRN",9.8,"NM",13,0)
BIENVCHK^^0^B16976563
"BLD",1179,"KRN",9.8,"NM",14,0)
BIPOST^^0^B34853125
"BLD",1179,"KRN",9.8,"NM",15,0)
BIDE^^0^B40231816
"BLD",1179,"KRN",9.8,"NM",16,0)
BILOGO^^0^B23635240
"BLD",1179,"KRN",9.8,"NM",17,0)
BINTEG^^0^B3324137
"BLD",1179,"KRN",9.8,"NM",18,0)
BIUTL4^^0^B106386697
"BLD",1179,"KRN",9.8,"NM","B","BIDE",15)

"BLD",1179,"KRN",9.8,"NM","B","BIENVCHK",13)

"BLD",1179,"KRN",9.8,"NM","B","BILETPR1",5)

"BLD",1179,"KRN",9.8,"NM","B","BILETPR3",6)

"BLD",1179,"KRN",9.8,"NM","B","BILOGO",16)

"BLD",1179,"KRN",9.8,"NM","B","BINTEG",17)

"BLD",1179,"KRN",9.8,"NM","B","BIPATUP1",1)

"BLD",1179,"KRN",9.8,"NM","B","BIPATUP2",2)

"BLD",1179,"KRN",9.8,"NM","B","BIPATVW2",7)

"BLD",1179,"KRN",9.8,"NM","B","BIPOST",14)

"BLD",1179,"KRN",9.8,"NM","B","BIRPC1",8)

"BLD",1179,"KRN",9.8,"NM","B","BIRPC3",10)

"BLD",1179,"KRN",9.8,"NM","B","BITN",3)

"BLD",1179,"KRN",9.8,"NM","B","BITN2",4)

"BLD",1179,"KRN",9.8,"NM","B","BIUTL4",18)

"BLD",1179,"KRN",9.8,"NM","B","BIUTL7",9)

"BLD",1179,"KRN",9.8,"NM","B","BIUTL8",12)

"BLD",1179,"KRN",9.8,"NM","B","BIVISIT",11)

"BLD",1179,"KRN",19,0)
19
"BLD",1179,"KRN",19,"NM",0)
^9.68A^^
"BLD",1179,"KRN",19.1,0)
19.1
"BLD",1179,"KRN",101,0)
101
"BLD",1179,"KRN",409.61,0)
409.61
"BLD",1179,"KRN",771,0)
771
"BLD",1179,"KRN",870,0)
870
"BLD",1179,"KRN",8989.51,0)
8989.51
"BLD",1179,"KRN",8989.52,0)
8989.52
"BLD",1179,"KRN",8994,0)
8994
"BLD",1179,"KRN","B",.4,.4)

"BLD",1179,"KRN","B",.401,.401)

"BLD",1179,"KRN","B",.402,.402)

"BLD",1179,"KRN","B",.403,.403)

"BLD",1179,"KRN","B",.5,.5)

"BLD",1179,"KRN","B",.84,.84)

"BLD",1179,"KRN","B",3.6,3.6)

"BLD",1179,"KRN","B",3.8,3.8)

"BLD",1179,"KRN","B",9.2,9.2)

"BLD",1179,"KRN","B",9.8,9.8)

"BLD",1179,"KRN","B",19,19)

"BLD",1179,"KRN","B",19.1,19.1)

"BLD",1179,"KRN","B",101,101)

"BLD",1179,"KRN","B",409.61,409.61)

"BLD",1179,"KRN","B",771,771)

"BLD",1179,"KRN","B",870,870)

"BLD",1179,"KRN","B",8989.51,8989.51)

"BLD",1179,"KRN","B",8989.52,8989.52)

"BLD",1179,"KRN","B",8994,8994)

"BLD",1179,"PRE")
BIENVCHK
"BLD",1179,"QUES",0)
^9.62^^
"FIA",9000010.12)
V SKIN TEST
"FIA",9000010.12,0)
^AUPNVSK(
"FIA",9000010.12,0,0)
9000010.12AIP
"FIA",9000010.12,0,1)
y^n^p^^^^n^^n
"FIA",9000010.12,0,10)

"FIA",9000010.12,0,11)

"FIA",9000010.12,0,"RLRO")

"FIA",9000010.12,0,"VR")
8.5^BI
"FIA",9000010.12,9000010.12)
1
"FIA",9000010.12,9000010.12,.14)

"INIT")
BIPOST
"KRN",.403,118,-1)
0^1
"KRN",.403,118,0)
BI FORM-SKIN VISIT ADD/EDIT^@^@^^2980101.1522^^^9000001^0^1^1
"KRN",.403,118,14)

"KRN",.403,118,40,0)
^.4031I^2^2
"KRN",.403,118,40,1,0)
1^^1,1
"KRN",.403,118,40,1,1)
Page 1
"KRN",.403,118,40,1,40,0)
^.4032IP^482^2
"KRN",.403,118,40,1,40,481,0)
BI BLK-SKIN VISIT HEADER^1^1,1^d
"KRN",.403,118,40,1,40,482,0)
BI BLK-SKIN VISIT ADD/EDIT^2^7,1^e
"KRN",.403,118,40,2,0)
2^^12,6^^^1^16,73
"KRN",.403,118,40,2,1)
BI PAGE-LOCATION NAME TOO LONG
"KRN",.403,118,40,2,40,0)
^.4032IP^490^1
"KRN",.403,118,40,2,40,490,0)
BI BLK-OUTSIDE LOC TOO LONG^1^2,4^e
"KRN",.404,481,0)
BI BLK-SKIN VISIT HEADER^9000001^
"KRN",.404,481,40,0)
^.4044I^8^8
"KRN",.404,481,40,1,0)
1^* * *  ADD/EDIT SKIN TEST VISIT  * * *^1
"KRN",.404,481,40,1,2)
^^2,22
"KRN",.404,481,40,2,0)
2^!M^1
"KRN",.404,481,40,2,.1)
S Y=IOINORM_" Patient: "_IORVON_$$NAME^BIUTL1(BIDFN)_IOINORM
"KRN",.404,481,40,2,2)
^^4,1
"KRN",.404,481,40,3,0)
3^!M^1
"KRN",.404,481,40,3,.1)
S Y="DOB: "_IORVON_$$DOBF^BIUTL1(BIDFN)_IOINORM
"KRN",.404,481,40,3,2)
^^4,44
"KRN",.404,481,40,4,0)
4^!M^1
"KRN",.404,481,40,4,.1)
S Y="  Chart#: "_IORVON_$$HRCN^BIUTL1(BIDFN)_" at "_$E($$INSTTX^BIUTL6($G(DUZ(2))),1,17)_IOINORM
"KRN",.404,481,40,4,2)
^^5,1
"KRN",.404,481,40,5,0)
5^!M^1
"KRN",.404,481,40,5,.1)
S Y=$$ACTIVE^BIUTL1(BIDFN)_"     "_$$SEXW^BIUTL1(BIDFN)
"KRN",.404,481,40,5,2)
^^5,49
"KRN",.404,481,40,6,0)
6^________________________________________________________________________________^1
"KRN",.404,481,40,6,2)
^^6,1
"KRN",.404,481,40,7,0)
.5^!M^1
"KRN",.404,481,40,7,.1)
S Y="Imm v"_$$VER^BILOGO()
"KRN",.404,481,40,7,2)
^^2,2
"KRN",.404,481,40,8,0)
.4^!M^1
"KRN",.404,481,40,8,.1)
S Y="Imm v"_$$VER^BILOGO()
"KRN",.404,481,40,8,2)
^^2,2
"KRN",.404,482,0)
BI BLK-SKIN VISIT ADD/EDIT^9000001
"KRN",.404,482,11)
D LOADVIS^BIUTL7("S")
"KRN",.404,482,12)

"KRN",.404,482,40,0)
^.4044I^16^16
"KRN",.404,482,40,1,0)
1^Date^2
"KRN",.404,482,40,1,2)
2,14^22^2,8
"KRN",.404,482,40,1,4)
1
"KRN",.404,482,40,1,11)
D HLP^DDSUTL("Enter the date of this Skin Test Visit.")
"KRN",.404,482,40,1,12)
S BI("E")=X D OLDDATE^BIUTL4(X)
"KRN",.404,482,40,1,13)
S BIDEFDT=X
"KRN",.404,482,40,1,14)
I $P(Y,".")>DT S DDSERROR="" D HLP^DDSUTL(" * Date may not be in the future.")
"KRN",.404,482,40,1,20)
D^^::PTEX
"KRN",.404,482,40,1,21,0)
^^2^2^2990305^
"KRN",.404,482,40,1,21,1,0)
Enter the date of this Skin Test Visit.  You may also add the Time of
"KRN",.404,482,40,1,21,2,0)
Visit following an "@", for example, 1/1/99@0900.
"KRN",.404,482,40,2,0)
2^Skin Test^2
"KRN",.404,482,40,2,2)
4,14^10^4,3
"KRN",.404,482,40,2,4)
1^^^
"KRN",.404,482,40,2,11)
D HLP^DDSUTL("Select the Skin Test for this Visit.")
"KRN",.404,482,40,2,12)
S BI("B")=X
"KRN",.404,482,40,2,13)
D SKINCHG^BIUTL4(X)
"KRN",.404,482,40,2,20)
P^^9999999.28:QEM
"KRN",.404,482,40,2,21,0)
^^1^1^2980211^^^
"KRN",.404,482,40,2,21,1,0)
Select the Skin Test for this Visit.
"KRN",.404,482,40,3,0)
3^Result^2
"KRN",.404,482,40,3,2)
6,11^8^6,3
"KRN",.404,482,40,3,4)
0^^^
"KRN",.404,482,40,3,11)
D HLP^DDSUTL("Select the result for this Skin Test: P for Positive, N for Negative, D for Doubtful, or O for No Take.  *** NOTE! If you enter a Result you MUST enter a Reading! ***")
"KRN",.404,482,40,3,12)
S BI("L")=X
"KRN",.404,482,40,3,14)
I ($$GET^DDSVALF(4,"","","I")>14)&(X="N") D BADREAD^BIUTL4
"KRN",.404,482,40,3,20)
S^M^P:POSITIVE;N:NEGATIVE;D:DOUBTFUL;O:NO TAKE
"KRN",.404,482,40,3,21,0)
^^1^1^2980211^
"KRN",.404,482,40,3,21,1,0)
Select the result for this Skin Test.
"KRN",.404,482,40,4,0)
4^Reading^2
"KRN",.404,482,40,4,2)
6,35^2^6,26
"KRN",.404,482,40,4,4)
^^^0
"KRN",.404,482,40,4,11)
D HLP^DDSUTL("Enter a whole number between 0 and 40, indicating the size of the reading in millimeters.  If the Result is NEGATIVE, the reading must be less than 15mm.")
"KRN",.404,482,40,4,12)
S BI("M")=X D READCHK^BIUTL7
"KRN",.404,482,40,4,14)
I ($$GET^DDSVALF(3,"","","I")="N")&(X>14) D BADREAD^BIUTL4
"KRN",.404,482,40,4,20)
N^^0:40:0
"KRN",.404,482,40,4,21,0)
^^3^3^3030814^
"KRN",.404,482,40,4,21,1,0)
Enter a whole number between 0 and 40, indicating the size of the reading
"KRN",.404,482,40,4,21,2,0)
in millimeters.  If the Result is NEGATIVE, the reading must be less than
"KRN",.404,482,40,4,21,3,0)
15 mm.
"KRN",.404,482,40,5,0)
5^Date of Reading^2
"KRN",.404,482,40,5,2)
6,60^11^6,43
"KRN",.404,482,40,5,4)
0
"KRN",.404,482,40,5,11)
D HLP^DDSUTL("Enter the date on which the result reading was taken.")
"KRN",.404,482,40,5,12)
S BI("N")=X
"KRN",.404,482,40,5,14)
I Y D BADRDAT^BIUTL4
"KRN",.404,482,40,5,20)
D^^
"KRN",.404,482,40,5,21,0)
^^1^1^3060808^^^
"KRN",.404,482,40,5,21,1,0)
Enter the date on which the result reading was taken
"KRN",.404,482,40,6,0)
7^Location^2
"KRN",.404,482,40,6,2)
8,36^40^8,26
"KRN",.404,482,40,6,4)
0
"KRN",.404,482,40,6,11)
D HLP^DDSUTL("Select a Location.  If the Location you wish to select is not in the Location File, go to the Location Type field on this screen and select ""OTHER"", then return to this field and enter the location you wish.")
"KRN",.404,482,40,6,12)
S BI("F")=X
"KRN",.404,482,40,6,20)
P^^4:QEM
"KRN",.404,482,40,6,21,0)
^^3^3^2990530^
"KRN",.404,482,40,6,21,1,0)
Select a Location.  If the Location you wish to select is not in the
"KRN",.404,482,40,6,21,2,0)
Location File, go to the Location Type field on this screen and select
"KRN",.404,482,40,6,21,3,0)
"OTHER", then return to this field and enter the location you wish.
"KRN",.404,482,40,6,24)
S DIR("S")="I $D(^AUTTLOC(Y,0)) I '$P(^(0),U,21)"
"KRN",.404,482,40,7,0)
6^Location Type^2
"KRN",.404,482,40,7,2)
8,18^5^8,3
"KRN",.404,482,40,7,3)
IHS
"KRN",.404,482,40,7,4)
1
"KRN",.404,482,40,7,11)
D HLP^DDSUTL("Enter ""I"" if this visit occurred at an IHS Location.  Enter ""O"" if it occurred at some Other location not listed in the Location File.")
"KRN",.404,482,40,7,12)
D READCH6^BIUTL7
"KRN",.404,482,40,7,20)
S^M^I:IHS;O:Other
"KRN",.404,482,40,7,21,0)
^^2^2^2990530^
"KRN",.404,482,40,7,21,1,0)
Enter "I" if this visit occurred at an IHS Location.  Enter "O" if it
"KRN",.404,482,40,7,21,2,0)
occurred at some Other location not listed in the Location File.
"KRN",.404,482,40,8,0)
8^Location^2
"KRN",.404,482,40,8,2)
8,36^40^8,26
"KRN",.404,482,40,8,4)
0^^^1
"KRN",.404,482,40,8,10)
I $G(BITOLONG) S DDSSTACK="BI PAGE-LOCATION NAME TOO LONG"
"KRN",.404,482,40,8,11)
D HLP^DDSUTL("Enter the name of the non-IHS location for this visit (between 2 and 30 characters).")
"KRN",.404,482,40,8,12)
S BI("G")=X
"KRN",.404,482,40,8,20)
F^^2:100
"KRN",.404,482,40,8,21,0)
^^2^2^2980127^
"KRN",.404,482,40,8,21,1,0)
Enter the name of the non-IHS location for this visit (between 2 and 30
"KRN",.404,482,40,8,21,2,0)
characters).
"KRN",.404,482,40,8,22)
I $L(X)>50 S Y=$E(X,1,50) S BITOLONG=1
"KRN",.404,482,40,9,0)
11^Category^2
"KRN",.404,482,40,9,2)
2,56^16^2,46
"KRN",.404,482,40,9,3)
A
"KRN",.404,482,40,9,4)
1
"KRN",.404,482,40,9,11)
D HLP^DDSUTL("Select the PCC Category for this visit (Ambulatory, Historical, or Inpatient).")
"KRN",.404,482,40,9,12)
S BI("I")=X D NOPROV^BIUTL7(X)
"KRN",.404,482,40,9,20)
S^M^A:Ambulatory;E:Historical Event;I:Inpatient
"KRN",.404,482,40,9,21,0)
^^1^1^2980112^
"KRN",.404,482,40,9,21,1,0)
Select the PCC Category for this visit.
"KRN",.404,482,40,10,0)
4.5^mm^1
"KRN",.404,482,40,10,2)
^^6,38
"KRN",.404,482,40,11,0)
9^Skin Test Provider^2
"KRN",.404,482,40,11,2)
10,23^28^10,3
"KRN",.404,482,40,11,11)
D HLP^DDSUTL("Select the Provider who actually administered the Skin Test.  (This may or may not be the person who read the test result.)")
"KRN",.404,482,40,11,12)
S BI("R")=X
"KRN",.404,482,40,11,20)
P^^200:QEM
"KRN",.404,482,40,11,21,0)
^^4^4^2990530^
"KRN",.404,482,40,11,21,1,0)
Select the Provider who actually administered the Skin Test.  This person
"KRN",.404,482,40,11,21,2,0)
must be listed as a Provider in the RPMS Person File (must have the
"KRN",.404,482,40,11,21,3,0)
Provider Key).  This may or may not be the person who read the test
"KRN",.404,482,40,11,21,4,0)
result.
"KRN",.404,482,40,11,24)
S DIR("S")="I $D(^XUSEC(""PROVIDER"",+Y))"
"KRN",.404,482,40,12,0)
10^Skin Test Reader^2
"KRN",.404,482,40,12,2)
11,23^28^11,5
"KRN",.404,482,40,12,11)
D HLP^DDSUTL("Select the provider who actually read the test result.")
"KRN",.404,482,40,12,12)
S BI("X")=X
"KRN",.404,482,40,12,20)
P^^200:QEM
"KRN",.404,482,40,13,0)
2.4^Site^2
"KRN",.404,482,40,13,2)
4,35^13^4,29
"KRN",.404,482,40,13,4)
0
"KRN",.404,482,40,13,11)
D HLP^DDSUTL("Enter ""L"" for Left Forearm or ""R"" for Right Forearm.")
"KRN",.404,482,40,13,12)
S BI("T")=X
"KRN",.404,482,40,13,20)
S^M^L:LEFT FOREARM;R:RIGHT FOREARM
"KRN",.404,482,40,14,0)
2.8^Volume^2
"KRN",.404,482,40,14,2)
4,60^4^4,52
"KRN",.404,482,40,14,4)
^^0^0
"KRN",.404,482,40,14,11)
D HLP^DDSUTL("Enter the Volume in mls of test fluid injected")
"KRN",.404,482,40,14,12)
S BI("W")=X
"KRN",.404,482,40,14,20)
N^N^0:5:2
"KRN",.404,482,40,15,0)
13.5^ml^2
"KRN",.404,482,40,15,2)
4,68^1^4,64^1
"KRN",.404,482,40,15,4)
^^^1
"KRN",.404,482,40,15,20)
F
"KRN",.404,482,40,16,0)
2.9^Lot#^2
"KRN",.404,482,40,16,2)
5,35^25^5,29
"KRN",.404,482,40,16,4)
0^^^0
"KRN",.404,482,40,16,11)
D HLP^DDSUTL("Select the Lot Number for the PPD used in this Skin Test.")
"KRN",.404,482,40,16,12)
S BI("LL")=X
"KRN",.404,482,40,16,20)
P^^9999999.41:QEM
"KRN",.404,482,40,16,21,0)
^^1^1^3150406^
"KRN",.404,482,40,16,21,1,0)
Select the Lot Number for the PPD used on this Skin Test Visit.
"KRN",.404,482,40,16,24)
D LOTSCRS^BIUTL8
"KRN",.404,490,0)
BI BLK-OUTSIDE LOC TOO LONG^9000001^
"KRN",.404,490,40,0)
^.4044I^1^1
"KRN",.404,490,40,1,0)
1^Your Other Loccation Name will be shortened to 50 characters.^1
"KRN",.404,490,40,1,2)
^^2,2
"MBREQ")
0
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"PKG",254,-1)
1^1
"PKG",254,0)
IMMUNIZATION^BI^IMMUNIZATION TRACKING & REPORTING SYSTEM
"PKG",254,20,0)
^9.402P^^
"PKG",254,22,0)
^9.49I^1^1
"PKG",254,22,1,0)
8.5^3120103
"PKG",254,22,1,"PAH",1,0)
10^3150422
"PRE")
BIENVCHK
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
18
"RTN","BIDE")
0^15^B40231816
"RTN","BIDE",1,0)
BIDE ;IHS/CMI/MWR - BUILD ^BIEXPDD GLOBAL.
"RTN","BIDE",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BIDE",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIDE",4,0)
 ;;  UTILITY: BUILD ^BIEXPDD GLOBAL.
"RTN","BIDE",5,0)
 ;;  PATCH 10: Add two new Skin Test Data Elements.  TABLE+88
"RTN","BIDE",6,0)
 ;
"RTN","BIDE",7,0)
 ;
"RTN","BIDE",8,0)
 ;----------
"RTN","BIDE",9,0)
START ;EP
"RTN","BIDE",10,0)
 D KGBL^BIUTL8("^BIEXPDD")
"RTN","BIDE",11,0)
 S ^BIEXPDD(0)="BI TABLE DATA ELEMENT^9002084.91I"
"RTN","BIDE",12,0)
 N I,X,Y,Z
"RTN","BIDE",13,0)
 F I=1:1 S X=$T(@"TABLE"+I) Q:X'[";;"  D
"RTN","BIDE",14,0)
 .S Y=$P(X,";;",2),Z=$P(X,";;",3)
"RTN","BIDE",15,0)
 .S ^BIEXPDD(Y,0)=Z
"RTN","BIDE",16,0)
 N DIK S DIK="^BIEXPDD(" D IXALL^DIK
"RTN","BIDE",17,0)
 Q
"RTN","BIDE",18,0)
 ;
"RTN","BIDE",19,0)
 ;
"RTN","BIDE",20,0)
 ;----------
"RTN","BIDE",21,0)
TABLE ; EP
"RTN","BIDE",22,0)
 ;;1;;LASTNAME,FIRSTNAME MI^S Y=$$NAME~BIUTL1(BIDFN)^NAME^A
"RTN","BIDE",23,0)
 ;;2;;LASTNAME ONLY^S Y=$$NAME~BIUTL1(BIDFN,3)^NAME^A
"RTN","BIDE",24,0)
 ;;3;;FIRSTNAME ONLY^S Y=$$NAME~BIUTL1(BIDFN,2)^NAME^A
"RTN","BIDE",25,0)
 ;;4;;VACCINE NAME, SHORT^S Y=$$VNAME~BIUTL2($P(BI0,U))^VS^I
"RTN","BIDE",26,0)
 ;;5;;CHART#^S Y=$$HRCN~BIUTL1(BIDFN,DUZ(2))^HRCN^A
"RTN","BIDE",27,0)
 ;;6;;DOSE#^S Y=$P(BI0,U,4)^SERIES^I
"RTN","BIDE",28,0)
 ;;7;;DATE OF BIRTH (MM/DD/YYYY)^S Y=$$DOB~BIUTL1(BIDFN),Y=$$SLDT2~BIUTL5(Y)^DOB^A
"RTN","BIDE",29,0)
 ;;8;;VACCINE COMPONENT IENS^ S Y=$$VCOMPS~BIUTL2($P(BI0,U))^COMPS^I
"RTN","BIDE",30,0)
 ;;9;;VACCINE NAME, LONG^S Y=$$VNAME~BIUTL2($P(BI0,U),1)^VL^I
"RTN","BIDE",31,0)
 ;;10;;SEX^S Y=$$SEX~BIUTL1(BIDFN)^^A
"RTN","BIDE",32,0)
 ;;11;;AGE IN MONTHS (TODAY)^S Y=$$AGE~BIUTL1(BIDFN,2)^AM^A
"RTN","BIDE",33,0)
 ;;12;;AGE IN YEARS (TODAY)^S Y=$$AGE~BIUTL1(BIDFN,1)^AY^A
"RTN","BIDE",34,0)
 ;;13;;SSN#^S Y=$$SSN~BIUTL1(BIDFN)^SOC^A
"RTN","BIDE",35,0)
 ;;14;;CHART# (NO DASHES)^S Y=$$HRCN~BIUTL1(BIDFN,DUZ(2),1)^HRCN^A
"RTN","BIDE",36,0)
 ;;15;;PHONE, HOME^S Y=$$HPHONE~BIUTL1(BIDFN)^HOME^A
"RTN","BIDE",37,0)
 ;;16;;ADDRESS-STREET^S Y=$$STREET~BIUTL1(BIDFN)^ADD^A
"RTN","BIDE",38,0)
 ;;17;;ADDRESS-CITY^S Y=$$CITY~BIUTL1(BIDFN)^ADDC^A
"RTN","BIDE",39,0)
 ;;18;;ADDRESS-STATE^S Y=$$STATE~BIUTL1(BIDFN)^ADDS^A
"RTN","BIDE",40,0)
 ;;19;;ADDRESS-ZIP^S Y=$$ZIP~BIUTL1(BIDFN)^ADDZ^A
"RTN","BIDE",41,0)
 ;;20;;CURRENT COMMUNITY IEN^S Y=$$CURCOM~BIUTL11(BIDFN)^COMM^A
"RTN","BIDE",42,0)
 ;;21;;DATE OF VISIT (MM/DD/YYYY)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."),Y=$$SLDT2~BIUTL5(Y)^DOV^A
"RTN","BIDE",43,0)
 ;;23;;DATE OF VISIT IMM/SERV (MMDDYYYY)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."),Y=$$NOSLDT~BIUTL5(Y)^DOV^A
"RTN","BIDE",44,0)
 ;;24;;V FILE IEN^S Y=BIVIEN^VISIT^A
"RTN","BIDE",45,0)
 ;;25;;VACCINE CODE, HL7-CVX^S Y=$$CODE~BIUTL2($P(BI0,U))^HL7^I
"RTN","BIDE",46,0)
 ;;26;;LOCATION OF VISIT IHS/OTHER (TEXT)^S Y=$$INSTTX1~BIUTL6(BIVPTR,1)^VISIT^A
"RTN","BIDE",47,0)
 ;;27;;VACCINE GRP NAME (SERIES TYPE)^S Y=$$IMMVG~BIUTL2($P(BI0,U),1)^GROUP^I
"RTN","BIDE",48,0)
 ;;28;;DATE OF BIRTH (DD-Mmm-YYYY)^S Y=$$DOB~BIUTL1(BIDFN),Y=$$TXDT1~BIUTL5(Y)^DOB^A
"RTN","BIDE",49,0)
 ;;29;;DATE OF VISIT (DD-Mmm-YYYY @HHMM)^S Y=$$IMMDTT~BIUTL6(BIVPTR,,1)^DOV^A
"RTN","BIDE",50,0)
 ;;30;;VACCINE NAME, IEN^S Y=$P(BI0,U)^VIEN^I
"RTN","BIDE",51,0)
 ;;31;;VACCINE MAXIMUM DOSE#^S Y=$$VMAX~BIUTL2($P(BI0,U))^MAXIM^I
"RTN","BIDE",52,0)
 ;;32;;VACCINE LOT NUMBER, IEN^S Y=$P(BI0,U,5)^LOT^I
"RTN","BIDE",53,0)
 ;;33;;VACCINE LOT NUMBER, TEXT^S Y=$P(BI0,U,5) S:+Y Y=$P($G(~AUTTIML($P(BI0,U,5),0)),U)^LOT^I
"RTN","BIDE",54,0)
 ;;34;;LOCATION IEN^S Y=$P(~AUPNVSIT(BIVPTR,0),U,6)^IEN^A
"RTN","BIDE",55,0)
 ;;35;;CATEGORY OF VISIT^S Y=$P(~AUPNVSIT(BIVPTR,0),U,7)^VISIT^A
"RTN","BIDE",56,0)
 ;;36;;LOCATION OF VISIT OTHER (TEXT)^S Y=$$INSTTX1~BIUTL6(BIVPTR,1,2)^OTHER^A
"RTN","BIDE",57,0)
 ;;37;;LOCATION OF VISIT IHS (TEXT)^S Y=$$INSTTX1~BIUTL6(BIVPTR,1,1)^VISIT^A
"RTN","BIDE",58,0)
 ;;38;;SKIN TEST RESULT^S Y=$$SKRESLT~BIUTL6($P(BI0,U,4))^RES^S
"RTN","BIDE",59,0)
 ;;39;;SKIN TEST READING^S Y=$P(BI0,U,5)^READ^S
"RTN","BIDE",60,0)
 ;;40;;SKIN TEST DATE READ (MM/DD/YY)^S Y=$$SLDT2~BIUTL5($P(BI0,U,6),1)^DATE^S
"RTN","BIDE",61,0)
 ;;41;;SKIN TEST NAME^S Y=$$SKNAME~BIUTL6($P(BI0,U))^TEST^S
"RTN","BIDE",62,0)
 ;;42;;SKIN TEST NAME IEN^S Y=$P(BI0,U)^TEST^S
"RTN","BIDE",63,0)
 ;;43;;VACCINE REACTION, IEN^S Y=$P(BI0,U,6)^VRX^I
"RTN","BIDE",64,0)
 ;;44;;VACCINE REACTION, TEXT^S Y=$$REACTXT~BIUTL6($P(BI0,U,6))^VRT^I
"RTN","BIDE",65,0)
 ;;45;;MOTHER'S HBSAG STATUS^S Y=$$MOTHER~BIUTL11(BIDFN,1)^HB^A
"RTN","BIDE",66,0)
 ;;46;;PARENT OR GUARDIAN^S Y=$$PARENT~BIUTL1(BIDFN)^GUARD^A
"RTN","BIDE",67,0)
 ;;47;;CASE MANAGER^S Y=$$CMGR~BIUTL1(BIDFN)^^A
"RTN","BIDE",68,0)
 ;;48;;DATE INACTIVE (DD-Mmm-YYYY)^S Y=$$TXDT1~BIUTL5($$INACT~BIUTL1(BIDFN))^INACT^A
"RTN","BIDE",69,0)
 ;;49;;VACCINE INFO STMT (1=YES, 2=NO)^S Y=$P(BI0,U,11)^VIS^I
"RTN","BIDE",70,0)
 ;;50;;VAC INFO STMT DATE FM (YYYMMDD)^S Y=$P(BI0,U,12)^VISD^I
"RTN","BIDE",71,0)
 ;;51;;VAC INFO STMT DATE (DD-Mmm-YYYY)^S Y=$P(BI0,U,12),Y=$$TXDT1~BIUTL5(Y)^VISD^I
"RTN","BIDE",72,0)
 ;;52;;VACCINE CODE, CPT^S Y=$$CODE~BIUTL2($P(BI0,U),2)^CPT^I
"RTN","BIDE",73,0)
 ;;55;;VACCINE GRP IEN (SERIES TYPE)^S Y=$$IMMVG~BIUTL2($P(BI0,U),2)^GROUP^I
"RTN","BIDE",74,0)
 ;;56;;DATE OF VISIT FILEMAN (YYYMMDD)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),".")^DOVF^A
"RTN","BIDE",75,0)
 ;;57;;AGE AT VISIT^S Y=$$AGEF~BIUTL1(BIDFN,$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."))^AV^A
"RTN","BIDE",76,0)
 ;;58;;PATIENT DFN^S Y=BIDFN^DFN^A
"RTN","BIDE",77,0)
 ;;59;;VISIT, PPC TYPE^S Y=$P(~AUPNVSIT(+BIVPTR,0),U,3)^TYPE^A
"RTN","BIDE",78,0)
 ;;60;;DATE OF VISIT (DD-Mmm-YYYY)^S Y=$P($G(~AUPNVSIT(+BIVPTR,0)),U),Y=$$TXDT1~BIUTL5(Y)^DOV^A
"RTN","BIDE",79,0)
 ;;61;;PROVIDER, ENCOUNTER IEN^S Y=$P(BI012,U,4)^^A
"RTN","BIDE",80,0)
 ;;62;;CURRENT COMMUNITY TEXT^S Y=$$CURCOM~BIUTL11(BIDFN,1)^COMM^A
"RTN","BIDE",81,0)
 ;;63;;MOTHER'S MAIDEN NAME^S Y=$$MOTHMAID~BIUTL11(BIDFN)^MAIDEN^A
"RTN","BIDE",82,0)
 ;;64;;PATIENT BENEFICIARY TYPE^S Y=$$BENTYP~BIUTL11(BIDFN,1)^BENEFI^A
"RTN","BIDE",83,0)
 ;;65;;DOSE OVERRIDE^S Y=$P(BI0,U,8)^OVRD^I
"RTN","BIDE",84,0)
 ;;66;;DATE OF VISIT YY (MM/DD/YY)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."),Y=$$SLDT2~BIUTL5(Y,1)^DOVYY^A
"RTN","BIDE",85,0)
 ;;67;;INJECTION SITE^S Y=$P(BI0,U,9)^IS^A
"RTN","BIDE",86,0)
 ;;68;;VOLUME^S Y=$P(BI0,U,11)^^A
"RTN","BIDE",87,0)
 ;;69;;VACCINE COMPONENT CVX CODE^S Y=$$CODE~BIUTL2($P(BI0,U))^COMP^I
"RTN","BIDE",88,0)
 ;;70;;SKIN TEST READER^S Y=$P(BI0,U,8)^READER^S
"RTN","BIDE",89,0)
 ;;71;;REASON INACTIVE^S Y=$$INACTRE~BIUTL1(BIDFN)^INACT^A
"RTN","BIDE",90,0)
 ;;72;;LOCATION MOVED OR TX ELSEWHERE^S Y=$$MOVEDLOC~BIUTL1(BIDFN)^MOVED^A
"RTN","BIDE",91,0)
 ;;73;;VACCINE CODE, HL7-CVX LEADING ZERO^S Y=$$CODE~BIUTL2($P(BI0,U),6)^HL70^I
"RTN","BIDE",92,0)
 ;;74;;CPT-CODED VISIT^S Y=$P(BI0,U,13)^CPTC^I
"RTN","BIDE",93,0)
 ;;75;;PROVIDER, NAME^S Y=$P(BI012,U,4) S:Y Y=$P($G(~VA(200,Y,0)),U)^^A
"RTN","BIDE",94,0)
 ;;76;;VISIT IEN^S Y=$P(BI0,U,3)^VIEN^A
"RTN","BIDE",95,0)
 ;;77;;ELIG CODE, IEN^S Y=$P(BI0,U,14)^VFC^I
"RTN","BIDE",96,0)
 ;;78;;IMPORTED FROM OUTSIDE REGISTRY^S Y=$P(BI0,U,15)^IMPORT^I
"RTN","BIDE",97,0)
 ;;79;;CONSENT STATE REGISTRY^S Y=$$CONSENT~BIUTL1(BIDFN)^CONS^A
"RTN","BIDE",98,0)
 ;;80;;NDC CODE, IEN^S Y=$P(BI0,U,16)^NDCPTR^I
"RTN","BIDE",99,0)
 ;;82;;ELIG CODE, TEXT^S Y=$$ELIGC~BIELIG($P(BI0,U,14),1)^ELIGTX^I
"RTN","BIDE",100,0)
 ;;83;;ELIG CODE, LABEL^S Y=$$ELIGC~BIELIG($P(BI0,U,14),2)^ELIGLB^I
"RTN","BIDE",101,0)
 ;;84;;NDC CODE, TEXT^S Y=$$NDC~BINDC($P(BI0,U,16),1)^NDCTXT^I
"RTN","BIDE",102,0)
 ;;85;;DATE OF EVENT OR VISIT (MM/DD/YY)^S Y=$$IMMDTT~BIUTL6(BIVPTR,$G(BI012))^DATEVT^A
"RTN","BIDE",103,0)
 ;;86;;DATE OF EVENT OR VISIT (YYYMMDD)^S Y=$$IMMDTT~BIUTL6(BIVPTR,$G(BI012),2)^DOEVFM^A
"RTN","BIDE",104,0)
 ;;87;;ADMINISTRATIVE NOTE^S Y=$P(BI01,U,1)^BIANOT^A
"RTN","BIDE",105,0)
 ;;88;;DATE OF VISIT TCH (YYYYMMDD)^S Y=$P($P($G(~AUPNVSIT(+BIVPTR,0)),U),"."),Y=$$FMTCHDT~BIUTL5(Y)^DOVTCH^A
"RTN","BIDE",106,0)
 ;;89;;DATE VIS PRESENTED FM (YYYMMDD)^S Y=$P(BI0,U,17)^DATVIS^I
"RTN","BIDE",107,0)
 ;;90;;DATE VIS PRESENTED (MM/DD/YY)^I $P(BI0,U,17) S Y=$$SLDT2~BIUTL5($P(BI0,U,17))^DTVISL^I
"RTN","BIDE",108,0)
 ;;91;;DATE ADMIN SHOT--EVENT ONLY^S Y=$$IMMDTT~BIUTL6(,$G(BI012))^DADMIN^I
"RTN","BIDE",109,0)
 ;;92;;SKIN TEST LOT NUMBER IEN^S Y=$P(BI0,U,14)^SK LOT^S
"RTN","BIDE",110,0)
 ;;93;;SKIN TEST LOT NUMBER TEXT^S Y=$P(BI0,U,14) S:+Y Y=$P($G(~AUTTIML($P(BI0,U,14),0)),U)^SK LOT^S
"RTN","BIENVCHK")
0^13^B16976563
"RTN","BIENVCHK",1,0)
BIENVCHK ;IHS/CMI/MWR - ENVIRONMENTAL CHECK FOR KIDS; DEC 15, 2010
"RTN","BIENVCHK",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BIENVCHK",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIENVCHK",4,0)
 ;;  ENVIRONMENTAL CHECK ROUTINE FOR KIDS INSTALLATION.
"RTN","BIENVCHK",5,0)
 ;;  PATCH 10, v8.5: Check environment for Imm v8.5 Patch 9. START+63
"RTN","BIENVCHK",6,0)
 ;;
"RTN","BIENVCHK",7,0)
 ;
"RTN","BIENVCHK",8,0)
 ;
"RTN","BIENVCHK",9,0)
 ;----------
"RTN","BIENVCHK",10,0)
START ;EP
"RTN","BIENVCHK",11,0)
 ;
"RTN","BIENVCHK",12,0)
 I '$G(DUZ) W !,"DUZ UNDEFINED OR 0." D SORRY(2) Q
"RTN","BIENVCHK",13,0)
 ;
"RTN","BIENVCHK",14,0)
 I '$L($G(DUZ(0))) W !,"DUZ(0) UNDEFINED OR NULL." D SORRY(2) Q
"RTN","BIENVCHK",15,0)
 ;
"RTN","BIENVCHK",16,0)
 N X,Z
"RTN","BIENVCHK",17,0)
 S X=$P(^VA(200,DUZ,0),U)
"RTN","BIENVCHK",18,0)
 W !!,$$CJ^XLFSTR("Hello, "_$P(X,",",2)_" "_$P(X,","),IOM)
"RTN","BIENVCHK",19,0)
 S X="Checking Environment for "_$P($T(+2),";",4)_" v"_$P($T(+2),";",3)
"RTN","BIENVCHK",20,0)
 S Z=$P($P($T(+2),";",5),"**",2)
"RTN","BIENVCHK",21,0)
 S:Z X=X_", Patch "_Z_"."
"RTN","BIENVCHK",22,0)
 W !!,$$CJ^XLFSTR(X,IOM),!
"RTN","BIENVCHK",23,0)
 ;
"RTN","BIENVCHK",24,0)
 S XPDQUIT=0
"RTN","BIENVCHK",25,0)
 ;
"RTN","BIENVCHK",26,0)
 ;---> REQUIREMENTS
"RTN","BIENVCHK",27,0)
 ;
"RTN","BIENVCHK",28,0)
 ;---> Kernel v8.
"RTN","BIENVCHK",29,0)
 I '$$VCHK("XU","8.0",2) S XPDQUIT=2
"RTN","BIENVCHK",30,0)
 ;
"RTN","BIENVCHK",31,0)
 ;
"RTN","BIENVCHK",32,0)
 ;---> Fileman v22.
"RTN","BIENVCHK",33,0)
 I '$$VCHK("DI","22",2) S XPDQUIT=2
"RTN","BIENVCHK",34,0)
 ;
"RTN","BIENVCHK",35,0)
 ;
"RTN","BIENVCHK",36,0)
 ;I '$$VCHK("AUT","98.1",2) S XPDQUIT=2
"RTN","BIENVCHK",37,0)
 ;S X=$$LAST("IHS DICTIONARIES (POINTERS)","98.1")
"RTN","BIENVCHK",38,0)
 ;I $P(X,U,1)'=14&($P(X,U,1)'>14) D  S XPDQUIT=2
"RTN","BIENVCHK",39,0)
 ;.W !,$$CJ^XLFSTR("AUT v98.1 Patch 14 NOT INSTALLED",IOM)
"RTN","BIENVCHK",40,0)
 ;
"RTN","BIENVCHK",41,0)
 ;---> XB/ZIB v3.0 patch 11.
"RTN","BIENVCHK",42,0)
 ;I '$$VCHK("XB","3.0",2) S XPDQUIT=2
"RTN","BIENVCHK",43,0)
 ;S X=$$LAST("IHS/VA UTILITIES","3.0")
"RTN","BIENVCHK",44,0)
 ;I $P(X,U)'=11&($P(X,U)'>11) D  S XPDQUIT=2
"RTN","BIENVCHK",45,0)
 ;.W !,$$CJ^XLFSTR("XB/ZIB v3.0 patch 11 NOT INSTALLED",IOM)
"RTN","BIENVCHK",46,0)
 ;
"RTN","BIENVCHK",47,0)
 ;---> IHS PCC REPORTS v3.0 patch 29.
"RTN","BIENVCHK",48,0)
 ;I '$$VCHK("APCL","3.0",2) S XPDQUIT=2
"RTN","BIENVCHK",49,0)
 ;S X=$$LAST("IHS PCC REPORTS","3.0")
"RTN","BIENVCHK",50,0)
 ;I $P(X,U)'=29&($P(X,U)'>29) D  S XPDQUIT=2
"RTN","BIENVCHK",51,0)
 ;.W !,$$CJ^XLFSTR("IHS PCC REPORTS v3.0 patch 29 NOT INSTALLED",IOM)
"RTN","BIENVCHK",52,0)
 ;
"RTN","BIENVCHK",53,0)
 ;---> PCC Suite v2.0 patch 2.
"RTN","BIENVCHK",54,0)
 ;I '$$VCHK("BJPC","2.0",2) S XPDQUIT=2
"RTN","BIENVCHK",55,0)
 ;S X=$$LAST("IHS PCC SUITE","2.0")
"RTN","BIENVCHK",56,0)
 ;I $P(X,U)'=2&($P(X,U)'>2) D  S XPDQUIT=2
"RTN","BIENVCHK",57,0)
 ;.W !,$$CJ^XLFSTR("BJPC v2.0 Patch 2 NOT INSTALLED",IOM)
"RTN","BIENVCHK",58,0)
 ;
"RTN","BIENVCHK",59,0)
 ;
"RTN","BIENVCHK",60,0)
 ;---> IHS Clinical Reporting System v9.0 patch 1.
"RTN","BIENVCHK",61,0)
 ;I '$$VCHK("BGP","9.0",2) S XPDQUIT=2
"RTN","BIENVCHK",62,0)
 ;S X=$$LAST("IHS CLINICAL REPORTING","9.0")
"RTN","BIENVCHK",63,0)
 ;I $P(X,U)'=1&($P(X,U)'>1) D  S XPDQUIT=2
"RTN","BIENVCHK",64,0)
 ;.W !,$$CJ^XLFSTR("BGP v9.0 Patch 1 NOT INSTALLED",IOM)
"RTN","BIENVCHK",65,0)
 ;
"RTN","BIENVCHK",66,0)
 ;---> IHS PCC REPORTS v3.0 patch 29.
"RTN","BIENVCHK",67,0)
 ;I '$$VCHK("APCL","3.0",2) S XPDQUIT=2
"RTN","BIENVCHK",68,0)
 ;S X=$$LAST("IHS PCC REPORTS","3.0")
"RTN","BIENVCHK",69,0)
 ;I $P(X,U)'=29&($P(X,U)'>29) D  S XPDQUIT=2
"RTN","BIENVCHK",70,0)
 ;.W !,$$CJ^XLFSTR("IHS PCC REPORTS v3.0 patch 29 NOT INSTALLED",IOM)
"RTN","BIENVCHK",71,0)
 ;
"RTN","BIENVCHK",72,0)
 ;
"RTN","BIENVCHK",73,0)
 ;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BIENVCHK",74,0)
 ;---> Check environment for previous load of Imm v8.5.
"RTN","BIENVCHK",75,0)
 I '$$VCHK("BI","8.5",2) S XPDQUIT=2
"RTN","BIENVCHK",76,0)
 ;
"RTN","BIENVCHK",77,0)
 ;---> Check Patch Level of Imm.
"RTN","BIENVCHK",78,0)
 ;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BIENVCHK",79,0)
 ;---> Check for Imm v8.5, required patch.
"RTN","BIENVCHK",80,0)
 D
"RTN","BIENVCHK",81,0)
 .S X=$$LAST("IMMUNIZATION","8.5")
"RTN","BIENVCHK",82,0)
 .;---> Patch 9.
"RTN","BIENVCHK",83,0)
 .I $P(X,U)'=9&($P(X,U)'>9) D  S XPDQUIT=2
"RTN","BIENVCHK",84,0)
 ..W !,$$CJ^XLFSTR("BI v8.5 Patch 9 NOT INSTALLED",IOM)
"RTN","BIENVCHK",85,0)
 .;
"RTN","BIENVCHK",86,0)
 .I XPDQUIT'=2 D
"RTN","BIENVCHK",87,0)
 ..W !,$$CJ^XLFSTR("Checking for Patch 9 of BI v8.5...Patch 9 Present",IOM)
"RTN","BIENVCHK",88,0)
 ;**********
"RTN","BIENVCHK",89,0)
 ;
"RTN","BIENVCHK",90,0)
 ;---> Check for multiple BI entries in the Package File.
"RTN","BIENVCHK",91,0)
 N DA,DIC
"RTN","BIENVCHK",92,0)
 S X="BI",DIC="^DIC(9.4,",DIC(0)="",D="C"
"RTN","BIENVCHK",93,0)
 D IX^DIC
"RTN","BIENVCHK",94,0)
 I Y<0,$D(^DIC(9.4,"C","BI")) D  S XPDQUIT=2
"RTN","BIENVCHK",95,0)
 .W !!,$$CJ^XLFSTR("You Have More Than One Entry In The",IOM)
"RTN","BIENVCHK",96,0)
 .W !,$$CJ^XLFSTR("PACKAGE File with a ""BI"" prefix.",IOM)
"RTN","BIENVCHK",97,0)
 .W !,$$CJ^XLFSTR("One entry needs to be deleted.",IOM)
"RTN","BIENVCHK",98,0)
 .W !,$$CJ^XLFSTR("Please do this before Proceeding.",IOM),!!
"RTN","BIENVCHK",99,0)
 .Q
"RTN","BIENVCHK",100,0)
 ;
"RTN","BIENVCHK",101,0)
 ;---> Do not allow KIDS installation to be queued (at DEVICE: prompt).
"RTN","BIENVCHK",102,0)
 S XPDNOQUE=1
"RTN","BIENVCHK",103,0)
 ;---> Do not ask "DISABLE Options...etc.?" question.
"RTN","BIENVCHK",104,0)
 S XPDDIQ("XPZ1")=0
"RTN","BIENVCHK",105,0)
 ;---> Do not ask "MOVE routines to other CPUs?" question.
"RTN","BIENVCHK",106,0)
 S XPDDIQ("XPZ2")=0
"RTN","BIENVCHK",107,0)
 ;
"RTN","BIENVCHK",108,0)
 I XPDQUIT D SORRY(XPDQUIT) Q
"RTN","BIENVCHK",109,0)
 ;
"RTN","BIENVCHK",110,0)
 W !!,$$CJ^XLFSTR("ENVIRONMENT OK.",IOM)
"RTN","BIENVCHK",111,0)
 ;
"RTN","BIENVCHK",112,0)
 I '$$DIR^XBDIR("E","","","","","",1) D SORRY(2) Q
"RTN","BIENVCHK",113,0)
 Q
"RTN","BIENVCHK",114,0)
 ;
"RTN","BIENVCHK",115,0)
SORRY(X) ;
"RTN","BIENVCHK",116,0)
 KILL DIFQ
"RTN","BIENVCHK",117,0)
 S XPDQUIT=X
"RTN","BIENVCHK",118,0)
 W:'$D(ZTQUEUED) !,$$CJ^XLFSTR("Sorry...",IOM),$$DIR^XBDIR("E","Press RETURN")
"RTN","BIENVCHK",119,0)
 Q
"RTN","BIENVCHK",120,0)
 ;
"RTN","BIENVCHK",121,0)
VCHK(ABMPRE,ABMVER,ABMQUIT) ; Check versions needed.
"RTN","BIENVCHK",122,0)
 ;
"RTN","BIENVCHK",123,0)
 NEW ABMV
"RTN","BIENVCHK",124,0)
 S ABMV=$$VERSION^XPDUTL(ABMPRE)
"RTN","BIENVCHK",125,0)
 W !,$$CJ^XLFSTR("Need at least "_ABMPRE_" v"_ABMVER_"..."_ABMPRE_" v"_ABMV_" Present",IOM)
"RTN","BIENVCHK",126,0)
 I ABMV<ABMVER W !,$$CJ^XLFSTR("^^^^**NEEDS TO BE INSTALLED**^^^^",IOM) Q 0
"RTN","BIENVCHK",127,0)
 Q 1
"RTN","BIENVCHK",128,0)
 ;
"RTN","BIENVCHK",129,0)
LAST(PKG,VER) ;EP - returns last patch applied for a Package, PATCH^DATE
"RTN","BIENVCHK",130,0)
 ;        Patch includes Seq # if Released
"RTN","BIENVCHK",131,0)
 N PKGIEN,VERIEN,LATEST,PATCH,SUBIEN
"RTN","BIENVCHK",132,0)
 I $G(VER)="" S VER=$$VERSION^XPDUTL(PKG) Q:'VER -1
"RTN","BIENVCHK",133,0)
 S PKGIEN=$O(^DIC(9.4,"B",PKG,"")) Q:'PKGIEN -1
"RTN","BIENVCHK",134,0)
 S VERIEN=$O(^DIC(9.4,PKGIEN,22,"B",VER,"")) Q:'VERIEN -1
"RTN","BIENVCHK",135,0)
 S LATEST=-1,PATCH=-1,SUBIEN=0
"RTN","BIENVCHK",136,0)
 F  S SUBIEN=$O(^DIC(9.4,PKGIEN,22,VERIEN,"PAH",SUBIEN)) Q:SUBIEN'>0  D
"RTN","BIENVCHK",137,0)
 . I $P(^DIC(9.4,PKGIEN,22,VERIEN,"PAH",SUBIEN,0),U,2)>LATEST S LATEST=$P(^(0),U,2),PATCH=$P(^(0),U)
"RTN","BIENVCHK",138,0)
 . I $P(^DIC(9.4,PKGIEN,22,VERIEN,"PAH",SUBIEN,0),U,2)=LATEST,$P(^(0),U)>PATCH S PATCH=$P(^(0),U)
"RTN","BIENVCHK",139,0)
 Q PATCH_U_LATEST
"RTN","BILETPR1")
0^5^B124280634
"RTN","BILETPR1",1,0)
BILETPR1 ;IHS/CMI/MWR - PRINT PATIENT LETTERS.; DEC 15, 2011
"RTN","BILETPR1",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BILETPR1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILETPR1",4,0)
 ;;  BUILD ^TMP WP ARRAY FOR PRINTING LETTERS.
"RTN","BILETPR1",5,0)
 ;;  PATCH 10: If no skin tests on record, display explicitly. HISTORY1+190
"RTN","BILETPR1",6,0)
 ;;            Display only the most recent three dates of Skin Tests. HISTORY1+209
"RTN","BILETPR1",7,0)
 ;
"RTN","BILETPR1",8,0)
 ;
"RTN","BILETPR1",9,0)
 ;----------
"RTN","BILETPR1",10,0)
BUILD(BIDFN,BILET,BIDLOC,BIFDT) ;EP
"RTN","BILETPR1",11,0)
 ;---> Build temporary global of populated letter in ^TMP("BILET",$J).
"RTN","BILETPR1",12,0)
 ;---> Parameters:
"RTN","BILETPR1",13,0)
 ;     1 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR1",14,0)
 ;     2 - BILET  (req) IEN of Letter in BI LETTER File.
"RTN","BILETPR1",15,0)
 ;     3 - BIDLOC (opt) Text of Date/Location line.
"RTN","BILETPR1",16,0)
 ;     4 - BIFDT  (opt) Forecast Date.
"RTN","BILETPR1",17,0)
 ;
"RTN","BILETPR1",18,0)
 K ^TMP("BILET",$J)
"RTN","BILETPR1",19,0)
 N BILINE,BI31 S BILINE=0,BI31=$C(31)_$C(31)
"RTN","BILETPR1",20,0)
 ;
"RTN","BILETPR1",21,0)
 ;---> Error check.
"RTN","BILETPR1",22,0)
 N BIERR S BIERR=""
"RTN","BILETPR1",23,0)
 D  I BIERR]"" D WRITE(.BILINE,BIERR) Q
"RTN","BILETPR1",24,0)
 .I '$G(BIDFN) D ERRCD^BIUTL2(201,.BIERR) Q
"RTN","BILETPR1",25,0)
 .I '$D(^DPT(BIDFN,0)) D ERRCD^BIUTL2(203,.BIERR) Q
"RTN","BILETPR1",26,0)
 .I '$G(BILET) D ERRCD^BIUTL2(609,.BIERR) Q
"RTN","BILETPR1",27,0)
 .I '$D(^BILET(BILET,0)) D ERRCD^BIUTL2(610,.BIERR) Q
"RTN","BILETPR1",28,0)
 .S:'$G(BIFDT) BIFDT=DT
"RTN","BILETPR1",29,0)
 ;
"RTN","BILETPR1",30,0)
 ;---> Get forecast string (BIFORCST) and problem dose string (BIPDSS).
"RTN","BILETPR1",31,0)
 ;---> Pass BIPDSS to HISTORY to mark problem doses with asterisks.
"RTN","BILETPR1",32,0)
 ;---> Pass BIFORCST to FORECAST for display.
"RTN","BILETPR1",33,0)
 N BIFORCST,BIPDSS S BIPDSS=""
"RTN","BILETPR1",34,0)
 D IMMFORC^BIRPC(.BIFORCST,BIDFN,BIFDT,,$G(BIDUZ2),.BIPDSS)
"RTN","BILETPR1",35,0)
 ;---> If Forecast comes first, set BIFF=1
"RTN","BILETPR1",36,0)
 N BIFF S BIFF=$P(^BILET(BILET,0),U,6)
"RTN","BILETPR1",37,0)
 ;
"RTN","BILETPR1",38,0)
 ;---> Retrieve and store sections of letter in WP ^TMP global.
"RTN","BILETPR1",39,0)
 D SECTION(BILET,.BILINE,1)
"RTN","BILETPR1",40,0)
 D
"RTN","BILETPR1",41,0)
 .I BIFF D FORECAST(BILET,.BILINE,BIFORCST,BIFDT) Q
"RTN","BILETPR1",42,0)
 .D HISTORY(BILET,.BILINE,BIDFN,BIPDSS)
"RTN","BILETPR1",43,0)
 D SECTION(BILET,.BILINE,2)
"RTN","BILETPR1",44,0)
 D
"RTN","BILETPR1",45,0)
 .I BIFF D HISTORY(BILET,.BILINE,BIDFN,BIPDSS) Q
"RTN","BILETPR1",46,0)
 .D FORECAST(BILET,.BILINE,BIFORCST,BIFDT)
"RTN","BILETPR1",47,0)
 D SECTION(BILET,.BILINE,3)
"RTN","BILETPR1",48,0)
 D DATELOC(BILET,.BILINE,BIDLOC)
"RTN","BILETPR1",49,0)
 D SECTION(BILET,.BILINE,4)
"RTN","BILETPR1",50,0)
 Q
"RTN","BILETPR1",51,0)
 ;
"RTN","BILETPR1",52,0)
 ;
"RTN","BILETPR1",53,0)
 ;----------
"RTN","BILETPR1",54,0)
SECTION(BILET,BILINE,BISEC) ;EP
"RTN","BILETPR1",55,0)
 ;---> Store Section of letter in ^TMP("BILET",$J).
"RTN","BILETPR1",56,0)
 ;---> Parameters:
"RTN","BILETPR1",57,0)
 ;     1 - BILET  (req) IEN of Letter in BI LETTER File.
"RTN","BILETPR1",58,0)
 ;     2 - BILINE (ret) Last line written into ^TMP array.
"RTN","BILETPR1",59,0)
 ;     3 - BISEC  (req) Section of Form Letter to retrieve.
"RTN","BILETPR1",60,0)
 ;
"RTN","BILETPR1",61,0)
 N N S N=0
"RTN","BILETPR1",62,0)
 F  S N=$O(^BILET(BILET,BISEC,N)) Q:'N  D
"RTN","BILETPR1",63,0)
 .D WRITE(.BILINE,^BILET(BILET,BISEC,N,0))
"RTN","BILETPR1",64,0)
 Q
"RTN","BILETPR1",65,0)
 ;
"RTN","BILETPR1",66,0)
 ;
"RTN","BILETPR1",67,0)
 ;----------
"RTN","BILETPR1",68,0)
HISTORY(BILET,BILINE,BIDFN,BIPDSS) ;EP
"RTN","BILETPR1",69,0)
 ;---> Retrieve and store Imm History in WP ^TMP global.
"RTN","BILETPR1",70,0)
 ;---> Parameters:
"RTN","BILETPR1",71,0)
 ;     1 - BILET  (req) IEN of Letter in BI LETTER File.
"RTN","BILETPR1",72,0)
 ;     2 - BILINE (ret) Last line written into ^TMP array.
"RTN","BILETPR1",73,0)
 ;     3 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR1",74,0)
 ;     4 - BIPDSS (opt) Returned string of Visit IEN's that are Problem Doses,
"RTN","BILETPR1",75,0)
 ;
"RTN","BILETPR1",76,0)
 ;---> Quit if this Form Letter does not included Imm History.
"RTN","BILETPR1",77,0)
 N BIFORM S BIFORM=$P(^BILET(BILET,0),U,2)
"RTN","BILETPR1",78,0)
 N BINVAL S BINVAL=+$P(^BILET(BILET,0),U,5)
"RTN","BILETPR1",79,0)
 Q:'BIFORM
"RTN","BILETPR1",80,0)
 ;
"RTN","BILETPR1",81,0)
 ;---> If History should be listed by Date, BIFORM=1 or 2;
"RTN","BILETPR1",82,0)
 ;---> If History should be listed by Vaccine, BIFORM=3 or 4.
"RTN","BILETPR1",83,0)
 D WRITE(.BILINE)
"RTN","BILETPR1",84,0)
 D HISTORY1(.BILINE,BIDFN,BIFORM,BINVAL,"BILET",BIPDSS)
"RTN","BILETPR1",85,0)
 D WRITE(.BILINE)
"RTN","BILETPR1",86,0)
 D CONTRAS(.BILINE,BIDFN,"BILET")
"RTN","BILETPR1",87,0)
 D WRITE(.BILINE)
"RTN","BILETPR1",88,0)
 Q
"RTN","BILETPR1",89,0)
 ;
"RTN","BILETPR1",90,0)
 ;
"RTN","BILETPR1",91,0)
 ;----------
"RTN","BILETPR1",92,0)
HISTORY1(BILINE,BIDFN,BIFORM,BINVAL,BIGBL,BIPDSS,BIHDRS,BINOSK,BILOC,BIMMRF,BIMMLF) ;EP
"RTN","BILETPR1",93,0)
 ;---> Retrieve and store Imm History in WP ^TMP global.
"RTN","BILETPR1",94,0)
 ;---> Parameters:
"RTN","BILETPR1",95,0)
 ;     1 - BILINE (ret) Last line written into ^TMP array.
"RTN","BILETPR1",96,0)
 ;     2 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR1",97,0)
 ;     3 - BIFORM (opt) 1=List by Date (default), 2=by Date w/Lot#,
"RTN","BILETPR1",98,0)
 ;                      3=List by Vaccine, 4=by Vaccine w/Lot#,
"RTN","BILETPR1",99,0)
 ;                      5=by Date w/VFC, 6=by Vaccine w/VFC
"RTN","BILETPR1",100,0)
 ;                      7=by Date w/Lot & VFC, 8=by Vaccine w/Lot & VFC.
"RTN","BILETPR1",101,0)
 ;     4 - BINVAL (opt) 0=Include Invalid Doses, 1=Exclude Invalid Doses.
"RTN","BILETPR1",102,0)
 ;     5 - BIGBL  (opt) ^TMP global node to write to (def="BILET").
"RTN","BILETPR1",103,0)
 ;     6 - BIPDSS (opt) Returned string of Visit IEN's that are
"RTN","BILETPR1",104,0)
 ;                        Problem Doses, according to ImmServe.
"RTN","BILETPR1",105,0)
 ;     7 - BIHDRS (opt) 0=Print Imm and Skin Subheaders; 1=No Subeaders.
"RTN","BILETPR1",106,0)
 ;     8 - BINOSK (opt) 0=Include Skin Tests, 1=Do not include Skin Tests
"RTN","BILETPR1",107,0)
 ;                      2=Include Skin Tests ONLY (NO Immunizations).
"RTN","BILETPR1",108,0)
 ;     9 - BILOC  (opt) 1=Add Location in the form: [4-char] for BIFORM 1&2.
"RTN","BILETPR1",109,0)
 ;    10 - BIMMRF (opt) Imms Received Filter array (subscript=CVX's included).
"RTN","BILETPR1",110,0)
 ;    11 - BIMMLF (opt) Lot Number Filter array (subscript=lot number text).
"RTN","BILETPR1",111,0)
 ;
"RTN","BILETPR1",112,0)
 S:$G(BIGBL)="" BIGBL="BILET"
"RTN","BILETPR1",113,0)
 S:$G(BIFORM)="" BIFORM=1 S:$G(BINVAL)="" BINVAL=0
"RTN","BILETPR1",114,0)
 ;
"RTN","BILETPR1",115,0)
 ;---> RPC to gather Immunization History.
"RTN","BILETPR1",116,0)
 ;     BIRETVAL - Return value of valid data from RPC.
"RTN","BILETPR1",117,0)
 ;     BIRETERR - Return value (text string) of error from RPC.
"RTN","BILETPR1",118,0)
 ;
"RTN","BILETPR1",119,0)
 N BIDE,BIRETVAL,BIRETERR,I S BIRETVAL=""
"RTN","BILETPR1",120,0)
 ;
"RTN","BILETPR1",121,0)
 ;---> Set BIDE local array for Data Elements to be returned.
"RTN","BILETPR1",122,0)
 ;---> The following are IEN's in ^BIEXPDD(.
"RTN","BILETPR1",123,0)
 ;---> IEN PC  DATA
"RTN","BILETPR1",124,0)
 ;---> --- --  ----
"RTN","BILETPR1",125,0)
 ;--->     1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BILETPR1",126,0)
 ;--->  4  2 = Vaccine Name, Short.
"RTN","BILETPR1",127,0)
 ;--->  8  3 = Vaccine Components.  ;v8.0
"RTN","BILETPR1",128,0)
 ;---> 24  4 = IEN, V File Visit.
"RTN","BILETPR1",129,0)
 ;---> 26  5 = Location (or Outside Location) where Imm was given.
"RTN","BILETPR1",130,0)
 ;---> 27  6 = Vaccine Group (Series Type) for grouping of vaccines.
"RTN","BILETPR1",131,0)
 ;---> 33  7 = Vaccine Lot#, Text.
"RTN","BILETPR1",132,0)
 ;---> 38  8 = Skin Test Result.
"RTN","BILETPR1",133,0)
 ;---> 39  9 = Skin Test Reading.
"RTN","BILETPR1",134,0)
 ;---> 41 10 = Skin Test Name.
"RTN","BILETPR1",135,0)
 ;---> 44 11 = Reaction to Immunization, text.
"RTN","BILETPR1",136,0)
 ;---> 56 12 = Date of Visit Fileman format (YYYMMDD).
"RTN","BILETPR1",137,0)
 ;---> 65 13 = Dose Override.
"RTN","BILETPR1",138,0)
 ;---> 69 14 = Vaccine Component CVX Code.
"RTN","BILETPR1",139,0)
 ;---> 77 15 = VFC for this immunization.
"RTN","BILETPR1",140,0)
 ;
"RTN","BILETPR1",141,0)
 ;
"RTN","BILETPR1",142,0)
 F I=4,8,24,26,27,33,38,39,41,44,56,65,69,77 S BIDE(I)=""
"RTN","BILETPR1",143,0)
 D IMMHX^BIRPC(.BIRETVAL,BIDFN,.BIDE,1,0)
"RTN","BILETPR1",144,0)
 ;
"RTN","BILETPR1",145,0)
 ;---> If BIRETERR has a value, store it and quit.
"RTN","BILETPR1",146,0)
 S BIRETERR=$P(BIRETVAL,BI31,2)
"RTN","BILETPR1",147,0)
 I BIRETERR]"" D  Q
"RTN","BILETPR1",148,0)
 .D WRITE(.BILINE,"     "_BIRETERR,BIGBL)
"RTN","BILETPR1",149,0)
 .D WRITE(.BILINE,,BIGBL)
"RTN","BILETPR1",150,0)
 ;
"RTN","BILETPR1",151,0)
 ;---> Set BIHX=to a valid Immunization History for this patient.
"RTN","BILETPR1",152,0)
 N BIHX S BIHX=$P(BIRETVAL,BI31,1)
"RTN","BILETPR1",153,0)
 ;
"RTN","BILETPR1",154,0)
 ;---> Build Listmanager array from BIHX string.
"RTN","BILETPR1",155,0)
 ;
"RTN","BILETPR1",156,0)
 ;---> List Immunization (and Skin Test)  History by Vaccine, and quit.
"RTN","BILETPR1",157,0)
 I (BIFORM=3)!(BIFORM=4) D HISTORY2^BILETPR3(.BILINE,BIHX,BIDFN,BIFORM,BINVAL,BIPDSS) Q
"RTN","BILETPR1",158,0)
 ;
"RTN","BILETPR1",159,0)
 D:$G(BINOSK)'=2 WRITE(.BILINE,,BIGBL)
"RTN","BILETPR1",160,0)
 ;
"RTN","BILETPR1",161,0)
 N BIAR,I,V,Y S V="|"
"RTN","BILETPR1",162,0)
 ;
"RTN","BILETPR1",163,0)
 ;---> List Immunization History by Date (if call is not for Skin Test ONLY).
"RTN","BILETPR1",164,0)
 ;---> Loop through "^"-pieces of Imm History, getting data.
"RTN","BILETPR1",165,0)
 I $G(BINOSK)'=2 F I=1:1 S Y=$P(BIHX,U,I) Q:Y=""  D
"RTN","BILETPR1",166,0)
 .;---> Quit if this is not an Immunization.
"RTN","BILETPR1",167,0)
 .Q:$P(Y,V)'="I"
"RTN","BILETPR1",168,0)
 .;
"RTN","BILETPR1",169,0)
 .;---> Set BIPD=1 if Immserve has a problem with this dose.
"RTN","BILETPR1",170,0)
 .N BIPD S BIPD=$$PDSS^BIUTL8($P(Y,V,4),$P(Y,V,14),$G(BIPDSS))
"RTN","BILETPR1",171,0)
 .;
"RTN","BILETPR1",172,0)
 .;---> Quit if not displaying Invalid Doses (but will display a Forced Valid).
"RTN","BILETPR1",173,0)
 .;Q:((BINVAL=1)&(($P(Y,V,13)&($P(Y,V,13)'=9))!BIPD))
"RTN","BILETPR1",174,0)
 .;
"RTN","BILETPR1",175,0)
 .;---> Do not display if this vaccine is not in the display filter array.
"RTN","BILETPR1",176,0)
 .I $D(BIMMRF) Q:('$D(BIMMRF(+$P(Y,V,14))))
"RTN","BILETPR1",177,0)
 .;
"RTN","BILETPR1",178,0)
 .;---> Do not display if this lot number is not in the display filter array.
"RTN","BILETPR1",179,0)
 .I $D(BIMMLF) Q:('$D(BIMMLF(+$P(Y,V,7))))
"RTN","BILETPR1",180,0)
 .;
"RTN","BILETPR1",181,0)
 .;---> Set Vaccine Name.
"RTN","BILETPR1",182,0)
 .N X S X=$P(Y,V,2)
"RTN","BILETPR1",183,0)
 .;
"RTN","BILETPR1",184,0)
 .;---> Tack on Lot# if specified.
"RTN","BILETPR1",185,0)
 .N BILOT S BILOT=$P(Y,V,7)
"RTN","BILETPR1",186,0)
 .S:((BIFORM=2)&(BILOT]"")) X=X_" (#"_BILOT_")"
"RTN","BILETPR1",187,0)
 .;
"RTN","BILETPR1",188,0)
 .;---> Tack on VFC if specified.
"RTN","BILETPR1",189,0)
 .N BIVFC S BIVFC=$P(Y,V,15)
"RTN","BILETPR1",190,0)
 .S:((BIFORM=5)&(BIVFC>1)) X=X_" (VFC+)"
"RTN","BILETPR1",191,0)
 .;
"RTN","BILETPR1",192,0)
 .;---> Tack on Lot# & VFC if specified.
"RTN","BILETPR1",193,0)
 .I BIFORM=7 D
"RTN","BILETPR1",194,0)
 ..I (BILOT="")&(BIVFC<2) Q
"RTN","BILETPR1",195,0)
 ..S X=X_" ("
"RTN","BILETPR1",196,0)
 ..I BILOT]"" S X=X_"#"_BILOT
"RTN","BILETPR1",197,0)
 ..I (BILOT]"")&(BIVFC>1) S X=X_", "
"RTN","BILETPR1",198,0)
 ..I BIVFC>1 S X=X_"VFC+"
"RTN","BILETPR1",199,0)
 ..S X=X_")"
"RTN","BILETPR1",200,0)
 .;
"RTN","BILETPR1",201,0)
 .;---> Tack on Location if specified.
"RTN","BILETPR1",202,0)
 .S:$G(BILOC) X=X_" ["_$E($P(Y,V,5),1,4)_"]"
"RTN","BILETPR1",203,0)
 .;
"RTN","BILETPR1",204,0)
 .;---> If this Dose has a User Override or is an ImmServe Problem Dose,
"RTN","BILETPR1",205,0)
 .;---> prepend an asterisk and tack the reason on the end.
"RTN","BILETPR1",206,0)
 .D
"RTN","BILETPR1",207,0)
 ..I $P(Y,V,13) D  Q
"RTN","BILETPR1",208,0)
 ...;---> But don't display text "Force Valid" ($P(Y,V,13)'=9).
"RTN","BILETPR1",209,0)
 ...S X="*"_X
"RTN","BILETPR1",210,0)
 ...;---> Next line would display Invalid Reason.
"RTN","BILETPR1",211,0)
 ...;I $P(Y,V,13)'=9 S X=X_"-"_$$DOVER^BIUTL8($P(Y,V,13))_"-"
"RTN","BILETPR1",212,0)
 ..;
"RTN","BILETPR1",213,0)
 ..S:BIPD X="*"_X
"RTN","BILETPR1",214,0)
 ..;---> Next line would display Immserve problem.
"RTN","BILETPR1",215,0)
 ..;_"-INVALID--SEE IMMSERVE-"
"RTN","BILETPR1",216,0)
 .;
"RTN","BILETPR1",217,0)
 .;---> If there was a Reaction, tack it on.
"RTN","BILETPR1",218,0)
 .I $P(Y,V,11)]"" S X=X_" Reaction: "_$P(Y,V,11)
"RTN","BILETPR1",219,0)
 .;
"RTN","BILETPR1",220,0)
 .;---> Set this Immunization in the array:
"RTN","BILETPR1",221,0)
 .;---> BIAR(VisitDate,VaccineName,VisitIEN)=VaccineName (Lot#)--Problem Dose
"RTN","BILETPR1",222,0)
 .S BIAR($P(Y,V,12),$P(Y,V,2),$P(Y,V,4))=X
"RTN","BILETPR1",223,0)
 ;
"RTN","BILETPR1",224,0)
 ;---> Build Imm History lines for History Section of Form Letter.
"RTN","BILETPR1",225,0)
 N N S N=0
"RTN","BILETPR1",226,0)
 F  S N=$O(BIAR(N)) Q:'N  D
"RTN","BILETPR1",227,0)
 .N BIHXLN
"RTN","BILETPR1",228,0)
 .S BIHXLN=$$SLDT2^BIUTL5(N,1)_": "
"RTN","BILETPR1",229,0)
 .N I,M S M=0
"RTN","BILETPR1",230,0)
 .;---> Note: I and J below are counters for inserting ", ".
"RTN","BILETPR1",231,0)
 .;---> In v8.1 come back here and allow for extremely long immunizations
"RTN","BILETPR1",232,0)
 .;---> that have Combo name + Lot# + Invalid text + reaction text.
"RTN","BILETPR1",233,0)
 .F I=1:1 S M=$O(BIAR(N,M)) Q:M=""  D
"RTN","BILETPR1",234,0)
 ..N J,P S P=0
"RTN","BILETPR1",235,0)
 ..F J=1:1 S P=$O(BIAR(N,M,P)) Q:'P  D
"RTN","BILETPR1",236,0)
 ...N X S X=BIAR(N,M,P)
"RTN","BILETPR1",237,0)
 ...;---> If this line will be too long, write it and start a new line.
"RTN","BILETPR1",238,0)
 ...I $L(BIHXLN_X)>70 D  Q
"RTN","BILETPR1",239,0)
 ....D WRITE(.BILINE,"     "_BIHXLN_",",BIGBL)
"RTN","BILETPR1",240,0)
 ....S BIHXLN="          "_X
"RTN","BILETPR1",241,0)
 ...S BIHXLN=BIHXLN_$S((I>1!(J>1)):", ",1:"")_X
"RTN","BILETPR1",242,0)
 .D:$O(BIAR(0)) WRITE(.BILINE,"     "_BIHXLN,BIGBL)
"RTN","BILETPR1",243,0)
 ;
"RTN","BILETPR1",244,0)
 ;---> If there are no previous immunizations and this call is NOT for
"RTN","BILETPR1",245,0)
 ;---> Skin Tests ONLY, then store next line.
"RTN","BILETPR1",246,0)
 I '$O(BIAR(0)),$G(BINOSK)'=2 D
"RTN","BILETPR1",247,0)
 .D WRITE(.BILINE,"        No previous immunizations recorded.",BIGBL)
"RTN","BILETPR1",248,0)
 ;
"RTN","BILETPR1",249,0)
 ;---> Quit if NOT including Skin Tests.
"RTN","BILETPR1",250,0)
 Q:($G(BINOSK))=1
"RTN","BILETPR1",251,0)
 ;
"RTN","BILETPR1",252,0)
 ;---> SKIN TESTS
"RTN","BILETPR1",253,0)
 ;---> PC  DATA
"RTN","BILETPR1",254,0)
 ;---> --  ----
"RTN","BILETPR1",255,0)
 ;--->  1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BILETPR1",256,0)
 ;--->  4 = V Skin Test File IEN.
"RTN","BILETPR1",257,0)
 ;--->  5 = Location (or Outside Location) where Imm was given.
"RTN","BILETPR1",258,0)
 ;--->  8 = Skin Test Result.
"RTN","BILETPR1",259,0)
 ;--->  9 = Skin Test Reading.
"RTN","BILETPR1",260,0)
 ;---> 10 = Skin Test Name.
"RTN","BILETPR1",261,0)
 ;---> 12 = Date of Visit Fileman format (YYYMMDD).
"RTN","BILETPR1",262,0)
 ;
"RTN","BILETPR1",263,0)
 ;---> List Skin Test History by Date.
"RTN","BILETPR1",264,0)
 ;---> Loop through "^"-pieces of Imm History, getting data.
"RTN","BILETPR1",265,0)
 K BIAR
"RTN","BILETPR1",266,0)
 F I=1:1 S Y=$P(BIHX,U,I) Q:Y=""  D
"RTN","BILETPR1",267,0)
 .;---> Quit if this is not a Skin Test.
"RTN","BILETPR1",268,0)
 .Q:$P(Y,V)'="S"
"RTN","BILETPR1",269,0)
 .;---> Set display line for this Skin Test Name and Date.
"RTN","BILETPR1",270,0)
 .S X=$P(Y,V,10),X=$$PAD^BIUTL5(X,12)
"RTN","BILETPR1",271,0)
 .;
"RTN","BILETPR1",272,0)
 .D
"RTN","BILETPR1",273,0)
 ..I $P(Y,V,8)]"" S X=X_$P(Y,V,8) Q
"RTN","BILETPR1",274,0)
 ..I $P(Y,V,9) S X=X_$P(Y,V,9)_" mm" Q
"RTN","BILETPR1",275,0)
 ..S X=X_"Not recorded"
"RTN","BILETPR1",276,0)
 .;
"RTN","BILETPR1",277,0)
 .;---> Set this Skin Test in the array:
"RTN","BILETPR1",278,0)
 .;---> BIAR(VisitDate,SkinTestName,VisitIEN)=Skin Test display line.
"RTN","BILETPR1",279,0)
 .S BIAR($P(Y,V,12),$P(Y,V,10),$P(Y,V,4))=X
"RTN","BILETPR1",280,0)
 ;
"RTN","BILETPR1",281,0)
 ;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BILETPR1",282,0)
 ;---> If no skin tests on record, display that explicitly.
"RTN","BILETPR1",283,0)
 ;Q:'$D(BIAR)
"RTN","BILETPR1",284,0)
 I '$D(BIAR) D  Q
"RTN","BILETPR1",285,0)
 .D WRITE(.BILINE)
"RTN","BILETPR1",286,0)
 .S X="     Skin Tests/PPD: None on record" D WRITE(.BILINE,X)
"RTN","BILETPR1",287,0)
 ;**********
"RTN","BILETPR1",288,0)
 ;
"RTN","BILETPR1",289,0)
 ;---> Skin Test Header.
"RTN","BILETPR1",290,0)
 D:$G(BINOSK)'=2 WRITE(.BILINE,,BIGBL)
"RTN","BILETPR1",291,0)
 D:'$G(BIHDRS)
"RTN","BILETPR1",292,0)
 .;S X="               Skin Tests:"
"RTN","BILETPR1",293,0)
 .S X="               Recent Skin Tests:"
"RTN","BILETPR1",294,0)
 .D WRITE(.BILINE,X,BIGBL)
"RTN","BILETPR1",295,0)
 .S X="               -----------------------"
"RTN","BILETPR1",296,0)
 .D WRITE(.BILINE,X,BIGBL)
"RTN","BILETPR1",297,0)
 ;
"RTN","BILETPR1",298,0)
 ;---> Build Skin Test History lines for History Section of Form Letter.
"RTN","BILETPR1",299,0)
 ;
"RTN","BILETPR1",300,0)
 ;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BILETPR1",301,0)
 ;---> Display only the most recent three dates of Skin Tests.
"RTN","BILETPR1",302,0)
 ;
"RTN","BILETPR1",303,0)
 N BIZTEMP
"RTN","BILETPR1",304,0)
 ;
"RTN","BILETPR1",305,0)
 N N S N=0
"RTN","BILETPR1",306,0)
 F  S N=$O(BIAR(N)) Q:'N  D
"RTN","BILETPR1",307,0)
 .N BIDT
"RTN","BILETPR1",308,0)
 .S BIDT=$$SLDT2^BIUTL5(N,1)
"RTN","BILETPR1",309,0)
 .N I,M S M=0
"RTN","BILETPR1",310,0)
 .F I=1:1 S M=$O(BIAR(N,M)) Q:M=""  D
"RTN","BILETPR1",311,0)
 ..N P S P=0
"RTN","BILETPR1",312,0)
 ..F  S P=$O(BIAR(N,M,P)) Q:'P  D
"RTN","BILETPR1",313,0)
 ...N X S X=BIAR(N,M,P)
"RTN","BILETPR1",314,0)
 ...S X="     "_$S(I=1:BIDT_": ",1:"          ")_X
"RTN","BILETPR1",315,0)
 ...;
"RTN","BILETPR1",316,0)
 ...S BIZTEMP(N,M)=X
"RTN","BILETPR1",317,0)
 ...;D WRITE(.BILINE,X,BIGBL)
"RTN","BILETPR1",318,0)
 ;
"RTN","BILETPR1",319,0)
 N N S N=9999999
"RTN","BILETPR1",320,0)
 F I=1:1:4 S N=+$O(BIZTEMP(N),-1) Q:'N
"RTN","BILETPR1",321,0)
 F  S N=$O(BIZTEMP(N)) Q:'N  D
"RTN","BILETPR1",322,0)
 .N M S M=""
"RTN","BILETPR1",323,0)
 .F  S M=$O(BIZTEMP(N,M)) Q:(M="")  D
"RTN","BILETPR1",324,0)
 ..D WRITE(.BILINE,BIZTEMP(N,M),BIGBL)
"RTN","BILETPR1",325,0)
 ;**********
"RTN","BILETPR1",326,0)
 ;
"RTN","BILETPR1",327,0)
 Q
"RTN","BILETPR1",328,0)
 ;
"RTN","BILETPR1",329,0)
 ;
"RTN","BILETPR1",330,0)
 ;----------
"RTN","BILETPR1",331,0)
CONTRAS(BILINE,BIDFN,BIGBL) ;EP
"RTN","BILETPR1",332,0)
 ;---> Retrieve and store Contraindications in WP ^TMP global.
"RTN","BILETPR1",333,0)
 ;---> Parameters:
"RTN","BILETPR1",334,0)
 ;     1 - BILINE (ret) Last line written into ^TMP array.
"RTN","BILETPR1",335,0)
 ;     2 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR1",336,0)
 ;     3 - BIGBL  (opt) ^TMP global node to write to (def="BILET").
"RTN","BILETPR1",337,0)
 ;
"RTN","BILETPR1",338,0)
 S:$G(BIGBL)="" BIGBL="BILET"
"RTN","BILETPR1",339,0)
 N BIRETVAL,BIRETERR,I S BIRETVAL=""
"RTN","BILETPR1",340,0)
 ;
"RTN","BILETPR1",341,0)
 ;---> RPC to retrieve Contraindications.
"RTN","BILETPR1",342,0)
 D CONTRAS^BIRPC5(.BIRETVAL,BIDFN)
"RTN","BILETPR1",343,0)
 ;
"RTN","BILETPR1",344,0)
 ;---> If BIRETERR has a value, display it and quit.
"RTN","BILETPR1",345,0)
 S BIRETERR=$P(BIRETVAL,BI31,2)
"RTN","BILETPR1",346,0)
 I BIRETERR]"" D  Q
"RTN","BILETPR1",347,0)
 .D WRITE(.BILINE,"     "_BIRETERR,BIGBL)
"RTN","BILETPR1",348,0)
 .D WRITE(.BILINE,,BIGBL)
"RTN","BILETPR1",349,0)
 ;
"RTN","BILETPR1",350,0)
 ;---> Set BICONT=to a string of Contraindications for this patient.
"RTN","BILETPR1",351,0)
 N BICONT S BICONT=$P(BIRETVAL,BI31,1)
"RTN","BILETPR1",352,0)
 Q:BICONT=""
"RTN","BILETPR1",353,0)
 ;
"RTN","BILETPR1",354,0)
 ;---> Build Listmanager array from BICONT string.
"RTN","BILETPR1",355,0)
 ;
"RTN","BILETPR1",356,0)
 N J S J=1
"RTN","BILETPR1",357,0)
 F I=1:1 S Y=$P(BICONT,U,I) Q:Y=""  D
"RTN","BILETPR1",358,0)
 .;---> Build display line for this Contraindication.
"RTN","BILETPR1",359,0)
 .N V S V="|",X="     "
"RTN","BILETPR1",360,0)
 .S:J X=X_"* Contraindications:",J=0 S X=$$PAD^BIUTL5(X,28)
"RTN","BILETPR1",361,0)
 .;
"RTN","BILETPR1",362,0)
 .;---> Display "Vaccine:  Date  Reason"
"RTN","BILETPR1",363,0)
 .;---> Quit if Reason is a "Refusal."  Also, if it's the first line of Contras
"RTN","BILETPR1",364,0)
 .;---> reset J so that "Contraindications:" header displays on the next one.
"RTN","BILETPR1",365,0)
 .I Y["Refusal" D  Q
"RTN","BILETPR1",366,0)
 ..I I=1 S J=1
"RTN","BILETPR1",367,0)
 .S X=X_$P(Y,V,2)_":",X=$$PAD^BIUTL5(X,40)_$P(Y,V,4)
"RTN","BILETPR1",368,0)
 .S X=$$PAD^BIUTL5(X,53)_$P(Y,V,3)
"RTN","BILETPR1",369,0)
 .;---> Set formatted Contraindication line and index in ^TMP.
"RTN","BILETPR1",370,0)
 .D WRITE(.BILINE,X,BIGBL)
"RTN","BILETPR1",371,0)
 Q
"RTN","BILETPR1",372,0)
 ;
"RTN","BILETPR1",373,0)
 ;
"RTN","BILETPR1",374,0)
 ;----------
"RTN","BILETPR1",375,0)
FORECAST(BILET,BILINE,BIFORCST,BIFDT) ;EP
"RTN","BILETPR1",376,0)
 ;---> Calculate and store Forecast in WP ^TMP global.
"RTN","BILETPR1",377,0)
 ;---> Parameters:
"RTN","BILETPR1",378,0)
 ;     1 - BILET    (req) IEN of Letter in BI LETTER File.
"RTN","BILETPR1",379,0)
 ;     2 - BILINE   (ret) Last line written into ^TMP array.
"RTN","BILETPR1",380,0)
 ;     3 - BIFORCST (req) Raw forecast string back from call to IMMFORC^BIRPC.
"RTN","BILETPR1",381,0)
 ;     4 - BIFDT    (opt) Forecast Date.
"RTN","BILETPR1",382,0)
 ;
"RTN","BILETPR1",383,0)
 ;---> Quit if this Form Letter does not included a Forecast.
"RTN","BILETPR1",384,0)
 Q:'$P(^BILET(BILET,0),U,3)
"RTN","BILETPR1",385,0)
 ;
"RTN","BILETPR1",386,0)
 ;---> If Forecast Date not provided, set it equal to today.
"RTN","BILETPR1",387,0)
 S:'$G(BIFDT) BIFDT=DT
"RTN","BILETPR1",388,0)
 ;
"RTN","BILETPR1",389,0)
 ;---> RPC to gather Immunization History.
"RTN","BILETPR1",390,0)
 ;     BIFORCST - Return value of valid data from RPC.
"RTN","BILETPR1",391,0)
 ;     BIRETERR - Return value (text string) of error from RPC.
"RTN","BILETPR1",392,0)
 ;
"RTN","BILETPR1",393,0)
 N BIRETERR S BIRETVAL=""
"RTN","BILETPR1",394,0)
 ;
"RTN","BILETPR1",395,0)
 ;---> If BIRETERR has a value, store it and quit.
"RTN","BILETPR1",396,0)
 S BIRETERR=$P(BIFORCST,BI31,2)
"RTN","BILETPR1",397,0)
 I BIRETERR]"" D  Q
"RTN","BILETPR1",398,0)
 .D WRITE(.BILINE),WRITE(.BILINE,"     "_BIRETERR),WRITE(.BILINE)
"RTN","BILETPR1",399,0)
 ;
"RTN","BILETPR1",400,0)
 ;---> Set BIFORC=to the Immunization Forecast for this patient.
"RTN","BILETPR1",401,0)
 N BIFORC,I,V S V="|",BIFORC=$P(BIFORCST,BI31,1)
"RTN","BILETPR1",402,0)
 ;
"RTN","BILETPR1",403,0)
 D WRITE(.BILINE)
"RTN","BILETPR1",404,0)
 ;
"RTN","BILETPR1",405,0)
 ;---> If Forecast Date is not Today, display Forecast Date in letter.
"RTN","BILETPR1",406,0)
 D:BIFDT'=DT
"RTN","BILETPR1",407,0)
 .;---> Set Forecast Date external form for letter text.
"RTN","BILETPR1",408,0)
 .N BIFDT1 S BIFDT1=$$TXDT1^BIUTL5(BIFDT)
"RTN","BILETPR1",409,0)
 .D WRITE(.BILINE,"        For "_BIFDT1_":")
"RTN","BILETPR1",410,0)
 ;
"RTN","BILETPR1",411,0)
 ;---> Loop through "^"-pieces of Imm Forecast, getting data.
"RTN","BILETPR1",412,0)
 F I=1:1 S Y=$P(BIFORC,U,I) Q:Y=""  D
"RTN","BILETPR1",413,0)
 .;
"RTN","BILETPR1",414,0)
 .S Y=$P(Y,V) I +Y&($E(Y,2)="-") S Y=$E(Y,3,99)
"RTN","BILETPR1",415,0)
 .;
"RTN","BILETPR1",416,0)
 .D WRITE(.BILINE,"        "_$$STRIP^BIUTL5(.Y))
"RTN","BILETPR1",417,0)
 D WRITE(.BILINE)
"RTN","BILETPR1",418,0)
 Q
"RTN","BILETPR1",419,0)
 ;
"RTN","BILETPR1",420,0)
 ;
"RTN","BILETPR1",421,0)
 ;----------
"RTN","BILETPR1",422,0)
DATELOC(BILET,BILINE,BIDLOC) ;EP
"RTN","BILETPR1",423,0)
 D DATELOC^BILETPR2(BILET,.BILINE,BIDLOC)
"RTN","BILETPR1",424,0)
 Q
"RTN","BILETPR1",425,0)
 ;
"RTN","BILETPR1",426,0)
 ;
"RTN","BILETPR1",427,0)
 ;----------
"RTN","BILETPR1",428,0)
WRITE(BILINE,BIVAL,BIGBL) ;EP
"RTN","BILETPR1",429,0)
 D WRITE^BILETPR3(.BILINE,$G(BIVAL),$G(BIGBL))
"RTN","BILETPR1",430,0)
 Q
"RTN","BILETPR3")
0^6^B29535293
"RTN","BILETPR3",1,0)
BILETPR3 ;IHS/CMI/MWR - PRINT PATIENT LETTERS.; MAY 10, 2010
"RTN","BILETPR3",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BILETPR3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILETPR3",4,0)
 ;;  BUILD ^TMP WP ARRAY FOR PRINTING LETTERS.
"RTN","BILETPR3",5,0)
 ;;  PATCH 10: If no skin tests on record, display explicitly. HISTORY2+106
"RTN","BILETPR3",6,0)
 ;;            Display only the most recent three dates of Skin Tests. HISTORY2+152
"RTN","BILETPR3",7,0)
 ;
"RTN","BILETPR3",8,0)
 ;
"RTN","BILETPR3",9,0)
 ;----------
"RTN","BILETPR3",10,0)
HISTORY2(BILINE,BIHX,BIDFN,BIFORM,BINVAL,BIPDSS) ;EP
"RTN","BILETPR3",11,0)
 ;---> Set Immunization History in Listman Letter array, sorted
"RTN","BILETPR3",12,0)
 ;---> by Vaccine.
"RTN","BILETPR3",13,0)
 ;---> Parameters:
"RTN","BILETPR3",14,0)
 ;     1 - BILINE (ret) Last line written into ^TMP array.
"RTN","BILETPR3",15,0)
 ;     2 - BIHX   (req) Patient's Immunization History (string).
"RTN","BILETPR3",16,0)
 ;     3 - BIDFN  (req) Patient's IEN in VA PATIENT File #2.
"RTN","BILETPR3",17,0)
 ;     4 - BIFORM (opt) 3=List by Vaccine, 4=Vaccine w/Lot#.
"RTN","BILETPR3",18,0)
 ;     5 - BINVAL (opt) 0=Include Invalid Doses, 1=Exclude Invalid Doses.
"RTN","BILETPR3",19,0)
 ;     6 - BIPDSS (opt) Returned string of Visit IEN's that are
"RTN","BILETPR3",20,0)
 ;                        Problem Doses, according to ImmServe.
"RTN","BILETPR3",21,0)
 ;
"RTN","BILETPR3",22,0)
 S:'$G(BIFORM) BIFORM=3
"RTN","BILETPR3",23,0)
 N I,V,X,Y,Z S V="|",Z=""
"RTN","BILETPR3",24,0)
 ;
"RTN","BILETPR3",25,0)
 ;---> IMMUNIZATIONS
"RTN","BILETPR3",26,0)
 ;---> PC  DATA
"RTN","BILETPR3",27,0)
 ;---> --  ----
"RTN","BILETPR3",28,0)
 ;--->  1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BILETPR3",29,0)
 ;--->  2 = Vaccine Name, Short.
"RTN","BILETPR3",30,0)
 ;--->  3 = Vaccine Components.  ;v8.0
"RTN","BILETPR3",31,0)
 ;--->  4 = IEN, V File Visit.
"RTN","BILETPR3",32,0)
 ;--->  5 = Location (or Outside Location) where Imm was given.
"RTN","BILETPR3",33,0)
 ;--->  6 = Vaccine Group (Series Type) for grouping of vaccines.
"RTN","BILETPR3",34,0)
 ;--->  7 = Vaccine Lot#, Text.
"RTN","BILETPR3",35,0)
 ;--->  8 = Skin Test Result.
"RTN","BILETPR3",36,0)
 ;--->  9 = Skin Test Reading.
"RTN","BILETPR3",37,0)
 ;---> 10 = Skin Test Name.
"RTN","BILETPR3",38,0)
 ;---> 11 = Reaction to Immunization, text.
"RTN","BILETPR3",39,0)
 ;---> 12 = Date of Visit Fileman format (YYYMMDD).
"RTN","BILETPR3",40,0)
 ;---> 13 = Dose Override.
"RTN","BILETPR3",41,0)
 ;---> 14 = Vaccine Component CVX Code.
"RTN","BILETPR3",42,0)
 ;
"RTN","BILETPR3",43,0)
 S X="       Immunization          Date Received   Location"
"RTN","BILETPR3",44,0)
 S:BIFORM=4 X=X_"           Lot#"
"RTN","BILETPR3",45,0)
 D WRITE(.BILINE,X)
"RTN","BILETPR3",46,0)
 S X="       ------------          -------------   ---------------"
"RTN","BILETPR3",47,0)
 S:BIFORM=4 X=X_"    ----------"
"RTN","BILETPR3",48,0)
 D WRITE(.BILINE,X)
"RTN","BILETPR3",49,0)
 ;
"RTN","BILETPR3",50,0)
 ;---> Loop through "^"-pieces of Imm History, displaying Immunizations.
"RTN","BILETPR3",51,0)
 F I=1:1 S Y=$P(BIHX,U,I) Q:Y=""  D
"RTN","BILETPR3",52,0)
 .;
"RTN","BILETPR3",53,0)
 .;---> Quit if this is not an Immunization.
"RTN","BILETPR3",54,0)
 .Q:$P(Y,V)'="I"
"RTN","BILETPR3",55,0)
 .;
"RTN","BILETPR3",56,0)
 .;---> If not the same Vaccine Group, insert a blank line.
"RTN","BILETPR3",57,0)
 .I $P(Y,V,6)'=Z D:I>1 WRITE(.BILINE) S Z=$P(Y,V,6)
"RTN","BILETPR3",58,0)
 .;
"RTN","BILETPR3",59,0)
 .;---> Set display line for this Immunization and Date.
"RTN","BILETPR3",60,0)
 .N BIPDSSA S BIPDSSA=0
"RTN","BILETPR3",61,0)
 .D
"RTN","BILETPR3",62,0)
 ..;---> Prepend asterisk if this Dose has a User Override or is
"RTN","BILETPR3",63,0)
 ..;---> an ImmServe Problem Dose (flag stored in BIPDSSA).
"RTN","BILETPR3",64,0)
 ..I $P(Y,V,13) S X="      *" Q
"RTN","BILETPR3",65,0)
 ..I $$PDSS^BIUTL8($P(Y,V,4),$P(Y,V,14),$G(BIPDSS)) S X="      *",BIPDSSA=1 Q
"RTN","BILETPR3",66,0)
 ..S X="       "
"RTN","BILETPR3",67,0)
 .;
"RTN","BILETPR3",68,0)
 .S X=X_$P(Y,V,2),X=$$PAD^BIUTL5(X,29)
"RTN","BILETPR3",69,0)
 .S X=X_$$TXDT1^BIUTL5($P(Y,V,12))
"RTN","BILETPR3",70,0)
 .;
"RTN","BILETPR3",71,0)
 .;---> Pad with spaces to line up in columns, add Location.
"RTN","BILETPR3",72,0)
 .S X=$$PAD^BIUTL5(X,45)_$E($P(Y,V,5),1,17)
"RTN","BILETPR3",73,0)
 .;
"RTN","BILETPR3",74,0)
 .;---> If Lot#'s specified, pad with spaces, add Lot#.
"RTN","BILETPR3",75,0)
 .D:BIFORM=4
"RTN","BILETPR3",76,0)
 ..S X=$$PAD^BIUTL5(X,64)_$P(Y,V,7)
"RTN","BILETPR3",77,0)
 .D WRITE(.BILINE,X)
"RTN","BILETPR3",78,0)
 .;
"RTN","BILETPR3",79,0)
 .;
"RTN","BILETPR3",80,0)
 .;---> If this is a Dose Override by user, set another line to display it.
"RTN","BILETPR3",81,0)
 .;---> NOT USED FOR NOW.
"RTN","BILETPR3",82,0)
 .;D:$P(Y,V,13)
"RTN","BILETPR3",83,0)
 .;.;---> Do not display if Override Reason is "FORCED VALID" (per Ros Singleton).
"RTN","BILETPR3",84,0)
 .;.Q:$P(Y,V,13)=9
"RTN","BILETPR3",85,0)
 .;.S X="                             -"_$$DOVER^BIUTL8($P(Y,V,13))_"-"
"RTN","BILETPR3",86,0)
 .;.D WRITE(.BILINE,X)
"RTN","BILETPR3",87,0)
 .;
"RTN","BILETPR3",88,0)
 .;---> If this is a Problem Dose by ImmServe, set another line to display it.
"RTN","BILETPR3",89,0)
 .;---> NOT USED FOR NOW.
"RTN","BILETPR3",90,0)
 .;D:$G(BIPDSSA)
"RTN","BILETPR3",91,0)
 .;.S X="                             -INVALID--SEE IMMSERVE-"
"RTN","BILETPR3",92,0)
 .;.;---> Pad Result with trailing spaces to justify columns.
"RTN","BILETPR3",93,0)
 .;.D WRITE(.BILINE,X)
"RTN","BILETPR3",94,0)
 .;
"RTN","BILETPR3",95,0)
 .;
"RTN","BILETPR3",96,0)
 .;---> If there was a Reaction, set another line to display it.
"RTN","BILETPR3",97,0)
 .D:$P(Y,V,11)]""
"RTN","BILETPR3",98,0)
 ..S X="                                Reaction: "_$P(Y,V,11)
"RTN","BILETPR3",99,0)
 ..;---> Pad Result with trailing spaces to justify columns.
"RTN","BILETPR3",100,0)
 ..D WRITE(.BILINE,X)
"RTN","BILETPR3",101,0)
 ;
"RTN","BILETPR3",102,0)
 ;
"RTN","BILETPR3",103,0)
 ;---> SKIN TESTS
"RTN","BILETPR3",104,0)
 ;---> PC  DATA
"RTN","BILETPR3",105,0)
 ;---> --  ----
"RTN","BILETPR3",106,0)
 ;--->  1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BILETPR3",107,0)
 ;--->  4 = V Skin Test File IEN.
"RTN","BILETPR3",108,0)
 ;--->  5 = Location (or Outside Location) where Imm was given.
"RTN","BILETPR3",109,0)
 ;--->  8 = Skin Test Result.
"RTN","BILETPR3",110,0)
 ;--->  9 = Skin Test Reading.
"RTN","BILETPR3",111,0)
 ;---> 10 = Skin Test Name.
"RTN","BILETPR3",112,0)
 ;---> 12 = Date of Visit Fileman format (YYYMMDD).
"RTN","BILETPR3",113,0)
 ;
"RTN","BILETPR3",114,0)
 ;---> Do not print Skin Test headers if patient has no Skin Tests.
"RTN","BILETPR3",115,0)
 ;
"RTN","BILETPR3",116,0)
 ;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BILETPR3",117,0)
 ;---> If no skin tests on record, display that explicitly.
"RTN","BILETPR3",118,0)
 ;I $G(BIDFN) Q:'$D(^AUPNVSK("AC",BIDFN))
"RTN","BILETPR3",119,0)
 Q:'$G(BIDFN)
"RTN","BILETPR3",120,0)
 I '$D(^AUPNVSK("AC",BIDFN)) D  Q
"RTN","BILETPR3",121,0)
 .D WRITE(.BILINE)
"RTN","BILETPR3",122,0)
 .S X="       Skin Tests/PPD: None on record"
"RTN","BILETPR3",123,0)
 .D WRITE(.BILINE,X)
"RTN","BILETPR3",124,0)
 ;
"RTN","BILETPR3",125,0)
 ;---> Add "Recent".
"RTN","BILETPR3",126,0)
 ;D WRITE(.BILINE),WRITE(.BILINE)
"RTN","BILETPR3",127,0)
 D WRITE(.BILINE),WRITE(.BILINE,"       Recent")
"RTN","BILETPR3",128,0)
 ;**********
"RTN","BILETPR3",129,0)
 S X="       Skin Tests     Date Received     Location"
"RTN","BILETPR3",130,0)
 S X=X_"            Result"
"RTN","BILETPR3",131,0)
 D WRITE(.BILINE,X)
"RTN","BILETPR3",132,0)
 S X="       ------------   -------------     ---------------"
"RTN","BILETPR3",133,0)
 S X=X_"     ---------"
"RTN","BILETPR3",134,0)
 D WRITE(.BILINE,X)
"RTN","BILETPR3",135,0)
 ;
"RTN","BILETPR3",136,0)
 ;---> Loop through "^"-pieces of Imm History, displaying Skin Tests.
"RTN","BILETPR3",137,0)
 ;
"RTN","BILETPR3",138,0)
 ;
"RTN","BILETPR3",139,0)
 ;Display only the most recent 3.
"RTN","BILETPR3",140,0)
 ;
"RTN","BILETPR3",141,0)
 N BIZTEMP
"RTN","BILETPR3",142,0)
 ;
"RTN","BILETPR3",143,0)
 F I=1:1 S Y=$P(BIHX,U,I) Q:Y=""  D
"RTN","BILETPR3",144,0)
 .;
"RTN","BILETPR3",145,0)
 .;---> Quit if this is not a Skin Test.
"RTN","BILETPR3",146,0)
 .Q:$P(Y,V)'="S"
"RTN","BILETPR3",147,0)
 .;
"RTN","BILETPR3",148,0)
 .;---> Set display line for this Skin Test Name and Date.
"RTN","BILETPR3",149,0)
 .S X="       "_$P(Y,V,10),X=$$PAD^BIUTL5(X,22)
"RTN","BILETPR3",150,0)
 .S X=X_$$TXDT1^BIUTL5($P(Y,V,12))
"RTN","BILETPR3",151,0)
 .;
"RTN","BILETPR3",152,0)
 .;---> Pad with spaces to line up in columns, add Location.
"RTN","BILETPR3",153,0)
 .S X=$$PAD^BIUTL5(X,40)_$E($P(Y,V,5),1,15)
"RTN","BILETPR3",154,0)
 .;
"RTN","BILETPR3",155,0)
 .;---> Pad with spaces to line up in columns, add Result.
"RTN","BILETPR3",156,0)
 .S X=$$PAD^BIUTL5(X,60)
"RTN","BILETPR3",157,0)
 .D
"RTN","BILETPR3",158,0)
 ..I $P(Y,V,8)]"" S X=X_$P(Y,V,8) Q
"RTN","BILETPR3",159,0)
 ..I $P(Y,V,9) S X=X_$P(Y,V,9)_" mm" Q
"RTN","BILETPR3",160,0)
 ..S X=X_"Not recorded"
"RTN","BILETPR3",161,0)
 ..;
"RTN","BILETPR3",162,0)
 .;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BILETPR3",163,0)
 .;---> Display only the most recent three dates of Skin Tests.
"RTN","BILETPR3",164,0)
 .S BIZTEMP($P(Y,V,12),$P(Y,V,10))=X
"RTN","BILETPR3",165,0)
 .;D WRITE(.BILINE,X)
"RTN","BILETPR3",166,0)
 ;
"RTN","BILETPR3",167,0)
 N N S N=9999999
"RTN","BILETPR3",168,0)
 F I=1:1:4 S N=+$O(BIZTEMP(N),-1) Q:'N
"RTN","BILETPR3",169,0)
 F  S N=$O(BIZTEMP(N)) Q:'N  D
"RTN","BILETPR3",170,0)
 .N M S M=""
"RTN","BILETPR3",171,0)
 .F  S M=$O(BIZTEMP(N,M)) Q:(M="")  D
"RTN","BILETPR3",172,0)
 ..D WRITE(.BILINE,BIZTEMP(N,M))
"RTN","BILETPR3",173,0)
 ;**********
"RTN","BILETPR3",174,0)
 Q
"RTN","BILETPR3",175,0)
 ;
"RTN","BILETPR3",176,0)
 ;
"RTN","BILETPR3",177,0)
 ;----------
"RTN","BILETPR3",178,0)
WRITE(BILINE,BIVAL,BIGBL) ;EP
"RTN","BILETPR3",179,0)
 ;---> Write a line to the ^TMP global for WP or Listman.
"RTN","BILETPR3",180,0)
 ;---> NOTE: DUPLICATE CODE IN ^BILETPR3 FOR SPEED.
"RTN","BILETPR3",181,0)
 ;---> Parameters:
"RTN","BILETPR3",182,0)
 ;     1 - BILINE (ret) Last line# in the WP ^TMP global.
"RTN","BILETPR3",183,0)
 ;     2 - BIVAL  (opt) Value/text of line (Null=blank line).
"RTN","BILETPR3",184,0)
 ;     3 - BIGBL  (opt) ^TMP global node to write to (def="BILET").
"RTN","BILETPR3",185,0)
 ;
"RTN","BILETPR3",186,0)
 Q:'$D(BILINE)
"RTN","BILETPR3",187,0)
 S:$G(BIGBL)="" BIGBL="BILET"
"RTN","BILETPR3",188,0)
 D WL^BIW(.BILINE,BIGBL,$G(BIVAL))
"RTN","BILETPR3",189,0)
 Q
"RTN","BILOGO")
0^16^B23635240
"RTN","BILOGO",1,0)
BILOGO ;IHS/CMI/MWR - DISPLAY LOGO WHRN ENTERING PKG; OCT 15, 2010
"RTN","BILOGO",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BILOGO",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BILOGO",4,0)
 ;;  DISPLAYS LOGO.  GETS VERSION FROM LINE 2 OF THIS ROUTINE.
"RTN","BILOGO",5,0)
 ;
"RTN","BILOGO",6,0)
 D SETVARS^BIUTL5
"RTN","BILOGO",7,0)
 ;---> Set Imm Package Version Number.
"RTN","BILOGO",8,0)
 S BIVER=$$VER
"RTN","BILOGO",9,0)
 ;
"RTN","BILOGO",10,0)
 W @IOF
"RTN","BILOGO",11,0)
 W !?13,"     .. --- ..         *     *         .. --- .."
"RTN","BILOGO",12,0)
 W !?13,"   *          ~ *.      \   /      .* ~          *"
"RTN","BILOGO",13,0)
 W !?13," *                *      \ /      *                *"
"RTN","BILOGO",14,0)
 W !?13,"(         RPMS      *    (|)    *     Version       )"
"RTN","BILOGO",15,0)
 W !?13," *    IMMUNIZATION    *  ***  *         "
"RTN","BILOGO",16,0)
 W $$PAD^BIUTL5($$VER,11),"*"
"RTN","BILOGO",17,0)
 W !?13,"   *.                   *   *                   .*"
"RTN","BILOGO",18,0)
 W !?13,"      *                *     *                *"
"RTN","BILOGO",19,0)
 W !?13,"        >              *     *              <"
"RTN","BILOGO",20,0)
 W !?13,"       *                *   *                *"
"RTN","BILOGO",21,0)
 W !?13,"     *               * *     * *               *"
"RTN","BILOGO",22,0)
 W !?13,"    *     @        *   *     *   *        @     *"
"RTN","BILOGO",23,0)
 W !?13,"   (             *      *   *      *             )"
"RTN","BILOGO",24,0)
 W !?13,"    *.        *          ***          *        .*"
"RTN","BILOGO",25,0)
 W !?13,"      / /-- ~             ~             ~ --\ \"
"RTN","BILOGO",26,0)
 N X S X="MAIN MENU at "_$P(^DIC(4,DUZ(2),0),U)
"RTN","BILOGO",27,0)
 D CENTERT^BIUTL5(.X)
"RTN","BILOGO",28,0)
 W !!,X
"RTN","BILOGO",29,0)
 Q
"RTN","BILOGO",30,0)
 ;
"RTN","BILOGO",31,0)
 ;
"RTN","BILOGO",32,0)
 ;----------
"RTN","BILOGO",33,0)
CHECK ;EP
"RTN","BILOGO",34,0)
 ;---> Check User's DUZ(2), BI SITE PARAMETER File for this site,
"RTN","BILOGO",35,0)
 ;---> and Standard Vaccine Table (IMMUNIZATION File).
"RTN","BILOGO",36,0)
 ;---> Called by ENTRY ACTION of Option BIMENU.
"RTN","BILOGO",37,0)
 ;
"RTN","BILOGO",38,0)
 ;---> Set Imm Package Version Number.
"RTN","BILOGO",39,0)
 S BIVER=$$VER
"RTN","BILOGO",40,0)
 ;
"RTN","BILOGO",41,0)
 ;---> User's DUZ(2) undefined.
"RTN","BILOGO",42,0)
 I '$G(DUZ(2)) D  Q
"RTN","BILOGO",43,0)
 .D WARN
"RTN","BILOGO",44,0)
 .W !?5,"Your DUZ(2) variable is not defined.",!
"RTN","BILOGO",45,0)
 .D TEXT1
"RTN","BILOGO",46,0)
 .D DIRZ^BIUTL3()
"RTN","BILOGO",47,0)
 ;
"RTN","BILOGO",48,0)
 ;
"RTN","BILOGO",49,0)
 ;---> BI SITE PARAMETER File not set up for this Site (DUZ(2)).
"RTN","BILOGO",50,0)
 I '$D(^BISITE(DUZ(2),0)) D  Q
"RTN","BILOGO",51,0)
 .D WARN
"RTN","BILOGO",52,0)
 .W !?5,"Immunization Site Parameters have NOT been set for the site"
"RTN","BILOGO",53,0)
 .W !?5,"you are logged on as: ",$P(^DIC(4,DUZ(2),0),U),!
"RTN","BILOGO",54,0)
 .D TEXT1
"RTN","BILOGO",55,0)
 .D:$$MAYMANAG^BIUTL11() TEXT2
"RTN","BILOGO",56,0)
 .D DIRZ^BIUTL3()
"RTN","BILOGO",57,0)
 ;
"RTN","BILOGO",58,0)
 ;
"RTN","BILOGO",59,0)
 ;---> Check for valid Immserve Forecasting Rules choice.
"RTN","BILOGO",60,0)
 ;---> If not a current, valid choice "IHS_1m18" will be used at RULES+6^BIUTL2.
"RTN","BILOGO",61,0)
 ;
"RTN","BILOGO",62,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BILOGO",63,0)
 ;---> Immserve Rule Set no longer relevant.
"RTN","BILOGO",64,0)
 ;D:'$$VALIDRUL^BIUTL2(DUZ(2))
"RTN","BILOGO",65,0)
 ;.D WARN
"RTN","BILOGO",66,0)
 ;.W !?5,"The ImmServe Forecasting site parameter is not currently set to"
"RTN","BILOGO",67,0)
 ;.W !?5,"a valid choice for the site you are logged on to: "
"RTN","BILOGO",68,0)
 ;.W !?5,$P(^DIC(4,DUZ(2),0),U),!
"RTN","BILOGO",69,0)
 ;.I $$MAYMANAG^BIUTL11() D TEXT4,DIRZ^BIUTL3() Q
"RTN","BILOGO",70,0)
 ;.D TEXT5,DIRZ^BIUTL3()
"RTN","BILOGO",71,0)
 ;
"RTN","BILOGO",72,0)
 ;
"RTN","BILOGO",73,0)
 ;---> Vaccine Table (^AUTTIMM global) not standard.
"RTN","BILOGO",74,0)
 D CHKSTAND^BIRESTD(.BIERROR)
"RTN","BILOGO",75,0)
 Q:$G(BIERROR)=""
"RTN","BILOGO",76,0)
 D WARN W !!?5,BIERROR,!
"RTN","BILOGO",77,0)
 D TEXT1
"RTN","BILOGO",78,0)
 D:$D(^XUSEC("BIZ MANAGER",$G(DUZ))) TEXT3
"RTN","BILOGO",79,0)
 D DIRZ^BIUTL3()
"RTN","BILOGO",80,0)
 Q
"RTN","BILOGO",81,0)
 ;
"RTN","BILOGO",82,0)
 ;
"RTN","BILOGO",83,0)
 ;----------
"RTN","BILOGO",84,0)
WARN ;EP
"RTN","BILOGO",85,0)
 W:$D(IOF) @IOF
"RTN","BILOGO",86,0)
 W " "_$$LMVER,!!?35,"WARNING",!?34,"---------",!!
"RTN","BILOGO",87,0)
 Q
"RTN","BILOGO",88,0)
 ;
"RTN","BILOGO",89,0)
 ;
"RTN","BILOGO",90,0)
 ;----------
"RTN","BILOGO",91,0)
TEXT1 ;EP
"RTN","BILOGO",92,0)
 ;;At this point you should back out of the Immunization Package
"RTN","BILOGO",93,0)
 ;;and contact your site manager or the person in charge of the
"RTN","BILOGO",94,0)
 ;;Immunization Software.
"RTN","BILOGO",95,0)
 ;;
"RTN","BILOGO",96,0)
 D PRINTX("TEXT1",5)
"RTN","BILOGO",97,0)
 Q
"RTN","BILOGO",98,0)
 ;
"RTN","BILOGO",99,0)
 ;
"RTN","BILOGO",100,0)
 ;----------
"RTN","BILOGO",101,0)
TEXT2 ;EP
"RTN","BILOGO",102,0)
 ;;Or, if you wish to set up Site Parameters for this site,
"RTN","BILOGO",103,0)
 ;;you may proceed to the Edit Site Parameters option and enter
"RTN","BILOGO",104,0)
 ;;parameters for this site.  (Menu Synonyms: MGR-->ESP)
"RTN","BILOGO",105,0)
 ;;
"RTN","BILOGO",106,0)
 D PRINTX("TEXT2",5)
"RTN","BILOGO",107,0)
 Q
"RTN","BILOGO",108,0)
 ;
"RTN","BILOGO",109,0)
 ;
"RTN","BILOGO",110,0)
 ;----------
"RTN","BILOGO",111,0)
TEXT3 ;EP
"RTN","BILOGO",112,0)
 ;;Or, you may fix this by Restandardizing the Immunization File.
"RTN","BILOGO",113,0)
 ;;To do so, proceed to the Manager Menu and select Restandardize.
"RTN","BILOGO",114,0)
 ;;(Menu Synonyms: MGR-->RES)
"RTN","BILOGO",115,0)
 ;;
"RTN","BILOGO",116,0)
 D PRINTX("TEXT3",5)
"RTN","BILOGO",117,0)
 Q
"RTN","BILOGO",118,0)
 ;
"RTN","BILOGO",119,0)
 ;
"RTN","BILOGO",120,0)
 ;----------
"RTN","BILOGO",121,0)
TEXT4 ;EP
"RTN","BILOGO",122,0)
 ;;To correct this problem, go to the Manager Menu, select the
"RTN","BILOGO",123,0)
 ;;option "ESP  Site Parameters Edit" and choose parameter 9,
"RTN","BILOGO",124,0)
 ;;"Immserve Forecasting Option," then select the Immserve option
"RTN","BILOGO",125,0)
 ;;that is most appropriate for your site.
"RTN","BILOGO",126,0)
 ;;(Menu Path: IMM-->MGR-->ESP-->9)
"RTN","BILOGO",127,0)
 ;;
"RTN","BILOGO",128,0)
 ;;Until that parameter is set correctly, forecasting will default
"RTN","BILOGO",129,0)
 ;;to Immserve Option #1.
"RTN","BILOGO",130,0)
 ;;
"RTN","BILOGO",131,0)
 D PRINTX("TEXT4",5)
"RTN","BILOGO",132,0)
 Q
"RTN","BILOGO",133,0)
 ;
"RTN","BILOGO",134,0)
 ;
"RTN","BILOGO",135,0)
 ;----------
"RTN","BILOGO",136,0)
TEXT5 ;EP
"RTN","BILOGO",137,0)
 ;;To correct this problem, notify your immunization coordinator or
"RTN","BILOGO",138,0)
 ;;site manager that this site parameter needs attention.
"RTN","BILOGO",139,0)
 ;;
"RTN","BILOGO",140,0)
 ;;Until that parameter is set correctly, forecasting will default
"RTN","BILOGO",141,0)
 ;;to Immserve Option #1.
"RTN","BILOGO",142,0)
 ;;
"RTN","BILOGO",143,0)
 D PRINTX("TEXT5",5)
"RTN","BILOGO",144,0)
 Q
"RTN","BILOGO",145,0)
 ;
"RTN","BILOGO",146,0)
 ;
"RTN","BILOGO",147,0)
 ;----------
"RTN","BILOGO",148,0)
VER() ;PEP - Return Version# and Patch Level (if any).
"RTN","BILOGO",149,0)
 ;
"RTN","BILOGO",150,0)
 N X,Y,Z
"RTN","BILOGO",151,0)
 S X=$P($T(BILOGO+1),";;",2)
"RTN","BILOGO",152,0)
 S Y=$P(X,";")
"RTN","BILOGO",153,0)
 S Z=$P(X,";",3)
"RTN","BILOGO",154,0)
 ;---> If no patch level, return version# and quit.
"RTN","BILOGO",155,0)
 Q:Z="" Y
"RTN","BILOGO",156,0)
 S Z=$TR(Z,"*","")
"RTN","BILOGO",157,0)
 Q Y_"*"_$P(Z,",",$L(Z,","))
"RTN","BILOGO",158,0)
 ;
"RTN","BILOGO",159,0)
 ;
"RTN","BILOGO",160,0)
 ;----------
"RTN","BILOGO",161,0)
LMVER() ;EP
"RTN","BILOGO",162,0)
 ;---> Return "Immunization"_version# for Listman screens,
"RTN","BILOGO",163,0)
 ;---> displayed in top left corner.
"RTN","BILOGO",164,0)
 ;
"RTN","BILOGO",165,0)
 Q " Immunization v"_$$VER
"RTN","BILOGO",166,0)
 ;
"RTN","BILOGO",167,0)
 ;
"RTN","BILOGO",168,0)
 ;----------
"RTN","BILOGO",169,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BILOGO",170,0)
 ;---> Print text at specified line label.
"RTN","BILOGO",171,0)
 ;
"RTN","BILOGO",172,0)
 Q:$G(BILINL)=""
"RTN","BILOGO",173,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BILOGO",174,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BILOGO",175,0)
 Q
"RTN","BINTEG")
0^17^B3324137
"RTN","BINTEG",1,0)
BINTEG ;INTEGRITY CHECKER;APR 21, 2015
"RTN","BINTEG",2,0)
 ;;8.5;IMMUNIZATION;;APR 21, 2015
"RTN","BINTEG",3,0)
 ;
"RTN","BINTEG",4,0)
START ;
"RTN","BINTEG",5,0)
 NEW BYTE,COUNT,RTN
"RTN","BINTEG",6,0)
 K ^UTILITY($J)
"RTN","BINTEG",7,0)
 F I=1:1 S X=$T(LIST+I) Q:X=""  S X=$P(X,";;",2),R=$P(X,"^",1),B=$P(X,"^",2),C=$P(X,"^",3),^UTILITY($J,R)=B_"^"_C
"RTN","BINTEG",8,0)
 F I=1:1:6 S X=$P($T(@("LINE"_I)),";;",2,99),@("XBSUMBLD("_I_")=X")
"RTN","BINTEG",9,0)
 X XBSUMBLD(1)
"RTN","BINTEG",10,0)
 Q
"RTN","BINTEG",11,0)
 ;
"RTN","BINTEG",12,0)
LINE1 ;;X XBSUMBLD(2),XBSUMBLD(6)
"RTN","BINTEG",13,0)
LINE2 ;;S RTN=0 F  S RTN=$O(^UTILITY($J,RTN)) Q:RTN=""  W !,RTN ZL @RTN S (BYTE,COUNT)=0 S X=$T(+1),X=$P(X," [ ",1) X XBSUMBLD(4),XBSUMBLD(3),XBSUMBLD(5)
"RTN","BINTEG",14,0)
LINE3 ;;F I=2:1 S X=$T(+I) Q:X=""  X XBSUMBLD(4)
"RTN","BINTEG",15,0)
LINE4 ;;F J=1:1 S Y=$E(X,J) Q:Y=""  S BYTE=BYTE+1,COUNT=COUNT+$A(Y)
"RTN","BINTEG",16,0)
LINE5 ;;S B=$P(^UTILITY($J,RTN),"^",1),C=$P(^(RTN),"^",2) I B'=BYTE!(C'=COUNT) W "  has been modified"
"RTN","BINTEG",17,0)
LINE6 ;;K XBSUMBLD,B,C,I,J,R,X,Y
"RTN","BINTEG",18,0)
 ;
"RTN","BINTEG",19,0)
LIST ;
"RTN","BINTEG",20,0)
 ;;BIDE^6255^415207
"RTN","BINTEG",21,0)
 ;;BIENVCHK^4436^288241
"RTN","BINTEG",22,0)
 ;;BILETPR1^14122^1000830
"RTN","BINTEG",23,0)
 ;;BILETPR3^6064^423030
"RTN","BINTEG",24,0)
 ;;BILOGO^4634^314454
"RTN","BINTEG",25,0)
 ;;BIPATUP1^13887^998643
"RTN","BINTEG",26,0)
 ;;BIPATUP2^4953^345355
"RTN","BINTEG",27,0)
 ;;BIPATVW2^12116^848895
"RTN","BINTEG",28,0)
 ;;BIPOST^7539^516543
"RTN","BINTEG",29,0)
 ;;BIRPC1^7112^501376
"RTN","BINTEG",30,0)
 ;;BIRPC3^11182^795370
"RTN","BINTEG",31,0)
 ;;BITN^14316^1098914
"RTN","BINTEG",32,0)
 ;;BITN2^12804^960554
"RTN","BINTEG",33,0)
 ;;BIUTL4^14073^1013952
"RTN","BINTEG",34,0)
 ;;BIUTL7^14063^964567
"RTN","BINTEG",35,0)
 ;;BIUTL8^12026^820804
"RTN","BINTEG",36,0)
 ;;BIVISIT^14063^976637
"RTN","BIPATUP1")
0^1^B52457054
"RTN","BIPATUP1",1,0)
BIPATUP1 ;IHS/CMI/MWR - UPDATE PATIENT DATA; DEC 15, 2011
"RTN","BIPATUP1",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BIPATUP1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATUP1",4,0)
 ;;  UPDATE PATIENT DATA, IMM FORECAST IN ^BIPDUE(.
"RTN","BIPATUP1",5,0)
 ;;  NOTE!: An earlier version of this routine is saved in BIZPATUP1.
"RTN","BIPATUP1",6,0)
 ;;  PATCH 8: Extensive changes to accommodate new TCH Forecaster   LDFORC+0
"RTN","BIPATUP1",7,0)
 ;;  PATCH 9: Numerous changes to accomodate new Heb B High Risk  IHSPOST+0
"RTN","BIPATUP1",8,0)
 ;;  PATCH 10: Recognize both TCH incoming 33 PNEUMO-PS or 133 PCV-13. DDUE2+56
"RTN","BIPATUP1",9,0)
 ;
"RTN","BIPATUP1",10,0)
 ;----------
"RTN","BIPATUP1",11,0)
LDFORC(BIDFN,BIFORC,BIHX,BIFDT,BIDUZ2,BINF,BIPDSS) ;EP
"RTN","BIPATUP1",12,0)
 ;---> Load Immserve Data (Immunizations Due) into ^BIPDUE(.
"RTN","BIPATUP1",13,0)
 ;---> Parameters:
"RTN","BIPATUP1",14,0)
 ;     1 - BIDFN  (req) Patient IEN.
"RTN","BIPATUP1",15,0)
 ;     2 - BIFORC (req) String containing Patient's Imms Due.
"RTN","BIPATUP1",16,0)
 ;     3 - BIHX   (req) String containing Patient's Imm History.
"RTN","BIPATUP1",17,0)
 ;     4 - BIFDT  (opt) Forecast Date (date used for forecast).
"RTN","BIPATUP1",18,0)
 ;     5 - BIDUZ2 (opt) User's DUZ(2) indicating site parameters.
"RTN","BIPATUP1",19,0)
 ;     6 - BINF   (opt) Array of Vaccine Grp IEN'S that should not be forecast.
"RTN","BIPATUP1",20,0)
 ;     7 - BIPDSS (ret) Returned string of V IMM IEN's that are
"RTN","BIPATUP1",21,0)
 ;                      Problem Doses, according to ImmServe.
"RTN","BIPATUP1",22,0)
 ;
"RTN","BIPATUP1",23,0)
 Q:'$G(BIDFN)  Q:$G(BIFORC)=""  Q:$G(BIHX)=""
"RTN","BIPATUP1",24,0)
 ;---> If no Forecast Date passed, set it equal to today.
"RTN","BIPATUP1",25,0)
 S:'$G(BIFDT) BIFDT=DT S:'$D(BINF) BINF=""
"RTN","BIPATUP1",26,0)
 ;
"RTN","BIPATUP1",27,0)
 ;---> Set Patient Age in months for this Forecast Date.
"RTN","BIPATUP1",28,0)
 N BIAGE S BIAGE=$$AGE^BIUTL1(BIDFN,2,BIFDT)
"RTN","BIPATUP1",29,0)
 ;
"RTN","BIPATUP1",30,0)
 ;---> First clear out any previously set Immunizations Due and
"RTN","BIPATUP1",31,0)
 ;---> any Forecasting Errors for this patient.
"RTN","BIPATUP1",32,0)
 D KILLDUE^BIPATUP2(BIDFN)
"RTN","BIPATUP1",33,0)
 ;
"RTN","BIPATUP1",34,0)
 ;---> If no BIDUZ2, try DUZ(2); otherwise, defaults will be used.
"RTN","BIPATUP1",35,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIPATUP1",36,0)
 ;
"RTN","BIPATUP1",37,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",38,0)
 ;---> Check for any input doses that TCH identified as problems.
"RTN","BIPATUP1",39,0)
 ;---> Build and return a string of "V IMM IEN_%_CVX" problem doses,
"RTN","BIPATUP1",40,0)
 ;---> as identified in the TCH Input Doses segment.
"RTN","BIPATUP1",41,0)
 ;D DPROBS^BIPATUP2(BIFORC,.BIPDSS,.BIID)
"RTN","BIPATUP1",42,0)
 D DPROBS^BIPATUP2(BIFORC,.BIPDSS)
"RTN","BIPATUP1",43,0)
 ;**********
"RTN","BIPATUP1",44,0)
 ;
"RTN","BIPATUP1",45,0)
 ;---> * * * * * NEXT PATCH REMOVE ALL FLU CODE. * * * * *
"RTN","BIPATUP1",46,0)
 ;---> Parse Doses Due from Forecaster string (BIFORC), perform any
"RTN","BIPATUP1",47,0)
 ;---> necessary translations, and set as due in patient global ^BIPDUE(.
"RTN","BIPATUP1",48,0)
 ;---> If Immserve set Flu due, set BIIMMFL=1.
"RTN","BIPATUP1",49,0)
 N BIIMMFL S BIIMMFL=0
"RTN","BIPATUP1",50,0)
 ;
"RTN","BIPATUP1",51,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",52,0)
 ;---> Check if TCH has already forecast Pneumo, pass in BITCHPN.
"RTN","BIPATUP1",53,0)
 ;---> If TCH set Pneumo due, set BITCHPN=1.
"RTN","BIPATUP1",54,0)
 N BITCHPN S BITCHPN=0
"RTN","BIPATUP1",55,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",56,0)
 ;---> Check if TCH has already forecast Hep B, pass in BITCHHB.
"RTN","BIPATUP1",57,0)
 N BITCHHB S BITCHHB=0
"RTN","BIPATUP1",58,0)
 ;
"RTN","BIPATUP1",59,0)
 ;D DDUE(BIFORC,BIAGE,BIHX,.BINF,.BIIMMFL,.BIIMMH1,BIDUZ2,.BITCHPN,BIFDT)
"RTN","BIPATUP1",60,0)
 D DDUE(BIFORC,BIAGE,BIHX,.BINF,.BIIMMFL,BIDUZ2,.BITCHPN,BIFDT,.BITCHHB)
"RTN","BIPATUP1",61,0)
 ;
"RTN","BIPATUP1",62,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",63,0)
 ;---> New parameter BIRISKH to pass High Risk Hep B.
"RTN","BIPATUP1",64,0)
 N BIFLU,BIFFLU,BILIVE,BIRISKI,BIRISKP,BIRISKH
"RTN","BIPATUP1",65,0)
 S BIFLU="",(BIFFLU,BILIVE,BIRISKI,BIRISKP,BIRISKH)=0
"RTN","BIPATUP1",66,0)
 ;
"RTN","BIPATUP1",67,0)
 ;---> After loading (SETDUE) TCH forecast, perform any follow-up forecasting
"RTN","BIPATUP1",68,0)
 ;---> needed for High Risk, "Post-forecast".
"RTN","BIPATUP1",69,0)
 D IHSPOST(BIDFN,BIHX,BIFDT,.BIFLU,.BIFFLU,.BIRISKI,.BIRISKP,.BILIVE,BIDUZ2,.BIRISKH)
"RTN","BIPATUP1",70,0)
 ;
"RTN","BIPATUP1",71,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",72,0)
 ;---> No longer called, since TCH forecasts Flu for all ages.
"RTN","BIPATUP1",73,0)
 ;---> Forecast Influenza.
"RTN","BIPATUP1",74,0)
 ;D IHSFLU^BIPATUP2(BIDFN,.BIFLU,BIFFLU,BIRISKI,.BINF,BIFDT,BIAGE,BIIMMFL,BIDUZ2)
"RTN","BIPATUP1",75,0)
 ;
"RTN","BIPATUP1",76,0)
 ;---> Forecast Pneumo.
"RTN","BIPATUP1",77,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",78,0)
 ;---> Only check to forecast Pneumo if TCH has not already done so.
"RTN","BIPATUP1",79,0)
 ;D IHSPNEU(BIDFN,.BIFLU,BIFFLU,BIRISKP,.BINF,BIFDT,BIAGE,BIDUZ2)
"RTN","BIPATUP1",80,0)
 I '$G(BITCHPN) D IHSPNEU(BIDFN,.BIFLU,BIFFLU,BIRISKP,.BINF,BIFDT,BIAGE,BIDUZ2)
"RTN","BIPATUP1",81,0)
 ;
"RTN","BIPATUP1",82,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",83,0)
 ;---> Only check to forecast HepB if TCH has not already done so.
"RTN","BIPATUP1",84,0)
 ;---> Forecast HepB.
"RTN","BIPATUP1",85,0)
 I '$G(BITCHHB) D IHSHEPB(BIDFN,.BIFLU,.BINF,BIFDT,BIAGE,BIDUZ2,BIRISKH)
"RTN","BIPATUP1",86,0)
 ;
"RTN","BIPATUP1",87,0)
 Q
"RTN","BIPATUP1",88,0)
 ;
"RTN","BIPATUP1",89,0)
 ;
"RTN","BIPATUP1",90,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",91,0)
 ;---> Add BITCHPN parameter to pass TCH already forecast Pneumo.
"RTN","BIPATUP1",92,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",93,0)
 ;---> Add BITCHHB parameter to pass TCH already forecast Hep B.
"RTN","BIPATUP1",94,0)
 ;----------
"RTN","BIPATUP1",95,0)
DDUE(BIFORC,BIAGE,BIHX,BINF,BIIMMFL,BIDUZ2,BITCHPN,BIFDT,BITCHHB) ;EP
"RTN","BIPATUP1",96,0)
 ;---> Parse Doses Due from Immserve string (BIFORC), perform any
"RTN","BIPATUP1",97,0)
 ;---> necessary translations, and set as due in patient global ^BIPDUE.
"RTN","BIPATUP1",98,0)
 ;---> Parameters:
"RTN","BIPATUP1",99,0)
 ;     1 - BIFORC  (req) Forecast string coming back from TCH.
"RTN","BIPATUP1",100,0)
 ;     2 - BIAGE   (req) Patient Age in months for this Forecast Date.
"RTN","BIPATUP1",101,0)
 ;     3 - BIHX    (req) String containing Patient's Imm History.
"RTN","BIPATUP1",102,0)
 ;     4 - BINF    (opt) Array of Vaccine Grp IEN'S that should not be forecast.
"RTN","BIPATUP1",103,0)
 ;     5 - BIIMMFL (opt) BIIMMFL=1 means Immserve already forecast Flu.
"RTN","BIPATUP1",104,0)
 ;     6 - BIDUZ2  (opt) User's DUZ(2) indicating site parameters.
"RTN","BIPATUP1",105,0)
 ;     7 - BITCHPN (opt) BITCHPN=1 means TCH already forecast Pneumo.
"RTN","BIPATUP1",106,0)
 ;     8 - BIFDT   (opt) Forecast Date (date used for forecast).
"RTN","BIPATUP1",107,0)
 ;     9 - BITCHHB (opt) BITCHHB=1 means TCH already forecast Hep B.
"RTN","BIPATUP1",108,0)
 ;
"RTN","BIPATUP1",109,0)
 ;
"RTN","BIPATUP1",110,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",111,0)
 ;---> Changes to accommodate new TCH Forecaster parsing.
"RTN","BIPATUP1",112,0)
 N BIFORC1,BIDOSE,N
"RTN","BIPATUP1",113,0)
 S BIFORC1=$P(BIFORC,"~~~",3)
"RTN","BIPATUP1",114,0)
 ;
"RTN","BIPATUP1",115,0)
 F N=1:1 S BIDOSE=$P(BIFORC1,"|||",N) Q:(BIDOSE="")  D
"RTN","BIPATUP1",116,0)
 .D DDUE2(BIDOSE,BIAGE,BIHX,.BINF,.BIPC,.BIIMMFL,BIDUZ2,.BITCHPN,BIFDT,.BITCHHB)
"RTN","BIPATUP1",117,0)
 Q
"RTN","BIPATUP1",118,0)
 ;
"RTN","BIPATUP1",119,0)
 ;
"RTN","BIPATUP1",120,0)
 ;----------
"RTN","BIPATUP1",121,0)
DDUE2(BIDOSE,BIAGE,BIHX,BINF,BIPC,BIIMMFL,BIDUZ2,BITCHPN,BIFDT,BITCHHB) ;EP
"RTN","BIPATUP1",122,0)
 ;---> Parse Doses Due (see linelabel DDUE above).
"RTN","BIPATUP1",123,0)
 ;---> Parameters: See DDUE immediately above!
"RTN","BIPATUP1",124,0)
 ;
"RTN","BIPATUP1",125,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",126,0)
 ;---> Many changes below to accommodate new TCH Forecaster.
"RTN","BIPATUP1",127,0)
 ;
"RTN","BIPATUP1",128,0)
 ;---> Uncomment next line to see raw ImmServe Doses Due:
"RTN","BIPATUP1",129,0)
 ;W !!!,BIDOSE R ZZZ
"RTN","BIPATUP1",130,0)
 ;
"RTN","BIPATUP1",131,0)
 N A,BI,D,X S X=BIDOSE
"RTN","BIPATUP1",132,0)
 ;---> A=CVX Code
"RTN","BIPATUP1",133,0)
 S A=$P(X,U,1)
"RTN","BIPATUP1",134,0)
 ;
"RTN","BIPATUP1",135,0)
 ;---> "PAST"=Past Due Indicator
"RTN","BIPATUP1",136,0)
 S BI("PAST")=$P(X,U,3)
"RTN","BIPATUP1",137,0)
 ;
"RTN","BIPATUP1",138,0)
 ;---> Get Fileman formats of due dates.
"RTN","BIPATUP1",139,0)
 ;---> "MIN"=Minimum Date Due
"RTN","BIPATUP1",140,0)
 S BI("MIN")=$$TCHFMDT^BIUTL5($P(X,U,4)) S:('BI("MIN")) BI("MIN")=""
"RTN","BIPATUP1",141,0)
 ;
"RTN","BIPATUP1",142,0)
 ;---> "REC"=Recommended Date Due
"RTN","BIPATUP1",143,0)
 S BI("REC")=$$TCHFMDT^BIUTL5($P(X,U,5)) S:('BI("REC")) BI("REC")=""
"RTN","BIPATUP1",144,0)
 ;
"RTN","BIPATUP1",145,0)
 ;---> "EXC"=Exceeds Date Due
"RTN","BIPATUP1",146,0)
 S BI("EXC")=$$TCHFMDT^BIUTL5($P(X,U,6)) S:('BI("EXC")) BI("EXC")=""
"RTN","BIPATUP1",147,0)
 ;
"RTN","BIPATUP1",148,0)
 ;---> Determine whether to set Recommended Age or Minimum Accepted Age
"RTN","BIPATUP1",149,0)
 ;---> based on Site Parameter.
"RTN","BIPATUP1",150,0)
 S BI("DUE")=BI("REC")
"RTN","BIPATUP1",151,0)
 I $$MINAGE^BIUTL2($G(BIDUZ2))="A" S BI("DUE")=BI("MIN")
"RTN","BIPATUP1",152,0)
 ;
"RTN","BIPATUP1",153,0)
 ;---> If this dose is past due (B=1), D(2) will stuff DATE PAST DUE;
"RTN","BIPATUP1",154,0)
 ;---> Otherwise, D(1) will stuff RECOMMENDED DATE DUE.
"RTN","BIPATUP1",155,0)
 ;S (D(1),D(2))="" D
"RTN","BIPATUP1",156,0)
 ;.I B S D(2)=D Q
"RTN","BIPATUP1",157,0)
 ;.S D(1)=D
"RTN","BIPATUP1",158,0)
 S (D(1),D(2))="" D
"RTN","BIPATUP1",159,0)
 .I BI("PAST") S D(2)=BI("EXC") Q
"RTN","BIPATUP1",160,0)
 .S D(1)=BI("DUE")
"RTN","BIPATUP1",161,0)
 ;
"RTN","BIPATUP1",162,0)
 ;---> *** TRANSLATIONS OF INCOMING IMMSERVE VACCINES:
"RTN","BIPATUP1",163,0)
 ;--->     -------------------------------------------
"RTN","BIPATUP1",164,0)
 ;
"RTN","BIPATUP1",165,0)
 Q:A=""
"RTN","BIPATUP1",166,0)
 ;
"RTN","BIPATUP1",167,0)
 ;---> Check to see if Site specified do not forecast this Vaccine Group.
"RTN","BIPATUP1",168,0)
 Q:$D(BINF($$HL7TX^BIUTL2(A,1)))
"RTN","BIPATUP1",169,0)
 ;
"RTN","BIPATUP1",170,0)
 ;---> Add this Immunization Due.
"RTN","BIPATUP1",171,0)
 D SETDUE^BIPATUP2(BIDFN_U_$$HL7TX^BIUTL2(A)_U_U_D(1)_U_D(2))
"RTN","BIPATUP1",172,0)
 ;
"RTN","BIPATUP1",173,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",174,0)
 ;---> If TCH set Pneumo due, set BITCHPN=1.
"RTN","BIPATUP1",175,0)
 ;
"RTN","BIPATUP1",176,0)
 ;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BIPATUP1",177,0)
 ;---> Check for TCH incoming 33 PNEUMO-PS or 133 PCV-13.
"RTN","BIPATUP1",178,0)
 ;S:(A=33) BITCHPN=1
"RTN","BIPATUP1",179,0)
 S:((A=33)!(A=133)) BITCHPN=1
"RTN","BIPATUP1",180,0)
 ;**********
"RTN","BIPATUP1",181,0)
 ;
"RTN","BIPATUP1",182,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",183,0)
 ;---> If TCH set Hep B due, set BITCHHB=1.
"RTN","BIPATUP1",184,0)
 S:(A=45) BITCHHB=1
"RTN","BIPATUP1",185,0)
 ;**********
"RTN","BIPATUP1",186,0)
 ;
"RTN","BIPATUP1",187,0)
 Q
"RTN","BIPATUP1",188,0)
 ;
"RTN","BIPATUP1",189,0)
 ;
"RTN","BIPATUP1",190,0)
 ;----------
"RTN","BIPATUP1",191,0)
IHSPOST(BIDFN,BIHX,BIFDT,BIFLU,BIFFLU,BIRISKI,BIRISKP,BILIVE,BIDUZ2,BIRISKH) ;EP
"RTN","BIPATUP1",192,0)
 ;---> Post forecast; after loading  TCH forecast, perform any follow-up forecasting
"RTN","BIPATUP1",193,0)
 ;---> needed for High Risk.
"RTN","BIPATUP1",194,0)
 ;---> Parameters:
"RTN","BIPATUP1",195,0)
 ;     1 - BIDFN   (req) Patient IEN.
"RTN","BIPATUP1",196,0)
 ;     2 - BIHX    (req) String containing Patient's Imm History.
"RTN","BIPATUP1",197,0)
 ;     3 - BIFDT   (req) Forecast Date (date used for forecast).
"RTN","BIPATUP1",198,0)
 ;     4 - BIFLU   (ret) Pneumo & Hep B history array: BIFLU(CVX,INVDATE).
"RTN","BIPATUP1",199,0)
 ;     5 - BIFFLU  (ret) Value (0-4) for force Flu/Pneumo regardless of age.
"RTN","BIPATUP1",200,0)
 ;     6 - BIRISKI (ret) 1=Patient has Risk of Influenza; otherwise 0.
"RTN","BIPATUP1",201,0)
 ;     7 - BIRISKP (ret) 1=Patient has Risk of Pneumo; otherwise 0.
"RTN","BIPATUP1",202,0)
 ;     8 - BILIVE  (ret) 1-Patient received a LIVE vaccine <28 days before
"RTN","BIPATUP1",203,0)
 ;                       the forecast date.
"RTN","BIPATUP1",204,0)
 ;     9 - BIDUZ2  (req) User's DUZ(2) indicating Immserve Forc Rules.
"RTN","BIPATUP1",205,0)
 ;    10 - BIRISKH (ret) 1=Patient has Risk of Hep B; otherwise 0.
"RTN","BIPATUP1",206,0)
 ;
"RTN","BIPATUP1",207,0)
 ;---> Loop through History string, gathering previous Influenzas and Pneumos.
"RTN","BIPATUP1",208,0)
 ;
"RTN","BIPATUP1",209,0)
 N BIDOSE,BIHX1,I,X,Y
"RTN","BIPATUP1",210,0)
 S BIHX1=$P(BIHX,"~~~",2)
"RTN","BIPATUP1",211,0)
 ;
"RTN","BIPATUP1",212,0)
 ;---> Loop through RPMS Input String History, collecting for prior Pneumo.
"RTN","BIPATUP1",213,0)
 ;---> Store in BIFLU by HL7 Code, inverse date.
"RTN","BIPATUP1",214,0)
 ;F I=1:1:Y D
"RTN","BIPATUP1",215,0)
 F I=1:1  S BIDOSE=$P(BIHX1,"|||",I) Q:BIDOSE=""  D
"RTN","BIPATUP1",216,0)
 .;
"RTN","BIPATUP1",217,0)
 .;---> For this Immunization, set A=CVX Code, D=Date.
"RTN","BIPATUP1",218,0)
 .N A,D S A=$P(BIDOSE,U,2),D=$P(BIDOSE,U,3)
"RTN","BIPATUP1",219,0)
 .;---> Quit if Dose Override (ImmServe Input Field 51)=Invalid Dose=2.
"RTN","BIPATUP1",220,0)
 .;I $P(BIDOSE,U,5),$P(BIDOSE,U,5)<9 Q
"RTN","BIPATUP1",221,0)
 .;
"RTN","BIPATUP1",222,0)
 .;
"RTN","BIPATUP1",223,0)
 .;---> If this is a Pneumo (33,100,109) or Hep B (8,42,43,44,45,etc.))
"RTN","BIPATUP1",224,0)
 .;---> translate and store it in local array BIFLU(CVX,Inverse Fm date).
"RTN","BIPATUP1",225,0)
 .;
"RTN","BIPATUP1",226,0)
 .;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",227,0)
 .;---> Update Pneumo CVX's.
"RTN","BIPATUP1",228,0)
 .;S:((A=100)!(A=109)) A=33
"RTN","BIPATUP1",229,0)
 .S:((A=100)!(A=109)!(A=133)!(A=152)) A=33
"RTN","BIPATUP1",230,0)
 .;
"RTN","BIPATUP1",231,0)
 .;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",232,0)
 .;---> Collect Hep B CVX's.
"RTN","BIPATUP1",233,0)
 .S:((A=8)!(A=42)!(A=44)!(A=43)!(A=43)!(A=51)!(A=102)) A=45
"RTN","BIPATUP1",234,0)
 .S:((A=104)!(A=110)!(A=132)!(A=146)) A=45
"RTN","BIPATUP1",235,0)
 .;
"RTN","BIPATUP1",236,0)
 .;
"RTN","BIPATUP1",237,0)
 .;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",238,0)
 .;---> Only concerned with Pneumos.
"RTN","BIPATUP1",239,0)
 .;
"RTN","BIPATUP1",240,0)
 .;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",241,0)
 .;---> Now concerned with Hep B's too.
"RTN","BIPATUP1",242,0)
 .;S:(A=33) BIFLU(A,9999999-$$TCHFMDT^BIUTL5(D))=""
"RTN","BIPATUP1",243,0)
 .S:(A=33)!(A=45) BIFLU(A,9999999-$$TCHFMDT^BIUTL5(D))=""
"RTN","BIPATUP1",244,0)
 .;**********
"RTN","BIPATUP1",245,0)
 .;S X=X+7 OLD IMMSERVE COUNTER.
"RTN","BIPATUP1",246,0)
 ;
"RTN","BIPATUP1",247,0)
 ;
"RTN","BIPATUP1",248,0)
 ;---> Get value for forced Influenza regardless of age.
"RTN","BIPATUP1",249,0)
 ;---> 0=Normal, 1=Influenza, 2=Pneumococcal, 3=Both, 4=Disregard Risk Factors.
"RTN","BIPATUP1",250,0)
 S BIFFLU=$$INFL^BIUTL11(BIDFN)
"RTN","BIPATUP1",251,0)
 ;---> Quit (don't check Risk Factors) if BIFFLU=4, Disregard Risk Factors.
"RTN","BIPATUP1",252,0)
 Q:BIFFLU=4
"RTN","BIPATUP1",253,0)
 ;
"RTN","BIPATUP1",254,0)
 ;
"RTN","BIPATUP1",255,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",256,0)
 ;---> Accommodate new parameter options.
"RTN","BIPATUP1",257,0)
 ;---> Quit if Site Param says NOT to include Risk Factors.
"RTN","BIPATUP1",258,0)
 N BIRSK S BIRSK=$$RISKP^BIUTL2(BIDUZ2)
"RTN","BIPATUP1",259,0)
 Q:'BIRSK
"RTN","BIPATUP1",260,0)
 ;
"RTN","BIPATUP1",261,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",262,0)
 ;---> Only Pneumo will be checked (Flu now forecast for everyone), by
"RTN","BIPATUP1",263,0)
 ;---> passing 2 in the third parameter.
"RTN","BIPATUP1",264,0)
 ;
"RTN","BIPATUP1",265,0)
 ;---> Check for Influenza and Pneumo Risk Factors.
"RTN","BIPATUP1",266,0)
 ;---> If BIRISKI, BIRISKP =0, then either site param is turned off
"RTN","BIPATUP1",267,0)
 ;---> or patient is NOT High Risk.  Both cases exclude it from forecast.
"RTN","BIPATUP1",268,0)
 ;D RISK^BIDX(BIDFN,BIFDT,0,.BIRISKI,.BIRISKP)
"RTN","BIPATUP1",269,0)
 ;
"RTN","BIPATUP1",270,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",271,0)
 ;---> New parameter to return Hep B risk. (No longer include Flu.)
"RTN","BIPATUP1",272,0)
 ;D RISK^BIDX(BIDFN,BIFDT,2,.BIRISKI,.BIRISKP)
"RTN","BIPATUP1",273,0)
 D RISK^BIDX(BIDFN,BIFDT,BIRSK,,.BIRISKP,.BIRISKH)
"RTN","BIPATUP1",274,0)
 ;**********
"RTN","BIPATUP1",275,0)
 Q
"RTN","BIPATUP1",276,0)
 ;
"RTN","BIPATUP1",277,0)
 ;
"RTN","BIPATUP1",278,0)
 ;----------
"RTN","BIPATUP1",279,0)
IHSPNEU(BIDFN,BIFLU,BIFFLU,BIRISKP,BINF,BIFDT,BIAGE,BIDUZ2) ;EP
"RTN","BIPATUP1",280,0)
 ;---> IHS Pneumo Forecast.
"RTN","BIPATUP1",281,0)
 ;---> Parameters:
"RTN","BIPATUP1",282,0)
 ;     1 - BIDFN   (req) Patient IEN.
"RTN","BIPATUP1",283,0)
 ;     2 - BIFLU   (req) Influ and Pneumo History array: BIFLU(CVX,INVDATE).
"RTN","BIPATUP1",284,0)
 ;     3 - BIFFLU  (req) Value (0-4) for force Flu/Pneumo regardless of age.
"RTN","BIPATUP1",285,0)
 ;     4 - BIRISKP (req) 1=Patient has Risk of Pneumo; otherwise 0.
"RTN","BIPATUP1",286,0)
 ;     5 - BINF    (opt) Array of Vaccine Grp IEN'S that should not be forecast.
"RTN","BIPATUP1",287,0)
 ;     6 - BIFDT   (req) Forecast Date (date used for forecast).
"RTN","BIPATUP1",288,0)
 ;     7 - BIAGE   (req) Patient Age in months for this Forecast Date.
"RTN","BIPATUP1",289,0)
 ;     8 - BIDUZ2  (req) User's DUZ(2) indicating Immserve Forc Rules.
"RTN","BIPATUP1",290,0)
 ;
"RTN","BIPATUP1",291,0)
 ;---> Quit if Forecasting turned off for Pneumo.
"RTN","BIPATUP1",292,0)
 Q:$D(BINF(11))
"RTN","BIPATUP1",293,0)
 ;
"RTN","BIPATUP1",294,0)
 ;---> Quit if this patient has a contraindication to Pneumo.
"RTN","BIPATUP1",295,0)
 ;********** PATCH 4, v8.5, DEC 01,2012, IHS/CMI/MWR
"RTN","BIPATUP1",296,0)
 ;---> Use newer Related Contraindications call to determine contraindicaton.
"RTN","BIPATUP1",297,0)
 ;Q:$$CONTR^BIUTL11(BIDFN,119)
"RTN","BIPATUP1",298,0)
 N BICT D CONTRA^BIUTL11(BIDFN,.BICT)
"RTN","BIPATUP1",299,0)
 Q:$D(BICT(33))
"RTN","BIPATUP1",300,0)
 ;**********
"RTN","BIPATUP1",301,0)
 ;
"RTN","BIPATUP1",302,0)
 ;---> Quit if this Pt Age <60 months (5yrs), regardless of risk.
"RTN","BIPATUP1",303,0)
 Q:BIAGE<60
"RTN","BIPATUP1",304,0)
 ;
"RTN","BIPATUP1",305,0)
 N BIPNAGE,BIMRECNT,BIALLAGE
"RTN","BIPATUP1",306,0)
 ;---> BIPNAGE=Site Parameter Age to forecast Pneumo ("Pneumo Age") in months.
"RTN","BIPATUP1",307,0)
 S BIPNAGE=($P($$PNMAGE^BIPATUP2(BIDUZ2),U)*12)
"RTN","BIPATUP1",308,0)
 ;---> BIMRECNT=Fileman Date of most recent Pneumo.
"RTN","BIPATUP1",309,0)
 S BIMRECNT=(9999999-$O(BIFLU(33,0))) S:BIMRECNT=9999999 BIMRECNT=0
"RTN","BIPATUP1",310,0)
 S BIALLAGE=0
"RTN","BIPATUP1",311,0)
 ;
"RTN","BIPATUP1",312,0)
 ;---> Quit if patient is less than Age Appropriate for Pneumo in years
"RTN","BIPATUP1",313,0)
 ;---> and has already had one Pneumo.
"RTN","BIPATUP1",314,0)
 Q:((BIAGE<BIPNAGE)&(BIMRECNT))
"RTN","BIPATUP1",315,0)
 ;
"RTN","BIPATUP1",316,0)
 ;---> If High Risk Pneumo or Forecast Regardless of Age, set BIALLAGE=1.
"RTN","BIPATUP1",317,0)
 I BIRISKP!(23[BIFFLU) S BIALLAGE=1
"RTN","BIPATUP1",318,0)
 ;
"RTN","BIPATUP1",319,0)
 ;---> Quit if Pt Age < Pneumo Age (on Forecast date) and not forecast for
"RTN","BIPATUP1",320,0)
 ;---> all ages.
"RTN","BIPATUP1",321,0)
 Q:((BIAGE<BIPNAGE)&('BIALLAGE))
"RTN","BIPATUP1",322,0)
 ;
"RTN","BIPATUP1",323,0)
 ;---> If patient has reached site Pneumo Age or has Forced Pneumo AND
"RTN","BIPATUP1",324,0)
 ;---> has NO previous pneumo, then forecast Pneumo and quit.
"RTN","BIPATUP1",325,0)
 I ((BIAGE'<BIPNAGE)!BIALLAGE),'BIMRECNT D  Q
"RTN","BIPATUP1",326,0)
 .D SETDUE^BIPATUP2(BIDFN_U_$$HL7TX^BIUTL2(33)_U_U_BIFDT)
"RTN","BIPATUP1",327,0)
 ;
"RTN","BIPATUP1",328,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP1",329,0)
 ;---> TCH will forecast routine Pneumo after age 65.
"RTN","BIPATUP1",330,0)
 Q
"RTN","BIPATUP1",331,0)
 ;
"RTN","BIPATUP1",332,0)
 ;
"RTN","BIPATUP1",333,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP1",334,0)
 ;---> Add parameter for Hep B (BIRISKH). Change BIFFLU to BIRSK.
"RTN","BIPATUP1",335,0)
 ;----------
"RTN","BIPATUP1",336,0)
IHSHEPB(BIDFN,BIFLU,BINF,BIFDT,BIAGE,BIDUZ2,BIRISKH) ;EP
"RTN","BIPATUP1",337,0)
 ;---> IHS Hep B Forecast.
"RTN","BIPATUP1",338,0)
 ;---> Parameters:
"RTN","BIPATUP1",339,0)
 ;     1 - BIDFN   (req) Patient IEN.
"RTN","BIPATUP1",340,0)
 ;     2 - BIFLU   (req) Influ and Pneumo History array: BIFLU(CVX,INVDATE).
"RTN","BIPATUP1",341,0)
 ;     3 - BINF    (opt) Array of Vaccine Grp IEN'S that should not be forecast.
"RTN","BIPATUP1",342,0)
 ;     4 - BIFDT   (req) Forecast Date (date used for forecast).
"RTN","BIPATUP1",343,0)
 ;     5 - BIAGE   (req) Patient Age in months for this Forecast Date.
"RTN","BIPATUP1",344,0)
 ;     6 - BIDUZ2  (req) User's DUZ(2) indicating Immserve Forc Rules.
"RTN","BIPATUP1",345,0)
 ;     7 - BIRISKH (req) 1=Patient has Risk of HEP B; otherwise 0.
"RTN","BIPATUP1",346,0)
 ;
"RTN","BIPATUP1",347,0)
 ;---> Quit if Forecasting turned off for Hep B.
"RTN","BIPATUP1",348,0)
 Q:$D(BINF(4))
"RTN","BIPATUP1",349,0)
 ;
"RTN","BIPATUP1",350,0)
 ;---> Quit if this patient has a contraindication to Hep B.
"RTN","BIPATUP1",351,0)
 N BICT D CONTRA^BIUTL11(BIDFN,.BICT)
"RTN","BIPATUP1",352,0)
 Q:$D(BICT(45))
"RTN","BIPATUP1",353,0)
 ;**********
"RTN","BIPATUP1",354,0)
 ;
"RTN","BIPATUP1",355,0)
 ;---> Quit if this Pt Age < 19 yrs or older than 60 yrs, regardless of risk.
"RTN","BIPATUP1",356,0)
 Q:(BIAGE<228)  Q:(BIAGE>719)
"RTN","BIPATUP1",357,0)
 ;
"RTN","BIPATUP1",358,0)
 ;---> Quit if this patient ever received a Hep B.
"RTN","BIPATUP1",359,0)
 Q:$D(BIFLU(45))
"RTN","BIPATUP1",360,0)
 ;
"RTN","BIPATUP1",361,0)
 ;---> Quit iF patient is NOT High Risk for Hep B.
"RTN","BIPATUP1",362,0)
 Q:('BIRISKH)
"RTN","BIPATUP1",363,0)
 ;
"RTN","BIPATUP1",364,0)
 D SETDUE^BIPATUP2(BIDFN_U_$$HL7TX^BIUTL2(45)_U_U_BIFDT)
"RTN","BIPATUP1",365,0)
 Q
"RTN","BIPATUP2")
0^2^B15773691
"RTN","BIPATUP2",1,0)
BIPATUP2 ;IHS/CMI/MWR - UPDATE PATIENT DATA 2; OCT 15, 2010
"RTN","BIPATUP2",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BIPATUP2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATUP2",4,0)
 ;;  IHS FORECAST. UPDATE PATIENT DATA, IMM FORECAST IN ^BIPDUE(.
"RTN","BIPATUP2",5,0)
 ;;  NOTE!: An earlier version of this routine is saved in BIZPATUP2.
"RTN","BIPATUP2",6,0)
 ;;  PATCH 8: Changes for Problem Doses retrieval from TCH Forecaster.  DPROBS+10
"RTN","BIPATUP2",7,0)
 ;;  PATCH 9: Mods to flag only problem components of combo vaccines.  DPROBS+23
"RTN","BIPATUP2",8,0)
 ;;  PATCH 10: Strip TCH's leading zero, so it matches RPMS CVX.  DPROBS+32
"RTN","BIPATUP2",9,0)
 ;
"RTN","BIPATUP2",10,0)
 ;
"RTN","BIPATUP2",11,0)
 ;----------
"RTN","BIPATUP2",12,0)
DPROBS(BIFORC,BIPDSS,BIID) ;EP
"RTN","BIPATUP2",13,0)
 ;---> Check for any Input Doses that have Dose Problems.
"RTN","BIPATUP2",14,0)
 ;---> If any exist, build the string BIPDSS, concatenating the
"RTN","BIPATUP2",15,0)
 ;---> Visit IEN's with U.
"RTN","BIPATUP2",16,0)
 ;---> Parameters:
"RTN","BIPATUP2",17,0)
 ;     1 - BIFORC (req) Forecast string coming back from TCH.
"RTN","BIPATUP2",18,0)
 ;     2 - BIPDSS (ret) Returned string of V IMM IEN's that are Problem Doses.
"RTN","BIPATUP2",19,0)
 ;                      according to ImmServe.
"RTN","BIPATUP2",20,0)
 ;     3 - BIID   (ret) NO LONGER USED. Immserve "Number of Input Doses" (Field 109 in 2010).
"RTN","BIPATUP2",21,0)
 ;
"RTN","BIPATUP2",22,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPATUP2",23,0)
 ;---> Changes to accommodate new TCH Forecaster.
"RTN","BIPATUP2",24,0)
 ;
"RTN","BIPATUP2",25,0)
 S BIPDSS=""
"RTN","BIPATUP2",26,0)
 ;
"RTN","BIPATUP2",27,0)
 ;---> NOTE: Pulling History from the TCH Output String (NOT RPMS Input string).
"RTN","BIPATUP2",28,0)
 N BIFORC1,BIDOSE,N
"RTN","BIPATUP2",29,0)
 S BIFORC1=$P(BIFORC,"~~~",2)
"RTN","BIPATUP2",30,0)
 ;
"RTN","BIPATUP2",31,0)
 F N=1:1 S BIDOSE=$P(BIFORC1,"|||",N) Q:(BIDOSE="")  D
"RTN","BIPATUP2",32,0)
 .;---> If this Input Dose was TCH-invalid (pc6), set V Imm IEN_%_CVX in
"RTN","BIPATUP2",33,0)
 .;---> Problem Doses string (BIPDSS).
"RTN","BIPATUP2",34,0)
 .;
"RTN","BIPATUP2",35,0)
 .;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATUP2",36,0)
 .;---> Mods to flag only problem components of combo vaccines.
"RTN","BIPATUP2",37,0)
 .;
"RTN","BIPATUP2",38,0)
 .;---> Quit if this is not a problem dose.
"RTN","BIPATUP2",39,0)
 .Q:('$P(BIDOSE,U,6))
"RTN","BIPATUP2",40,0)
 .;
"RTN","BIPATUP2",41,0)
 .N BICVXS S BICVXS=$P(BIDOSE,U,7)
"RTN","BIPATUP2",42,0)
 .;---> If piece 7 is null then not a combo, set BIPDSS and quit.
"RTN","BIPATUP2",43,0)
 .;
"RTN","BIPATUP2",44,0)
 .;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BIPATUP2",45,0)
 .;---> Strip TCH's leading zero, so it matches RPMS CVX ("03"=3).
"RTN","BIPATUP2",46,0)
 .;I 'BICVXS S BIPDSS=BIPDSS_$P(BIDOSE,U)_"%"_$P(BIDOSE,U,2)_U Q
"RTN","BIPATUP2",47,0)
 .I 'BICVXS S BIPDSS=BIPDSS_$P(BIDOSE,U)_"%"_+$P(BIDOSE,U,2)_U Q
"RTN","BIPATUP2",48,0)
 .;**********
"RTN","BIPATUP2",49,0)
 .;
"RTN","BIPATUP2",50,0)
 .;--> Piece 7 equals one or more problem CVX's in this combo, delimited by comma.
"RTN","BIPATUP2",51,0)
 .N J F J=1:1 S BICVX=$P(BICVXS,",",J) Q:'BICVX  D
"RTN","BIPATUP2",52,0)
 ..S BIPDSS=BIPDSS_$P(BIDOSE,U)_"%"_BICVX_U
"RTN","BIPATUP2",53,0)
 .;**********
"RTN","BIPATUP2",54,0)
 ;
"RTN","BIPATUP2",55,0)
 ;W !,BIPDSS R ZZZ
"RTN","BIPATUP2",56,0)
 Q
"RTN","BIPATUP2",57,0)
 ;
"RTN","BIPATUP2",58,0)
 ;
"RTN","BIPATUP2",59,0)
 ;----------
"RTN","BIPATUP2",60,0)
KILLDUE(BIDFN) ;EP
"RTN","BIPATUP2",61,0)
 ;---> Clear out any previously set Immunizations Due and
"RTN","BIPATUP2",62,0)
 ;---> any Forecasting Errors for this patient.
"RTN","BIPATUP2",63,0)
 ;---> Hardcoded to improve performance during massive reports.
"RTN","BIPATUP2",64,0)
 ;---> Parameters:
"RTN","BIPATUP2",65,0)
 ;     1 - BIDFN (req) Patient IEN.
"RTN","BIPATUP2",66,0)
 ;
"RTN","BIPATUP2",67,0)
 Q:'BIDFN
"RTN","BIPATUP2",68,0)
 ;
"RTN","BIPATUP2",69,0)
 ;---> Clear previous Immunizations Due.
"RTN","BIPATUP2",70,0)
 D:$D(^BIPDUE("B",BIDFN))
"RTN","BIPATUP2",71,0)
 .N N S N=0
"RTN","BIPATUP2",72,0)
 .F  S N=$O(^BIPDUE("B",BIDFN,N)) Q:'N  D
"RTN","BIPATUP2",73,0)
 ..N Y,Z S Y=$G(^BIPDUE(N,0))
"RTN","BIPATUP2",74,0)
 ..K ^BIPDUE(N),^BIPDUE("B",BIDFN,N)
"RTN","BIPATUP2",75,0)
 ..Q:Y=""
"RTN","BIPATUP2",76,0)
 ..S Z=$P(Y,U,4) K:Z ^BIPDUE("D",Z,N)
"RTN","BIPATUP2",77,0)
 ..S Z=$P(Y,U,5) K:Z ^BIPDUE("D",Z,N)
"RTN","BIPATUP2",78,0)
 ..S $P(^BIPDUE(0),U,4)=$P(^BIPDUE(0),U,4)-1
"RTN","BIPATUP2",79,0)
 .K ^BIPDUE("B",BIDFN),^BIPDUE("E",BIDFN)
"RTN","BIPATUP2",80,0)
 ;
"RTN","BIPATUP2",81,0)
 ;---> Clear previous Forecasting Errors.
"RTN","BIPATUP2",82,0)
 D:$D(^BIPERR("B",BIDFN))
"RTN","BIPATUP2",83,0)
 .N N S N=0
"RTN","BIPATUP2",84,0)
 .F  S N=$O(^BIPERR("B",BIDFN,N)) Q:'N  D
"RTN","BIPATUP2",85,0)
 ..K ^BIPERR("B",BIDFN,N),^BIPERR(N)
"RTN","BIPATUP2",86,0)
 ..S $P(^BIPERR(0),U,4)=$P(^BIPERR(0),U,4)-1
"RTN","BIPATUP2",87,0)
 .K ^BIPERR("B",BIDFN)
"RTN","BIPATUP2",88,0)
 Q
"RTN","BIPATUP2",89,0)
 ;
"RTN","BIPATUP2",90,0)
 ;
"RTN","BIPATUP2",91,0)
 ;----------
"RTN","BIPATUP2",92,0)
IMMSDT(DATE) ;EP
"RTN","BIPATUP2",93,0)
 ;---> Convert Immserve Date (format MMDDYYYY) TO FILEMAN
"RTN","BIPATUP2",94,0)
 ;---> Internal format.
"RTN","BIPATUP2",95,0)
 ;---> NOTE: This code is copied from routine ^BIUTL5 for speed.
"RTN","BIPATUP2",96,0)
 ;---> Any changes here should also be made to ^BIUTL5 too.
"RTN","BIPATUP2",97,0)
 Q:'$G(DATE) "NO DATE"
"RTN","BIPATUP2",98,0)
 Q ($E(DATE,5,9)-1700)_$E(DATE,1,2)_$E(DATE,3,4)
"RTN","BIPATUP2",99,0)
 ;
"RTN","BIPATUP2",100,0)
 ;
"RTN","BIPATUP2",101,0)
 ;----------
"RTN","BIPATUP2",102,0)
PNMAGE(BISITE) ;EP - Return Age Appropriate in years for Pneumo at this site.
"RTN","BIPATUP2",103,0)
 ;---> Parameters:
"RTN","BIPATUP2",104,0)
 ;     1 - BISITE (req) User's DUZ(2)
"RTN","BIPATUP2",105,0)
 ;
"RTN","BIPATUP2",106,0)
 Q:'$G(BISITE) "65"
"RTN","BIPATUP2",107,0)
 N Y
"RTN","BIPATUP2",108,0)
 S Y=$P($G(^BISITE(BISITE,0)),U,10) S:'Y Y=65
"RTN","BIPATUP2",109,0)
 Q Y
"RTN","BIPATUP2",110,0)
 ;---> q6-years no longer used.
"RTN","BIPATUP2",111,0)
 ;Q:'$G(BISITE) "65^0"
"RTN","BIPATUP2",112,0)
 ;N Y,Z
"RTN","BIPATUP2",113,0)
 ;S Y=$P($G(^BISITE(BISITE,0)),U,10) S:'Y Y=65
"RTN","BIPATUP2",114,0)
 ;S Z=$P($G(^BISITE(BISITE,0)),U,22) S:'Z Z=0
"RTN","BIPATUP2",115,0)
 ;Q Y_U_Z
"RTN","BIPATUP2",116,0)
 Q
"RTN","BIPATUP2",117,0)
 ;
"RTN","BIPATUP2",118,0)
 ;
"RTN","BIPATUP2",119,0)
 ;----------
"RTN","BIPATUP2",120,0)
FLUALL(BISITE) ;EP - Return 1 to forecast Flu for ALL ages.
"RTN","BIPATUP2",121,0)
 ;---> Parameters:
"RTN","BIPATUP2",122,0)
 ;     1 - BISITE (req) User's DUZ(2)
"RTN","BIPATUP2",123,0)
 ;
"RTN","BIPATUP2",124,0)
 Q:'$G(BISITE) 1
"RTN","BIPATUP2",125,0)
 N Y S Y=$P($G(^BISITE(BISITE,0)),U,27)
"RTN","BIPATUP2",126,0)
 Q:(Y=0) 0
"RTN","BIPATUP2",127,0)
 Q 1
"RTN","BIPATUP2",128,0)
 ;
"RTN","BIPATUP2",129,0)
 ;
"RTN","BIPATUP2",130,0)
 ;----------
"RTN","BIPATUP2",131,0)
ZOSTER(BISITE) ;EP - Return 1 if Zostervax should be forecast.
"RTN","BIPATUP2",132,0)
 ;---> Parameters:
"RTN","BIPATUP2",133,0)
 ;     1 - BISITE (req) User's DUZ(2)
"RTN","BIPATUP2",134,0)
 ;
"RTN","BIPATUP2",135,0)
 Q:'$G(BISITE) 1
"RTN","BIPATUP2",136,0)
 N Y S Y=$P($G(^BISITE(BISITE,0)),U,29)
"RTN","BIPATUP2",137,0)
 Q:(Y=0) 0
"RTN","BIPATUP2",138,0)
 Q 1
"RTN","BIPATUP2",139,0)
 ;
"RTN","BIPATUP2",140,0)
 ;
"RTN","BIPATUP2",141,0)
 ;----------
"RTN","BIPATUP2",142,0)
SETDUE(BIDATA) ;EP
"RTN","BIPATUP2",143,0)
 ;---> Code to add this Immunization Due to BI PATIENT IMM DUE File #9002084.1.
"RTN","BIPATUP2",144,0)
 ;---> Hardcoded to improve performance during massive reports.
"RTN","BIPATUP2",145,0)
 ;---> Parameters:
"RTN","BIPATUP2",146,0)
 ;     1 - BIDATA (req) Data string (5 fields) for 0-node.
"RTN","BIPATUP2",147,0)
 ;                      BIDFN^Vaccine IEN^Dose#^Recommended Date^Date Past Due
"RTN","BIPATUP2",148,0)
 ;
"RTN","BIPATUP2",149,0)
 Q:$G(BIDATA)=""
"RTN","BIPATUP2",150,0)
 N A,B,BIDFN,M,N
"RTN","BIPATUP2",151,0)
 S M=^BIPDUE(0),N=$P(M,U,3),M=$P(M,U,4) S:'N N=1
"RTN","BIPATUP2",152,0)
 F  Q:'$D(^BIPDUE(N))  S N=N+1
"RTN","BIPATUP2",153,0)
 S BIDFN=$P(BIDATA,U) Q:'BIDFN
"RTN","BIPATUP2",154,0)
 S ^BIPDUE(N,0)=BIDATA
"RTN","BIPATUP2",155,0)
 ;
"RTN","BIPATUP2",156,0)
 ;********** PATCH 1, v8.3.1, Dec 30,2008, IHS/CMI/MWR
"RTN","BIPATUP2",157,0)
 ;---> Add 6th pc, Date Forecast Calculated.
"RTN","BIPATUP2",158,0)
 S:$G(DT) $P(^BIPDUE(N,0),U,6)=DT
"RTN","BIPATUP2",159,0)
 ;**********
"RTN","BIPATUP2",160,0)
 ;
"RTN","BIPATUP2",161,0)
 S ^BIPDUE("B",BIDFN,N)=""
"RTN","BIPATUP2",162,0)
 S A=$P(BIDATA,U,4),B=$P(BIDATA,U,5)
"RTN","BIPATUP2",163,0)
 I A S ^BIPDUE("D",A,N)=""
"RTN","BIPATUP2",164,0)
 I B S ^BIPDUE("D",B,N)="",^BIPDUE("E",BIDFN,B,N)=""
"RTN","BIPATUP2",165,0)
 S $P(^BIPDUE(0),U,3,4)=N_U_(M+1)
"RTN","BIPATUP2",166,0)
 Q
"RTN","BIPATVW2")
0^7^B84034422
"RTN","BIPATVW2",1,0)
BIPATVW2 ;IHS/CMI/MWR - ADD/EDIT/DELETE VISITS; MAY 10, 2010
"RTN","BIPATVW2",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BIPATVW2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPATVW2",4,0)
 ;;BIB PROTOTYPE; JAN 31,2015
"RTN","BIPATVW2",5,0)
 ;;  ADD, EDIT, DELETE VISITS VIA LIST MANAGER.
"RTN","BIPATVW2",6,0)
 ;;  PATCH 1: Do not stuff default VFC if patient < 19 yrs.  ADDIMM+33
"RTN","BIPATVW2",7,0)
 ;;  PATCH 9: Add Admin Date and VIS Presented Date to array. EDITIMM+87
"RTN","BIPATVW2",8,0)
 ;;           If patient is adult, set Eligibility default="V01".  ADDIMM+40
"RTN","BIPATVW2",9,0)
 ;;  PATCH 10: Add Skin Test Lot Number.  EDITIMM+113
"RTN","BIPATVW2",10,0)
 ;
"RTN","BIPATVW2",11,0)
 ;
"RTN","BIPATVW2",12,0)
 ;----------
"RTN","BIPATVW2",13,0)
ADDIMM ;EP
"RTN","BIPATVW2",14,0)
 ;---> Add an Immunization via List Manager.
"RTN","BIPATVW2",15,0)
 ;---> Steps:
"RTN","BIPATVW2",16,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BIPATVW2",17,0)
 ;               BI IMMUNIZATION VISIT ADD, an action on the
"RTN","BIPATVW2",18,0)
 ;               List Manager menu protocol: BI MENU PATIENT VIEW
"RTN","BIPATVW2",19,0)
 ;
"RTN","BIPATVW2",20,0)
 ;            2) This code calls ScreenMan form:
"RTN","BIPATVW2",21,0)
 ;               BI FORM-IMM VISIT ADD/EDIT to build BI local array
"RTN","BIPATVW2",22,0)
 ;               of data for add/edit of Immunization visit.
"RTN","BIPATVW2",23,0)
 ;               Data already stored in the BI local array is loaded
"RTN","BIPATVW2",24,0)
 ;               into the form by LOADVIS^BIUTL7, which is called
"RTN","BIPATVW2",25,0)
 ;               by the Pre-Action of Blocks for Imm/Skin Edits.
"RTN","BIPATVW2",26,0)
 ;
"RTN","BIPATVW2",27,0)
 ;            3) SAVISIT^BIUTL7 uses BI local array to build data
"RTN","BIPATVW2",28,0)
 ;               to pass to ADDEDIT^BIRPC3 (which is also called by
"RTN","BIPATVW2",29,0)
 ;               the Broker from the GUI).
"RTN","BIPATVW2",30,0)
 ;
"RTN","BIPATVW2",31,0)
 ;            4) BIRPC3 calls ADDV^BIVISIT, which adds the
"RTN","BIPATVW2",32,0)
 ;               Visit to the V Files.
"RTN","BIPATVW2",33,0)
 ;
"RTN","BIPATVW2",34,0)
 ;---> Variables:
"RTN","BIPATVW2",35,0)
 ;     1 - BIDFN   (req) Patient DFN.
"RTN","BIPATVW2",36,0)
 ;     2 - BIDUZ2  (req) DUZ(2) of User (for Site Parameters).
"RTN","BIPATVW2",37,0)
 ;     3 - BIDEFDT (opt) Default date of new Visit.
"RTN","BIPATVW2",38,0)
 ;
"RTN","BIPATVW2",39,0)
 ;---> Check that DFN for this patient is present.
"RTN","BIPATVW2",40,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(405,,1) D RESET Q
"RTN","BIPATVW2",41,0)
 ;
"RTN","BIPATVW2",42,0)
 ;
"RTN","BIPATVW2",43,0)
 ;********** BARCODE PROTO, v8.5, JAN 31,2015, IHS/CMI/MWR
"RTN","BIPATVW2",44,0)
 ;---> Parse parameter of scanned values for adding new Lot Numbers.
"RTN","BIPATVW2",45,0)
 ;N BI S BI("A")=BIDFN
"RTN","BIPATVW2",46,0)
 I '$G(BISCANA) N BI
"RTN","BIPATVW2",47,0)
 S BI("A")=BIDFN
"RTN","BIPATVW2",48,0)
 ;**********
"RTN","BIPATVW2",49,0)
 ;
"RTN","BIPATVW2",50,0)
 ;---> Set default VFC Eligibility.
"RTN","BIPATVW2",51,0)
 ;---> If Patient Ben Type is 01 (Am Indian/AK Native), set VFC default=4.
"RTN","BIPATVW2",52,0)
 ;
"RTN","BIPATVW2",53,0)
 ;********** PATCH 1, v8.3.1, Dec 30,2008, IHS/CMI/MWR
"RTN","BIPATVW2",54,0)
 ;---> Do NOT stuff VFC default if patient is not < 19 years old.
"RTN","BIPATVW2",55,0)
 ;I $$BENTYP^BIUTL11(BIDFN,2)="01" S BI("P")=4
"RTN","BIPATVW2",56,0)
 ;--> If patient was less than 19yrs set default=V01 and quit.
"RTN","BIPATVW2",57,0)
 ;Q:($$AGE^BIUTL1(BIDFN,1,BIDATE)>18)
"RTN","BIPATVW2",58,0)
 ;
"RTN","BIPATVW2",59,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATVW2",60,0)
 ;---> If patient is adult, set Eligibility default="V01".
"RTN","BIPATVW2",61,0)
 D
"RTN","BIPATVW2",62,0)
 .I $$AGE^BIUTL1(BIDFN,1)<19,$$BENTYP^BIUTL11(BIDFN,2)="01" S BI("P")=4 Q
"RTN","BIPATVW2",63,0)
 .;---> Otherwise patient is adult, set default="V01" and quit.
"RTN","BIPATVW2",64,0)
 .S BI("P")=1
"RTN","BIPATVW2",65,0)
 ;**********
"RTN","BIPATVW2",66,0)
 ;
"RTN","BIPATVW2",67,0)
 ;---> Set default date.
"RTN","BIPATVW2",68,0)
 S BI("E")=$G(BIDEFDT)
"RTN","BIPATVW2",69,0)
 ;
"RTN","BIPATVW2",70,0)
 ;---> Get Site IEN for parameters.
"RTN","BIPATVW2",71,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIPATVW2",72,0)
 I '$G(BIDUZ2) D ERRCD^BIUTL2(105,,1) Q
"RTN","BIPATVW2",73,0)
 S BI("Z")=BIDUZ2
"RTN","BIPATVW2",74,0)
 ;
"RTN","BIPATVW2",75,0)
 ;---> Call Screenman to build BI local array of data by user.
"RTN","BIPATVW2",76,0)
 ;---> NOTE: The absence of BI("K") (IEN of Old V File entry) signals
"RTN","BIPATVW2",77,0)
 ;--->       a NEW V Immunizaton.
"RTN","BIPATVW2",78,0)
 ;---> BISAVE=Flag to call BIUTL7 to save data (below).  vvv83
"RTN","BIPATVW2",79,0)
 ;---> BITOLONG=Flag used in Screenman to display pop-up: Other Loc too long.
"RTN","BIPATVW2",80,0)
 N BISAVE,BITOLONG
"RTN","BIPATVW2",81,0)
 N DR S DR="[BI FORM-IMM VISIT ADD/EDIT]"
"RTN","BIPATVW2",82,0)
 D DDS^BIFMAN(9000001,DR,BIDFN,"S",.BISAVE,.BIPOP)
"RTN","BIPATVW2",83,0)
 ;
"RTN","BIPATVW2",84,0)
 ;---> If user saved data, call ^BIUTL7 to save it.
"RTN","BIPATVW2",85,0)
 D:$G(BISAVE) SAVISIT^BIUTL7("I",.BI)
"RTN","BIPATVW2",86,0)
 ;
"RTN","BIPATVW2",87,0)
 D RESET
"RTN","BIPATVW2",88,0)
 Q
"RTN","BIPATVW2",89,0)
 ;
"RTN","BIPATVW2",90,0)
 ;
"RTN","BIPATVW2",91,0)
 ;----------
"RTN","BIPATVW2",92,0)
ADDSK ;EP
"RTN","BIPATVW2",93,0)
 ;---> Add a Skin Test via List Manager.
"RTN","BIPATVW2",94,0)
 ;---> Steps are the same as ADDIMM above.
"RTN","BIPATVW2",95,0)
 ;
"RTN","BIPATVW2",96,0)
 ;---> Check that DFN for this patient is present.
"RTN","BIPATVW2",97,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(405,,1) D RESET Q
"RTN","BIPATVW2",98,0)
 N BI S BI("A")=BIDFN
"RTN","BIPATVW2",99,0)
 ;
"RTN","BIPATVW2",100,0)
 ;---> Set default date and volume.
"RTN","BIPATVW2",101,0)
 S BI("E")=$G(BIDEFDT),BI("W")=.1
"RTN","BIPATVW2",102,0)
 ;
"RTN","BIPATVW2",103,0)
 ;---> Get Site IEN for parameters.
"RTN","BIPATVW2",104,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIPATVW2",105,0)
 I '$G(BIDUZ2) D ERRCD^BIUTL2(105,,1) Q
"RTN","BIPATVW2",106,0)
 S BI("Z")=BIDUZ2
"RTN","BIPATVW2",107,0)
 ;
"RTN","BIPATVW2",108,0)
 ;---> Call Screenman to build BI local array of data by user.
"RTN","BIPATVW2",109,0)
 ;---> NOTE: The absence of BI("K") (IEN of Old V File entry) signals
"RTN","BIPATVW2",110,0)
 ;--->       a NEW V Skin Test.
"RTN","BIPATVW2",111,0)
 ;---> BISAVE=Flag to call BIUTL7 to save data (below).  vvv83
"RTN","BIPATVW2",112,0)
 ;---> BITOLONG=Flag used in Screenman to display pop-up: Other Loc too long.
"RTN","BIPATVW2",113,0)
 N BISAVE,BITOLONG
"RTN","BIPATVW2",114,0)
 N DR S DR="[BI FORM-SKIN VISIT ADD/EDIT]"
"RTN","BIPATVW2",115,0)
 D DDS^BIFMAN(9000001,DR,BIDFN,"S",.BISAVE,.BIPOP)
"RTN","BIPATVW2",116,0)
 ;
"RTN","BIPATVW2",117,0)
 ;---> If user saved data, call ^BIUTL7 to save it.
"RTN","BIPATVW2",118,0)
 D:$G(BISAVE) SAVISIT^BIUTL7("S",.BI)
"RTN","BIPATVW2",119,0)
 ;
"RTN","BIPATVW2",120,0)
 D RESET
"RTN","BIPATVW2",121,0)
 Q
"RTN","BIPATVW2",122,0)
 ;
"RTN","BIPATVW2",123,0)
 ;
"RTN","BIPATVW2",124,0)
 ;----------
"RTN","BIPATVW2",125,0)
EDITIMM ;EP
"RTN","BIPATVW2",126,0)
 ;---> Edit an Immunization via List Manager.
"RTN","BIPATVW2",127,0)
 ;---> Steps:
"RTN","BIPATVW2",128,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BIPATVW2",129,0)
 ;               BI V FILE VISIT EDIT, an action on the
"RTN","BIPATVW2",130,0)
 ;               List Manager menu protocol: BI MENU PATIENT VIEW
"RTN","BIPATVW2",131,0)
 ;
"RTN","BIPATVW2",132,0)
 ;            2) This code gets an Imm Visit from List Manager
"RTN","BIPATVW2",133,0)
 ;               and loads the data into the Screenman form:
"RTN","BIPATVW2",134,0)
 ;               BI FORM-IMM VISIT ADD/EDIT to build BI local array
"RTN","BIPATVW2",135,0)
 ;               of data for add/edit of Immunization visit.
"RTN","BIPATVW2",136,0)
 ;               Data already stored in the BI local array is loaded
"RTN","BIPATVW2",137,0)
 ;               into the form by LOADVIS^BIUTL7, which is called
"RTN","BIPATVW2",138,0)
 ;               by the Pre-Action of Blocks for Imm/Skin Edits.
"RTN","BIPATVW2",139,0)
 ;
"RTN","BIPATVW2",140,0)
 ;            3) SAVISIT^BIUTL7 uses BI local array to build data
"RTN","BIPATVW2",141,0)
 ;               to pass to ADDEDIT^BIRPC3 (which is also called by
"RTN","BIPATVW2",142,0)
 ;               the Broker from the GUI).
"RTN","BIPATVW2",143,0)
 ;
"RTN","BIPATVW2",144,0)
 ;            4) BIRPC3 calls DELETE^BIVISIT and ADDV^BIVISIT,
"RTN","BIPATVW2",145,0)
 ;               which broker Visits to the V Files.
"RTN","BIPATVW2",146,0)
 ;
"RTN","BIPATVW2",147,0)
 ;
"RTN","BIPATVW2",148,0)
 ;---> Call the List Manager Generic Selector of items displayed.
"RTN","BIPATVW2",149,0)
 N VALMY
"RTN","BIPATVW2",150,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","BIPATVW2",151,0)
 ;
"RTN","BIPATVW2",152,0)
 ;---> Check that Imm History string for this patient is present.
"RTN","BIPATVW2",153,0)
 ;---> If Imm History not supplied, set Error Code and quit.
"RTN","BIPATVW2",154,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(405,,1) D RESET Q
"RTN","BIPATVW2",155,0)
 I $G(BIHX(BIDFN))']"" D ERRCD^BIUTL2(303,,1) D RESET Q
"RTN","BIPATVW2",156,0)
 ;
"RTN","BIPATVW2",157,0)
 ;---> Check that a Listman Item was passed; if so, set Y=which
"RTN","BIPATVW2",158,0)
 ;---> item (Imm Visit) was passed/selected.
"RTN","BIPATVW2",159,0)
 ;I '$D(VALMY) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIPATVW2",160,0)
 I '$D(VALMY) D RESET Q
"RTN","BIPATVW2",161,0)
 N Y S Y=$O(VALMY(0))
"RTN","BIPATVW2",162,0)
 I '$G(Y) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIPATVW2",163,0)
 ;
"RTN","BIPATVW2",164,0)
 ;---> Get V Type: Imm or Skin.
"RTN","BIPATVW2",165,0)
 N BIVTYPE S BIVTYPE=$P($P(BIHX(BIDFN),U,Y),"|")
"RTN","BIPATVW2",166,0)
 ;
"RTN","BIPATVW2",167,0)
 ;---> If BIVTYPE does not="I" (Immunization Visit) and it does
"RTN","BIPATVW2",168,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIPATVW2",169,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D  Q
"RTN","BIPATVW2",170,0)
 .D ERRCD^BIUTL2(410,,1) D RESET
"RTN","BIPATVW2",171,0)
 ;
"RTN","BIPATVW2",172,0)
 ;---> Set BIVFIEN=V File IEN.
"RTN","BIPATVW2",173,0)
 N BIVFIEN S BIVFIEN=$P($P(BIHX(BIDFN),U,Y),"|",4)
"RTN","BIPATVW2",174,0)
 ;
"RTN","BIPATVW2",175,0)
 ;---> Gather data for this Visit to load for Screenman edit.
"RTN","BIPATVW2",176,0)
 D GET^BIRPC1(.Y,BIVFIEN,BIVTYPE)
"RTN","BIPATVW2",177,0)
 ;
"RTN","BIPATVW2",178,0)
 ;---> If an error is passed back, display it and quit.
"RTN","BIPATVW2",179,0)
 N BI31,BIERR S BI31=$C(31)_$C(31)
"RTN","BIPATVW2",180,0)
 S BIERR=$P(Y,BI31,2)
"RTN","BIPATVW2",181,0)
 I BIERR]"" D IO^BIO(BIERR),DIRZ^BIUTL3() D RESET Q
"RTN","BIPATVW2",182,0)
 ;
"RTN","BIPATVW2",183,0)
 ;---> If no error, then set Y=data (1st BI31 piece).
"RTN","BIPATVW2",184,0)
 S Y=$P(Y,BI31)
"RTN","BIPATVW2",185,0)
 ;
"RTN","BIPATVW2",186,0)
 ;---> Build BI array of Visit data for ScreenMan Edit form.
"RTN","BIPATVW2",187,0)
 N BI,DR,V S V="|"
"RTN","BIPATVW2",188,0)
 ;
"RTN","BIPATVW2",189,0)
 ;---> Build array for Immunization Visit.
"RTN","BIPATVW2",190,0)
 D:BIVTYPE="I"
"RTN","BIPATVW2",191,0)
 .S BI("A")=+BIDFN          ;Patient DFN.
"RTN","BIPATVW2",192,0)
 .S BI("B")=+$P(Y,V,7)      ;Vaccine Name IEN.
"RTN","BIPATVW2",193,0)
 .S BI("C")=$P(Y,V,3)       ;Dose# of Immunization.
"RTN","BIPATVW2",194,0)
 .S BI("D")=$P(Y,V,9)       ;Lot Number IEN.
"RTN","BIPATVW2",195,0)
 .S BI("E")=$P(Y,V,6)       ;Date/Time of Imm Visit (ext form).
"RTN","BIPATVW2",196,0)
 .S BI("F")=+$P(Y,V,11)     ;Location of Encounter IEN.
"RTN","BIPATVW2",197,0)
 .S BI("G")=$P(Y,V,13)      ;Other Location of Encounter Text.
"RTN","BIPATVW2",198,0)
 .S BI("I")=$P(Y,V,12)      ;Catgegory of Visit (A,E,I).
"RTN","BIPATVW2",199,0)
 .S BI("J")=$P(Y,V,22)      ;Visit IEN.
"RTN","BIPATVW2",200,0)
 .S BI("K")=BIVFIEN         ;Old V File IEN - indicates EDIT of previous Imm.
"RTN","BIPATVW2",201,0)
 .S BI("O")=+$P(Y,V,15)     ;Reaction to Immunization on this Visit.
"RTN","BIPATVW2",202,0)
 .S BI("P")=$P(Y,V,23)      ;VFC Eligibility.  vvv83
"RTN","BIPATVW2",203,0)
 .S BI("Q")=$P(Y,V,17)      ;Release/Revision Date of VIS (DD-Mmm-YYYY).
"RTN","BIPATVW2",204,0)
 .S BI("R")=$P(Y,V,18)      ;Immunization Provider.
"RTN","BIPATVW2",205,0)
 .S BI("S")=$P(Y,V,19)      ;Dose Override.
"RTN","BIPATVW2",206,0)
 .S BI("T")=$P(Y,V,20)      ;Injection Site.
"RTN","BIPATVW2",207,0)
 .S BI("W")=$P(Y,V,21)      ;Volume.
"RTN","BIPATVW2",208,0)
 .S BI("Y")=$P(Y,V,24)      ;Imported From Outside Source (=1).
"RTN","BIPATVW2",209,0)
 .S BI("H")=$P(Y,V,25)      ;NDC Code pointer IEN.
"RTN","BIPATVW2",210,0)
 .;
"RTN","BIPATVW2",211,0)
 .;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATVW2",212,0)
 .;---> Add VIS Presented Dateand Admin Date to array for Screenman.
"RTN","BIPATVW2",213,0)
 .S BI("QQ")=$P(Y,V,30)     ;Date VIS Presented to Patient.
"RTN","BIPATVW2",214,0)
 .S BI("EE")=$P(Y,V,31)     ;Admin/shot Date ONLY (not Visit); can be null.
"RTN","BIPATVW2",215,0)
 .;**********
"RTN","BIPATVW2",216,0)
 .;X ^O
"RTN","BIPATVW2",217,0)
 .;
"RTN","BIPATVW2",218,0)
 .S DR="[BI FORM-IMM VISIT ADD/EDIT]"
"RTN","BIPATVW2",219,0)
 ;
"RTN","BIPATVW2",220,0)
 ;---> Build array for Skin Test Visit.
"RTN","BIPATVW2",221,0)
 D:BIVTYPE="S"
"RTN","BIPATVW2",222,0)
 .S BI("A")=+BIDFN          ;Patient DFN.
"RTN","BIPATVW2",223,0)
 .S BI("B")=+$P(Y,V,13)     ;Skin Test IEN.
"RTN","BIPATVW2",224,0)
 .S BI("E")=$P(Y,V,4)       ;Date/Time of Skin Test Visit (ext form).
"RTN","BIPATVW2",225,0)
 .S BI("F")=+$P(Y,V,5)      ;Location of Encounter IEN.
"RTN","BIPATVW2",226,0)
 .S BI("G")=$P(Y,V,7)       ;Other Location of Encounter Text.
"RTN","BIPATVW2",227,0)
 .S BI("I")=$P(Y,V,6)       ;Catgegory of Visit (A,E,I).
"RTN","BIPATVW2",228,0)
 .S BI("J")=$P(Y,V,18)      ;Visit IEN.
"RTN","BIPATVW2",229,0)
 .S BI("K")=BIVFIEN         ;Old V File IEN (for edits).
"RTN","BIPATVW2",230,0)
 .S BI("L")=$P(Y,V,9)       ;Skin Test Result.
"RTN","BIPATVW2",231,0)
 .S BI("M")=$P(Y,V,10)      ;Skin Test Reading.
"RTN","BIPATVW2",232,0)
 .S BI("N")=$P(Y,V,11)      ;Skin Test Date Read.
"RTN","BIPATVW2",233,0)
 .S BI("R")=$P(Y,V,14)      ;Skin Test Provider.
"RTN","BIPATVW2",234,0)
 .S BI("T")=$P(Y,V,15)      ;Injection Site.
"RTN","BIPATVW2",235,0)
 .S BI("W")=$P(Y,V,16)      ;Volume.
"RTN","BIPATVW2",236,0)
 .S BI("X")=$P(Y,V,17)      ;Skin Test Reader.
"RTN","BIPATVW2",237,0)
 .;
"RTN","BIPATVW2",238,0)
 .;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPATVW2",239,0)
 .;---> Add Skin Test Lot Number.
"RTN","BIPATVW2",240,0)
 .S BI("LL")=$P(Y,V,19)
"RTN","BIPATVW2",241,0)
 .;**********
"RTN","BIPATVW2",242,0)
 .S DR="[BI FORM-SKIN VISIT ADD/EDIT]"
"RTN","BIPATVW2",243,0)
 ;
"RTN","BIPATVW2",244,0)
 ;
"RTN","BIPATVW2",245,0)
 ;---> Get Site IEN for parameters.
"RTN","BIPATVW2",246,0)
 S:'$G(BIDUZ2) BIDUZ2=$G(DUZ(2))
"RTN","BIPATVW2",247,0)
 I '$G(BIDUZ2) D ERRCD^BIUTL2(105,,1) Q
"RTN","BIPATVW2",248,0)
 S BI("Z")=BIDUZ2
"RTN","BIPATVW2",249,0)
 ;
"RTN","BIPATVW2",250,0)
 ;---> Call Screenman to build BI local array of data edited by user.
"RTN","BIPATVW2",251,0)
 ;---> BISAVE=Flag to call BIUTL7 to save data (below).  vvv83
"RTN","BIPATVW2",252,0)
 ;---> BITOLONG=Flag used in Screenman to display pop-up: Other Loc too long.
"RTN","BIPATVW2",253,0)
 N BISAVE,BITOLONG
"RTN","BIPATVW2",254,0)
 D DDS^BIFMAN(9000001,DR,BIDFN,"S",.BISAVE,.BIPOP)
"RTN","BIPATVW2",255,0)
 ;
"RTN","BIPATVW2",256,0)
 ;---> If user saved data, call ^BIUTL7 to save it.
"RTN","BIPATVW2",257,0)
 D:$G(BISAVE) SAVISIT^BIUTL7(BIVTYPE,.BI)
"RTN","BIPATVW2",258,0)
 ;
"RTN","BIPATVW2",259,0)
 D RESET
"RTN","BIPATVW2",260,0)
 Q
"RTN","BIPATVW2",261,0)
 ;
"RTN","BIPATVW2",262,0)
 ;
"RTN","BIPATVW2",263,0)
 ;----------
"RTN","BIPATVW2",264,0)
DELETIMM ;EP
"RTN","BIPATVW2",265,0)
 ;---> Delete an Immunization or Skin Test via List Manager.
"RTN","BIPATVW2",266,0)
 ;---> Steps:
"RTN","BIPATVW2",267,0)
 ;            1) This entry point is called by the Protocol:
"RTN","BIPATVW2",268,0)
 ;               BI V FILE VISIT DELETE, an action on the
"RTN","BIPATVW2",269,0)
 ;               List Manager menu protocol: BI MENU PATIENT VIEW
"RTN","BIPATVW2",270,0)
 ;
"RTN","BIPATVW2",271,0)
 ;            2) This code gets an Imm or Skin Visit from List Manager
"RTN","BIPATVW2",272,0)
 ;               and calls DELETE^BIRPC3 (which is also called by
"RTN","BIPATVW2",273,0)
 ;               the Broker from the GUI).
"RTN","BIPATVW2",274,0)
 ;
"RTN","BIPATVW2",275,0)
 ;            5) BIRPC3 calls DELETE^BIVISIT, which will
"RTN","BIPATVW2",276,0)
 ;               delete the V File entry.
"RTN","BIPATVW2",277,0)
 ;
"RTN","BIPATVW2",278,0)
 ;---> Call the List Manager Generic Selector of items displayed.
"RTN","BIPATVW2",279,0)
 N VALMY
"RTN","BIPATVW2",280,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","BIPATVW2",281,0)
 ;
"RTN","BIPATVW2",282,0)
 ;---> Check that Imm History string for this patient is present.
"RTN","BIPATVW2",283,0)
 ;---> If Imm History not provided, set Error Code and quit.
"RTN","BIPATVW2",284,0)
 I '$G(BIDFN) D ERRCD^BIUTL2(405,,1) D RESET Q
"RTN","BIPATVW2",285,0)
 I $G(BIHX(BIDFN))']"" D ERRCD^BIUTL2(303,,1) D RESET Q
"RTN","BIPATVW2",286,0)
 ;
"RTN","BIPATVW2",287,0)
 ;---> Check that a Listman Item was passed.
"RTN","BIPATVW2",288,0)
 I '$D(VALMY) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIPATVW2",289,0)
 N Y S Y=$O(VALMY(0))
"RTN","BIPATVW2",290,0)
 I '$G(Y) D ERRCD^BIUTL2(406,,1) D RESET Q
"RTN","BIPATVW2",291,0)
 ;
"RTN","BIPATVW2",292,0)
 S Y=$P(BIHX(BIDFN),U,Y)
"RTN","BIPATVW2",293,0)
 I Y']"" D ERRCD^BIUTL2(303,,1) D RESET Q
"RTN","BIPATVW2",294,0)
 ;
"RTN","BIPATVW2",295,0)
 D FULL^VALM1
"RTN","BIPATVW2",296,0)
 ;
"RTN","BIPATVW2",297,0)
 ;---> Display visit for confirmation.
"RTN","BIPATVW2",298,0)
 N BIVFIEN,BIVTYPE,V S V="|"
"RTN","BIPATVW2",299,0)
 ;
"RTN","BIPATVW2",300,0)
 S BIVTYPE=$P(Y,V)
"RTN","BIPATVW2",301,0)
 ;---> If BIVTYPE does not="I" (Immunization Visit) and it does
"RTN","BIPATVW2",302,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIPATVW2",303,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D  Q
"RTN","BIPATVW2",304,0)
 .D ERRCD^BIUTL2(410,,1) D RESET Q
"RTN","BIPATVW2",305,0)
 ;
"RTN","BIPATVW2",306,0)
 ;---> Set Immunization confirmation display fields and Visit IEN.
"RTN","BIPATVW2",307,0)
 I BIVTYPE="I" D
"RTN","BIPATVW2",308,0)
 .S X=$P(Y,V,7)_"  "_$P(Y,V,2)_"   "_$P(Y,V,5)
"RTN","BIPATVW2",309,0)
 .S BIVFIEN=$P(Y,V,4)
"RTN","BIPATVW2",310,0)
 ;
"RTN","BIPATVW2",311,0)
 ;---> Set Skin Test confirmation display fields and Visit IEN.
"RTN","BIPATVW2",312,0)
 I BIVTYPE="S" D
"RTN","BIPATVW2",313,0)
 .S X=$P(Y,V,7)_"  "_$P(Y,V,11)_"   "_$P(Y,V,8)_"  "_$P(Y,V,9)
"RTN","BIPATVW2",314,0)
 .S:$P(Y,V,9) X=X_" mm"
"RTN","BIPATVW2",315,0)
 .S X=X_"  "_$P(Y,V,5)
"RTN","BIPATVW2",316,0)
 .S BIVFIEN=$P(Y,V,4)
"RTN","BIPATVW2",317,0)
 ;
"RTN","BIPATVW2",318,0)
 ;
"RTN","BIPATVW2",319,0)
 D TITLE^BIUTL5("DELETE AN IMMUNIZATION VISIT")
"RTN","BIPATVW2",320,0)
 N A
"RTN","BIPATVW2",321,0)
 S A(1)="Do you really wish to DELETE this Visit?"
"RTN","BIPATVW2",322,0)
 S A(1,"F")="!!?3"
"RTN","BIPATVW2",323,0)
 S A(2)="Patient: "_$E($$NAME^BIUTL1(BIDFN),1,25)
"RTN","BIPATVW2",324,0)
 S A(2)=A(2)_"       Chart#: "_$$HRCN^BIUTL1(BIDFN)
"RTN","BIPATVW2",325,0)
 S A(2,"F")="!!?10"
"RTN","BIPATVW2",326,0)
 S A(3)=X,A(3,"F")="!!?10"
"RTN","BIPATVW2",327,0)
 S A(4,"F")="!"
"RTN","BIPATVW2",328,0)
 D EN^DDIOL(.A)
"RTN","BIPATVW2",329,0)
 ;
"RTN","BIPATVW2",330,0)
 N B,BIERR S BIERR=0
"RTN","BIPATVW2",331,0)
 S B(1)="     Enter YES to DELETE this Visit."
"RTN","BIPATVW2",332,0)
 S B(2)="     Enter NO to leave it unchanged."
"RTN","BIPATVW2",333,0)
 D DIR^BIFMAN("Y",.Y,,"   Enter Yes or No","NO",B(2),B(1))
"RTN","BIPATVW2",334,0)
 ;
"RTN","BIPATVW2",335,0)
 ;---> Failed to confirm.
"RTN","BIPATVW2",336,0)
 I Y<1 D  Q
"RTN","BIPATVW2",337,0)
 .D IO^BIO("NO changes made.")
"RTN","BIPATVW2",338,0)
 .D DIRZ^BIUTL3(),RESET
"RTN","BIPATVW2",339,0)
 ;
"RTN","BIPATVW2",340,0)
 ;---> Delete the visit.
"RTN","BIPATVW2",341,0)
 S BIERR=""
"RTN","BIPATVW2",342,0)
 D DELETE^BIRPC3(.BIERR,BIVFIEN,BIVTYPE)
"RTN","BIPATVW2",343,0)
 ;
"RTN","BIPATVW2",344,0)
 ;---> If an error is passed back, display it.
"RTN","BIPATVW2",345,0)
 N BI31 S BI31=$C(31)_$C(31),BIERR=$P(BIERR,BI31,2)
"RTN","BIPATVW2",346,0)
 I BIERR]"" D IO^BIO(BIERR),DIRZ^BIUTL3()
"RTN","BIPATVW2",347,0)
 D RESET
"RTN","BIPATVW2",348,0)
 Q
"RTN","BIPATVW2",349,0)
 ;
"RTN","BIPATVW2",350,0)
 ;
"RTN","BIPATVW2",351,0)
 ;----------
"RTN","BIPATVW2",352,0)
RESET ;EP
"RTN","BIPATVW2",353,0)
 ;---> Update partition for return to Listman.
"RTN","BIPATVW2",354,0)
 I $D(VALMQUIT) S VALMBCK="Q" Q
"RTN","BIPATVW2",355,0)
 D TERM^VALM0 S VALMBCK="R"
"RTN","BIPATVW2",356,0)
 D HDR^BIPATVW(),INIT^BIPATVW
"RTN","BIPATVW2",357,0)
 Q
"RTN","BIPOST")
0^14^B34853125
"RTN","BIPOST",1,0)
BIPOST ;IHS/CMI/MWR - POST-INIT ROUTINE; OCT 15, 2010
"RTN","BIPOST",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BIPOST",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIPOST",4,0)
 ;;  PATCH 3: Set MenCY-Hib (148) and Flu-nasal4 (149) and all Skin Tests
"RTN","BIPOST",5,0)
 ;;           in the Vaccine Table to Inactive.   START+30
"RTN","BIPOST",6,0)
 ;;  PATCH 3: Set all Skin Tests in the Skin Test table to Inactive, except
"RTN","BIPOST",7,0)
 ;;           PPD and Tetanus. START+38
"RTN","BIPOST",8,0)
 ;;  PATCH 4, v8.5: Update Source options in Imm Lot File.  START+9
"RTN","BIPOST",9,0)
 ;;  PATCH 5, v8.5: Remove dash from Eligibility Codes.
"RTN","BIPOST",10,0)
 ;;  PATCH 5, v8.5: Add SNOMED Codes to all Contraindications.
"RTN","BIPOST",11,0)
 ;;  PATCH 5, v8.5: Restandardize Vaccine Table, with updates from BITN.
"RTN","BIPOST",12,0)
 ;;  PATCH 6, v8.5: Restandardize Vaccine Table, with updates from BITN.
"RTN","BIPOST",13,0)
 ;;  PATCH 8: Changes to Set Mening C CVX 103 vaccine to Inactive.  START+55
"RTN","BIPOST",14,0)
 ;;  PATCH 9:  Restandardize Vaccine Table, with updates from BITN. START+49
"RTN","BIPOST",15,0)
 ;;            Changes to force specified vaccines active.  START+52
"RTN","BIPOST",16,0)
 ;;            Update Taxonomies.  START+142
"RTN","BIPOST",17,0)
 ;;  PATCH 10: Restandardize Vaccine Table, with updates from BITN. START+49
"RTN","BIPOST",18,0)
 ;;            Changes to force specified vaccines active.  START+56
"RTN","BIPOST",19,0)
 ;;            Update BI TABLE DATA ELEMENTS File.  START+154
"RTN","BIPOST",20,0)
 ;
"RTN","BIPOST",21,0)
 ;
"RTN","BIPOST",22,0)
 ;----------
"RTN","BIPOST",23,0)
START ;EP
"RTN","BIPOST",24,0)
 ;---> Update software after KIDS installation.
"RTN","BIPOST",25,0)
 ;
"RTN","BIPOST",26,0)
 D SETVARS^BIUTL5 S BIPOP=0
"RTN","BIPOST",27,0)
 ;S IOP=$I D ^%ZIS
"RTN","BIPOST",28,0)
 ;
"RTN","BIPOST",29,0)
 ;W !!!?3,"Please hold..."
"RTN","BIPOST",30,0)
 ;
"RTN","BIPOST",31,0)
 ;
"RTN","BIPOST",32,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIPOST",33,0)
 ;---> Remove dash from Eligibility Codes.
"RTN","BIPOST",34,0)
 ;N N S N=0 F  S N=$O(^BIELIG(N)) Q:'N  D
"RTN","BIPOST",35,0)
 ;.N X S X=$P($G(^BIELIG(N,0)),U)
"RTN","BIPOST",36,0)
 ;.Q:(X="")  Q:(X'["-")
"RTN","BIPOST",37,0)
 ;.N Y S Y=$P(X,"-")_$P(X,"-",2)
"RTN","BIPOST",38,0)
 ;.;W !,X,"   ",Y Q
"RTN","BIPOST",39,0)
 ;.S $P(^BIELIG(N,0),U)=Y
"RTN","BIPOST",40,0)
 ;N I F I="AC","B","C","D","E","F","U" K ^BIELIG(I)
"RTN","BIPOST",41,0)
 ;S DIK="^BIELIG("
"RTN","BIPOST",42,0)
 ;D IXALL^DIK
"RTN","BIPOST",43,0)
 ;
"RTN","BIPOST",44,0)
 ;
"RTN","BIPOST",45,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIPOST",46,0)
 ;---> Back-populate SNOMED Codes to all Contraindications.
"RTN","BIPOST",47,0)
 ;D
"RTN","BIPOST",48,0)
 ;.;---> If BCQM IHS CODE MAPPING Version 1.0 is not loaded, abort back-pop.
"RTN","BIPOST",49,0)
 ;.I '($L($T(MM^BCQMAPI))) D  Q
"RTN","BIPOST",50,0)
 ;..D TEXT2,DIRZ^BIUTL3()
"RTN","BIPOST",51,0)
 ;.D SNOMED^BIUTLFIX
"RTN","BIPOST",52,0)
 ;
"RTN","BIPOST",53,0)
 ;
"RTN","BIPOST",54,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPOST",55,0)
 ;---> Update Manufacturer Table.
"RTN","BIPOST",56,0)
 ;S ^BIMAN(167,0)="CRUCELL^CRU^1^Crucell"
"RTN","BIPOST",57,0)
 ;S ^BIMAN(168,0)="KEDRIAN BIOPHARMA^KED^1^Kedrian Biopharma"
"RTN","BIPOST",58,0)
 ;
"RTN","BIPOST",59,0)
 ;**********
"RTN","BIPOST",60,0)
 ;
"RTN","BIPOST",61,0)
 ;********** PATCH 4, v8.5, DEC 01,2012, IHS/CMI/MWR
"RTN","BIPOST",62,0)
 ;---> Update Source options in Imm Lot File.
"RTN","BIPOST",63,0)
 ;N BIX S BIX="^DD(9999999.41,.13,0)"
"RTN","BIPOST",64,0)
 ;S @BIX="VACCINE SOURCE^S^v:VFC;n:NON-VFC;o:Other State;i:IHS/Tribal;^0;13^Q"
"RTN","BIPOST",65,0)
 ;**********
"RTN","BIPOST",66,0)
 ;
"RTN","BIPOST",67,0)
 ;---> Reindex any Listman Hidden Menus.
"RTN","BIPOST",68,0)
 ;D LISTMENU^BIUTLFIX
"RTN","BIPOST",69,0)
 ;
"RTN","BIPOST",70,0)
 ;
"RTN","BIPOST",71,0)
 ;---> Re-Standardize the Vaccine Table.
"RTN","BIPOST",72,0)
 D RESTAND^BIRESTD()
"RTN","BIPOST",73,0)
 ;
"RTN","BIPOST",74,0)
 ;
"RTN","BIPOST",75,0)
 ;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BIPOST",76,0)
 ;---> Force vaccines Active or Inactive by CVX Code.
"RTN","BIPOST",77,0)
 ;---> Insert CVX Codes into For loop below.
"RTN","BIPOST",78,0)
 ;
"RTN","BIPOST",79,0)
 ;---> Make these CVX's ACTIVE:
"RTN","BIPOST",80,0)
 N BICVX F BICVX=96 D
"RTN","BIPOST",81,0)
 .N N S N=$$HL7TX^BIUTL2(BICVX)
"RTN","BIPOST",82,0)
 .;---> Quit if CVX is Unknown.
"RTN","BIPOST",83,0)
 .Q:(N=137)
"RTN","BIPOST",84,0)
 .;---> 0=ACTIVE.
"RTN","BIPOST",85,0)
 .S $P(^AUTTIMM(N,0),U,7)=0
"RTN","BIPOST",86,0)
 .S $P(^BITN(N,0),U,7)=0
"RTN","BIPOST",87,0)
 .;
"RTN","BIPOST",88,0)
 ;---> Make these CVX's INACTIVE:
"RTN","BIPOST",89,0)
 N BICVX F BICVX=162,163,164 D
"RTN","BIPOST",90,0)
 .N N S N=$$HL7TX^BIUTL2(BICVX)
"RTN","BIPOST",91,0)
 .;---> Quit if CVX is Unknown.
"RTN","BIPOST",92,0)
 .Q:(N=137)
"RTN","BIPOST",93,0)
 .;---> 1=INACTIVE.
"RTN","BIPOST",94,0)
 .S $P(^AUTTIMM(N,0),U,7)=1
"RTN","BIPOST",95,0)
 .S $P(^BITN(N,0),U,7)=1
"RTN","BIPOST",96,0)
 ;
"RTN","BIPOST",97,0)
 ;
"RTN","BIPOST",98,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIPOST",99,0)
 ;---> Set Mening C CVX 103 vaccine to Inactive.
"RTN","BIPOST",100,0)
 ;F N=143 D
"RTN","BIPOST",101,0)
 ;.S $P(^AUTTIMM(N,0),U,7)=1
"RTN","BIPOST",102,0)
 ;.S $P(^BITN(N,0),U,7)=1
"RTN","BIPOST",103,0)
 ;
"RTN","BIPOST",104,0)
 ;---> Set newer Mening vaccines to Active.
"RTN","BIPOST",105,0)
 ;F N=220,237,251 D
"RTN","BIPOST",106,0)
 ;.S $P(^AUTTIMM(N,0),U,7)=0
"RTN","BIPOST",107,0)
 ;.S $P(^BITN(N,0),U,7)=0
"RTN","BIPOST",108,0)
 ;
"RTN","BIPOST",109,0)
 ;
"RTN","BIPOST",110,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIPOST",111,0)
 ;---> Set all Skin Tests in Vaccine Table to Inactive (so that they will be
"RTN","BIPOST",112,0)
 ;---> unavailable to select as vaccines in EHR).
"RTN","BIPOST",113,0)
 ;---> Set MenCY-Hib (148) and Flu-nasal4 (149) to Inactive.
"RTN","BIPOST",114,0)
 ;N N F N=202,203,204,205,252,253 D
"RTN","BIPOST",115,0)
 ;.S $P(^AUTTIMM(N,0),U,7)=1
"RTN","BIPOST",116,0)
 ;.S $P(^BITN(N,0),U,7)=1
"RTN","BIPOST",117,0)
 ;
"RTN","BIPOST",118,0)
 ;---> Also set all Skin Tests in the Skin Test file Inactive,
"RTN","BIPOST",119,0)
 ;---> except PPD and Tetanus.
"RTN","BIPOST",120,0)
 ;N N S N=0 F  S N=$O(^AUTTSK(N)) Q:'N  D
"RTN","BIPOST",121,0)
 ;.Q:'$D(^AUTTSK(N,0))
"RTN","BIPOST",122,0)
 ;.S $P(^AUTTSK(N,0),U,3)=1
"RTN","BIPOST",123,0)
 ;---> Now set PPD and Tetanus to Active.
"RTN","BIPOST",124,0)
 ;D
"RTN","BIPOST",125,0)
 ;.K N S N=$O(^AUTTSK("B","PPD",0))
"RTN","BIPOST",126,0)
 ;.Q:'N
"RTN","BIPOST",127,0)
 ;.S $P(^AUTTSK(N,0),U,3)=""
"RTN","BIPOST",128,0)
 ;.S N=$O(^AUTTSK("B","TETANUS",0))
"RTN","BIPOST",129,0)
 ;.Q:'N
"RTN","BIPOST",130,0)
 ;.S $P(^AUTTSK(N,0),U,3)=""
"RTN","BIPOST",131,0)
 ;**********
"RTN","BIPOST",132,0)
 ;
"RTN","BIPOST",133,0)
 ;---> Reset Display Order of Vaccine Groups in BI TABLE VACCINE GROUP File #9002084.93.
"RTN","BIPOST",134,0)
 ;S $P(^BISERT(1,0),"^",2)=1
"RTN","BIPOST",135,0)
 ;S $P(^BISERT(2,0),"^",2)=3
"RTN","BIPOST",136,0)
 ;S $P(^BISERT(3,0),"^",2)=4
"RTN","BIPOST",137,0)
 ;S $P(^BISERT(4,0),"^",2)=6
"RTN","BIPOST",138,0)
 ;S $P(^BISERT(5,0),"^",2)=5
"RTN","BIPOST",139,0)
 ;S $P(^BISERT(6,0),"^",2)=7
"RTN","BIPOST",140,0)
 ;S $P(^BISERT(7,0),"^",2)=8
"RTN","BIPOST",141,0)
 ;S $P(^BISERT(8,0),"^",2)=2
"RTN","BIPOST",142,0)
 ;S $P(^BISERT(9,0),"^",2)=9
"RTN","BIPOST",143,0)
 ;S $P(^BISERT(10,0),"^",2)=10
"RTN","BIPOST",144,0)
 ;S $P(^BISERT(11,0),"^",2)=12
"RTN","BIPOST",145,0)
 ;S $P(^BISERT(12,0),"^",2)=90
"RTN","BIPOST",146,0)
 ;S $P(^BISERT(13,0),"^",2)=99
"RTN","BIPOST",147,0)
 ;S $P(^BISERT(14,0),"^",2)=95
"RTN","BIPOST",148,0)
 ;S $P(^BISERT(15,0),"^",2)=85
"RTN","BIPOST",149,0)
 ;S $P(^BISERT(16,0),"^",2)=15
"RTN","BIPOST",150,0)
 ;S $P(^BISERT(17,0),"^",2)=18
"RTN","BIPOST",151,0)
 ;S $P(^BISERT(18,0),"^",2)=11
"RTN","BIPOST",152,0)
 ;
"RTN","BIPOST",153,0)
 ;---> Turn off H1N1forecasting.
"RTN","BIPOST",154,0)
 ;S $P(^BISERT(18,0),"^",5)=0
"RTN","BIPOST",155,0)
 ;
"RTN","BIPOST",156,0)
 ;---> Standardize the VT-100 Codes in the Terminal Type File.
"RTN","BIPOST",157,0)
 ;D ^BIVT100
"RTN","BIPOST",158,0)
 ;---> Set new Immserve Path.
"RTN","BIPOST",159,0)
 ;D IMMPATH
"RTN","BIPOST",160,0)
 ;---> Check and fix any Lot Numbers with a Status of null.
"RTN","BIPOST",161,0)
 ;D NULLACT^BILOT1
"RTN","BIPOST",162,0)
 ;---> Reindex killed globals.
"RTN","BIPOST",163,0)
 ;D REINDEX
"RTN","BIPOST",164,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIPOST",165,0)
 ;---> Update Taxonomies.
"RTN","BIPOST",166,0)
 ;D ^BITX
"RTN","BIPOST",167,0)
 ;---> Reindex BI Letter Sample and BI Table Manufactures Files.
"RTN","BIPOST",168,0)
 ;D REINDLS
"RTN","BIPOST",169,0)
 ;
"RTN","BIPOST",170,0)
 ;---> Kill dangling xref to old file.
"RTN","BIPOST",171,0)
 ;K ^DIC("B","BI IMMUNIZATION TABLE OLD LOCAL",9002084.95)
"RTN","BIPOST",172,0)
 ;
"RTN","BIPOST",173,0)
 ;---> Scan for any V Imms with a .14 Eligibility=0, change to 8, which is
"RTN","BIPOST",174,0)
 ;---> the IEN of "Unknown" in the new BI TABLE ELIG File.
"RTN","BIPOST",175,0)
 ;D ^BIELIG3
"RTN","BIPOST",176,0)
 ;
"RTN","BIPOST",177,0)
 ;---> Update BI TABLE DATA ELEMENTS File.
"RTN","BIPOST",178,0)
 D ^BIDE
"RTN","BIPOST",179,0)
 ;
"RTN","BIPOST",180,0)
 ;---> Update "Last Version Fully Installed" Field in BI SITE PARAMETER File.
"RTN","BIPOST",181,0)
 N N S N=0 F  S N=$O(^BISITE(N)) Q:'N  S $P(^BISITE(N,0),"^",15)=$$VER^BILOGO
"RTN","BIPOST",182,0)
 ;
"RTN","BIPOST",183,0)
 ;D TEXT2,DIRZ^BIUTL3()
"RTN","BIPOST",184,0)
 D TEXT1,DIRZ^BIUTL3()
"RTN","BIPOST",185,0)
 ;
"RTN","BIPOST",186,0)
 D EXIT
"RTN","BIPOST",187,0)
 Q
"RTN","BIPOST",188,0)
 ;
"RTN","BIPOST",189,0)
 ;
"RTN","BIPOST",190,0)
 ;----------
"RTN","BIPOST",191,0)
EXIT ;EP
"RTN","BIPOST",192,0)
 D KILLALL^BIUTL8(1)
"RTN","BIPOST",193,0)
 Q
"RTN","BIPOST",194,0)
 ;
"RTN","BIPOST",195,0)
 ;
"RTN","BIPOST",196,0)
 ;
"RTN","BIPOST",197,0)
 ;----------
"RTN","BIPOST",198,0)
TEXT1 ;EP
"RTN","BIPOST",199,0)
 ;;
"RTN","BIPOST",200,0)
 ;;
"RTN","BIPOST",201,0)
 ;;
"RTN","BIPOST",202,0)
 ;;
"RTN","BIPOST",203,0)
 ;;
"RTN","BIPOST",204,0)
 ;;
"RTN","BIPOST",205,0)
 ;;         - This concludes the Post-Initialization program. -
"RTN","BIPOST",206,0)
 ;;
"RTN","BIPOST",207,0)
 ;;                       * CONGRATULATIONS! *
"RTN","BIPOST",208,0)
 ;;
"RTN","BIPOST",209,0)
 ;;          You have successfully installed Immunization v8.510.
"RTN","BIPOST",210,0)
 ;;
"RTN","BIPOST",211,0)
 ;;
"RTN","BIPOST",212,0)
 ;;
"RTN","BIPOST",213,0)
 ;;
"RTN","BIPOST",214,0)
 ;;
"RTN","BIPOST",215,0)
 ;;
"RTN","BIPOST",216,0)
 ;;
"RTN","BIPOST",217,0)
 ;;
"RTN","BIPOST",218,0)
 W @IOF
"RTN","BIPOST",219,0)
 D PRINTX("TEXT1")
"RTN","BIPOST",220,0)
 Q
"RTN","BIPOST",221,0)
 ;**********
"RTN","BIPOST",222,0)
 ;
"RTN","BIPOST",223,0)
 ;
"RTN","BIPOST",224,0)
 ;----------
"RTN","BIPOST",225,0)
TEXT2 ;EP
"RTN","BIPOST",226,0)
 ;;
"RTN","BIPOST",227,0)
 ;;
"RTN","BIPOST",228,0)
 ;;
"RTN","BIPOST",229,0)
 ;;
"RTN","BIPOST",230,0)
 ;;                            * NOTE!!! *
"RTN","BIPOST",231,0)
 ;;
"RTN","BIPOST",232,0)
 ;; NOTE: Be sure that you have installed the new TCH FORECASTER,
"RTN","BIPOST",233,0)
 ;;       as outlined in the TCH Forecaster Installation Instructions
"RTN","BIPOST",234,0)
 ;;       (separate document in this distribution).
"RTN","BIPOST",235,0)
 ;;
"RTN","BIPOST",236,0)
 ;;       Immunization forecasting will not work if you have not
"RTN","BIPOST",237,0)
 ;;       performed this crucial step in addition to the KIDS file
"RTN","BIPOST",238,0)
 ;;       installation.
"RTN","BIPOST",239,0)
 ;;
"RTN","BIPOST",240,0)
 ;;                            * NOTE!!! *
"RTN","BIPOST",241,0)
 ;;
"RTN","BIPOST",242,0)
 ;;
"RTN","BIPOST",243,0)
 ;;
"RTN","BIPOST",244,0)
 ;;
"RTN","BIPOST",245,0)
 ;;
"RTN","BIPOST",246,0)
 W @IOF
"RTN","BIPOST",247,0)
 D PRINTX("TEXT2")
"RTN","BIPOST",248,0)
 Q
"RTN","BIPOST",249,0)
 ;
"RTN","BIPOST",250,0)
 ;
"RTN","BIPOST",251,0)
 ;----------
"RTN","BIPOST",252,0)
PRINTX(BILINL,BITAB) ;EP
"RTN","BIPOST",253,0)
 ;---> Print text at specified line label.
"RTN","BIPOST",254,0)
 ;
"RTN","BIPOST",255,0)
 Q:$G(BILINL)=""
"RTN","BIPOST",256,0)
 N I,T,X S T="" S:'$D(BITAB) BITAB=5 F I=1:1:BITAB S T=T_" "
"RTN","BIPOST",257,0)
 F I=1:1 S X=$T(@BILINL+I) Q:X'[";;"  W !,T,$P(X,";;",2)
"RTN","BIPOST",258,0)
 Q
"RTN","BIPOST",259,0)
 ;
"RTN","BIPOST",260,0)
 ;
"RTN","BIPOST",261,0)
 ;----------
"RTN","BIPOST",262,0)
IMMPATH ;EP
"RTN","BIPOST",263,0)
 ;---> Update path for new Immserve files.
"RTN","BIPOST",264,0)
 N N,X,Y S Y=$$VERSION^%ZOSV(1) D
"RTN","BIPOST",265,0)
 .I Y["Windows" S X="C:\Program Files\Immserve852\" Q
"RTN","BIPOST",266,0)
 .I Y["UNIX" S X="/usr/local/immserve852/"
"RTN","BIPOST",267,0)
 ;
"RTN","BIPOST",268,0)
 S N=0
"RTN","BIPOST",269,0)
 F  S N=$O(^BISITE(N)) Q:'N  D
"RTN","BIPOST",270,0)
 .S $P(^BISITE(N,0),"^",18)=X
"RTN","BIPOST",271,0)
 Q
"RTN","BIPOST",272,0)
 ;
"RTN","BIPOST",273,0)
 ;
"RTN","BIPOST",274,0)
 ;----------
"RTN","BIPOST",275,0)
REINDEX ;EP
"RTN","BIPOST",276,0)
 ;---> Not called.  Programmer to use if KIDS fails to index these files.
"RTN","BIPOST",277,0)
 ;
"RTN","BIPOST",278,0)
 N DIK
"RTN","BIPOST",279,0)
 F DIK="^BINFO(","^BILETS(","^BIVT100(","^BIERR(","^BINFO(","^BIEXPDD(","^BISERT(","^BICONT(" D
"RTN","BIPOST",280,0)
 .D IXALL^DIK
"RTN","BIPOST",281,0)
 .S DIK="^BISERT(" D IXALL^DIK
"RTN","BIPOST",282,0)
 Q
"RTN","BIPOST",283,0)
 ;
"RTN","BIPOST",284,0)
 ;
"RTN","BIPOST",285,0)
KEYS ;EP
"RTN","BIPOST",286,0)
 ;---> Clean up subordinate keys (there should be none).
"RTN","BIPOST",287,0)
 N X,Y
"RTN","BIPOST",288,0)
 F X="BIZ EDIT PATIENTS","BIZ MANAGER","BIZMENU" D
"RTN","BIPOST",289,0)
 .S Y=$O(^DIC(19.1,"B",X,0)) K @("^DIC(19.1,"""_Y_""",3)")
"RTN","BIPOST",290,0)
 Q
"RTN","BIPOST",291,0)
 ;
"RTN","BIPOST",292,0)
 ;
"RTN","BIPOST",293,0)
REINDLS ;EP
"RTN","BIPOST",294,0)
 ;---> Reindex BI LETTER SAMPLE File.
"RTN","BIPOST",295,0)
 N X,Y
"RTN","BIPOST",296,0)
 S DIK="^BILETS("
"RTN","BIPOST",297,0)
 D IXALL^DIK
"RTN","BIPOST",298,0)
 S DIK="^BIMAN("
"RTN","BIPOST",299,0)
 D IXALL^DIK
"RTN","BIPOST",300,0)
 Q
"RTN","BIRPC1")
0^8^B7323216
"RTN","BIRPC1",1,0)
BIRPC1 ;IHS/CMI/MWR - REMOTE PROCEDURE CALLS; MAY 10, 2010
"RTN","BIRPC1",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BIRPC1",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIRPC1",4,0)
 ;;  RETURNS PATIENT DATA, DATA FOR AN IMMUNIZATION OR SKIN TEST VISIT.
"RTN","BIRPC1",5,0)
 ;;  PATCH 3: Add Eligibility Code to default Hx string.  GET+35
"RTN","BIRPC1",6,0)
 ;;  PATCH 5: Add Admin Note to default Hx string. GET+38
"RTN","BIRPC1",7,0)
 ;;  PATCH 9: Add Date VIS Presented and Admin Date to data string. GET+40
"RTN","BIRPC1",8,0)
 ;;  PATCH 10: Add Skin Test Lot Number IEN and Text.  GET+86
"RTN","BIRPC1",9,0)
 ;
"RTN","BIRPC1",10,0)
 ;
"RTN","BIRPC1",11,0)
 ;----------
"RTN","BIRPC1",12,0)
PDATA(BIDATA,BIDFN) ;EP
"RTN","BIRPC1",13,0)
 ;---> Return Patient Data in 5 ^-delimited pieces:
"RTN","BIRPC1",14,0)
 ;--->   1 - DOB in format: OCT 01,1994.
"RTN","BIRPC1",15,0)
 ;--->   2 - Age in format: 35 Months.
"RTN","BIRPC1",16,0)
 ;--->   3 - Text of Patient's sex.
"RTN","BIRPC1",17,0)
 ;--->   4 - HRCN in the format XX-XX-XX.
"RTN","BIRPC1",18,0)
 ;--->   5 - Text of ACTIVE/INACTIVE Status.
"RTN","BIRPC1",19,0)
 ;---> Parameters:
"RTN","BIRPC1",20,0)
 ;     1 - BIDATA  (ret) String of patient data||error.
"RTN","BIRPC1",21,0)
 ;     2 - BIDFN   (req) DFN of patient.
"RTN","BIRPC1",22,0)
 ;
"RTN","BIRPC1",23,0)
 ;---> Delimiter to pass error with result to GUI.
"RTN","BIRPC1",24,0)
 N BI31,BIERR S BI31=$C(31)_$C(31)
"RTN","BIRPC1",25,0)
 S BIDATA="",BIERR=""
"RTN","BIRPC1",26,0)
 ;
"RTN","BIRPC1",27,0)
 ;---> If DFN not supplied, set Error Code and quit.
"RTN","BIRPC1",28,0)
 I '$G(BIDFN) D  Q
"RTN","BIRPC1",29,0)
 .D ERRCD^BIUTL2(201,.BIERR) S BIDATA=BI31_BIERR
"RTN","BIRPC1",30,0)
 ;
"RTN","BIRPC1",31,0)
 ;---> DOB.
"RTN","BIRPC1",32,0)
 S BIDATA=$$TXDT1^BIUTL5($$DOB^BIUTL1(BIDFN))
"RTN","BIRPC1",33,0)
 ;
"RTN","BIRPC1",34,0)
 ;---> Age.
"RTN","BIRPC1",35,0)
 S BIDATA=BIDATA_U_$$AGEF^BIUTL1(BIDFN)
"RTN","BIRPC1",36,0)
 ;
"RTN","BIRPC1",37,0)
 ;---> Text of sex.
"RTN","BIRPC1",38,0)
 S BIDATA=BIDATA_U_$$SEXW^BIUTL1(BIDFN)
"RTN","BIRPC1",39,0)
 ;
"RTN","BIRPC1",40,0)
 ;---> HRCN, format XX-XX-XX.
"RTN","BIRPC1",41,0)
 S BIDATA=BIDATA_U_$$HRCN^BIUTL1(BIDFN)
"RTN","BIRPC1",42,0)
 ;
"RTN","BIRPC1",43,0)
 ;---> Active/Inactive Status.
"RTN","BIRPC1",44,0)
 S BIDATA=BIDATA_U_$$ACTIVE^BIUTL1(BIDFN)
"RTN","BIRPC1",45,0)
 ;
"RTN","BIRPC1",46,0)
 S BIDATA=BIDATA_BI31
"RTN","BIRPC1",47,0)
 ;
"RTN","BIRPC1",48,0)
 Q
"RTN","BIRPC1",49,0)
 ;
"RTN","BIRPC1",50,0)
 ;
"RTN","BIRPC1",51,0)
 ;----------
"RTN","BIRPC1",52,0)
GET(BIDATA,BIDA,BIVTYPE,BIDE) ;PEP - Return data for one Immunization or Skin Test.
"RTN","BIRPC1",53,0)
 ;---> Return data for one Immunization or Skin Test.
"RTN","BIRPC1",54,0)
 ;---> Called by RPC: BI VISIT GET.
"RTN","BIRPC1",55,0)
 ;---> Parameters:
"RTN","BIRPC1",56,0)
 ;     1 - BIDATA  (ret) Visit Data or Text of Error Code if any.
"RTN","BIRPC1",57,0)
 ;     2 - BIDA    (req) IEN of V IMM or V SKIN entry for data retrieval.
"RTN","BIRPC1",58,0)
 ;     3 - BIVTYPE (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIRPC1",59,0)
 ;     4 - BIDE    (opt) Local array for Data Elements to be returned.
"RTN","BIRPC1",60,0)
 ;
"RTN","BIRPC1",61,0)
 ;---> Delimiter to pass error with result to GUI.
"RTN","BIRPC1",62,0)
 N BI31,BIERR S BI31=$C(31)_$C(31)
"RTN","BIRPC1",63,0)
 S BIDATA="",BIERR=""
"RTN","BIRPC1",64,0)
 ;
"RTN","BIRPC1",65,0)
 ;---> If BIVTYPE does not="I" (Immunization Visit) and it does
"RTN","BIRPC1",66,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIRPC1",67,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D  Q
"RTN","BIRPC1",68,0)
 .D ERRCD^BIUTL2(410,.BIERR) S BIDATA=BI31_BIERR
"RTN","BIRPC1",69,0)
 ;
"RTN","BIRPC1",70,0)
 ;---> If BIDA not supplied, set Error Code and quit.
"RTN","BIRPC1",71,0)
 I '$G(BIDA) D  Q
"RTN","BIRPC1",72,0)
 .D ERRCD^BIUTL2(409,.BIERR) S BIDATA=BI31_BIERR
"RTN","BIRPC1",73,0)
 ;
"RTN","BIRPC1",74,0)
 ;---> Set required variables, kill ^BITMP($J).
"RTN","BIRPC1",75,0)
 D SETVARS^BIUTL5 K ^BITMP($J)
"RTN","BIRPC1",76,0)
 ;
"RTN","BIRPC1",77,0)
 ;---> Set BIDE local array for Data Elements to be returned.
"RTN","BIRPC1",78,0)
 ;---> IENs are in ^BIEXPDD(, the BI TABLE DATA ELEMENT File.
"RTN","BIRPC1",79,0)
 ;---> The Pieces (PC) indicate position in the returned data string,
"RTN","BIRPC1",80,0)
 ;---> BIDATA, below.
"RTN","BIRPC1",81,0)
 ;---> Branching logic for Immunization versus Skin Test Visits.
"RTN","BIRPC1",82,0)
 ;
"RTN","BIRPC1",83,0)
 ;---> IMMUNIZATION:
"RTN","BIRPC1",84,0)
 ;---> If this is an Immunization Visit, collect these Data Elements.
"RTN","BIRPC1",85,0)
 N I
"RTN","BIRPC1",86,0)
 ;---> Next line: 6 (Dose#) defunct, but serves as a place holder. v8.0
"RTN","BIRPC1",87,0)
 ;
"RTN","BIRPC1",88,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIRPC1",89,0)
 ;---> Add Eligibility Code Text and NDC Code Text to default Hx string.
"RTN","BIRPC1",90,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIRPC1",91,0)
 ;---> Add Admin Note to default Hx string.
"RTN","BIRPC1",92,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIRPC1",93,0)
 ;---> Add Date VIS Presented to Patient (YYYYMMDD) and Date of Event ONLY.
"RTN","BIRPC1",94,0)
 ;I '$D(BIDE),BIVTYPE="I" F I=4,6,24,27,29:1:37,43,49,51,61,65,67,68,76,77,78,80,82,84,87  S BIDE(I)=""
"RTN","BIRPC1",95,0)
 I '$D(BIDE),BIVTYPE="I" D
"RTN","BIRPC1",96,0)
 .F I=4,6,24,27,29:1:37,43,49,51,61,65,67,68,76,77,78,80,82,84,85,87,90,91  S BIDE(I)=""
"RTN","BIRPC1",97,0)
 ;**********
"RTN","BIRPC1",98,0)
 ;
"RTN","BIRPC1",99,0)
 ;---> IEN PC  DATA
"RTN","BIRPC1",100,0)
 ;---> --- --  ----
"RTN","BIRPC1",101,0)
 ;--->     1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BIRPC1",102,0)
 ;---> 4   2 = Vaccine Name, Short.
"RTN","BIRPC1",103,0)
 ;---> 6   3 = Dose#.  v8.0 No longer used.
"RTN","BIRPC1",104,0)
 ;---> 24  4 = V IMMUNIZATION IEN.
"RTN","BIRPC1",105,0)
 ;---> 27  5 = Vaccine Group ("Series Type").
"RTN","BIRPC1",106,0)
 ;---> 29  6 = Date of Immunization (DD-Mmm-YYYY @HH:MM).
"RTN","BIRPC1",107,0)
 ;---> 30  7 = Vaccine Name, IEN.
"RTN","BIRPC1",108,0)
 ;---> 31  8 = Vaccine maximum Dose#.
"RTN","BIRPC1",109,0)
 ;---> 32  9 = Vaccine Lot Number, IEN.
"RTN","BIRPC1",110,0)
 ;---> 33 10 = Vaccine Lot Number.
"RTN","BIRPC1",111,0)
 ;---> 34 11 = Location IEN.
"RTN","BIRPC1",112,0)
 ;---> 35 12 = Category of Visit (A,E, or I)
"RTN","BIRPC1",113,0)
 ;---> 36 13 = Location Other (text).
"RTN","BIRPC1",114,0)
 ;---> 37 14 = Location IHS (text).
"RTN","BIRPC1",115,0)
 ;---> 43 15 = Vaccine Reaction.
"RTN","BIRPC1",116,0)
 ;---> 49 16 = VIS Statement Info (Yes/No).
"RTN","BIRPC1",117,0)
 ;---> 51 17 = Release/Revision Date of VIS (DD-Mmm-YYYY).
"RTN","BIRPC1",118,0)
 ;---> 61 18 = Immunization Provider IEN.
"RTN","BIRPC1",119,0)
 ;---> 65 19 = Dose Override.
"RTN","BIRPC1",120,0)
 ;---> 67 20 = Injection Site.
"RTN","BIRPC1",121,0)
 ;---> 68 21 = Volume.
"RTN","BIRPC1",122,0)
 ;---> 76 22 = Visit IEN.
"RTN","BIRPC1",123,0)
 ;---> 77 23 = Eligibility Code IEN.
"RTN","BIRPC1",124,0)
 ;---> 78 24 - Imported from Outside Registry (1=imported, 2=imported & edited).
"RTN","BIRPC1",125,0)
 ;---> 80 25 = NDC Code pointer IEN.
"RTN","BIRPC1",126,0)
 ;---> 82 26 = Eligibility Code Text.
"RTN","BIRPC1",127,0)
 ;---> 84 27 = NDC Code Text.
"RTN","BIRPC1",128,0)
 ;---> 85 28 = Date of Event OR Visit; Admin Shot Date (1201 of V File) in MM/DD/YY
"RTN","BIRPC1",129,0)
 ;--->         If 1201 is not populated, this element returns the Visit Date!
"RTN","BIRPC1",130,0)
 ;---> 87 29 = Administrative Note.
"RTN","BIRPC1",131,0)
 ;---> 90 30 = Date VIS Presented to Patient.
"RTN","BIRPC1",132,0)
 ;---> 91 31 = Date of Event (1201) ONLY; if 1201 is null, return null.
"RTN","BIRPC1",133,0)
 ;
"RTN","BIRPC1",134,0)
 ;
"RTN","BIRPC1",135,0)
 ;---> SKIN TEST:
"RTN","BIRPC1",136,0)
 ;---> If this is a Skin Test Visit, collect these Data Elements.
"RTN","BIRPC1",137,0)
 ;
"RTN","BIRPC1",138,0)
 ;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BIRPC1",139,0)
 ;---> Add Skin Test Lot Number IEN and Text.
"RTN","BIRPC1",140,0)
 ;I '$D(BIDE),BIVTYPE="S" F I=24,26,29,34:1:42,61,67,68,70,76 S BIDE(I)=""
"RTN","BIRPC1",141,0)
 I '$D(BIDE),BIVTYPE="S" F I=24,26,29,34:1:42,61,67,68,70,76,92,93 S BIDE(I)=""
"RTN","BIRPC1",142,0)
 ;
"RTN","BIRPC1",143,0)
 ;---> IEN PC  DATA
"RTN","BIRPC1",144,0)
 ;---> --- --  ----
"RTN","BIRPC1",145,0)
 ;--->     1 = Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BIRPC1",146,0)
 ;---> 24  2 = V File IEN.
"RTN","BIRPC1",147,0)
 ;---> 26  3 = Location (or Outside Location) of Visit.
"RTN","BIRPC1",148,0)
 ;---> 29  4 = Date of Skin Test (DD-Mmm-YYYY @HH:MM).
"RTN","BIRPC1",149,0)
 ;---> 34  5 = Location IEN.
"RTN","BIRPC1",150,0)
 ;---> 35  6 = Category of Visit (A,E, or I)
"RTN","BIRPC1",151,0)
 ;---> 36  7 = Location Other (text).
"RTN","BIRPC1",152,0)
 ;---> 37  8 = Location IHS (text).
"RTN","BIRPC1",153,0)
 ;---> 38  9 = Skin Test Result.
"RTN","BIRPC1",154,0)
 ;---> 39 10 = Skin Test Reading.
"RTN","BIRPC1",155,0)
 ;---> 40 11 = Skin Test Date Read.
"RTN","BIRPC1",156,0)
 ;---> 41 12 = Skin Test Name.
"RTN","BIRPC1",157,0)
 ;---> 42 13 = Skin Test Name IEN.
"RTN","BIRPC1",158,0)
 ;---> 61 14 = Immunization Provider IEN.
"RTN","BIRPC1",159,0)
 ;---> 67 15 = Injection Site.
"RTN","BIRPC1",160,0)
 ;---> 68 16 = Volume.
"RTN","BIRPC1",161,0)
 ;---> 70 17 = Skin Test Reader (Provider) IEN.
"RTN","BIRPC1",162,0)
 ;---> 76 18 = Visit IEN.
"RTN","BIRPC1",163,0)
 ;---> 92 19 = Skin Test Lot Number IEN.
"RTN","BIRPC1",164,0)
 ;---> 93 20 = Skin Test Lot Number Text.
"RTN","BIRPC1",165,0)
 ;**********
"RTN","BIRPC1",166,0)
 ;
"RTN","BIRPC1",167,0)
 ;
"RTN","BIRPC1",168,0)
 ;---> Now, gather data from one V File Visit.
"RTN","BIRPC1",169,0)
 ;     1 - BIDA    (req) IEN of V File Visit.
"RTN","BIRPC1",170,0)
 ;     2 - BIDE    (req) Data Elements array (null if HL7)
"RTN","BIRPC1",171,0)
 ;     3 - BIFMT   (req) Format: 0=ASCII Split, 1=ASCII, 2=HL7, 3=IMM/SERVE
"RTN","BIRPC1",172,0)
 ;     4 - BIVTYPE (req) Visit Type: "I"=Immunization, "S"=Skin Test.
"RTN","BIRPC1",173,0)
 ;     5 - BIDATA  (opt) Data returned in this param if desired.
"RTN","BIRPC1",174,0)
 ;
"RTN","BIRPC1",175,0)
 D HISTORY1^BIEXPRT3(BIDA,.BIDE,1,BIVTYPE,,.BIERR)
"RTN","BIRPC1",176,0)
 I BIERR]"" S BIDATA=BI31_BIERR Q
"RTN","BIRPC1",177,0)
 ;
"RTN","BIRPC1",178,0)
 ;
"RTN","BIRPC1",179,0)
 ;---> Set parameters for writing data as a string in BIDATA.
"RTN","BIRPC1",180,0)
 ;---> Parameters:
"RTN","BIRPC1",181,0)
 ;     1 - BIEXP    (req) Export: 0=screen, 1=host file, 2=string
"RTN","BIRPC1",182,0)
 ;     2 - BIFMT    (req) Format: 1=ASCII, 2=HL7, 3=IMM/SERVE
"RTN","BIRPC1",183,0)
 ;     3 - BIFLNM   (opt) File name
"RTN","BIRPC1",184,0)
 ;     4 - BIPATH   (opt) BI Path name for host files
"RTN","BIRPC1",185,0)
 ;     5 - BIDATA   (ret) Immunization History in "|"-delimited string
"RTN","BIRPC1",186,0)
 ;                        NOTE: Since this is necessarily only one
"RTN","BIRPC1",187,0)
 ;                              record, strip "^"-delimiter at end.
"RTN","BIRPC1",188,0)
 ;
"RTN","BIRPC1",189,0)
 D WRITE^BIEXPRT4(2,1,,,.BIDATA)
"RTN","BIRPC1",190,0)
 ;
"RTN","BIRPC1",191,0)
 ;---> Returned data string, with error delimiter concatenated.
"RTN","BIRPC1",192,0)
 S BIDATA=$P(BIDATA,U)_BI31
"RTN","BIRPC1",193,0)
 Q
"RTN","BIRPC3")
0^10^B47888701
"RTN","BIRPC3",1,0)
BIRPC3 ;IHS/CMI/MWR - REMOTE PROCEDURE CALLS; MAY 10, 2010
"RTN","BIRPC3",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BIRPC3",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIRPC3",4,0)
 ;;  ADD/EDIT A VISIT (IMMUNIZATION OR SKIN TEST), DELETE A VISIT.
"RTN","BIRPC3",5,0)
 ;;  Check validity of data in several fields.
"RTN","BIRPC3",6,0)
 ;;  PATCH 3: If Category=Historical Event, Lot need not be Active.
"RTN","BIRPC3",7,0)
 ;;                                                    ADDEDIT+117, LOTCHK+34
"RTN","BIRPC3",8,0)
 ;;  PATCH 5: Added BINOM parameter to ADDEDIT P.E.P. for Visit Selection Menu.
"RTN","BIRPC3",9,0)
 ;;                                                    ADDEDIT+0
"RTN","BIRPC3",10,0)
 ;;  PATCH 5: Ignore 1st piece of zero node; just check for node. ADDEDIT+63
"RTN","BIRPC3",11,0)
 ;;  PATCH 9: Added save of Admin Date and VIS Presented Date.  ADDEDIT+39
"RTN","BIRPC3",12,0)
 ;;  PATCH 10: Added save of Skin Test Lot Number.  ADDEDIT+44
"RTN","BIRPC3",13,0)
 ;
"RTN","BIRPC3",14,0)
 ;
"RTN","BIRPC3",15,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIRPC3",16,0)
 ;---> Added BINOM parameter to ADDEDIT P.E.P., to control Visit Menu display.
"RTN","BIRPC3",17,0)
 ;---> Added Admin Note, piece 27.
"RTN","BIRPC3",18,0)
 ;----------
"RTN","BIRPC3",19,0)
ADDEDIT(BIERR,BIDATA,BINOM) ;PEP - Add/Edit an V IMMUNIZATION or V SKIN TEST.
"RTN","BIRPC3",20,0)
 ;---> Add/Edit an V IMMUNIZATION or V SKIN TEST.
"RTN","BIRPC3",21,0)
 ;---> Called by RPC: BI VISIT ADD/EDIT.
"RTN","BIRPC3",22,0)
 ;---> Parameters:
"RTN","BIRPC3",23,0)
 ;     1 - BIERR   (ret) Text of Error Code if any, otherwise null.
"RTN","BIRPC3",24,0)
 ;     2 - BIDATA  (req) String of data for the Visit to be added.
"RTN","BIRPC3",25,0)
 ;     3 - BINOM   (opt) 0=Allow display of Visit Selection Menu if site
"RTN","BIRPC3",26,0)
 ;                       parameter is set. 1=No display (for export).
"RTN","BIRPC3",27,0)
 ;
"RTN","BIRPC3",28,0)
 ;---> Pieces of BIDATA delimited by "|":
"RTN","BIRPC3",29,0)
 ;     ----------------------------------
"RTN","BIRPC3",30,0)
 ;     1 - (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIRPC3",31,0)
 ;     2 - (req) DFN of patient.
"RTN","BIRPC3",32,0)
 ;     3 - (req) Vaccine or Skin Test .01 pointer.
"RTN","BIRPC3",33,0)
 ;     4 - (opt) Dose# number for this Immunization (NO LONGER USED).
"RTN","BIRPC3",34,0)
 ;     5 - (opt) Lot number IEN for this Immunization.
"RTN","BIRPC3",35,0)
 ;     6 - (req) Date.Time of Visit.
"RTN","BIRPC3",36,0)
 ;     7 - (req) Location of encounter IEN.
"RTN","BIRPC3",37,0)
 ;     8 - (opt) Other Location of encounter.
"RTN","BIRPC3",38,0)
 ;     9 - (req) Category: A (Ambul), I (Inpat), E (Event/Hist)
"RTN","BIRPC3",39,0)
 ;    10 - (opt) Visit IEN.
"RTN","BIRPC3",40,0)
 ;    11 - (opt) Old V File IEN (for edits).
"RTN","BIRPC3",41,0)
 ;    12 - (req) Skin Test Result: P,N,D,O.
"RTN","BIRPC3",42,0)
 ;    13 - (req) Skin Test Reading: 0-40.
"RTN","BIRPC3",43,0)
 ;    14 - (req) Skin Test Date Read.
"RTN","BIRPC3",44,0)
 ;    15 - (opt) Vaccine Reaction.
"RTN","BIRPC3",45,0)
 ;    16 - (opt) VFC Eligibility.  vvv83
"RTN","BIRPC3",46,0)
 ;    17 - (opt) Release/Revision Date of VIS.
"RTN","BIRPC3",47,0)
 ;    18 - (opt) IEN of Provider of Immunization/Skin Test.
"RTN","BIRPC3",48,0)
 ;    19 - (opt) Dose Override.
"RTN","BIRPC3",49,0)
 ;    20 - (opt) Injection Site.
"RTN","BIRPC3",50,0)
 ;    21 - (opt) Volume.
"RTN","BIRPC3",51,0)
 ;    22 - (opt) IEN of Reader (Provider) of Skin Test.
"RTN","BIRPC3",52,0)
 ;    23 - (req) DUZ(2) for Site Parameters.
"RTN","BIRPC3",53,0)
 ;    24 - (opt) If this was an imported CPT Coded Imm from PCC (=IEN of V CPT).
"RTN","BIRPC3",54,0)
 ;    25 - (opt) If this =1, then imported (IF =2, then was edited after import).
"RTN","BIRPC3",55,0)
 ;    26 - (opt) NDC pointer IEN (to file #9002084.95).
"RTN","BIRPC3",56,0)
 ;    27 - (opt) Administrative Note (<161 chars).
"RTN","BIRPC3",57,0)
 ;
"RTN","BIRPC3",58,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIRPC3",59,0)
 ;---> Add Admin Date and VIS Presented Date to data being saved.
"RTN","BIRPC3",60,0)
 ;    28 - (opt) Admin Date (Date shot admin'd to patient.
"RTN","BIRPC3",61,0)
 ;    29 - (opt) Date VIS Presented to Patient.
"RTN","BIRPC3",62,0)
 ;
"RTN","BIRPC3",63,0)
 ;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BIRPC3",64,0)
 ;    30 - (opt) Skin Test Lot Number.
"RTN","BIRPC3",65,0)
 ;
"RTN","BIRPC3",66,0)
 ;---> Define delimiter to pass error and error variable.
"RTN","BIRPC3",67,0)
 N BI31,BIDUZ2,BIOIEN
"RTN","BIRPC3",68,0)
 S BI31=$C(31)_$C(31),BIERR=""
"RTN","BIRPC3",69,0)
 ;
"RTN","BIRPC3",70,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIRPC3",71,0)
 ;---> Added BINOM parameter to ADDEDIT P.E.P., to control Visit Menu display.
"RTN","BIRPC3",72,0)
 S:($G(BINOM)="") BINOM=0
"RTN","BIRPC3",73,0)
 ;
"RTN","BIRPC3",74,0)
 ;---> If this is an edit of an old Visit, preserve IEN of old V File entry.
"RTN","BIRPC3",75,0)
 S BIOIEN=$P(BIDATA,"|",11)
"RTN","BIRPC3",76,0)
 ;
"RTN","BIRPC3",77,0)
 ;---> If DATA not supplied, set Error Code and quit.
"RTN","BIRPC3",78,0)
 I $G(BIDATA)']"" D  Q
"RTN","BIRPC3",79,0)
 .D ERRCD^BIUTL2(403,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",80,0)
 ;
"RTN","BIRPC3",81,0)
 ;---> Get Site IEN (passed DUZ(2)) for Site Parameters.
"RTN","BIRPC3",82,0)
 S BIDUZ2=$P(BIDATA,"|",23)
"RTN","BIRPC3",83,0)
 ;---> If no Site IEN was passed, try to get it from local symbol table.
"RTN","BIRPC3",84,0)
 S:'BIDUZ2 (BIDUZ2,$P(BIDATA,"|",23))=$G(DUZ(2))
"RTN","BIRPC3",85,0)
 ;--> If still no Site IEN, error out.
"RTN","BIRPC3",86,0)
 I '$G(BIDUZ2) D ERRCD^BIUTL2(121,.BIERR) S BIERR=BI31_BIERR Q
"RTN","BIRPC3",87,0)
 ;
"RTN","BIRPC3",88,0)
 ;---> Check for valid Patient.
"RTN","BIRPC3",89,0)
 N BIDFN S BIDFN=$P(BIDATA,"|",2)
"RTN","BIRPC3",90,0)
 ;
"RTN","BIRPC3",91,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIRPC3",92,0)
 ;---> Ignore 1st piece of zero node; just check for node.
"RTN","BIRPC3",93,0)
 ;I '$G(^AUPNPAT(+BIDFN,0)) D  Q
"RTN","BIRPC3",94,0)
 I '$D(^AUPNPAT(+BIDFN,0)) D  Q
"RTN","BIRPC3",95,0)
 .;**********
"RTN","BIRPC3",96,0)
 .;
"RTN","BIRPC3",97,0)
 .D ERRCD^BIUTL2(217,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",98,0)
 ;
"RTN","BIRPC3",99,0)
 ;---> Visit Type: "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIRPC3",100,0)
 ;---> If BIVTYPE does not="I" (Immunization Visit) and it does
"RTN","BIRPC3",101,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIRPC3",102,0)
 N BIVTYPE S BIVTYPE=$P(BIDATA,"|",1)
"RTN","BIRPC3",103,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D  Q
"RTN","BIRPC3",104,0)
 .D ERRCD^BIUTL2(410,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",105,0)
 ;
"RTN","BIRPC3",106,0)
 ;---> If this is an Immunization Visit and the Vaccine Table
"RTN","BIRPC3",107,0)
 ;---> not standard, set Error Code and quit.
"RTN","BIRPC3",108,0)
 I (BIVTYPE="I")&($D(^BISITE(-1))) D  Q
"RTN","BIRPC3",109,0)
 .D ERRCD^BIUTL2(503,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",110,0)
 ;
"RTN","BIRPC3",111,0)
 ;---> If this Visit (new or edited) will be a duplicate, set error
"RTN","BIRPC3",112,0)
 ;---> and quit.
"RTN","BIRPC3",113,0)
 D DUPTEST^BIUTL8(.BIERR,BIDATA,$G(BIOIEN))
"RTN","BIRPC3",114,0)
 Q:BIERR]""
"RTN","BIRPC3",115,0)
 ;
"RTN","BIRPC3",116,0)
 ;---> Reformat dates to Fileman Internal format.
"RTN","BIRPC3",117,0)
 D
"RTN","BIRPC3",118,0)
 .N I F I=6,14,17 D
"RTN","BIRPC3",119,0)
 ..N X S X=$P(BIDATA,"|",I)
"RTN","BIRPC3",120,0)
 ..D DT^DILF("PT",X,.X)
"RTN","BIRPC3",121,0)
 ..S $P(BIDATA,"|",I)=X
"RTN","BIRPC3",122,0)
 ;
"RTN","BIRPC3",123,0)
 ;---> If Visit Date is before Patient's DOB, set Error Code and quit.
"RTN","BIRPC3",124,0)
 I $P(BIDATA,"|",6)<$$DOB^BIUTL1($P(BIDATA,"|",2)) D  Q
"RTN","BIRPC3",125,0)
 .D ERRCD^BIUTL2(422,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",126,0)
 ;
"RTN","BIRPC3",127,0)
 ;---> Set Lot# and Category.
"RTN","BIRPC3",128,0)
 N BILOT S BILOT=$P(BIDATA,"|",5)
"RTN","BIRPC3",129,0)
 N BICAT S BICAT=$P(BIDATA,"|",9)
"RTN","BIRPC3",130,0)
 ;
"RTN","BIRPC3",131,0)
 ;---> If this is an Immunization, check for valid.
"RTN","BIRPC3",132,0)
 D:BIVTYPE="I"  Q:$G(BIERR)]""
"RTN","BIRPC3",133,0)
 .N BIVAC S BIVAC=$P(BIDATA,"|",3)
"RTN","BIRPC3",134,0)
 .;
"RTN","BIRPC3",135,0)
 .;---> If Vaccine not provided, set Error and quit.
"RTN","BIRPC3",136,0)
 .I '$G(BIVAC) D  Q
"RTN","BIRPC3",137,0)
 ..D ERRCD^BIUTL2(502,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",138,0)
 .;
"RTN","BIRPC3",139,0)
 .;---> If Vaccine does not exist, set Error and quit.
"RTN","BIRPC3",140,0)
 .I '$D(^AUTTIMM(BIVAC,0)) D  Q
"RTN","BIRPC3",141,0)
 ..D ERRCD^BIUTL2(430,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",142,0)
 .;
"RTN","BIRPC3",143,0)
 .;---> If the Vaccine is INACTIVE and Category is NOT "Historical Event"
"RTN","BIRPC3",144,0)
 .;---> set Error Code and quit.
"RTN","BIRPC3",145,0)
 .I $P(^AUTTIMM(BIVAC,0),U,7)&(BICAT'="E") D  Q
"RTN","BIRPC3",146,0)
 ..D ERRCD^BIUTL2(429,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",147,0)
 .;
"RTN","BIRPC3",148,0)
 .;********** PATCH 1, v8.2.1, FEB 01,2008, IHS/CMI/MWR
"RTN","BIRPC3",149,0)
 .;---> Use new call, LOTCHK, to check validity of Lot Number.
"RTN","BIRPC3",150,0)
 .;---> If Lot# is required and one was not passed, set Error and quit.
"RTN","BIRPC3",151,0)
 .;---> (If Category is Historical Event, Lot# not required.)
"RTN","BIRPC3",152,0)
 .I $$LOTREQ^BIUTL2(BIDUZ2)&(BILOT="")&(BICAT'="E") D  Q
"RTN","BIRPC3",153,0)
 ..D ERRCD^BIUTL2(431,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",154,0)
 .;
"RTN","BIRPC3",155,0)
 .;---> If Lot Number was passed, check it.
"RTN","BIRPC3",156,0)
 .D:BILOT  Q:$G(BIERR)]""
"RTN","BIRPC3",157,0)
 ..;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIRPC3",158,0)
 ..;---> If Category=Historical Event, Lot need not be Active.
"RTN","BIRPC3",159,0)
 ..;D LOTCHK(BILOT,BIVAC,.BIERR)
"RTN","BIRPC3",160,0)
 ..D LOTCHK(BILOT,BIVAC,BICAT,.BIERR)
"RTN","BIRPC3",161,0)
 ..;**********
"RTN","BIRPC3",162,0)
 ..;
"RTN","BIRPC3",163,0)
 ..I $G(BIERR)]"" S BIERR=BI31_BIERR
"RTN","BIRPC3",164,0)
 ;
"RTN","BIRPC3",165,0)
 ;---> If this is a Skin Test, Category is NOT Historical, and it has a Result,
"RTN","BIRPC3",166,0)
 ;---> then check for Reading in mm.
"RTN","BIRPC3",167,0)
 I BIVTYPE="S",BICAT'="E",$P(BIDATA,"|",12)]"",$P(BIDATA,"|",13)="" D  Q
"RTN","BIRPC3",168,0)
 .D ERRCD^BIUTL2(436,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",169,0)
 ;
"RTN","BIRPC3",170,0)
 ;
"RTN","BIRPC3",171,0)
 ;---> Add Visit.
"RTN","BIRPC3",172,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIRPC3",173,0)
 ;---> Added BINOM parameter to ADDEDIT P.E.P., to control Visit Menu display.
"RTN","BIRPC3",174,0)
 ;D ADDV^BIVISIT(.BIERR,BIDATA)
"RTN","BIRPC3",175,0)
 D ADDV^BIVISIT(.BIERR,BIDATA,,BINOM)
"RTN","BIRPC3",176,0)
 ;
"RTN","BIRPC3",177,0)
 ;---> If add Visit fails, then return error and quit;
"RTN","BIRPC3",178,0)
 ;---> do NOT delete the old Visit.
"RTN","BIRPC3",179,0)
 I BIERR S BIERR=BI31_$P(BIERR,U,2) Q
"RTN","BIRPC3",180,0)
 ;
"RTN","BIRPC3",181,0)
 ;---> If this is an Edit of an old Visit, then DELETE the old V File entry.
"RTN","BIRPC3",182,0)
 I $G(BIOIEN) D DELETE(.BIERR,BIOIEN,BIVTYPE) Q
"RTN","BIRPC3",183,0)
 ;
"RTN","BIRPC3",184,0)
 ;---> Since this was a New Visit (not an Edit), decrement the Lot Total.
"RTN","BIRPC3",185,0)
 I $G(BILOT) D LOTDECR(BILOT)
"RTN","BIRPC3",186,0)
 ;
"RTN","BIRPC3",187,0)
 Q
"RTN","BIRPC3",188,0)
 ;
"RTN","BIRPC3",189,0)
 ;
"RTN","BIRPC3",190,0)
 ;----------
"RTN","BIRPC3",191,0)
LOTDECR(BILOT) ;PEP - Decrement Lot Total for a given Lot Number.
"RTN","BIRPC3",192,0)
 ;---> Parameters:
"RTN","BIRPC3",193,0)
 ;     1 - BILOT  (req) Lot Number IEN for this Immunization.
"RTN","BIRPC3",194,0)
 ;
"RTN","BIRPC3",195,0)
 Q:'$G(BILOT)  Q:'$D(^AUTTIML(BILOT,0))
"RTN","BIRPC3",196,0)
 N X,Y,Z S X=^AUTTIML(BILOT,0),Y=$P(X,U,11),Z=$P(X,U,12)
"RTN","BIRPC3",197,0)
 ;---> Quit if no Starting Amount (i.e., not tracked).
"RTN","BIRPC3",198,0)
 Q:Y=""
"RTN","BIRPC3",199,0)
 ;---> Okay, decrement Number Unused by 1.
"RTN","BIRPC3",200,0)
 S $P(^AUTTIML(BILOT,0),U,12)=Z-1
"RTN","BIRPC3",201,0)
 ;
"RTN","BIRPC3",202,0)
 Q
"RTN","BIRPC3",203,0)
 ;
"RTN","BIRPC3",204,0)
 ;
"RTN","BIRPC3",205,0)
 ;----------
"RTN","BIRPC3",206,0)
LOTRBAL(BILIEN) ;PEP - Return Remaining Balance (Starting Total - Number Used).
"RTN","BIRPC3",207,0)
 ;---> Parameters:
"RTN","BIRPC3",208,0)
 ;     1 - BILIEN (req) Lot Number IEN for this Immunization.
"RTN","BIRPC3",209,0)
 ;
"RTN","BIRPC3",210,0)
 N BIERR
"RTN","BIRPC3",211,0)
 I '$G(BILIEN) D ERRCD^BIUTL2(511,.BIERR) Q BIERR
"RTN","BIRPC3",212,0)
 I '$D(^AUTTIML(BILIEN,0)) D ERRCD^BIUTL2(512,.BIERR) Q BIERR
"RTN","BIRPC3",213,0)
 N X,Y,Z S X=^AUTTIML(BILIEN,0),Y=$P(X,U,11),Z=$P(X,U,12)
"RTN","BIRPC3",214,0)
 Q:(Y="") "Not tracked"
"RTN","BIRPC3",215,0)
 Q +Z
"RTN","BIRPC3",216,0)
 ;
"RTN","BIRPC3",217,0)
 ;
"RTN","BIRPC3",218,0)
 ;----------
"RTN","BIRPC3",219,0)
LOTEXP(BILIEN,BIYY) ;PEP - Return Lot Expiration Date in format: MM/DD/YYYY.
"RTN","BIRPC3",220,0)
 ;---> Parameters:
"RTN","BIRPC3",221,0)
 ;     1 - BILIEN (req) Lot Number IEN for this Immunization.
"RTN","BIRPC3",222,0)
 ;     2 - BIYY   (opt) If BIYY=1, return 2-digit year: MM/DD/YY.
"RTN","BIRPC3",223,0)
 ;                      If BIYY=2, return Fileman format of date.
"RTN","BIRPC3",224,0)
 ;
"RTN","BIRPC3",225,0)
 I '$G(BILIEN) D ERRCD^BIUTL2(511,.BIERR) Q BIERR
"RTN","BIRPC3",226,0)
 I '$D(^AUTTIML(BILIEN,0)) D ERRCD^BIUTL2(512,.BIERR) Q BIERR
"RTN","BIRPC3",227,0)
 N BIDATE S BIDATE=$P(^AUTTIML(BILIEN,0),U,9)
"RTN","BIRPC3",228,0)
 Q:($G(BIYY)=2) BIDATE
"RTN","BIRPC3",229,0)
 Q $$SLDT2^BIUTL5(BIDATE,$G(BIYY))
"RTN","BIRPC3",230,0)
 ;
"RTN","BIRPC3",231,0)
 ;
"RTN","BIRPC3",232,0)
 ;********** PATCH 1, v8.2.1, FEB 01,2008, IHS/CMI/MWR
"RTN","BIRPC3",233,0)
 ;---> New LOTCHK subroutine to combine all checks for valid Lot Number.
"RTN","BIRPC3",234,0)
 ;----------
"RTN","BIRPC3",235,0)
LOTCHK(BILOT,BIVAC,BICAT,BIERR) ;EP
"RTN","BIRPC3",236,0)
 ;---> Check for valid Lot Number given the Vaccine passed.
"RTN","BIRPC3",237,0)
 ;---> Parameters:
"RTN","BIRPC3",238,0)
 ;     1 - BILOT (req) IEN of Lot Number.
"RTN","BIRPC3",239,0)
 ;     2 - BIVAC (req) IEN of Vaccine IMMUNIZATION File (9999999.14).
"RTN","BIRPC3",240,0)
 ;     3 - BICAT (opt) Category of Visit.
"RTN","BIRPC3",241,0)
 ;     4 - BIERR (ret) Text of Error Code if any, otherwise null.
"RTN","BIRPC3",242,0)
 ;
"RTN","BIRPC3",243,0)
 ;---> Check a) Valid Vaccine and Lot Number
"RTN","BIRPC3",244,0)
 ;--->       b) Lot Number has been assigned to the Vaccine passed;
"RTN","BIRPC3",245,0)
 ;--->       b) Lot Number is Active
"RTN","BIRPC3",246,0)
 ;--->       c) Lot Number does not have duplicates
"RTN","BIRPC3",247,0)
 ;
"RTN","BIRPC3",248,0)
 S BIERR=""
"RTN","BIRPC3",249,0)
 ;
"RTN","BIRPC3",250,0)
 ;---> If Lot# IEN not passed, set Error and quit.
"RTN","BIRPC3",251,0)
 I '$G(BILOT) D ERRCD^BIUTL2(511,.BIERR) Q
"RTN","BIRPC3",252,0)
 ;
"RTN","BIRPC3",253,0)
 ;---> If Vaccine IEN not passed, set Error and quit.
"RTN","BIRPC3",254,0)
 I '$G(BILOT) D ERRCD^BIUTL2(502,.BIERR) Q
"RTN","BIRPC3",255,0)
 ;
"RTN","BIRPC3",256,0)
 ;---> Set Y=^AUTTIML(BILOT,0).
"RTN","BIRPC3",257,0)
 N Y S Y=$G(^AUTTIML(BILOT,0))
"RTN","BIRPC3",258,0)
 ;
"RTN","BIRPC3",259,0)
 ;---> If Lot# does not exist, set Error and quit.
"RTN","BIRPC3",260,0)
 I Y="" D  Q
"RTN","BIRPC3",261,0)
 .D ERRCD^BIUTL2(512,.BIERR)
"RTN","BIRPC3",262,0)
 ;
"RTN","BIRPC3",263,0)
 ;---> If this Lot# does NOT point back to this Vaccine, set Error and quit.
"RTN","BIRPC3",264,0)
 I $P(Y,U,4)'=BIVAC D ERRCD^BIUTL2(513,.BIERR) Q
"RTN","BIRPC3",265,0)
 ;
"RTN","BIRPC3",266,0)
 ;---> If the Lot# is INACTIVE (attempted save of earlier visit
"RTN","BIRPC3",267,0)
 ;---> with Lot# previously chosen), set Error Code and quit.
"RTN","BIRPC3",268,0)
 ;
"RTN","BIRPC3",269,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIRPC3",270,0)
 ;---> If Category=Historical Event, Lot need not be Active.
"RTN","BIRPC3",271,0)
 ;I $P(Y,U,3) D ERRCD^BIUTL2(426,.BIERR) Q
"RTN","BIRPC3",272,0)
 I ($P(Y,U,3)&($G(BICAT)'="E")) D ERRCD^BIUTL2(426,.BIERR) Q
"RTN","BIRPC3",273,0)
 ;**********
"RTN","BIRPC3",274,0)
 ;
"RTN","BIRPC3",275,0)
 ;---> If Lot# is duplicated in the IMM LOT File, set Error and quit.
"RTN","BIRPC3",276,0)
 I $$LOTDUP^BIUTL4(BILOT) D ERRCD^BIUTL2(427,.BIERR)
"RTN","BIRPC3",277,0)
 ;
"RTN","BIRPC3",278,0)
 Q
"RTN","BIRPC3",279,0)
 ;**********
"RTN","BIRPC3",280,0)
 ;
"RTN","BIRPC3",281,0)
 ;
"RTN","BIRPC3",282,0)
 ;----------
"RTN","BIRPC3",283,0)
DELETE(BIERR,BIDA,BIVTYPE) ;PEP - Delete an Immunization or Skin Test.
"RTN","BIRPC3",284,0)
 ;---> Delete an Immunization or Skin Test.
"RTN","BIRPC3",285,0)
 ;---> Called by RPC: BI VISIT DELETE.
"RTN","BIRPC3",286,0)
 ;---> Parameters:
"RTN","BIRPC3",287,0)
 ;     1 - BIERR   (ret) Text of Error Code if any, otherwise null.
"RTN","BIRPC3",288,0)
 ;     2 - BIDA    (req) IEN of V IMM or V SKIN entry to be deleted.
"RTN","BIRPC3",289,0)
 ;     3 - BIVTYPE (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIRPC3",290,0)
 ;
"RTN","BIRPC3",291,0)
 ;---> Define delimiter to pass error and error variable.
"RTN","BIRPC3",292,0)
 N BI31 S BI31=$C(31)_$C(31),BIERR=""
"RTN","BIRPC3",293,0)
 ;
"RTN","BIRPC3",294,0)
 ;---> If DA not supplied, set Error Code and quit.
"RTN","BIRPC3",295,0)
 I '$G(BIDA) D  Q
"RTN","BIRPC3",296,0)
 .D ERRCD^BIUTL2(404,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",297,0)
 ;
"RTN","BIRPC3",298,0)
 ;---> If BIVTYPE does not="I" (Immunization Visit) and it does
"RTN","BIRPC3",299,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIRPC3",300,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D  Q
"RTN","BIRPC3",301,0)
 .D ERRCD^BIUTL2(410,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",302,0)
 ;
"RTN","BIRPC3",303,0)
 ;---> Delete V IMMUNIZATION entry.
"RTN","BIRPC3",304,0)
 D DELETE^BIVISIT2(BIDA,BIVTYPE,.BIERR) S BIERR=BI31_BIERR
"RTN","BIRPC3",305,0)
 Q
"RTN","BITN")
0^3^B170868012
"RTN","BITN",1,0)
BITN ;IHS/CMI/MWR - BUILD ^BITN GLOBAL.
"RTN","BITN",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BITN",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BITN",4,0)
 ;;  UTILITY: BUILD STANDARD ^BITN GLOBAL.
"RTN","BITN",5,0)
 ;
"RTN","BITN",6,0)
 ;
"RTN","BITN",7,0)
 ;----------
"RTN","BITN",8,0)
START ;EP
"RTN","BITN",9,0)
 D KGBL^BIUTL8("^BITN")
"RTN","BITN",10,0)
 S ^BITN(0)="BI IMMUNIZATION TABLE HL7 STANDARD^9002084.94I"
"RTN","BITN",11,0)
 N I,X,Y,Z
"RTN","BITN",12,0)
 F I=1:2 S X=$T(@"TABLE"+I) Q:X'[";;"  D
"RTN","BITN",13,0)
 .S Y=$P(X,";;",2),Z=$P(X,";;",3)
"RTN","BITN",14,0)
 .S ^BITN(Y,0)=Z
"RTN","BITN",15,0)
 .S X=$T(@"TABLE"+(I+1)),Z=$P(X,";;",3),^BITN(Y,1)=Z
"RTN","BITN",16,0)
 ;
"RTN","BITN",17,0)
 F I=1:2 S X=$T(@"TABLE"+I^BITN2) Q:X'[";;"  D
"RTN","BITN",18,0)
 .S Y=$P(X,";;",2),Z=$P(X,";;",3)
"RTN","BITN",19,0)
 .S ^BITN(Y,0)=Z
"RTN","BITN",20,0)
 .S X=$T(@"TABLE"+(I+1)^BITN2),Z=$P(X,";;",3),^BITN(Y,1)=Z
"RTN","BITN",21,0)
 ;
"RTN","BITN",22,0)
 N DIK S DIK="^BITN(" D IXALL^DIK
"RTN","BITN",23,0)
 Q
"RTN","BITN",24,0)
 ;
"RTN","BITN",25,0)
 ;
"RTN","BITN",26,0)
 ;----------
"RTN","BITN",27,0)
TABLE ; EP
"RTN","BITN",28,0)
 ;;101;;SMALLPOX^SMALLPOX^75^^^^1^^12^^^^3070831^V04.1^99.42^0^1^.5^^^^
"RTN","BITN",29,0)
 ;;101a;;^^^^^^^^^^^^^Smallpox vaccine
"RTN","BITN",30,0)
 ;;102;;TD (ADULT)^Td-ADULT^9^^^^0^^8^TD-ADULT^90718^9,28,35,112,113,115,138,139,142^3150224^V06.5^99.38^0^1^.5^^^
"RTN","BITN",31,0)
 ;;102a;;Tetanus and Diphtheria Toxoids^54^^^^^^^^^^^^Tetanus and Diphtheria Toxoids, adsorbed for adult use
"RTN","BITN",32,0)
 ;;103;;DTP^DTP^1^^8^^1^^1^^90701^^^V06.1^99.39^0^1^.5^^^^
"RTN","BITN",33,0)
 ;;103a;;Diphtheria and Tetanus Toxoids^54^Tri-Immunol^63^^^^^^^^^^Diphtheria, tetanus toxoids and pertussis vaccine
"RTN","BITN",34,0)
 ;;104;;TETANUS TOXOID^TET TOX^35^^^^0^^1^^90703^9,28,35,112,113,115,138,139,142^3140204^V03.7^99.38^0^1^.5^^^
"RTN","BITN",35,0)
 ;;104a;;Tetanus Toxoids USP For Booste^54^Tetanus Toxoid USP^63^^^^^^^^^^Tetanus Toxoid
"RTN","BITN",36,0)
 ;;105;;TYPHOID, NOS^TYPH,NOS^91^^^^1^^12^^90714^^^V03.1^99.32^0^1^.5^^^
"RTN","BITN",37,0)
 ;;105a;;^^^^^^^^^^^^^Typhoid vaccine, NOS
"RTN","BITN",38,0)
 ;;106;;OPV^OPV^2^^8^^1^^2^SABIN^90712^^^V04.0^99.41^1^1^.5^^^^
"RTN","BITN",39,0)
 ;;106a;;Orimune^63^^^^^^^^^^^^Poliovirus vaccine, live, oral
"RTN","BITN",40,0)
 ;;107;;IPV^IPV^10^^7^^0^^2^SALK^90713^110^3141022^V04.0^99.41^0^1^.5^^^^
"RTN","BITN",41,0)
 ;;107a;;IPOL^54^^^^^^^^^^^^Poliovirus vaccine, inactivated
"RTN","BITN",42,0)
 ;;108;;INFLUENZA, NOS^FLU,NOS^88^^^^1^^10^Flu,NOS^90724^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^^V04.8^99.52^0^1^.5^^^^
"RTN","BITN",43,0)
 ;;108a;;^^^^^^^^^^^^^Influenza virus vaccine, NOS
"RTN","BITN",44,0)
 ;;110;;HEP B, NOS^HEP B,NOS^45^^6^^1^^4^RECOMBIVAX^90731^8,43,44,51,110,104^^V05.3^99.59^0^1^.5^^^^
"RTN","BITN",45,0)
 ;;110a;;Hepagene^56^^^^^^^^^^^^Hepatitis B vaccine, NOS
"RTN","BITN",46,0)
 ;;111;;MEASLES^MEASLES^5^^3^^1^^6^^90705^3,4,94^^V04.2^99.45^0^1^.5^^^^
"RTN","BITN",47,0)
 ;;111a;;ATTENUVAX^45^^^^^^^^^^^^Measles virus vaccine
"RTN","BITN",48,0)
 ;;113;;CHOLERA^CHOLERA^26^^^^1^^12^^90725^^^V03.0^99.31^0^0^.5^^^^
"RTN","BITN",49,0)
 ;;113a;;Generic-Intramuscular^63^^^^^^^^^^^^Cholera vaccine, intramuscular
"RTN","BITN",50,0)
 ;;114;;RUBELLA^RUBELLA^6^^3^^1^^6^^90706^3,4,94,38^^V04.3^99.47^0^1^.5^^^^
"RTN","BITN",51,0)
 ;;114a;;MERUVAX II^45^^^^^^^^^^^^Rubella Virus vaccine
"RTN","BITN",52,0)
 ;;115;;MUMPS^MUMPS^7^^3^^1^^6^^90704^7,94,38^^V04.6^99.46^0^0^.5^^^^
"RTN","BITN",53,0)
 ;;115a;;MUMPSVAX^45^^^^^^^^^^^^Mumps Virus vaccine
"RTN","BITN",54,0)
 ;;116;;BCG^BCG^19^^^^1^^12^^90728^^^V03.2^99.33^1^1^.5^^^^
"RTN","BITN",55,0)
 ;;116a;;Tice BCG^51^Mycobax^54^^^^^^^^^^Bacillus Calmette-Guerin vaccine^90585
"RTN","BITN",56,0)
 ;;117;;MMR^MMR^3^^3^^0^^6^^90707^4,5,6,7,94,38^3120420^V06.4^99.48^0^1^.5^^^^
"RTN","BITN",57,0)
 ;;117a;;M-M-R II^45^^^^^^^^^^^^Measles, Mumps, and Rubella virus vaccine
"RTN","BITN",58,0)
 ;;118;;M/R^MR^4^^3^^1^^6^^90708^3,5,6,94,38^^V04.2^99.59^0^1^.5^^^^
"RTN","BITN",59,0)
 ;;118a;;M-R-VAX II^45^^^^^^^^^^^^Measles and Rubella virus vaccine
"RTN","BITN",60,0)
 ;;119;;PNEUMOCOCCAL^PNEUMO-PS^33^^^^0^^11^^90732^33,100,109,133^3100528^V03.82^99.55^0^1^.5^^^^
"RTN","BITN",61,0)
 ;;119a;;PNEUMOVAX 23^45^PNU-IMUNE 23^63^PPV23^^^^^^^^^Pneumococcal polysaccharide PPV23
"RTN","BITN",62,0)
 ;;120;;YELLOW FEVER^YELLOW FEV^37^^^^0^^12^^90717^^3110330^V04.4^99.43^0^1^.5^^^
"RTN","BITN",63,0)
 ;;120a;;YF-VAX^54^^^^^^^^^^^^Yellow Fever Vaccine
"RTN","BITN",64,0)
 ;;122;;RABIES, NOS^RABIES,NOS^90^^^^1^^12^^90726^^^V04.5^99.44^0^1^.5^^^^
"RTN","BITN",65,0)
 ;;122a;;^^^^^^^^^^^^^Rabies vaccine, NOS
"RTN","BITN",66,0)
 ;;123;;DT (PEDIATRIC)^DT-PEDS^28^^8^^0^^1^^90702^9,28,35,112,113,115,138,139,142^3141022^V06.5^99.38^0^1^.5^^^^
"RTN","BITN",67,0)
 ;;123a;;Diphtheria and Tetanus Toxoids^40^^^^^^^^^^^^Diphtheria and tetanus toxoids adsorbed for pediatric use
"RTN","BITN",68,0)
 ;;124;;HIB, NOS^HIB,NOS^17^^6^^1^^3^^90737^46,47,48,49,51,110^^V03.81^99.59^0^1^.5^^^^
"RTN","BITN",69,0)
 ;;124a;;^^^^^^^^^^^^^Haemophilus influenza type b vaccine, conjugate NOS
"RTN","BITN",70,0)
 ;;126;;HIB (HBOC)^HIBTITER^47^^6^^0^^3^HIB,HBOC^90645^17,46,48,49^3141022^V03.81^99.59^0^1^.5^^^^
"RTN","BITN",71,0)
 ;;126a;;HibTITER^63^^^^^^^^^^^^Haemophilus influenza type b vaccine, HbOC
"RTN","BITN",72,0)
 ;;127;;HIB (PRP-OMP)^PEDVAXHIB^49^^5^^0^^3^HIB,PRPOMP^90647^17,46,47,48,51^3141022^V03.81^99.59^0^1^.5^^^^
"RTN","BITN",73,0)
 ;;127a;;PedvaxHIB^45^^^^^^^^^^^^Haemophilus influenza type b vaccine, PRP-OMP conjugate
"RTN","BITN",74,0)
 ;;128;;HIB (PRP-D)^PROHIBIT^46^^6^^1^^3^HIB,PRP-D^90646^17,47,48,49^3141022^V03.81^99.59^0^0^.5^^^^
"RTN","BITN",75,0)
 ;;128a;;ProHIBiT^54^^^^^^^^^^^^Haemophilus influenza type b vaccine, PRP-D conjugate
"RTN","BITN",76,0)
 ;;129;;HBIG^HBIG^30^^^^0^^5^^90371^^^V07.2^99.14^0^1^^^^^
"RTN","BITN",77,0)
 ;;129a;;Hepatitis B Immune Globulin (H^19^^^^^^^^^^^^Hepatitis B immune globulin
"RTN","BITN",78,0)
 ;;130;;IG, NOS^IG,NOS^14^^^^1^^12^^90741^^^V07.2^99.14^0^0^^^^^
"RTN","BITN",79,0)
 ;;130a;;^^^^^^^^^^^^^Immune globulin, NOS
"RTN","BITN",80,0)
 ;;131;;HEP A, NOS^HEP A,NOS^85^^3^^1^^9^^90730^52,83,84,31,104^^V05.3^99.59^0^1^.5^^^^^
"RTN","BITN",81,0)
 ;;131a;;^^^^^^^^^^^^^Hepatitis A vaccine, NOS
"RTN","BITN",82,0)
 ;;132;;VARICELLA^VARICELLA^21^^3^^0^^7^^90716^94,121^3080313^V05.4^99.59^0^1^.5^^^
"RTN","BITN",83,0)
 ;;132a;;VARIVAX^45^^^^^^^^^^^^Varicella virus vaccine
"RTN","BITN",84,0)
 ;;133;;DTAP^DTaP^20^^6^^0^^1^DTAP^90700^106,107,110,50^3141022^V06.1^99.39^0^1^.5^^^^
"RTN","BITN",85,0)
 ;;133a;;Tripedia^54^Infanrix^59^Acel-Imune^63^Certiva^24^^^^^^Diphtheria, tetanus toxoids and acellular pertussis vaccine
"RTN","BITN",86,0)
 ;;134;;MENINGOCOCCAL^MENING-PS^32^^^^0^^16^^90733^32,103,108,114,136,147,148,162,163,164^3111014^V03.89^99.59^0^1^.5^^^^
"RTN","BITN",87,0)
 ;;134a;;Menomume A/C/Y/W-135^54^^^^^^^^^^^^Meningococcal polysaccharide vaccine
"RTN","BITN",88,0)
 ;;135;;ROTAVIRUS TETRAVALENT^ROTA-4^74^^4^^1^^15^^^116,119,122^3150415^V04.89^99.59^1^1^.5^^^^
"RTN","BITN",89,0)
 ;;135a;;ROTASHIELD^63^^^^^^^^^^^^Rotavirus vaccine, tetravalent, live, oral
"RTN","BITN",90,0)
 ;;136;;HIB (PRP-T)^ACTHIB^48^^6^^0^^3^HIB,PRP-T^90648^17,46,47,49^3141022^V03.81^99.59^0^1^.5^^^
"RTN","BITN",91,0)
 ;;136a;;ActHIB^54^OmniHIB^59^Hiberix^^^^^^^^^Haemophilus influenza type b vaccine, PRP-T conjugate
"RTN","BITN",92,0)
 ;;137;;UNKNOWN^OTHER^999^^^^1^^12^TEST^90749^^^^99.59^0^0^.5^^^
"RTN","BITN",93,0)
 ;;137a;;^^^^^^^^^^^^^Unknown vaccine or immune globulin
"RTN","BITN",94,0)
 ;;138;;HEP B, ADOLESCENT OR PEDIATRIC^HEP B PED^8^^6^^0^^4^^90744^43,44,45,51,110,42,104^3141022^V05.3^99.59^0^1^.5^^^
"RTN","BITN",95,0)
 ;;138a;;Recombivax HB pediatric formul^45^Engerix-B pediatric/adolescent^59^^^^^^^^^^Hepatitis B vaccine, pediatric or pediatric/adolescent dosage
"RTN","BITN",96,0)
 ;;139;;POLIO, NOS^POLIO,NOS^89^^^^1^^2^^^^^V04.0^99.41^0^1^.5^^^
"RTN","BITN",97,0)
 ;;139a;;^^^^^^^^^^^^^Polio, NOS
"RTN","BITN",98,0)
 ;;140;;LYME DISEASE^LYME^66^^^^1^^12^^90665^^^V03.89^99.59^1^1^.5^^^
"RTN","BITN",99,0)
 ;;140a;;LYMErix^59^^^^^^^^^^^^Lyme Disease Vaccine
"RTN","BITN",100,0)
 ;;141;;RSV-MAB^RSV-MAb^93^^^^0^^12^SYNAGIS^90378^71,93,145^^V07.2^99.14^0^1^^^^
"RTN","BITN",101,0)
 ;;141a;;Synagis^42^^^^^^^^^^^^Respiratory Syncytial virus monoclanal antibody (palivizumab), intramuscular
"RTN","BITN",102,0)
 ;;142;;Pneumococcal, PCV-7^PCV-7^100^^6^^1^^11^PCV7^90669^33,100,109,133^^V03.82^99.55^0^1^.5^^^
"RTN","BITN",103,0)
 ;;142a;;Prevnar 7^63^PREVNAR 7^^^^^^^^^^^pneumococcal conjugate vaccine, 7 valent
"RTN","BITN",104,0)
 ;;143;;MENINGOCOCCAL C CONJUGATE^MEN-C CONJ^103^^^^1^^16^^^32,103,108,114,136,147,148,162,163,164^^V03.89^99.59^0^1^.5^^^
"RTN","BITN",105,0)
 ;;143a;;^^^^^^^^^^^^^Meningococcal C conjugate vaccine
"RTN","BITN",106,0)
 ;;144;;HEP B,ADULT^HEP B ADLT^43^^6^^0^^4^^90746^8,42,44,45,104^3120202^V05.3^99.59^0^1^1^^^
"RTN","BITN",107,0)
 ;;144a;;Recombivax HB adult formulatio^45^Heptavax-B^45^Engerix-B adult dose^59^^^^^^^^Hepatitis B vaccine, adult dosage^90743
"RTN","BITN",108,0)
 ;;145;;PERTUSSIS^PERTUSSIS^11^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",109,0)
 ;;145a;;^^^^^^^^^^^^^Pertussis
"RTN","BITN",110,0)
 ;;146;;DIPHTHERIA ANTITOXIN^DIPHTHERIA^12^^^^1^^^^90296^^^^^0^1^.5^^
"RTN","BITN",111,0)
 ;;146a;;Diphtheria antitoxin^^^^^^^^^^^^^Diphtheria antitoxin
"RTN","BITN",112,0)
 ;;147;;TIG^TIG^13^^^^0^^^^90389^^^^^0^1^
"RTN","BITN",113,0)
 ;;147a;;^^^^^^^^^^^^^Tetanus immune globulin
"RTN","BITN",114,0)
 ;;148;;INFLUENZA, SPLIT [TIVhx] (INCL PURIFIED)^FLU-TIVhx^15^^^^1^^10^Flu-TIVhx^90657^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^^^^0^1^.5
"RTN","BITN",115,0)
 ;;148a;;^^^^^^^^^^^^^Influenza virus vaccine, split virus (incl. Purified surface antigen)^90658
"RTN","BITN",116,0)
 ;;149;;INFLUENZA, WHOLE^FLU-WHOLE^16^^^^1^^10^Flu-Whole^90659^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^^^^0^1^.5
"RTN","BITN",117,0)
 ;;149a;;^54^^^^^^^^^^^^Influenza virus vaccine, whole virus
"RTN","BITN",118,0)
 ;;150;;RABIES, INTRAMUSCULAR INJECTION^RABIES,IM^18^^^^0^^^^90675^^3091006^^^0^1^.5
"RTN","BITN",119,0)
 ;;150a;;RabAvert^29^Imovax Rabies^54^Rabies Vaccine Absorbed^44^^^^^^^^Rabies vaccine - for intramuscular injection
"RTN","BITN",120,0)
 ;;151;;DTP-HIB^DTP-HIB^22^^^^1^^14^^90720^^^^^0^1^.5^^^103^126
"RTN","BITN",121,0)
 ;;151a;;ActHIB/DTP^54^Tetramune^63^^^^^^^^^^DTP-Haemophilus influenza type b conjugate vaccine
"RTN","BITN",122,0)
 ;;152;;PLAGUE^PLAGUE^23^^^^1^^^^90727^^^^^0^0^.5
"RTN","BITN",123,0)
 ;;152a;;^^^^^^^^^^^^^Plague
"RTN","BITN",124,0)
 ;;153;;ANTHRAX^ANTHRAX^24^^^^1^^^^90581^^3100310^^^0^1^.5^^
"RTN","BITN",125,0)
 ;;153a;;Biothrax^44^^^^^^^^^^^^Anthrax vaccine
"RTN","BITN",126,0)
 ;;154;;TYPHOID, ORAL^TYPHOID,OR^25^^^^0^^^^90690^^3120529^^^0^1^.5
"RTN","BITN",127,0)
 ;;154a;;Vivotif Berna^27^^^^^^^^^^^^Typhoid vaccine, live, oral
"RTN","BITN",128,0)
 ;;155;;BOTULINUM ANTITOXIN^BOTULINUM^27^^^^1^^^^90287^^^^^0^1^.5^^
"RTN","BITN",129,0)
 ;;155a;;Botox^17^^^^^^^^^^^^Botulinum antitoxin
"RTN","BITN",130,0)
 ;;156;;CMVIG^CMVIG^29^^^^0^^^^90291^^^^^0^1^.5^^
"RTN","BITN",131,0)
 ;;156a;;CytoGam^40^^^^^^^^^^^^Cytomegalovirus immune globulin, intravenous
"RTN","BITN",132,0)
 ;;157;;HEP A, PEDIATRIC, NOS^HEP AP,NOS^31^^^^1^^9^^^83,84,85,52,104^^^^0^1^.5^^
"RTN","BITN",133,0)
 ;;157a;;^^^^^^^^^^^^^Hepatitis A vaccine, pediatric dosage NOS
"RTN","BITN",134,0)
 ;;158;;RIG^RIG^34^^^^0^^^^90376^^^^^0^0^.5
"RTN","BITN",135,0)
 ;;158a;;BayRab^25^IMOGRAM RABIES - HT^54^^^^^^^^^^Rabies immune globulin^90375
"RTN","BITN",136,0)
 ;;159;;VZIG^VZIG^36^^^^0^^^^90396^117^^^^0^0^
"RTN","BITN",137,0)
 ;;159a;;^^^^^^^^^^^^^Varicella zoster immune globulin
"RTN","BITN",138,0)
 ;;160;;RUBELLA/MUMPS^RUBELLA/MU^38^^^^1^^^^^6,3,4,94^^^^0^0^.5
"RTN","BITN",139,0)
 ;;160a;;BIAVAX II^45^^^^^^^^^^^^Rubella and Mumps virus vaccine
"RTN","BITN",140,0)
 ;;161;;JAPANESE ENCEPHALITIS^JAPANESE E^39^^^^1^^^^90735^^3140124^^^0^1^.5
"RTN","BITN",141,0)
 ;;161a;;JE-VAX^54^^^^^^^^^^^^Japanese Encephalitis virus vaccine
"RTN","BITN",142,0)
 ;;162;;RABIES, INTRADERMAL INJECTION^RABIES,ID^40^^^^0^^^^90676^^3091006^^^0^1^.5
"RTN","BITN",143,0)
 ;;162a;;Imovax Rabies I.D.^54^^^^^^^^^^^^Rabies vaccine, for intradermal injection
"RTN","BITN",144,0)
 ;;163;;TYPHOID, PARENTERAL^TYPHOID,PA^41^^^^1^^^^90692^^3120529^^^0^1^.5
"RTN","BITN",145,0)
 ;;163a;;Typhim Vi^54^^^^^^^^^^^^Typhoid vaccine, Parenteral; other than acetone killed, dried
"RTN","BITN",146,0)
 ;;164;;HEP B, ADOLESCENT/HIGH RISK INFA^HEP B ADOL^42^^^^1^^4^^90745^43,44,45,8,104^3120202^^^0^1^.5
"RTN","BITN",147,0)
 ;;164a;;Recombivax HB adolescent/high-^45^^^^^^^^^^^^Hepatitis B vaccine, adolescent/high risk infant dosage
"RTN","BITN",148,0)
 ;;165;;HEP B, DIALYSIS^HEP B DIAL^44^^^^1^^4^^90740^8,43,45,42,104^3120202^^^0^1^1
"RTN","BITN",149,0)
 ;;165a;;^^^^^^^^^^^^^Hepatitis B vaccine, dialysis patient dosage^90747
"RTN","BITN",150,0)
 ;;166;;DTAP-HIB^DTAP-HIB^50^^^^1^^14^^90721^20,106,107,110,46,47,48,49,17,51,120^3141022^^^0^1^.5^^^133^136
"RTN","BITN",151,0)
 ;;166a;;TriHIBit^54^^^^^^^^^^^^DTaP-Haemophilus influenza type b conjugate vaccine
"RTN","BITN",152,0)
 ;;167;;HIB-HEP B^COMVAX^51^^^^0^^14^^90748^46,47,48,8,42,43,44,45,49,17^3141022^^^0^1^.5^^^138^127
"RTN","BITN",153,0)
 ;;167a;;Comvax^45^^^^^^^^^^^^Haemophilus influenza type b vaccine conjugate and Hepatitis B vaccine
"RTN","BITN",154,0)
 ;;168;;HEP A, ADULT^HEP A ADLT^52^^^^0^^9^^90632^83,84,31,104,85^3111025^^^0^1^1
"RTN","BITN",155,0)
 ;;168a;;VAQTA adult formulation^45^Havrix 1440 ELU/1 mL^59^^^^^^^^^^Hepatitis A vaccine, adult dosage
"RTN","BITN",156,0)
 ;;169;;TYPHOID, PARENTERAL, AKD (U.S. M^TYPHOID,PM^53^^^^1^^^^90693^^3120529^^^0^1^.5
"RTN","BITN",157,0)
 ;;169a;;^^^^^^^^^^^^^Typhoid vaccine, Parenteral; acetone killed, dried (U.S. military)
"RTN","BITN",158,0)
 ;;170;;ADENOVIRUS, TYPE 4^ADENOVI,T4^54^^^^1^^^^90476^54,55,82,143^^^^0^0^.5
"RTN","BITN",159,0)
 ;;170a;;^^^^^^^^^^^^^Adenovirus vaccine, type 4, live, oral
"RTN","BITN",160,0)
 ;;171;;ADENOVIRUS, TYPE 7^ADENOVI,T7^55^^^^1^^^^90477^54,55,82,143^^^^0^0^.5^^
"RTN","BITN",161,0)
 ;;171a;;^^^^^^^^^^^^^Adenovirus vaccine, type 7, live, oral
"RTN","BITN",162,0)
 ;;172;;DENGUE FEVER^DENGUE FEV^56^^^^1^^^^^^^^^0^0^.5^^
"RTN","BITN",163,0)
 ;;172a;;^^^^^^^^^^^^^Dengue fever vaccine
"RTN","BITN",164,0)
 ;;173;;HANTAVIRUS^HANTAVIRUS^57^^^^1^^^^^^^^^0^0^.5^^
"RTN","BITN",165,0)
 ;;173a;;^^^^^^^^^^^^^Hantavirus vaccine
"RTN","BITN",166,0)
 ;;174;;HEP C^HEP C^58^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",167,0)
 ;;174a;;^^^^^^^^^^^^^Hepatitis C vaccine
"RTN","BITN",168,0)
 ;;175;;HEP E^HEP E^59^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",169,0)
 ;;175a;;^^^^^^^^^^^^^Hepatitis E vaccine
"RTN","BITN",170,0)
 ;;176;;HERPES SIMPLEX 2^HERPES SIM^60^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",171,0)
 ;;176a;;^^^^^^^^^^^^^Herpes simples virus, type 2 vaccine
"RTN","BITN",172,0)
 ;;177;;HIV^HIV^61^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",173,0)
 ;;177a;;^^^^^^^^^^^^^Human immunodeficiency virus vaccine
"RTN","BITN",174,0)
 ;;178;;HPV QUADRIVALENT^HPV-4^62^^^^0^^17^^90649^62,118,137,165^3130517^^^0^1^.5
"RTN","BITN",175,0)
 ;;178a;;Gardasil^^^^^^^^^^^^^Human papilloma virus vaccine
"RTN","BITN",176,0)
 ;;179;;JUNIN VIRUS^JUNIN VIRU^63^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",177,0)
 ;;179a;;^^^^^^^^^^^^^Junin virus vaccine
"RTN","BITN",178,0)
 ;;180;;LEISHMANIASIS^LEISHMANIA^64^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",179,0)
 ;;180a;;^^^^^^^^^^^^^Leishmaniasis vaccine
"RTN","BITN",180,0)
 ;;181;;LEPROSY^LEPROSY^65^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",181,0)
 ;;181a;;^^^^^^^^^^^^^Leprosy vaccine
"RTN","BITN",182,0)
 ;;182;;MALARIA^MALARIA^67^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",183,0)
 ;;182a;;^^^^^^^^^^^^^Malaria vaccine
"RTN","BITN",184,0)
 ;;183;;MELANOMA^MELANOMA^68^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",185,0)
 ;;183a;;^^^^^^^^^^^^^Melanoma vaccine
"RTN","BITN",186,0)
 ;;184;;PARAINFLUENZA-3^PARAINFLUE^69^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",187,0)
 ;;184a;;^^^^^^^^^^^^^Parinfluenza - 3 virus vaccine
"RTN","BITN",188,0)
 ;;185;;Q FEVER^Q FEVER^70^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",189,0)
 ;;185a;;^^^^^^^^^^^^^Q Fever vaccine
"RTN","BITN",190,0)
 ;;186;;RSV-IGIV ^RSV-IGIV ^71^^^^1^^^^90379^71,93,145^^^^0^1^
"RTN","BITN",191,0)
 ;;186a;;RespiGam^42^^^^^^^^^^^^Respiratory Syncytial virus immune globulin, intravenous
"RTN","BITN",192,0)
 ;;187;;RHEUMATIC FEVER^RHEUMATIC ^72^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",193,0)
 ;;187a;;^^^^^^^^^^^^^Rheumatic fever vaccine
"RTN","BITN",194,0)
 ;;188;;RIFT VALLEY FEVER^RIFT VALLE^73^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",195,0)
 ;;188a;;^^^^^^^^^^^^^Rift Valley Fever vaccine
"RTN","BITN",196,0)
 ;;189;;STAPHYLOCOCCUS BACTERIO LYSATE^STAPHYLOCO^76^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",197,0)
 ;;189a;;^^^^^^^^^^^^^Staphylococcus Bacterophage lysate
"RTN","BITN",198,0)
 ;;190;;TICK-BORNE ENCEPHALITIS^TICK-BORNE^77^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",199,0)
 ;;190a;;^^^^^^^^^^^^^Tick-borne enchephalitis vaccine
"RTN","BITN",200,0)
 ;;191;;TULAREMIA VACCINE^TULAREMIA ^78^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",201,0)
 ;;191a;;^^^^^^^^^^^^^Tularemia vaccine
"RTN","BITN",202,0)
 ;;192;;VACCINIA IMMUNE GLOBULIN^VACCINIA I^79^^^^1^^^^90393^^3070831^^^0^0^.5
"RTN","BITN",203,0)
 ;;192a;;^^^^^^^^^^^^^Vaccinia immune globulin
"RTN","BITN",204,0)
 ;;193;;VEE, LIVE^VEE, LIVE^80^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",205,0)
 ;;193a;;^^^^^^^^^^^^^Venezuelan equine enchapahlitis vaccine, live, attenuated
"RTN","BITN",206,0)
 ;;194;;VEE, INACTIVATED^VEE, INACT^81^^^^1^^^^^^^^^0^0^.5
"RTN","BITN",207,0)
 ;;194a;;^^^^^^^^^^^^^Venezuelan equine enchapahlitis vaccine, inactivated
"RTN","BITN",208,0)
 ;;195;;ADENOVIRUS, NOS^ADENOV,NOS^82^^^^1^^^^^54,55,82,143^^^^0^0^.5^^
"RTN","BITN",209,0)
 ;;195a;;^^^^^^^^^^^^^Adenovirus vaccine, NOS
"RTN","BITN",210,0)
 ;;196;;HEP A, PED/ADOL, 2 DOSE^HEP A PED^83^^^^0^^9^^90633^52,84,31,85,104^3111025^^^0^1^.5^^
"RTN","BITN",211,0)
 ;;196a;;VAQTA pediatric/adolescent for^45^Havrix 720 ELU/0.5 mL^59^^^^^^^^^^Hepatitis A vaccine, pediatric/adolescent dosage, 2 dose schedule
"RTN","BITN",212,0)
 ;;197;;HEP A, PED/ADOL, 3 DOSE^HEP A 3PED^84^^^^1^^9^^90634^52,83,31,85,104^^^^0^1^.5^^
"RTN","BITN",213,0)
 ;;197a;;Havrix 360 ELU/0.5 mL^59^^^^^^^^^^^^Hepatitis A vaccine, pediatric/adolescent dosage, 3 dose schedule
"RTN","BITN",214,0)
 ;;198;;IG^IG^86^^^^^^^^90281^^^^^0^0^
"RTN","BITN",215,0)
 ;;198a;;^^^^^^^^^^^^^Immune globulin, intramuscular
"RTN","BITN",216,0)
 ;;199;;IGIV^IGIV^87^^^^0^^^^90283^^^^^0^0^
"RTN","BITN",217,0)
 ;;199a;;Gammar-P IV^21^Venoglobulin-S^19^^^^^^^^^^Immune globulin, intravenous
"RTN","BITN2")
0^4^B126145453
"RTN","BITN2",1,0)
BITN2 ;IHS/CMI/MWR - BUILD ^BITN GLOBAL SECOND HALF.
"RTN","BITN2",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BITN2",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BITN2",4,0)
 ;;  UTILITY: BUILD STANDARD ^BITN GLOBAL.
"RTN","BITN2",5,0)
 ;
"RTN","BITN2",6,0)
 ;
"RTN","BITN2",7,0)
 ;----------
"RTN","BITN2",8,0)
TABLE ; EP
"RTN","BITN2",9,0)
 ;;200;;VEE, NOS^VEE,NOS^92^^^^1^^^^^^^^^0^0^.5
"RTN","BITN2",10,0)
 ;;200a;;^^^^^^^^^^^^^Venezuelan equine enchapahlitis vaccine, NOS
"RTN","BITN2",11,0)
 ;;201;;MMRV^MMRV^94^^^^0^^14^^90710^3,4,5,6,7,21,38,121^3100521^^^0^1^.5^^^117^132
"RTN","BITN2",12,0)
 ;;201a;;Pro-Quad^^^^^^^^^^^^^Measles, Mumps, Rubella, and Varicella virus vaccine
"RTN","BITN2",13,0)
 ;;202;;TST-OT TINE TEST^TST-OT TIN^95^^^^1^1^13^^^^^^^0^0^.5
"RTN","BITN2",14,0)
 ;;202a;;^^^^^^^^^^^^^Tuberculin skin test; old tuberculin, multipuncture device
"RTN","BITN2",15,0)
 ;;203;;TST-PPD INTRADERMAL^TST-PPD^96^^^^1^1^13^^^^^^^0^0^.5
"RTN","BITN2",16,0)
 ;;203a;;PPD^^^^^^^^^^^^^Tuberculin skin test; purified protein derivative, intradermal
"RTN","BITN2",17,0)
 ;;204;;TST-PPD TINE TEST^TST-PPD TI^97^^^^1^1^13^^^^^^^0^0^.5
"RTN","BITN2",18,0)
 ;;204a;;^^^^^^^^^^^^^Tuberculin skin test; purified proten derivative, multipuncture device
"RTN","BITN2",19,0)
 ;;205;;TST, NOS^TST,NOS^98^^^^1^1^13^^^^^^^0^0^.5
"RTN","BITN2",20,0)
 ;;205a;;^^^^^^^^^^^^^Tuberculin skin test; NOS
"RTN","BITN2",21,0)
 ;;206;;RESERVED - DO NOT USE3^RESERVED -^99^^^^1^^^^^^^^^0^0^.5
"RTN","BITN2",22,0)
 ;;206a;;^^^^^^^^^^^^^RESERVED -do not use
"RTN","BITN2",23,0)
 ;;207;;TYPHOID, VICPS^TYPHOID,VI^101^^^^1^^^^90691^^3120529^^^0^1^.5
"RTN","BITN2",24,0)
 ;;207a;;^^^^^^^^^^^^^Typhoid Vi capsular polysaccharide vaccine
"RTN","BITN2",25,0)
 ;;208;;DTP-HIB-HEP B^DTP-HIB-HE^102^^^^1^^14^^^^3080918^^^0^0^.5^^^103^136^138
"RTN","BITN2",26,0)
 ;;208a;;^^^^^^^^^^^^^DTP-Haemophilus influenzae type b conjugate and hepatitis b vaccine
"RTN","BITN2",27,0)
 ;;209;;HEP A-HEP B^TWINRIX^104^^^^0^^14^^90636^52,83,84,31,85,8,42,43,44,45,51,110^3120202^^^0^1^1^^^144^168
"RTN","BITN2",28,0)
 ;;209a;;Twinrix^59^^^^^^^^^^^^Hepatitis A and hepatitis B vaccine
"RTN","BITN2",29,0)
 ;;210;;SMALLPOX, DILUTED^SMALLPOX,D^105^^^^1^^^^^^3070831^^^0^1^.5
"RTN","BITN2",30,0)
 ;;210a;;^^^^^^^^^^^^^Smallpox vaccine, diluted
"RTN","BITN2",31,0)
 ;;211;;DTAP, 5 PERTUSSIS ANTIGENS^DTAP,5PE^106^^^^1^^1^^90700^20,107,110,50^3141022^^^0^1^.5^^
"RTN","BITN2",32,0)
 ;;211a;;Daptacel^54^^^^^^^^^^^^Diphtheria, tetanus toxoids and acellular pertussis vaccine, 5 pertussis antigens
"RTN","BITN2",33,0)
 ;;212;;DTAP, NOS^DTAP,NOS^107^^^^1^^1^^^20,106,110,50^^^^0^1^.5^^
"RTN","BITN2",34,0)
 ;;212a;;^^^^^^^^^^^^^Diphtheria, tetanus toxoids and acellular pertussis vaccine, NOS
"RTN","BITN2",35,0)
 ;;213;;MENINGOCOCCAL, NOS^MENING,NOS^108^^^^1^^16^^^32,103,108,114,136,147,148,162,163,164^^^^0^1^.5
"RTN","BITN2",36,0)
 ;;213a;;^^^^^^^^^^^^^Meningococcal vaccine, NOS
"RTN","BITN2",37,0)
 ;;214;;PNEUMOCOCCAL, NOS^PNEUMO,NOS^109^^^^1^^11^^^33,100,109,133^^^^0^1^.5
"RTN","BITN2",38,0)
 ;;214a;;^^^^^^^^^^^^^Pneumococcal vaccine, NOS
"RTN","BITN2",39,0)
 ;;215;;NO VACCINE ADMINISTERED^NO VACCINE^998^^^^1^^^^^^^^^0^0^.5
"RTN","BITN2",40,0)
 ;;215a;;^^^^^^^^^^^^^No vaccine administered
"RTN","BITN2",41,0)
 ;;216;;DTaP-Hep B-IPV^PEDIARIX^110^^^^0^^14^^90723^1,22,28,102,43,44,45,10,106,107,50,8,42,20^3141022^^^0^1^.5^^^138^107^133
"RTN","BITN2",42,0)
 ;;216a;;Pediarix^59^^^^^^^^^^^^DTap- hepatitis B and poliovirus vaccine
"RTN","BITN2",43,0)
 ;;217;;INFLUENZA, Intranasal, Trivalent^FLU-LAIV3^111^^^^1^0^10^Flu-LAIV3^90660^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^3120702^^^0^1^.2
"RTN","BITN2",44,0)
 ;;217a;;FluMist^42^^^^^^^^^^^^Influenza virus vaccine, live, attenuated, for intranasal use
"RTN","BITN2",45,0)
 ;;218;;TETANUS TOXOID, NOS^TETTOX,NOS^112^^^^1^^1^^^9,28,35,112,113,115,138,139,142^^^^^1^.5
"RTN","BITN2",46,0)
 ;;218a;;^^^^^^^^^^^^^TETANUS TOXOID, NOS
"RTN","BITN2",47,0)
 ;;219;;TD (ADULT) PRESERVATIVE FREE^Td-ADULTpf^113^^^^0^^8^^90714^9,28,35,112,113,115,138,139,142^3150224^^^0^1^.5
"RTN","BITN2",48,0)
 ;;219a;;^^^^^^^^^^^^^TD (ADULT) PRESERVATIVE FREE
"RTN","BITN2",49,0)
 ;;220;;MENINGOCOCCAL A,C,Y,W-135 DIPHTHERIA CONJ^MENING-CV4^114^^^^0^^16^^90734^32,103,108,114,136,147,148,162,163,164^3111014^^^^1^.5
"RTN","BITN2",50,0)
 ;;220a;;Menactra^^^^^^^^^^^^^MENINGOCOCCAL POLYSACCHARIDE (groups A, C, Y and W-135) diphtheria toxoid conj
"RTN","BITN2",51,0)
 ;;221;;Tdap^Tdap^115^^^^0^^8^^90715^9,28,35,112,113,115,138,139,142^3150224^V06.1^^^1^.5
"RTN","BITN2",52,0)
 ;;221a;;Boostrix^^Adacel^^^^^^^^^^^TETANUS TOXOID, REDUCED DIPHTHERIA, ACELL PERTUSSIS VACCINE, ABSORBED
"RTN","BITN2",53,0)
 ;;222;;ROTAVIRUS, PENTAVALENT^ROTA-5^116^^^^0^0^15^^90680^74,119,122^3150415^V04.89^^^1^2
"RTN","BITN2",54,0)
 ;;222a;;Rotateq^^^^^^^^^^^^^rotavirus, live, pentavalent vaccine
"RTN","BITN2",55,0)
 ;;223;;VZIG-IND^VZIG-IND^117^^^^1^0^7^^^36^^^^^1
"RTN","BITN2",56,0)
 ;;223a;;^^^^^^^^^^^^^varicella zoster immune globulin (Investigational New Drug)
"RTN","BITN2",57,0)
 ;;224;;HPV, bivalent^HPV-2^118^^^^0^0^17^^90650^62,118,137,165^3110503^^^^1^.5
"RTN","BITN2",58,0)
 ;;224a;;Cervarix^^^^^^^^^^^^^human papilloma virus vaccine, bivalent
"RTN","BITN2",59,0)
 ;;225;;ROTAVIRUS, MONOVALENT^ROTA-1^119^^^^0^0^15^^90681^74,116,122^3150415^V04.89^^^1
"RTN","BITN2",60,0)
 ;;225a;;Rotarix^^^^^^^^^^^^^rotavirus, live, monovalent vaccine
"RTN","BITN2",61,0)
 ;;226;;DTaP-Hib-IPV^PENTACEL^120^^^^1^0^14^^90698^01,10,17,20,22,46,47,48,49,50,51,102,106,107,110,120^3141022^^^^1^.5^^^133^136^107
"RTN","BITN2",62,0)
 ;;226a;;^^^^^^^^^^^^^DTaP-Hib-IPV
"RTN","BITN2",63,0)
 ;;227;;ZOSTER^ZOSTER^121^^^^0^0^7^^90736^21,94,117^3091006^^^^^.65
"RTN","BITN2",64,0)
 ;;227a;;Zostavax^^^^^^^^^^^^^zoster vaccine, live
"RTN","BITN2",65,0)
 ;;228;;ROTAVIRUS, NOS^ROTA,NOS^122^^^^1^0^15^^^74,116,119^3150415^^^^1
"RTN","BITN2",66,0)
 ;;228a;;^^^^^^^^^^^^^rotavirus vaccine, NOS
"RTN","BITN2",67,0)
 ;;229;;INFLUENZA, H5N1^FLU-H5N1^123^^^^1^^10^Flu-H5N1^^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^^^^0^0^
"RTN","BITN2",68,0)
 ;;229a;;^^^^^^^^^^^^^Influenza virus vaccine, H5N1, A/Vietnam/1203/2004 (national stockpile)
"RTN","BITN2",69,0)
 ;;230;;DTaP-IPV^KINRIX^130^^^^0^0^14^^90696^10,110,20,50,106,107^3141022^^^^1^.5^^^133^107
"RTN","BITN2",70,0)
 ;;230a;;Kinrix^^^^^^^^^^^^^Diphtheria, tetanus toxoids and acellular pertussis, and poliovirus, inactivated
"RTN","BITN2",71,0)
 ;;231;;Novel Influenza-H1N1-09, Nasal^H1N1-NASAL^125^^^^1^0^18^SWINEFLU^^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^3091001^^^0^1^.2
"RTN","BITN2",72,0)
 ;;231a;;^^^^^^^^^^^^^Novel Influenza-H1N1-09, live virus for nasal administration
"RTN","BITN2",73,0)
 ;;232;;Novel influenza-H1N1-09, preservative-free^H1N1-pfree^126^^^^1^0^18^^^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^3091001^^^0^1
"RTN","BITN2",74,0)
 ;;232a;;^^^^^^^^^^^^^Novel influenza-H1N1-09, preservative-free, injectable
"RTN","BITN2",75,0)
 ;;233;;Novel influenza-H1N1-09^H1N1^127^^^^1^0^18^^^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^3091001^^^0^1^.5
"RTN","BITN2",76,0)
 ;;233a;;^^^^^^^^^^^^^Novel influenza-H1N1-09, injectable
"RTN","BITN2",77,0)
 ;;234;;Novel influenza-H1N1-09, all formulations^H1N1,NOS^128^^^^1^0^18^^90663^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^^^^0^1^.5
"RTN","BITN2",78,0)
 ;;234a;;^^^^^^^^^^^^^Novel influenza-H1N1-09, all formulations^90470
"RTN","BITN2",79,0)
 ;;235;;Pneumococcal, PCV-13^PCV-13^133^^^^0^0^11^PCV13^90670^33,100,109,133^3141022^^^0^1^.5
"RTN","BITN2",80,0)
 ;;235a;;Prevnar 13^^PREVNAR 13^^^^^^^^^^^pneumococcal conjugate vaccine, 13 valent
"RTN","BITN2",81,0)
 ;;236;;INFLUENZA, HIGH DOSE SEASONAL^FLU-HIGH^135^^^^0^0^10^Flu-HIGH^90662^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^3140819^^^^1^.5
"RTN","BITN2",82,0)
 ;;236a;;Fluzone High Dose^^^^^^^^^^^^^INFLUENZA, HIGH DOSE SEASONAL, PRESERVATIVE-FREE
"RTN","BITN2",83,0)
 ;;237;;Meningococcal MCV4O^MeningCV4O^136^^^^0^^16^^90734^32,103,108,114,136,147,148,162,163,164^3111014^^^0^1^.5
"RTN","BITN2",84,0)
 ;;237a;;Menveo^^^^^^^^^^^^^meningococcal oligosaccharide (groups A, C, Y and W-135) diphtheria toxoid conj
"RTN","BITN2",85,0)
 ;;238;;DTaP-IPV-HIB-HEP B, historical^DTaPIPVHHb^132^^^^1^^14^^^^^^^^^^^^133^107^124^110
"RTN","BITN2",86,0)
 ;;238a;;^^^^^^^^^^^^^DTaP-IPV-HIB-HEP B, historical
"RTN","BITN2",87,0)
 ;;239;;HPV,NOS^HPV,NOS^137^^^^1^0^17^^^62,118,137,165^^^^0^1^.5
"RTN","BITN2",88,0)
 ;;239a;;^^^^^^^^^^^^^HPV, unspecified formulation
"RTN","BITN2",89,0)
 ;;240;;Japanese Encephalitis-IM^JAPAN E IM^134^^^^1^^12^^90738^^3140124
"RTN","BITN2",90,0)
 ;;240a;;^^^^^^^^^^^^^Japanese Encephalitis vaccine for intramuscular administration.
"RTN","BITN2",91,0)
 ;;241;;Typhus, historical^TYPHUS,NOS^131^^^^1^^12
"RTN","BITN2",92,0)
 ;;241a;;^^^^^^^^^^^^^Historical record of a typhus vaccination
"RTN","BITN2",93,0)
 ;;242;;INFLUENZA, seasonal, injectable, preservative free, trivalent ^FLU-IIV3pf^140^^^^0^0^10^Flu-IIV3pf^90655^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^3130726^^^0^1^
"RTN","BITN2",94,0)
 ;;242a;;Fluzone^^Fluvirin^^^^^^^^^^^INFLUENZA, SEASONAL INJ, PRES. FREE^90656
"RTN","BITN2",95,0)
 ;;243;;INFLUENZA [TIV], SEASONAL, INJ^FLU-IIV3^141^^^^0^0^10^Flu-IIV3^90657^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^3140819^^^0^1^.5
"RTN","BITN2",96,0)
 ;;243a;;Fluzone^^Fluvirin ^^^^^^^^^^^INFLUENZA, SEASONAL INJECTABLE^90658
"RTN","BITN2",97,0)
 ;;244;;Td-NA^Td-NA^138^^^^1^0^8^^^9,28,35,112,113,115,138,139,142^3150224^^^0^1^.5
"RTN","BITN2",98,0)
 ;;244a;;^^^^^^^^^^^^^tetanus and diphtheria toxoids, not adsorbed, for adult use
"RTN","BITN2",99,0)
 ;;245;;Td,NOS^Td,NOS^139^^^^1^0^8^^^9,28,35,112,113,115,138,139,142^3150224^^^0^1^.5
"RTN","BITN2",100,0)
 ;;245a;;^^^^^^^^^^^^^Td(adult) unspecified formulation
"RTN","BITN2",101,0)
 ;;246;;TET TOX,NA^TET TOX,NA^142^^^^1^0^8^^^9,28,35,112,113,115,138,139,142^3140204^^^0^1
"RTN","BITN2",102,0)
 ;;246a;;^^^^^^^^^^^^^tetanus toxoid, not adsorbed
"RTN","BITN2",103,0)
 ;;247;;ADENOVIRUS, TYPES 4&7^ADENO,oral^143^^^^1^0^12^^^54,55,82,143^^^^0^1
"RTN","BITN2",104,0)
 ;;247a;;^^^^^^^^^^^^^Adenovirus, type 4 and type 7, live, oral
"RTN","BITN2",105,0)
 ;;248;;INFLUENZA, INTRADERMAL^FLU-DERMAL^144^^^^0^0^10^Flu-Dermal^90654^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3140819^^^0^1^.1
"RTN","BITN2",106,0)
 ;;248a;;Fluzone Intradermal^^^^^^^^^^^^^seasonal influenza, intradermal, preservative free
"RTN","BITN2",107,0)
 ;;249;;RSV-MAb,M^RSV-MAb,M^145^^^^1^0^12^^^71,93,145^^^^0^1
"RTN","BITN2",108,0)
 ;;249a;;Motavizumab^^^^^^^^^^^^^respiratory syncytial virus monoclonal antibody (motavizumab), intramuscular
"RTN","BITN2",109,0)
 ;;250;;DTaP,IPV,Hib,HepB^DTaPPVHHb^146^^^^1^0^12^^^^
"RTN","BITN2",110,0)
 ;;250a;;^^^^^^^^^^^^^Diphtheria, Tetanus, Acell Pertussis Absorbed, Inactiv Polio, HIB Conj, Hep B
"RTN","BITN2",111,0)
 ;;251;;Meningococcal MCV4, unspecified form^MenCV4-NOS^147^^^^1^0^16^^^32,103,108,114,136,147,148,162,163,164^3111014^^^^1^.5
"RTN","BITN2",112,0)
 ;;251a;;^^^^^^^^^^^^^Meningococcal, MCV4, unspecified formulation(groups A, C, Y and W-135)
"RTN","BITN2",113,0)
 ;;252;;Meningococcal C/Y-HIB PRP^MenCY-Hib^148^^^^1^0^14^^90644^32,103,108,114,136,147,148,162,163,164^^^^0^1^.5^^^136^213
"RTN","BITN2",114,0)
 ;;252a;;MenHibrix^^^^^^^^^^^^^Meningococcal Groups C and Y and Haemophilus b Tetanus Toxoid Conjugate Vaccine
"RTN","BITN2",115,0)
 ;;253;;INFLUENZA, Live, Intranasal, Quadrivalent^FLU-LAIV4^149^^^^0^0^10^Flu-LAIV4^90672^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161^3140819^^^0^1^.2
"RTN","BITN2",116,0)
 ;;253a;;FluMist^^^^^^^^^^^^^Influenza, Live, Intranasal, Quadrivalent
"RTN","BITN2",117,0)
 ;;254;;INFLUENZA, INJECTABLE, QUAD, PF^FLU-IIV4pf^150^^^^1^0^10^Flu-IIV4pf^90685^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^3140819^^^^1
"RTN","BITN2",118,0)
 ;;254a;;^^^^^^^^^^^^^Influenza, injectable, quadrivalent, preservative free^90686
"RTN","BITN2",119,0)
 ;;255;;INFLUENZA NASAL, UNSPECIFIED^FLU-NasNOS^151^^^^1^0^10^Flu-NasNOS^^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166
"RTN","BITN2",120,0)
 ;;255a;;FluMist^^^^^^^^^^^^^influenza nasal, unspecified formulation
"RTN","BITN2",121,0)
 ;;256;;Pneumococcal, Unspecified^PCV-NOS^152^^^^1^0^11
"RTN","BITN2",122,0)
 ;;256a;;^^^^^^^^^^^^^Pneumococcal Conjugate, unspecified formulation
"RTN","BITN2",123,0)
 ;;257;;INFLUENZA, INJECTABLE, MDCK, PF^FLU-ccIIV3^153^^^^1^0^10^Flu-ccIIV3^90661^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^3140819^^^^1
"RTN","BITN2",124,0)
 ;;257a;;Flucelvax^^^^^^^^^^^^^Influenza, injectable, Madin Darby Canine Kidney, preservative free
"RTN","BITN2",125,0)
 ;;258;;HEP A, IG^HEP A,IG^154^^^^1^0^9^^^^^^^^1
"RTN","BITN2",126,0)
 ;;258a;;^^^^^^^^^^^^^Hepatitis A immune globulin
"RTN","BITN2",127,0)
 ;;259;;INFLUENZA, INJECTABLE, RECOMB, PF^FLU-RIV3^155^^^^1^0^10^Flu-RIV3^90673^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^3140819
"RTN","BITN2",128,0)
 ;;259a;;FluBlok^^^^^^^^^^^^^Seasonal, trivalent, recombinant, injectable influenza, preservative free
"RTN","BITN2",129,0)
 ;;260;;INFLUENZA, Injectable, Quadravalent^FLU-IIV4^158^^^^1^0^10^Flu-IIV4^90688^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^3140819^^^^1
"RTN","BITN2",130,0)
 ;;260a;;FluLaval Quadrivalent^^^^^^^^^^^^^Influenza, injectable, quadrivalent
"RTN","BITN2",131,0)
 ;;261;;Rho(D)-IG^Rho(D)-IG^156^^^^1^0^12
"RTN","BITN2",132,0)
 ;;261a;;^^^^^^^^^^^^^Rho(D) Immune globulin- IV or IM
"RTN","BITN2",133,0)
 ;;262;;Rho(D) -IG IM^Rho(D)IGIM^157^^^^1^^12
"RTN","BITN2",134,0)
 ;;262a;;^^^^^^^^^^^^^Rho(D) Immune globulin - IM
"RTN","BITN2",135,0)
 ;;263;;Rho(D) - Unspecified formulation^Rho(D),NOS^159^^^^1^^12
"RTN","BITN2",136,0)
 ;;263a;;^^^^^^^^^^^^^Rho(D) Unspecified formulation
"RTN","BITN2",137,0)
 ;;264;;INFLUENZA A monovalent (H5N1), ADJUVANTED-2013^H5N1,adj^160^^^^1^0^10
"RTN","BITN2",138,0)
 ;;264a;;^^^^^^^^^^^^^Influenza A monovalent (H5N1), adjuvanted, National stockpile 2013
"RTN","BITN2",139,0)
 ;;265;;INFLUENZA, injectable,quadrivalent, preservative free, pediatric^FLU-PEDIV4^161^^^^0^0^10^Flu-PedIV4^^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^3140819^^^0^1^.25
"RTN","BITN2",140,0)
 ;;265a;;^^^^^^^^^^^^^Influenza, injectable,quadrivalent, preservative free, pediatric
"RTN","BITN2",141,0)
 ;;266;;Meningococcal Group B Vaccine^Men-B^162^^^^0^0^16^^^32,103,108,114,136,147,148,162,163,164^^^^0^1^.5
"RTN","BITN2",142,0)
 ;;266a;;Trumenba^^^^^^^^^^^^^meningococcal B vaccine, fully recombinant
"RTN","BITN2",143,0)
 ;;267;;Meningococcal B, OMV^Men-B,OMV^163^^^^0^0^16^^^^^^^0^1^.5
"RTN","BITN2",144,0)
 ;;267a;;Bexsero^^^^^^^^^^^^^meningococcal B vaccine, recombinant, OMV, adjuvanted
"RTN","BITN2",145,0)
 ;;268;;Meningococcal B, unspecified^Men-B,NOS^164^^^^0^0^16^^^32,103,108,114,136,147,148,162,163,164^^^^0^1^.5
"RTN","BITN2",146,0)
 ;;268a;;^^^^^^^^^^^^^meningococcal B, unspecified formulation
"RTN","BITN2",147,0)
 ;;269;;HPV-9^HPV9^165^^^^0^0^17^^^62,118,137,165^3150415^^^0^1^.5
"RTN","BITN2",148,0)
 ;;269a;;^^^^^^^^^^^^^Human Papillomavirus 9-valent vaccine
"RTN","BITN2",149,0)
 ;;270;;INFLUENZA, intradermal, quadrivalent, preservative free^FLU-DERM4^166^^^^0^0^10^Flu-Derm4^^15,16,88,111,123,125,126,127,128,135,140,141,144,149,150,151,153,155,158,161,166^3140819^^^0^1^.1
"RTN","BITN2",150,0)
 ;;270a;;^^^^^^^^^^^^^influenza, intradermal, quadrivalent, preservative free, injectable
"RTN","BIUTL4")
0^18^B106386697
"RTN","BIUTL4",1,0)
BIUTL4 ;IHS/CMI/MWR - UTIL: SCREENMAN CODE; OCT 15, 2010
"RTN","BIUTL4",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BIUTL4",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIUTL4",4,0)
 ;;  UTILITY: SCREENMAN CODE: VAC SELECT ACTIONS, SERIES VALID,
"RTN","BIUTL4",5,0)
 ;;           LOC BRANCHING LOGIC, VISIT LOC DEF, SKIN TEST READ MM.
"RTN","BIUTL4",6,0)
 ;;  PATCH 2: Comment out code that would disable VFC Elig field for
"RTN","BIUTL4",7,0)
 ;            patients >19yrs.  OLDDATE+15
"RTN","BIUTL4",8,0)
 ;;  PATCH 5: Add NDC to reset fields when vaccine is changed.  VACCHG+14
"RTN","BIUTL4",9,0)
 ;;  PATCH 5: Add leading zero to default volume if less than 1.  VISVOL+21
"RTN","BIUTL4",10,0)
 ;;  PATCH 9: Make VIS Presented Date default to Visit Date (when changed).  OLDATE+9
"RTN","BIUTL4",11,0)
 ;;  PATCH 10: Only stuff VIS Presented Date if this is a V Imm.  OLDDATE+18
"RTN","BIUTL4",12,0)
 ;
"RTN","BIUTL4",13,0)
 ;----------
"RTN","BIUTL4",14,0)
VACSCR ;EP
"RTN","BIUTL4",15,0)
 ;---> Set Screen for vaccine selection in Screen field of
"RTN","BIUTL4",16,0)
 ;---> "Form Only Field Parameters" of the Form BI FORM-IMM VISIT ADD/EDIT
"RTN","BIUTL4",17,0)
 ;---> when selecting vaccine.
"RTN","BIUTL4",18,0)
 ;---> Screen: If this vaccine is Active OR if this is an Historical Event
"RTN","BIUTL4",19,0)
 ;--->         AND this is NOT a Skin Test.
"RTN","BIUTL4",20,0)
 ;
"RTN","BIUTL4",21,0)
 S DIR("S")="I ('$P(^AUTTIMM(Y,0),U,7)!($G(BI(""I""))=""E""))"
"RTN","BIUTL4",22,0)
 S DIR("S")=DIR("S")_"&('$P(^AUTTIMM(Y,0),U,8))"
"RTN","BIUTL4",23,0)
 Q
"RTN","BIUTL4",24,0)
 ;
"RTN","BIUTL4",25,0)
 ;
"RTN","BIUTL4",26,0)
 ;----------
"RTN","BIUTL4",27,0)
VACSEL(BIVAC) ;EP
"RTN","BIUTL4",28,0)
 ;---> For IMMUNIZATIONS:
"RTN","BIUTL4",29,0)
 ;---> Actions to take in Screenman when Vaccine is selected.
"RTN","BIUTL4",30,0)
 ;---> Called by the POST ACTION of Field 2, Vaccine
"RTN","BIUTL4",31,0)
 ;---> of the Form BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL4",32,0)
 ;---> Parameters:
"RTN","BIUTL4",33,0)
 ;     1 - BIVAC (req) IEN of Vaccine in IMM File (9999999.14).
"RTN","BIUTL4",34,0)
 ;
"RTN","BIUTL4",35,0)
 ;---> Display Vaccine Short Name below Vaccine Name.
"RTN","BIUTL4",36,0)
 Q:('$G(BIVAC))
"RTN","BIUTL4",37,0)
 S BI("B")=BIVAC
"RTN","BIUTL4",38,0)
 D PUT^DDSVALF(2.5,,,"("_$$VNAME^BIUTL2(BIVAC)_")")
"RTN","BIUTL4",39,0)
 Q
"RTN","BIUTL4",40,0)
 ;
"RTN","BIUTL4",41,0)
 ;
"RTN","BIUTL4",42,0)
 ;----------
"RTN","BIUTL4",43,0)
VACSELC(BIVAC) ;EP
"RTN","BIUTL4",44,0)
 ;---> For CONTRAINDICATIONS:
"RTN","BIUTL4",45,0)
 ;---> Actions to take in Screenman when Vaccine is selected.
"RTN","BIUTL4",46,0)
 ;---> Called by the POST ACTION of Field 2, Vaccine
"RTN","BIUTL4",47,0)
 ;---> of the Form BI FORM-CONTRAINDICATION ADD.
"RTN","BIUTL4",48,0)
 ;---> Parameters:
"RTN","BIUTL4",49,0)
 ;     1 - BIVAC (req) IEN of Vaccine in IMM File (9999999.14).
"RTN","BIUTL4",50,0)
 ;
"RTN","BIUTL4",51,0)
 ;---> If a vaccine has not been chosen, then disable the Reason field.
"RTN","BIUTL4",52,0)
 I '$G(BIVAC) D  Q
"RTN","BIUTL4",53,0)
 .D HLP^DDSUTL("You must first choose a vaccine."),HLP^DDSUTL("$$EOP")
"RTN","BIUTL4",54,0)
 .;---> Make Reason uneditable.
"RTN","BIUTL4",55,0)
 .D UNED^DDSUTL(4,,,1)
"RTN","BIUTL4",56,0)
 ;
"RTN","BIUTL4",57,0)
 ;---> Make Reason editable.
"RTN","BIUTL4",58,0)
 D UNED^DDSUTL(4,,,0)
"RTN","BIUTL4",59,0)
 ;---> Display Vaccine Short Name below Vaccine Name.
"RTN","BIUTL4",60,0)
 S BI("B")=BIVAC
"RTN","BIUTL4",61,0)
 D PUT^DDSVALF(2.5,,,"("_$$VNAME^BIUTL2(BIVAC)_")")
"RTN","BIUTL4",62,0)
 Q
"RTN","BIUTL4",63,0)
 ;
"RTN","BIUTL4",64,0)
 ;
"RTN","BIUTL4",65,0)
 ;----------
"RTN","BIUTL4",66,0)
VACCHG(BIVAC) ;EP
"RTN","BIUTL4",67,0)
 ;---> Actions to take in Screenman when the Vaccine is selected
"RTN","BIUTL4",68,0)
 ;---> or changed.
"RTN","BIUTL4",69,0)
 ;---> Called by the POST ACTION ON CHANGE of Field 2, Vaccine"
"RTN","BIUTL4",70,0)
 ;---> of the Form BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL4",71,0)
 ;---> Parameters:
"RTN","BIUTL4",72,0)
 ;     1 - BIVAC  (req) IEN of Vaccine IMMUNIZATION File (9999999.14).
"RTN","BIUTL4",73,0)
 ;
"RTN","BIUTL4",74,0)
 Q:'$G(BIVAC)
"RTN","BIUTL4",75,0)
 ;
"RTN","BIUTL4",76,0)
 ;---> If this is NOT a new visit, inform user that Dose#, Lot#,
"RTN","BIUTL4",77,0)
 ;---> Reaction, and VIS will be deleted and replaced.
"RTN","BIUTL4",78,0)
 D:$G(BI("K"))
"RTN","BIUTL4",79,0)
 .N BIMSG
"RTN","BIUTL4",80,0)
 .;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIUTL4",81,0)
 .;---> Add NDC to reset fields when vaccine is changed.
"RTN","BIUTL4",82,0)
 .S BIMSG="* NOTE: Because you have changed the vaccine, Dose Override,"
"RTN","BIUTL4",83,0)
 .;S BIMSG=BIMSG_"Lot#, and any Reaction and VIS will be removed or replaced"
"RTN","BIUTL4",84,0)
 .S BIMSG=BIMSG_"Lot#, NDC, and any Reaction and VIS will be removed or replaced"
"RTN","BIUTL4",85,0)
 .S BIMSG=BIMSG_" with defaults for the new vaccine."
"RTN","BIUTL4",86,0)
 .D HLP^DDSUTL(BIMSG),HLP^DDSUTL("$$EOP")
"RTN","BIUTL4",87,0)
 ;
"RTN","BIUTL4",88,0)
 ;---> Clear data relating to previous Vaccine (if any).
"RTN","BIUTL4",89,0)
 D PUT^DDSVALF(3) S BI("D")=""    ;Lot# IEN
"RTN","BIUTL4",90,0)
 D PUT^DDSVALF(13) S BI("O")=""   ;Reaction
"RTN","BIUTL4",91,0)
 D PUT^DDSVALF(10) S BI("Q")=""   ;VIS
"RTN","BIUTL4",92,0)
 D PUT^DDSVALF(14) S BI("S")=""   ;Dose Override
"RTN","BIUTL4",93,0)
 D PUT^DDSVALF(5) S BI("W")=""    ;Volume
"RTN","BIUTL4",94,0)
 D PUT^DDSVALF(3.8) S BI("H")=""  ;NDC
"RTN","BIUTL4",95,0)
 ;**********
"RTN","BIUTL4",96,0)
 ;
"RTN","BIUTL4",97,0)
 ;---> If Category is Historical Event, do not stuff Lot# and VIS defaults.
"RTN","BIUTL4",98,0)
 Q:$G(BI("I"))="E"
"RTN","BIUTL4",99,0)
 ;
"RTN","BIUTL4",100,0)
 ;---> If this Vaccine has a Default ("Current") Lot#, then stuff it.
"RTN","BIUTL4",101,0)
 N BIX
"RTN","BIUTL4",102,0)
 I '$G(BI("D")) D
"RTN","BIUTL4",103,0)
 .S BIX=$$LOTDEF^BIUTL2(BIVAC)
"RTN","BIUTL4",104,0)
 .I BIX D PUT^DDSVALF(3,,,BIX,"I") S BI("D")=BIX
"RTN","BIUTL4",105,0)
 ;
"RTN","BIUTL4",106,0)
 D VISVOL(BIVAC)
"RTN","BIUTL4",107,0)
 Q
"RTN","BIUTL4",108,0)
 ;
"RTN","BIUTL4",109,0)
 ;
"RTN","BIUTL4",110,0)
 ;----------
"RTN","BIUTL4",111,0)
VISVOL(BIVAC) ;EP
"RTN","BIUTL4",112,0)
 ;---> Stuff VIS and Volume defaults for a Lot Number on
"RTN","BIUTL4",113,0)
 ;---> the Form BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL4",114,0)
 ;---> Parameters:
"RTN","BIUTL4",115,0)
 ;     1 - BIVAC (req) IEN of Vaccine in IMM File (9999999.14).
"RTN","BIUTL4",116,0)
 ;
"RTN","BIUTL4",117,0)
 Q:'$G(BIVAC)
"RTN","BIUTL4",118,0)
 N BIX
"RTN","BIUTL4",119,0)
 ;---> If this Vaccine has a Default VIS, stuff it.
"RTN","BIUTL4",120,0)
 D:'$G(BI("Q"))
"RTN","BIUTL4",121,0)
 .S BIX=$$VISDEF^BIUTL2(BIVAC)
"RTN","BIUTL4",122,0)
 .I BIX D PUT^DDSVALF(10,,,BIX,"I") S BI("Q")=BIX
"RTN","BIUTL4",123,0)
 ;
"RTN","BIUTL4",124,0)
 ;---> If this is a new visit, stuff Volume Default.
"RTN","BIUTL4",125,0)
 D:'$G(BI("K"))
"RTN","BIUTL4",126,0)
 .N X S X=$$CODE^BIUTL2(BIVAC,5)
"RTN","BIUTL4",127,0)
 .Q:'X
"RTN","BIUTL4",128,0)
 .;---> For Influenza CVX 15, if patient is <36 mths change default=.25 ml.
"RTN","BIUTL4",129,0)
 .D:BIVAC=148
"RTN","BIUTL4",130,0)
 ..Q:'$G(BIDFN)  S:$$AGE^BIUTL1(BIDFN)<36 X=".25"
"RTN","BIUTL4",131,0)
 .;
"RTN","BIUTL4",132,0)
 .;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIUTL4",133,0)
 .;---> Add leading zero to default volume if less than 1.
"RTN","BIUTL4",134,0)
 .S:(X<1) X="0"_X
"RTN","BIUTL4",135,0)
 .;**********
"RTN","BIUTL4",136,0)
 .S BI("W")=X D PUT^DDSVALF(5,,,BI("W"),"I")
"RTN","BIUTL4",137,0)
 ;
"RTN","BIUTL4",138,0)
 Q
"RTN","BIUTL4",139,0)
 ;
"RTN","BIUTL4",140,0)
 ;
"RTN","BIUTL4",141,0)
 ;----------
"RTN","BIUTL4",142,0)
LOTDUP(BILIEN) ;EP
"RTN","BIUTL4",143,0)
 ;---> Return 1 if the Lot# has a duplicate in the IMMUNIZATION LOT
"RTN","BIUTL4",144,0)
 ;---> File; 0 if it is unique.
"RTN","BIUTL4",145,0)
 ;---> Parameters:
"RTN","BIUTL4",146,0)
 ;     1 - BILIEN  (req) IEN of Lot# in IMMUNIZATION LOT File.
"RTN","BIUTL4",147,0)
 ;
"RTN","BIUTL4",148,0)
 Q:'$G(BILIEN) 0
"RTN","BIUTL4",149,0)
 Q:'$D(^AUTTIML(BILIEN,0)) 0
"RTN","BIUTL4",150,0)
 ;
"RTN","BIUTL4",151,0)
 ;---> If Lot# is duplicated in the IMM LOT File, return 1.
"RTN","BIUTL4",152,0)
 N Y,Z S Y=$P(^AUTTIML(BILIEN,0),U) S Z=$O(^AUTTIML("B",Y,0))
"RTN","BIUTL4",153,0)
 Q:$O(^AUTTIML("B",Y,Z)) 1
"RTN","BIUTL4",154,0)
 ;---> Lot# is unique, return 0.
"RTN","BIUTL4",155,0)
 Q 0
"RTN","BIUTL4",156,0)
 ;
"RTN","BIUTL4",157,0)
 ;
"RTN","BIUTL4",158,0)
 ;----------
"RTN","BIUTL4",159,0)
LOTHELP(BILIEN) ;EP
"RTN","BIUTL4",160,0)
 ;---> If chosen Lot# is a duplicate, provide help message.
"RTN","BIUTL4",161,0)
 ;---> Parameters:
"RTN","BIUTL4",162,0)
 ;     1 - BILIEN  (req) IEN of Lot# in IMMUNIZATION LOT File.
"RTN","BIUTL4",163,0)
 N BIPOP,X
"RTN","BIUTL4",164,0)
 Q:'$$LOTDUP(BILIEN)
"RTN","BIUTL4",165,0)
 ;
"RTN","BIUTL4",166,0)
 D TITLE^BIUTL5("DUPLICATE LOT NUMBERS")
"RTN","BIUTL4",167,0)
 S X="--> Lot# "_$$LOTTX^BIUTL6(BILIEN)_" <--" D CENTERT^BIUTL5(.X)
"RTN","BIUTL4",168,0)
 W X,!
"RTN","BIUTL4",169,0)
 D
"RTN","BIUTL4",170,0)
 .I $$MAYMANAG^BIUTL11 D  Q
"RTN","BIUTL4",171,0)
 ..D TEXT2^BIUTL6,DIRZ^BIUTL3(.BIPOP)
"RTN","BIUTL4",172,0)
 ..Q:$G(BIPOP)
"RTN","BIUTL4",173,0)
 ..D TITLE^BIUTL5("DUPLICATE LOT NUMBERS"),TEXT3^BIUTL6
"RTN","BIUTL4",174,0)
 .D TEXT1^BIUTL6
"RTN","BIUTL4",175,0)
 D:'$G(BIPOP) DIRZ^BIUTL3()
"RTN","BIUTL4",176,0)
 D REFRESH^DDSUTL
"RTN","BIUTL4",177,0)
 S BI("D")="",DDSBR=3 D PUT^DDSVALF(3)
"RTN","BIUTL4",178,0)
 Q
"RTN","BIUTL4",179,0)
 ;
"RTN","BIUTL4",180,0)
 ;
"RTN","BIUTL4",181,0)
 ;----------
"RTN","BIUTL4",182,0)
LOTSCR ;EP
"RTN","BIUTL4",183,0)
 ;---> Set Screen for Lot Number selection in Screen field of
"RTN","BIUTL4",184,0)
 ;---> "Form Only Field Parameters" of the Form BI FORM-IMM VISIT ADD/EDIT
"RTN","BIUTL4",185,0)
 ;---> when selecting Lot Number.
"RTN","BIUTL4",186,0)
 ;---> Screen: If this Lot Number is Active, AND if no Vaccine has been selected OR
"RTN","BIUTL4",187,0)
 ;--->         this Lot Number is assigned to the selected Vaccine,
"RTN","BIUTL4",188,0)
 ;--->         AND if EITHER [it has no specific Location] OR
"RTN","BIUTL4",189,0)
 ;--->         [its Location matches the user's Location (DUZ(2))].
"RTN","BIUTL4",190,0)
 ;
"RTN","BIUTL4",191,0)
 N BILOC S BILOC=$P($G(^AUTTIML(+Y,0)),U,14)
"RTN","BIUTL4",192,0)
 ;
"RTN","BIUTL4",193,0)
 ;---> Next line: Concat to avoid suspected naked ref.
"RTN","BIUTL4",194,0)
 S DIR("S")="I $P(^"_"(0),U,3)=0,($G(BI(""B""))=""""!$D(^AUTTIML(""C"",+$G(BI(""B"")),Y)))"
"RTN","BIUTL4",195,0)
 S DIR("S")=DIR("S")_",(('$P($G(^AUTTIML(Y,0)),U,14))!($P($G(^AUTTIML(Y,0)),U,14)=$G(DUZ(2))))"
"RTN","BIUTL4",196,0)
 Q
"RTN","BIUTL4",197,0)
 ;
"RTN","BIUTL4",198,0)
 ;
"RTN","BIUTL4",199,0)
 ;----------
"RTN","BIUTL4",200,0)
LOTSEL(BIX) ;EP
"RTN","BIUTL4",201,0)
 ;---> Action to take after Lot Number has been selected.
"RTN","BIUTL4",202,0)
 ;---> Parameters:
"RTN","BIUTL4",203,0)
 ;     1 - BIX (req) X=Internal Value of Lot Number selected.
"RTN","BIUTL4",204,0)
 ;
"RTN","BIUTL4",205,0)
 ;---> Executed from the "POST ACTION ON CHANGE" field of the
"RTN","BIUTL4",206,0)
 ;---> "Form ONly Field Properties" of the Form BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL4",207,0)
 ;
"RTN","BIUTL4",208,0)
 ;---> Action: If a Vaccine was not chosen, but instead a Lot Number was entered first,
"RTN","BIUTL4",209,0)
 ;---> then populate the Vaccine field on the form (which triggers VACCHG above).
"RTN","BIUTL4",210,0)
 ;
"RTN","BIUTL4",211,0)
 Q:'BIX
"RTN","BIUTL4",212,0)
 ;
"RTN","BIUTL4",213,0)
 D
"RTN","BIUTL4",214,0)
 .;---> Don't change the Vaccine if it has already been selected.
"RTN","BIUTL4",215,0)
 .Q:(+$G(BI("B")))
"RTN","BIUTL4",216,0)
 .;---> Stuff Vaccine IEN for this Lot Number.
"RTN","BIUTL4",217,0)
 .N BIVAC S BIVAC=$$LOTTX^BIUTL6(BIX,1)
"RTN","BIUTL4",218,0)
 .D PUT^DDSVALF(2,,,BIVAC,"I")
"RTN","BIUTL4",219,0)
 .D VACSEL(BIVAC)
"RTN","BIUTL4",220,0)
 .D LOTWARN^BIUTL7($G(BI("D")),$G(BI("E")),$G(BI("F")))
"RTN","BIUTL4",221,0)
 .D VISVOL(BIVAC)
"RTN","BIUTL4",222,0)
 ;
"RTN","BIUTL4",223,0)
 D
"RTN","BIUTL4",224,0)
 .;---> Stuff default NDC IEN for this Lot Number.
"RTN","BIUTL4",225,0)
 .Q:(+$G(BI("H")))
"RTN","BIUTL4",226,0)
 .N BINDC S BINDC=$$LOTTX^BIUTL6(BIX,3)
"RTN","BIUTL4",227,0)
 .I BINDC D PUT^DDSVALF(3.8,,,BINDC,"I")
"RTN","BIUTL4",228,0)
 ;
"RTN","BIUTL4",229,0)
 Q
"RTN","BIUTL4",230,0)
 ;
"RTN","BIUTL4",231,0)
 ;
"RTN","BIUTL4",232,0)
 ;----------
"RTN","BIUTL4",233,0)
NDCSCR ;EP
"RTN","BIUTL4",234,0)
 ;---> Set Screen for NDC Code selection in Screen field of
"RTN","BIUTL4",235,0)
 ;---> "Form Only Field Parameters" of the Form BI FORM-IMM VISIT ADD/EDIT
"RTN","BIUTL4",236,0)
 ;---> when selecting NDC Code.
"RTN","BIUTL4",237,0)
 ;---> Screen: If this NDC is Active, AND this NDC is assigned to the selected
"RTN","BIUTL4",238,0)
 ;---> vaccine in BI("B").
"RTN","BIUTL4",239,0)
 ;
"RTN","BIUTL4",240,0)
 ;W !!,"This screen in NDCSCR^BIUTL4",! X ^O
"RTN","BIUTL4",241,0)
 S DIR("S")="I $P(^BINDC(Y,0),U,6)'=1,$D(^BINDC(""C"",+$G(BI(""B"")),Y))"
"RTN","BIUTL4",242,0)
 Q
"RTN","BIUTL4",243,0)
 ;
"RTN","BIUTL4",244,0)
 ;
"RTN","BIUTL4",245,0)
 ;----------
"RTN","BIUTL4",246,0)
CREASCR ;EP
"RTN","BIUTL4",247,0)
 ;---> Set Screen for Contraindication Reason selection in Reason field
"RTN","BIUTL4",248,0)
 ;---> "Form Only Field Parameters" of the Form BI FORM-CONTRAINDICATION ADD.
"RTN","BIUTL4",249,0)
 ;---> Screen: If this Reason is Active AND if this Reason is Skin Test
"RTN","BIUTL4",250,0)
 ;--->         related AND this Vaccine is a Skin Test.
"RTN","BIUTL4",251,0)
 ;
"RTN","BIUTL4",252,0)
 ;---> If no vaccine chosen, then screen says all reasons are invalid.
"RTN","BIUTL4",253,0)
 I '$G(BI("B")) S DIR("S")="I 0" Q
"RTN","BIUTL4",254,0)
 ;
"RTN","BIUTL4",255,0)
 S DIR("S")="I ($P(^BICONT(Y,0),U,3))&(+$P(^BICONT(Y,0),U,4)"
"RTN","BIUTL4",256,0)
 S DIR("S")=DIR("S")_"=+$P(^AUTTIMM(BI(""B""),0),U,8))"
"RTN","BIUTL4",257,0)
 Q
"RTN","BIUTL4",258,0)
 ;
"RTN","BIUTL4",259,0)
 ;
"RTN","BIUTL4",260,0)
 ;----------
"RTN","BIUTL4",261,0)
HISTORY(X) ;EP
"RTN","BIUTL4",262,0)
 ;---> Add/Edit Screenman actions to take ON POST-CHANGE of Category Field.
"RTN","BIUTL4",263,0)
 ;---> Parameters:
"RTN","BIUTL4",264,0)
 ;     1 - X (opt) X=Internal Value of Category Field ("E"=Historical Event).
"RTN","BIUTL4",265,0)
 ;
"RTN","BIUTL4",266,0)
 ;---> If this is an Historical Event, then set Lot#="" and not required.
"RTN","BIUTL4",267,0)
 I X="E" D
"RTN","BIUTL4",268,0)
 .S BI("D")=""
"RTN","BIUTL4",269,0)
 .D PUT^DDSVALF(3,"","",""),REQ^DDSUTL(3,"","",0)
"RTN","BIUTL4",270,0)
 .D PUT^DDSVALF(9,,,) S BI("R")=""
"RTN","BIUTL4",271,0)
 Q
"RTN","BIUTL4",272,0)
 ;
"RTN","BIUTL4",273,0)
 ;
"RTN","BIUTL4",274,0)
 ;----------
"RTN","BIUTL4",275,0)
OLDDATE(X) ;EP
"RTN","BIUTL4",276,0)
 ;---> Add/Edit Screenman actions to take ON POST-CHANGE of Date Field.
"RTN","BIUTL4",277,0)
 ;---> If date entered is earlier than today, Category default changes to
"RTN","BIUTL4",278,0)
 ;---> Historical.  If the date is more than 5 days earlier than today,
"RTN","BIUTL4",279,0)
 ;---> user as default Provider is removed.
"RTN","BIUTL4",280,0)
 ;---> Parameters:
"RTN","BIUTL4",281,0)
 ;     1 - X (opt) X=Internal Value of Date of Visit entered.
"RTN","BIUTL4",282,0)
 ;
"RTN","BIUTL4",283,0)
 ;
"RTN","BIUTL4",284,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL4",285,0)
 ;---> Make VIS Presented Date default to Visit Date (when changed).
"RTN","BIUTL4",286,0)
 N BIDATEE S BIDATEE=X
"RTN","BIUTL4",287,0)
 ;
"RTN","BIUTL4",288,0)
 I '$G(BI("K"))&($P(X,".")'=DT) D
"RTN","BIUTL4",289,0)
 .D PUT^DDSVALF(11,,,"E","I") S BI("I")="E"
"RTN","BIUTL4",290,0)
 .I ($G(DT)-X)>5 D NOPROV^BIUTL7("E")
"RTN","BIUTL4",291,0)
 ;
"RTN","BIUTL4",292,0)
 ;
"RTN","BIUTL4",293,0)
 ;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BIUTL4",294,0)
 ;---> Only stuff VIS Presented Date if this is a V Imm.
"RTN","BIUTL4",295,0)
 ;D PUT^DDSVALF(10.2,,,BIDATEE,"E") S BI("QQ")=BIDATEE
"RTN","BIUTL4",296,0)
 I $G(BIVTYPE)="I" D PUT^DDSVALF(10.2,,,BIDATEE,"E") S BI("QQ")=BIDATEE
"RTN","BIUTL4",297,0)
 ;**********
"RTN","BIUTL4",298,0)
 ;
"RTN","BIUTL4",299,0)
 ;
"RTN","BIUTL4",300,0)
 ;----------
"RTN","BIUTL4",301,0)
SKINCHG(BISKIEN) ;EP
"RTN","BIUTL4",302,0)
 ;---> Actions to take in Screenman when the Skin Test is selected
"RTN","BIUTL4",303,0)
 ;---> or changed.
"RTN","BIUTL4",304,0)
 ;---> Called by the POST ACTION ON CHANGE of Field 2, Skin Test"
"RTN","BIUTL4",305,0)
 ;---> of the Form BI FORM-SKIN VISIT ADD/EDIT.
"RTN","BIUTL4",306,0)
 ;---> Parameters:
"RTN","BIUTL4",307,0)
 ;     1 - BISKIEN  (opt) IEN of Vaccine IMMUNIZATION File (9999999.14).
"RTN","BIUTL4",308,0)
 ;                        (Not used for now.)
"RTN","BIUTL4",309,0)
 Q:'$G(BISKIEN)
"RTN","BIUTL4",310,0)
 ;
"RTN","BIUTL4",311,0)
 ;---> If this is NOT a new visit, inform user that Dose#, Lot#,
"RTN","BIUTL4",312,0)
 ;---> Reaction, and VIS will be deleted and replaced.
"RTN","BIUTL4",313,0)
 D:$G(BI("K"))
"RTN","BIUTL4",314,0)
 .N BIMSG
"RTN","BIUTL4",315,0)
 .S BIMSG="* NOTE: Because you have changed the Skin Test, the Result,"
"RTN","BIUTL4",316,0)
 .S BIMSG=BIMSG_" Reading, Date of Reading, and Reader will be removed."
"RTN","BIUTL4",317,0)
 .D HLP^DDSUTL(BIMSG),HLP^DDSUTL("$$EOP")
"RTN","BIUTL4",318,0)
 ;
"RTN","BIUTL4",319,0)
 ;---> Clear data relating to previous Skin Test (if any).
"RTN","BIUTL4",320,0)
 D PUT^DDSVALF(3) S BI("L")=""   ;Result
"RTN","BIUTL4",321,0)
 D PUT^DDSVALF(4) S BI("M")=""   ;Reading
"RTN","BIUTL4",322,0)
 D PUT^DDSVALF(5) S BI("N")=""   ;Date of Reading
"RTN","BIUTL4",323,0)
 D PUT^DDSVALF(10) S BI("X")=""  ;Reader
"RTN","BIUTL4",324,0)
 Q
"RTN","BIUTL4",325,0)
 ;
"RTN","BIUTL4",326,0)
 ;
"RTN","BIUTL4",327,0)
 ;----------
"RTN","BIUTL4",328,0)
SERVAL(BIDOSE,BIVAC) ;EP
"RTN","BIUTL4",329,0)
 ;---> Validate Dose# for this Immunization Visit.
"RTN","BIUTL4",330,0)
 ;---> Parameters:
"RTN","BIUTL4",331,0)
 ;     1 - BIDOSE (req) Dose# entered by the user.
"RTN","BIUTL4",332,0)
 ;     2 - BIVAC  (req) IEN of Vaccine IMMUNIZATION File (9999999.14).
"RTN","BIUTL4",333,0)
 ;
"RTN","BIUTL4",334,0)
 Q:'BIDOSE  Q:'BIVAC
"RTN","BIUTL4",335,0)
 S BIMAX=$$VMAX^BIUTL2(BIVAC)
"RTN","BIUTL4",336,0)
 ;
"RTN","BIUTL4",337,0)
 ;---> If Dose# entered is greater than Max Dose# for this Vaccine,
"RTN","BIUTL4",338,0)
 ;---> reject value and display help text.
"RTN","BIUTL4",339,0)
 I BIDOSE>BIMAX S DDSERROR=1 D
"RTN","BIUTL4",340,0)
 .N Z
"RTN","BIUTL4",341,0)
 .S Z="The Maximum Dose# for "_$$VNAME^BIUTL2(BIVAC)_" is "_BIMAX
"RTN","BIUTL4",342,0)
 .S Z=Z_".  Please enter a number between 1 and "_BIMAX_"."
"RTN","BIUTL4",343,0)
 .D HLP^DDSUTL(Z)
"RTN","BIUTL4",344,0)
 Q
"RTN","BIUTL4",345,0)
 ;
"RTN","BIUTL4",346,0)
 ;
"RTN","BIUTL4",347,0)
 ;----------
"RTN","BIUTL4",348,0)
INACTV(X) ;EP
"RTN","BIUTL4",349,0)
 ;---> Called by the POST ACTION of Field 4, "Inactive Date"
"RTN","BIUTL4",350,0)
 ;---> of the Form BI FORM-CASE DATA EDIT.
"RTN","BIUTL4",351,0)
 ;---> Actions to take in Screenman when Patient is made Inactive
"RTN","BIUTL4",352,0)
 ;---> by adding a date to Field 4, Inactive Date, of the Form.
"RTN","BIUTL4",353,0)
 ;---> Parameters:
"RTN","BIUTL4",354,0)
 ;     1 - X (req) Internal value of the date entered.
"RTN","BIUTL4",355,0)
 ;
"RTN","BIUTL4",356,0)
 ;---> If no Inactive Date entered, set Reason="" and "Moved to"=""
"RTN","BIUTL4",357,0)
 ;---> and disable navigation to and editing of the fields.
"RTN","BIUTL4",358,0)
 I '$G(X) D  Q
"RTN","BIUTL4",359,0)
 .D PUT^DDSVALF(5),PUT^DDSVALF(5.5)
"RTN","BIUTL4",360,0)
 .D UNED^DDSUTL(5,,,1),UNED^DDSUTL(5.5,,,1)
"RTN","BIUTL4",361,0)
 .S (BI("F"),BI("I"))="@"
"RTN","BIUTL4",362,0)
 ;---> A date has been entered, so enable edit and navigation.
"RTN","BIUTL4",363,0)
 D UNED^DDSUTL(5,,,0),UNED^DDSUTL(5.5,,,0)
"RTN","BIUTL4",364,0)
 Q
"RTN","BIUTL4",365,0)
 ;
"RTN","BIUTL4",366,0)
 ;
"RTN","BIUTL4",367,0)
 ;----------
"RTN","BIUTL4",368,0)
LOCBR ;EP
"RTN","BIUTL4",369,0)
 ;---> Location Type branching logic for Add/Edit Imm Visit Form:
"RTN","BIUTL4",370,0)
 ;---> "Location" field.
"RTN","BIUTL4",371,0)
 ;
"RTN","BIUTL4",372,0)
 ;---> If Location Type is "Other":
"RTN","BIUTL4",373,0)
 I (X="O")&($G(DDSOLD)'="O") D
"RTN","BIUTL4",374,0)
 .;
"RTN","BIUTL4",375,0)
 .;---> Disable IHS Loc (7) and put a null value in IHS Loc (7).
"RTN","BIUTL4",376,0)
 .D UNED^DDSUTL(7,,,1),PUT^DDSVALF(7)
"RTN","BIUTL4",377,0)
 .;
"RTN","BIUTL4",378,0)
 .;---> Set IHS Location IEN in BI array =null (ADD+18^BIVISIT).
"RTN","BIUTL4",379,0)
 .S BI("F")=""
"RTN","BIUTL4",380,0)
 .;
"RTN","BIUTL4",381,0)
 .;---> Enable Other Loc (8).
"RTN","BIUTL4",382,0)
 .D UNED^DDSUTL(8,,,0)
"RTN","BIUTL4",383,0)
 .;
"RTN","BIUTL4",384,0)
 .;---> Make Other Loc required, and IHS Loc not required.
"RTN","BIUTL4",385,0)
 .D REQ^DDSUTL(8,,,1),REQ^DDSUTL(7,,,0)
"RTN","BIUTL4",386,0)
 ;
"RTN","BIUTL4",387,0)
 ;
"RTN","BIUTL4",388,0)
 ;---> If Location Type is "IHS":
"RTN","BIUTL4",389,0)
 I (X="I")&($G(DDSOLD)'="I") D
"RTN","BIUTL4",390,0)
 .;
"RTN","BIUTL4",391,0)
 .;---> Disable Other Loc (8) and put a null value in Other Loc (8).
"RTN","BIUTL4",392,0)
 .D UNED^DDSUTL(8,,,1),PUT^DDSVALF(8)
"RTN","BIUTL4",393,0)
 .;
"RTN","BIUTL4",394,0)
 .;---> Set Outside Location text in BI array =null (ADD+19^BIVISIT).
"RTN","BIUTL4",395,0)
 .S BI("G")=""
"RTN","BIUTL4",396,0)
 .;
"RTN","BIUTL4",397,0)
 .;---> Enable IHS Loc (7).
"RTN","BIUTL4",398,0)
 .D UNED^DDSUTL(7,,,0)
"RTN","BIUTL4",399,0)
 .;
"RTN","BIUTL4",400,0)
 .;---> Make IHS Loc required, and Other Loc not required.
"RTN","BIUTL4",401,0)
 .D REQ^DDSUTL(7,,,1),REQ^DDSUTL(8,,,0),DEFSITE
"RTN","BIUTL4",402,0)
 Q
"RTN","BIUTL4",403,0)
 ;
"RTN","BIUTL4",404,0)
 ;
"RTN","BIUTL4",405,0)
 ;----------
"RTN","BIUTL4",406,0)
VISDATE ;EP
"RTN","BIUTL4",407,0)
 ;---> Enable/disable and if necessary clear VIS Date, based on
"RTN","BIUTL4",408,0)
 ;---> YES/NO answer of VIS Given question.
"RTN","BIUTL4",409,0)
 ;
"RTN","BIUTL4",410,0)
 ;---> If VIS Given=YES (1), then enable editing of VIS Date.
"RTN","BIUTL4",411,0)
 I X=1 D  Q
"RTN","BIUTL4",412,0)
 .D UNED^DDSUTL(13,,,0)
"RTN","BIUTL4",413,0)
 .;---> If no VIS Date present, get default from IMMUNIZATION File.
"RTN","BIUTL4",414,0)
 .Q:$$GET^DDSVALF(13)
"RTN","BIUTL4",415,0)
 .N BIY S BIY=$$GET^DDSVALF(2)
"RTN","BIUTL4",416,0)
 .D PUT^DDSVALF(13,,,$$VISDEF^BIUTL2(BIY))
"RTN","BIUTL4",417,0)
 ;
"RTN","BIUTL4",418,0)
 ;---> Otherwise, stuff null in VIS Date and make it uneditable.
"RTN","BIUTL4",419,0)
 D PUT^DDSVALF(13) S BI("Q")=""
"RTN","BIUTL4",420,0)
 D UNED^DDSUTL(13,,,1)
"RTN","BIUTL4",421,0)
 Q
"RTN","BIUTL4",422,0)
 ;
"RTN","BIUTL4",423,0)
 ;
"RTN","BIUTL4",424,0)
 ;----------
"RTN","BIUTL4",425,0)
DEFSITE ;EP
"RTN","BIUTL4",426,0)
 ;---> Code to stuff default Location of Visit in Add/Edit Imm Visit
"RTN","BIUTL4",427,0)
 ;---> form.  If Location Type is IHS and current value is null,
"RTN","BIUTL4",428,0)
 ;---> stuff user's DUZ(2) as default.
"RTN","BIUTL4",429,0)
 ;
"RTN","BIUTL4",430,0)
 Q:$$GET^DDSVALF(6)'="I"
"RTN","BIUTL4",431,0)
 Q:$$GET^DDSVALF(7)]""
"RTN","BIUTL4",432,0)
 D PUT^DDSVALF(7,"","",DUZ(2),"I")
"RTN","BIUTL4",433,0)
 Q
"RTN","BIUTL4",434,0)
 ;
"RTN","BIUTL4",435,0)
 ;
"RTN","BIUTL4",436,0)
 ;----------
"RTN","BIUTL4",437,0)
BADREAD ;EP
"RTN","BIUTL4",438,0)
 ;---> Code to check Skin Test results: If the result is Negative,
"RTN","BIUTL4",439,0)
 ;---> the Reading must be <15mm; in that case,
"RTN","BIUTL4",440,0)
 ;---> display help message and reject value.
"RTN","BIUTL4",441,0)
 ;
"RTN","BIUTL4",442,0)
 N X
"RTN","BIUTL4",443,0)
 S X="If the result is NEGATIVE, the Reading must be less than 15 millimeters."
"RTN","BIUTL4",444,0)
 D HLP^DDSUTL(X)
"RTN","BIUTL4",445,0)
 S DDSERROR=""
"RTN","BIUTL4",446,0)
 Q
"RTN","BIUTL4",447,0)
 ;
"RTN","BIUTL4",448,0)
 ;
"RTN","BIUTL4",449,0)
 ;----------
"RTN","BIUTL4",450,0)
BADRDAT ;EP
"RTN","BIUTL4",451,0)
 ;---> If the Read Date is earlier than the initial visit date or later
"RTN","BIUTL4",452,0)
 ;---> than today, advise and return to Read Date field.
"RTN","BIUTL4",453,0)
 ;
"RTN","BIUTL4",454,0)
 I Y<$$GET^DDSVALF(1) S DDSERROR="" D  Q
"RTN","BIUTL4",455,0)
 .D HLP^DDSUTL(" * Date of Reading may not be prior to date of initial visit.")
"RTN","BIUTL4",456,0)
 I Y>DT S DDSERROR="" D  Q
"RTN","BIUTL4",457,0)
 .D HLP^DDSUTL(" * Date of Reading may not be later than today.")
"RTN","BIUTL4",458,0)
 Q
"RTN","BIUTL7")
0^9^B140935805
"RTN","BIUTL7",1,0)
BIUTL7 ;IHS/CMI/MWR - UTIL: SCREENMAN CODE; MAY 10, 2010
"RTN","BIUTL7",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BIUTL7",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIUTL7",4,0)
 ;;  SCREENMAN RELATED CODE TO LOAD & SAVE: VISIT, CASE DATA, CONTRAS.
"RTN","BIUTL7",5,0)
 ;;  PATCH 9: Added Preload of Admin Date and VIS Presented Date. LOADVIS+70
"RTN","BIUTL7",6,0)
 ;;           Added save of Admin Date and VIS Presented Date. SAVISIT+41
"RTN","BIUTL7",7,0)
 ;;  PATCH 10: Added Preload of Skin Test Lot Number. LOADVIS+92
"RTN","BIUTL7",8,0)
 ;;            Added save of Skin Test Lot Number.  SAVISIT+46
"RTN","BIUTL7",9,0)
 ;
"RTN","BIUTL7",10,0)
 ;
"RTN","BIUTL7",11,0)
 ;----------
"RTN","BIUTL7",12,0)
LOADVIS(BIVTYPE) ;EP
"RTN","BIUTL7",13,0)
 ;---> Code to load Visit data for ScreenMan Edit form.
"RTN","BIUTL7",14,0)
 ;---> Called by Pre Action of Block BI BLK-IMM VISIT ADD/EDIT or
"RTN","BIUTL7",15,0)
 ;---> BI BLK-SKIN VISIT ADD/EDIT of Forms BI FORM-IMM VISIT ADD/EDIT
"RTN","BIUTL7",16,0)
 ;---> or BI FORM-SKIN VISIT ADD/EDIT, respectively.
"RTN","BIUTL7",17,0)
 ;---> Parameters:
"RTN","BIUTL7",18,0)
 ;     1 - BIVTYPE (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIUTL7",19,0)
 ;
"RTN","BIUTL7",20,0)
 ;---> If BIVTYPE does not="I" (Imm Visit) and it does
"RTN","BIUTL7",21,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIUTL7",22,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D ERRCD^BIUTL2(410,,1) Q
"RTN","BIUTL7",23,0)
 ;
"RTN","BIUTL7",24,0)
 ;
"RTN","BIUTL7",25,0)
 ;---> If this is an old Visit, load data for Screenman.
"RTN","BIUTL7",26,0)
 D:$G(BI("K"))
"RTN","BIUTL7",27,0)
 .;
"RTN","BIUTL7",28,0)
 .;---> IMMUNIZATIONS *
"RTN","BIUTL7",29,0)
 .D:BIVTYPE="I"
"RTN","BIUTL7",30,0)
 ..;
"RTN","BIUTL7",31,0)
 ..;---> Load the Vaccine.
"RTN","BIUTL7",32,0)
 ..D:$G(BI("B"))
"RTN","BIUTL7",33,0)
 ...;---> Load Vaccine Name and display Short Name below (if different).
"RTN","BIUTL7",34,0)
 ...D PUT^DDSVALF(2,,,BI("B"),"I")
"RTN","BIUTL7",35,0)
 ...D VSHORT(BI("B"))
"RTN","BIUTL7",36,0)
 ..;
"RTN","BIUTL7",37,0)
 ..;---> Load Lot Number IEN, and display Lot data (Amount and Exp Date).
"RTN","BIUTL7",38,0)
 ..I $G(BI("D")) D
"RTN","BIUTL7",39,0)
 ...D PUT^DDSVALF(3,,,BI("D"),"I")
"RTN","BIUTL7",40,0)
 ...D LOTDAT(BI("D"))
"RTN","BIUTL7",41,0)
 ..;
"RTN","BIUTL7",42,0)
 ..;---> Make Dose Override editable (Screenman Field "Disable Editing"
"RTN","BIUTL7",43,0)
 ..;---> is set to "YES" by default when the form is loaded.)
"RTN","BIUTL7",44,0)
 ..D UNED^DDSUTL(14,,,0)
"RTN","BIUTL7",45,0)
 ..;---> Load Dose Override if there is one.
"RTN","BIUTL7",46,0)
 ..I $G(BI("S")) D PUT^DDSVALF(14,,,BI("S"),"I")
"RTN","BIUTL7",47,0)
 ..;
"RTN","BIUTL7",48,0)
 ..;
"RTN","BIUTL7",49,0)
 ..;---> Make Reaction editable (Screenman Field "Disable Editing"
"RTN","BIUTL7",50,0)
 ..;---> is set to "YES" by default when the form is loaded.)
"RTN","BIUTL7",51,0)
 ..D UNED^DDSUTL(13,,,0)
"RTN","BIUTL7",52,0)
 ..;---> Load Immunization Reaction.
"RTN","BIUTL7",53,0)
 ..I $G(BI("O")) D PUT^DDSVALF(13,,,BI("O"),"I")
"RTN","BIUTL7",54,0)
 ..;
"RTN","BIUTL7",55,0)
 ..;---> Load the Injection Site.
"RTN","BIUTL7",56,0)
 ..I $G(BI("T"))]"" D PUT^DDSVALF(4,,,BI("T"),"I")
"RTN","BIUTL7",57,0)
 ..;
"RTN","BIUTL7",58,0)
 ..;---> Release/Rev Date of VIS (DD-Mmm-YYYY).
"RTN","BIUTL7",59,0)
 ..I $G(BI("Q"))>1 D PUT^DDSVALF(10,,,BI("Q"),"E")
"RTN","BIUTL7",60,0)
 ..;
"RTN","BIUTL7",61,0)
 ..;---> Load the Volume, add leading zero to Volume if necessary.
"RTN","BIUTL7",62,0)
 ..I $G(BI("W")) D PUT^DDSVALF(5,,,$$LEADZ^BIUTL5(BI("W")),"E")
"RTN","BIUTL7",63,0)
 ..;
"RTN","BIUTL7",64,0)
 ..;---> Load Imported from Outside Source, if=1 (display "edited" if=2).
"RTN","BIUTL7",65,0)
 ..I $G(BI("Y")) D PUT^DDSVALF(15,,,"*Imported"_$S(BI("Y")=2:" (edited)*",1:"*"))
"RTN","BIUTL7",66,0)
 ..;
"RTN","BIUTL7",67,0)
 ..;---> Load VFC Elig if Native and <19.
"RTN","BIUTL7",68,0)
 ..D VFCSET^BIUTL8
"RTN","BIUTL7",69,0)
 ..;
"RTN","BIUTL7",70,0)
 ..;---> Load NDC Code.
"RTN","BIUTL7",71,0)
 ..I $G(BI("H"))]"" D PUT^DDSVALF(3.8,,,BI("H"),"I")
"RTN","BIUTL7",72,0)
 ..;
"RTN","BIUTL7",73,0)
 ..;
"RTN","BIUTL7",74,0)
 ..;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL7",75,0)
 ..;---> Preload Admin Date and Date VIS Presented.
"RTN","BIUTL7",76,0)
 ..I $G(BI("EE"))>1 D PUT^DDSVALF(1.5,,,BI("EE"),"E")
"RTN","BIUTL7",77,0)
 ..I $G(BI("QQ"))>1 D PUT^DDSVALF(10.2,,,BI("QQ"),"E")
"RTN","BIUTL7",78,0)
 ..;**********
"RTN","BIUTL7",79,0)
 .;
"RTN","BIUTL7",80,0)
 .;---> SKIN TESTS *
"RTN","BIUTL7",81,0)
 .D:BIVTYPE="S"
"RTN","BIUTL7",82,0)
 ..;
"RTN","BIUTL7",83,0)
 ..;---> Load the Skin Test.
"RTN","BIUTL7",84,0)
 ..D:$G(BI("B")) PUT^DDSVALF(2,,,BI("B"),"I")
"RTN","BIUTL7",85,0)
 ..;
"RTN","BIUTL7",86,0)
 ..;---> Load Skin Test Result.
"RTN","BIUTL7",87,0)
 ..I $G(BI("L"))]"" D PUT^DDSVALF(3,,,$E(BI("L")),"I")
"RTN","BIUTL7",88,0)
 ..;
"RTN","BIUTL7",89,0)
 ..;---> Load Skin Test Reading.
"RTN","BIUTL7",90,0)
 ..I $G(BI("M"))'="" D PUT^DDSVALF(4,,,BI("M"),"I")
"RTN","BIUTL7",91,0)
 ..;
"RTN","BIUTL7",92,0)
 ..;---> Load Skin Test Date Read.
"RTN","BIUTL7",93,0)
 ..I $D(BI("N")) D PUT^DDSVALF(5,,,BI("N"),"E")
"RTN","BIUTL7",94,0)
 ..;
"RTN","BIUTL7",95,0)
 ..;---> If Reader already stored previously, load it.
"RTN","BIUTL7",96,0)
 ..I $G(BI("X")) D PUT^DDSVALF(10,,,BI("X"),"I")
"RTN","BIUTL7",97,0)
 ..;
"RTN","BIUTL7",98,0)
 ..;---> Load the Injection Site.
"RTN","BIUTL7",99,0)
 ..I $G(BI("T"))]"" D PUT^DDSVALF(2.4,,,BI("T"),"I")
"RTN","BIUTL7",100,0)
 ..;
"RTN","BIUTL7",101,0)
 ..;---> Load the Volume.
"RTN","BIUTL7",102,0)
 ..I $G(BI("W"))]"" D PUT^DDSVALF(2.8,,,BI("W"),"I")
"RTN","BIUTL7",103,0)
 ..;
"RTN","BIUTL7",104,0)
 ..;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BIUTL7",105,0)
 ..;---> Preload Skin Test Lot Number.
"RTN","BIUTL7",106,0)
 ..I $G(BI("LL"))>1 D PUT^DDSVALF(2.9,,,BI("LL"),"I")
"RTN","BIUTL7",107,0)
 ..;**********
"RTN","BIUTL7",108,0)
 .;
"RTN","BIUTL7",109,0)
 .;
"RTN","BIUTL7",110,0)
 .;---> If there is text for Other Location:
"RTN","BIUTL7",111,0)
 .D:$G(BI("G"))]""
"RTN","BIUTL7",112,0)
 ..;---> Set Location Type to Other.
"RTN","BIUTL7",113,0)
 ..D PUT^DDSVALF(6,,,"O","I")
"RTN","BIUTL7",114,0)
 ..;---> Make IHS Loc uneditable and null (ADD+12^BIVISIT will handle).
"RTN","BIUTL7",115,0)
 ..D UNED^DDSUTL(7,,,1),PUT^DDSVALF(7)
"RTN","BIUTL7",116,0)
 ..;---> Load Other Loc text and make editable.
"RTN","BIUTL7",117,0)
 ..D PUT^DDSVALF(8,,,BI("G")),UNED^DDSUTL(8,,,0)
"RTN","BIUTL7",118,0)
 ..;---> Make Other Loc required, IHS Loc not required.
"RTN","BIUTL7",119,0)
 ..D REQ^DDSUTL(8,,,1),REQ^DDSUTL(7,,,0)
"RTN","BIUTL7",120,0)
 .;
"RTN","BIUTL7",121,0)
 .;---> If Other Loc is null and IHS Loc is set, load it.
"RTN","BIUTL7",122,0)
 .I $G(BI("G"))="" I $G(BI("F")) D
"RTN","BIUTL7",123,0)
 ..D PUT^DDSVALF(7,,,BI("F"),"I")
"RTN","BIUTL7",124,0)
 .;
"RTN","BIUTL7",125,0)
 .;---> Load Category.
"RTN","BIUTL7",126,0)
 .I $G(BI("I"))]"" D PUT^DDSVALF(11,,,BI("I"),"I")
"RTN","BIUTL7",127,0)
 ;
"RTN","BIUTL7",128,0)
 ;---> Load default date.
"RTN","BIUTL7",129,0)
 D
"RTN","BIUTL7",130,0)
 .N X S X=$G(BI("E"))
"RTN","BIUTL7",131,0)
 .Q:X=""
"RTN","BIUTL7",132,0)
 .S:X[" @12:00" X=$P(X," @")
"RTN","BIUTL7",133,0)
 .D PUT^DDSVALF(1,,,X,"E")
"RTN","BIUTL7",134,0)
 ;
"RTN","BIUTL7",135,0)
 ;---> Load default site.
"RTN","BIUTL7",136,0)
 D DEFSITE^BIUTL4
"RTN","BIUTL7",137,0)
 S BI("F")=$$GET^DDSVALF(7),BI("I")=$$GET^DDSVALF(11)
"RTN","BIUTL7",138,0)
 ;
"RTN","BIUTL7",139,0)
 ;---> If this is an Immunization, load VFC Eligibility and Local Text.
"RTN","BIUTL7",140,0)
 I BIVTYPE="I",$G(BI("P"))]"" D PUT^DDSVALF(10.5,,,BI("P"),"I"),ELIGLAB^BIUTL8(BI("P"))
"RTN","BIUTL7",141,0)
 ;
"RTN","BIUTL7",142,0)
 ;---> If Provider already stored previously, load it and quit.
"RTN","BIUTL7",143,0)
 I $G(BI("R")) D PUT^DDSVALF(9,,,BI("R"),"I") Q
"RTN","BIUTL7",144,0)
 ;
"RTN","BIUTL7",145,0)
 ;---> If this is a new Skin Test, load default volume of .1 ml.
"RTN","BIUTL7",146,0)
 I BIVTYPE="S",'$G(BI("K")) S BI("W")=.1 D PUT^DDSVALF(2.8,,,BI("W"),"I")
"RTN","BIUTL7",147,0)
 ;
"RTN","BIUTL7",148,0)
 ;---> If this is a new Visit, and if Site Parameter is yes, and
"RTN","BIUTL7",149,0)
 ;---> if the User is a provider, then load User as default Provider.
"RTN","BIUTL7",150,0)
 I '$G(BI("K")),$$DEFPROV^BIUTL6($G(DUZ(2))) D
"RTN","BIUTL7",151,0)
 .I $D(^XUSEC("PROVIDER",DUZ)) D
"RTN","BIUTL7",152,0)
 ..;
"RTN","BIUTL7",153,0)
 ..;---> Same as NOPROV (see below).
"RTN","BIUTL7",154,0)
 ..Q:('$G(BI("K"))&($G(BI("I"))="E"))
"RTN","BIUTL7",155,0)
 ..;
"RTN","BIUTL7",156,0)
 ..;---> To set default provider into local BI array, even if the
"RTN","BIUTL7",157,0)
 ..;---> user doesn't <return> past the provider field on the screen.
"RTN","BIUTL7",158,0)
 ..D PUT^DDSVALF(9,,,$G(DUZ),"I") S BI("R")=$G(DUZ)
"RTN","BIUTL7",159,0)
 ;
"RTN","BIUTL7",160,0)
 Q
"RTN","BIUTL7",161,0)
 ;
"RTN","BIUTL7",162,0)
 ;
"RTN","BIUTL7",163,0)
 ;----------
"RTN","BIUTL7",164,0)
NOPROV(X) ;EP
"RTN","BIUTL7",165,0)
 ;---> Called by Post Action field of Field 11 on BI FORM-IMM VISIT ADD/EDIT
"RTN","BIUTL7",166,0)
 ;---> and BI FORM-SKIN VISIT ADD/EDIT.
"RTN","BIUTL7",167,0)
 ;---> If adding a new immunization and user changes Category to
"RTN","BIUTL7",168,0)
 ;---> "E" (Hist Event), then remove default user/provider from Field 9.
"RTN","BIUTL7",169,0)
 ;---> Parameters:
"RTN","BIUTL7",170,0)
 ;     1 - X  Value of Field 11, Category (A, E or I).
"RTN","BIUTL7",171,0)
 I X="E" I '$G(BI("K")) D PUT^DDSVALF(9,,,"") S BI("R")=""
"RTN","BIUTL7",172,0)
 Q
"RTN","BIUTL7",173,0)
 ;
"RTN","BIUTL7",174,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL7",175,0)
 ;---> Next 4 calls moved to BIUTL9 for space (<15000k).
"RTN","BIUTL7",176,0)
 ;
"RTN","BIUTL7",177,0)
 ;----------
"RTN","BIUTL7",178,0)
REASCHK ;EP
"RTN","BIUTL7",179,0)
 ;---> See BIUTL9.
"RTN","BIUTL7",180,0)
 D REASCHK^BIUTL9
"RTN","BIUTL7",181,0)
 Q
"RTN","BIUTL7",182,0)
 ;
"RTN","BIUTL7",183,0)
 ;
"RTN","BIUTL7",184,0)
 ;----------
"RTN","BIUTL7",185,0)
READCHK ;EP
"RTN","BIUTL7",186,0)
 ;---> See BIUTL9.
"RTN","BIUTL7",187,0)
 D READCHK^BIUTL9
"RTN","BIUTL7",188,0)
 Q
"RTN","BIUTL7",189,0)
 ;
"RTN","BIUTL7",190,0)
 ;
"RTN","BIUTL7",191,0)
 ;----------
"RTN","BIUTL7",192,0)
READCH6 ;EP
"RTN","BIUTL7",193,0)
 ;---> See BIUTL9.
"RTN","BIUTL7",194,0)
 D READCH6^BIUTL9
"RTN","BIUTL7",195,0)
 Q
"RTN","BIUTL7",196,0)
 ;
"RTN","BIUTL7",197,0)
 ;
"RTN","BIUTL7",198,0)
 ;----------
"RTN","BIUTL7",199,0)
CREASCHK ;EP
"RTN","BIUTL7",200,0)
 ;---> See BIUTL9.
"RTN","BIUTL7",201,0)
 D CREASCHK^BIUTL9
"RTN","BIUTL7",202,0)
 Q
"RTN","BIUTL7",203,0)
 ;**********
"RTN","BIUTL7",204,0)
 ;
"RTN","BIUTL7",205,0)
 ;
"RTN","BIUTL7",206,0)
 ;----------
"RTN","BIUTL7",207,0)
LOTDAT(X) ;EP
"RTN","BIUTL7",208,0)
 ;---> Called by Post Action field of Field 3 on BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL7",209,0)
 ;---> Display Lot Exp Date and Remaining Balance (if tracked).
"RTN","BIUTL7",210,0)
 ;---> Parameters:
"RTN","BIUTL7",211,0)
 ;     1 - X (req) IEN of Lot Number in ^AUTTIML.
"RTN","BIUTL7",212,0)
 ;
"RTN","BIUTL7",213,0)
 Q:'$G(X)
"RTN","BIUTL7",214,0)
 D PUT^DDSVALF(3.4,,," Exp Date: "_$$LOTEXP^BIRPC3(X,1))
"RTN","BIUTL7",215,0)
 D PUT^DDSVALF(3.5,,,"Remaining: "_$$LOTRBAL^BIRPC3(X))
"RTN","BIUTL7",216,0)
 Q
"RTN","BIUTL7",217,0)
 ;
"RTN","BIUTL7",218,0)
 ;
"RTN","BIUTL7",219,0)
 ;----------
"RTN","BIUTL7",220,0)
LOTWARN(BILIEN,BIVDATE,BILOC) ;EP
"RTN","BIUTL7",221,0)
 ;---> Called by Branching Logic field of Field 3 on BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL7",222,0)
 ;---> Display Lot Exp Date and Remaining Balance (if tracked).
"RTN","BIUTL7",223,0)
 ;---> Parameters:
"RTN","BIUTL7",224,0)
 ;     1 - BILIEN  (req) IEN of Lot Number in ^AUTTIML.
"RTN","BIUTL7",225,0)
 ;     2 - BIVDATE (req) Date of Imm Visit.
"RTN","BIUTL7",226,0)
 ;     3 - BILOC   (req) Location of Encounter.
"RTN","BIUTL7",227,0)
 ;
"RTN","BIUTL7",228,0)
 Q:'$G(BILIEN)  Q:'$D(^AUTTIML(BILIEN,0))
"RTN","BIUTL7",229,0)
 N BIEXP,BILOW S (BIEXP,BILOW)=0
"RTN","BIUTL7",230,0)
 ;
"RTN","BIUTL7",231,0)
 D
"RTN","BIUTL7",232,0)
 .N X S X=$$LOTRBAL^BIRPC3(BILIEN)
"RTN","BIUTL7",233,0)
 .;---> Do not alert if this Lot is not tracked.   vvv83
"RTN","BIUTL7",234,0)
 .Q:(X="Not tracked")
"RTN","BIUTL7",235,0)
 .I X<$$LOTLOW^BIUTL2(BILIEN,BILOC) S BILOW=1
"RTN","BIUTL7",236,0)
 ;
"RTN","BIUTL7",237,0)
 D
"RTN","BIUTL7",238,0)
 .N X S X=$$LOTEXP^BIRPC3(BILIEN,2)
"RTN","BIUTL7",239,0)
 .;---> Do not warn if this Lot has no expiration date.
"RTN","BIUTL7",240,0)
 .Q:('X)
"RTN","BIUTL7",241,0)
 .I BIVDATE>X S BIEXP=1
"RTN","BIUTL7",242,0)
 ;
"RTN","BIUTL7",243,0)
 I (BILOW&BIEXP) S DDSSTACK="BI PAGE-EXPIRED AND LOW" Q
"RTN","BIUTL7",244,0)
 I BILOW S DDSSTACK="BI PAGE-LOW SUPPLY ALERT"
"RTN","BIUTL7",245,0)
 I BIEXP S DDSSTACK="BI PAGE-LOT EXPIRED"
"RTN","BIUTL7",246,0)
 Q
"RTN","BIUTL7",247,0)
 ;
"RTN","BIUTL7",248,0)
 ;
"RTN","BIUTL7",249,0)
 ;----------
"RTN","BIUTL7",250,0)
VSHORT(X) ;EP
"RTN","BIUTL7",251,0)
 ;---> Called by LOADVIS above and by Post Action field of Field 2
"RTN","BIUTL7",252,0)
 ;---> on BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL7",253,0)
 ;---> Display Short Name below Vaccine Name if different.
"RTN","BIUTL7",254,0)
 ;---> Parameters:
"RTN","BIUTL7",255,0)
 ;     1 - X (req) IEN of Vaccine in ^AUTTIMM.
"RTN","BIUTL7",256,0)
 ;
"RTN","BIUTL7",257,0)
 Q:'$G(X)  Q:($$VNAME^BIUTL2(X)=$$VNAME^BIUTL2(X,1))
"RTN","BIUTL7",258,0)
 D PUT^DDSVALF(2.5,,,"("_$$VNAME^BIUTL2(X)_")")
"RTN","BIUTL7",259,0)
 Q
"RTN","BIUTL7",260,0)
 ;
"RTN","BIUTL7",261,0)
 ;
"RTN","BIUTL7",262,0)
 ;----------
"RTN","BIUTL7",263,0)
SAVISIT(BIVTYPE,BI) ;EP
"RTN","BIUTL7",264,0)
 ;---> Called by BIPATVW2 to save data after exiting Screenman Forms
"RTN","BIUTL7",265,0)
 ;---> BI FORM-IMM VISIT ADD/EDIT and BI FORM-SKIN VISIT ADD/EDIT.
"RTN","BIUTL7",266,0)
 ;---> Parameters:
"RTN","BIUTL7",267,0)
 ;     1 - BIVTYPE (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIUTL7",268,0)
 ;     2 - BI      (req) Local array of data elements for this visit.
"RTN","BIUTL7",269,0)
 ;
"RTN","BIUTL7",270,0)
 N BI31 S BI31=$C(31)_$C(31)
"RTN","BIUTL7",271,0)
 ;
"RTN","BIUTL7",272,0)
 ;---> If BIVTYPE does not="I" (Immunization Visit) and it does
"RTN","BIUTL7",273,0)
 ;---> not="S" (Skin Test Visit), then set Error Code and quit.
"RTN","BIUTL7",274,0)
 I ($G(BIVTYPE)'="I")&($G(BIVTYPE)'="S") D ERRCD^BIUTL2(410,,1) Q
"RTN","BIUTL7",275,0)
 ;
"RTN","BIUTL7",276,0)
 N A,B,BIDATA,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,V,W,X,Y,Z,EE,QQ,LL S V="|"
"RTN","BIUTL7",277,0)
 ;
"RTN","BIUTL7",278,0)
 S A=$G(BI("A"))      ;Patient DFN.
"RTN","BIUTL7",279,0)
 S B=$G(BI("B"))      ;Vaccine or Skin Test IEN.
"RTN","BIUTL7",280,0)
 S C=$G(BI("C"))      ;Dose Override.
"RTN","BIUTL7",281,0)
 S D=$G(BI("D"))      ;Lot Number IEN.
"RTN","BIUTL7",282,0)
 S E=$G(BI("E"))      ;Date of Visit.
"RTN","BIUTL7",283,0)
 S F=$G(BI("F"))      ;Location of Encounter IEN.
"RTN","BIUTL7",284,0)
 S G=$G(BI("G"))      ;Other Location of Encounter Text.
"RTN","BIUTL7",285,0)
 S H=$G(BI("H"))      ;NDC Code Pointer.
"RTN","BIUTL7",286,0)
 S I=$G(BI("I"))      ;Catgegory of Visit (A,E,I).
"RTN","BIUTL7",287,0)
 S J=$G(BI("J"))      ;Visit IEN
"RTN","BIUTL7",288,0)
 S K=$G(BI("K"))      ;Old Visit IEN (for edits).
"RTN","BIUTL7",289,0)
 S L=$G(BI("L"))      ;Skin Test Result.
"RTN","BIUTL7",290,0)
 S M=$G(BI("M"))      ;Skin Test Reading (mm).
"RTN","BIUTL7",291,0)
 S N=$G(BI("N"))      ;Skin Test Date Read.
"RTN","BIUTL7",292,0)
 S O=$G(BI("O"))      ;Immunization Reaction
"RTN","BIUTL7",293,0)
 S P=$G(BI("P"))      ;VFC Elilgibility
"RTN","BIUTL7",294,0)
 S Q=$G(BI("Q"))      ;Release/Revision Date of VIS (DD-Mmm-YYYY).
"RTN","BIUTL7",295,0)
 S R=$G(BI("R"))      ;IEN of Provider of Imm/Skin Test.
"RTN","BIUTL7",296,0)
 S S=$G(BI("S"))      ;Dose Override.
"RTN","BIUTL7",297,0)
 S T=$G(BI("T"))      ;Injection Site.
"RTN","BIUTL7",298,0)
 S W=$G(BI("W"))      ;Volume.
"RTN","BIUTL7",299,0)
 S X=$G(BI("X"))      ;IEN of Reader (Provider) of Skin Test.
"RTN","BIUTL7",300,0)
 S Z=$G(BI("Z"))      ;DUZ(2) for Site Parameters.
"RTN","BIUTL7",301,0)
 S Y=$G(BI("Y"))      ;If Y=1, this was a previously imported Imm;
"RTN","BIUTL7",302,0)
 ;                     now it needs to =2 ("Imported (edited)").
"RTN","BIUTL7",303,0)
 ;
"RTN","BIUTL7",304,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL7",305,0)
 ;---> Add Admin Date and VIS Presented Date to data being saved.
"RTN","BIUTL7",306,0)
 S EE=$G(BI("EE"))     ;Admin Date (Date shot admin'd to patient.
"RTN","BIUTL7",307,0)
 S QQ=$G(BI("QQ"))     ;Date VIS Presented to Patient.
"RTN","BIUTL7",308,0)
 ;
"RTN","BIUTL7",309,0)
 ;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BIUTL7",310,0)
 ;---> Add Skin Test Lot Number.
"RTN","BIUTL7",311,0)
 S LL=$G(BI("LL"))
"RTN","BIUTL7",312,0)
 ;
"RTN","BIUTL7",313,0)
 ;---> Check Site IEN for parameters.
"RTN","BIUTL7",314,0)
 S:'$G(Z) Z=$G(DUZ(2))
"RTN","BIUTL7",315,0)
 I '$G(Z) D ERRCD^BIUTL2(105,,1) Q
"RTN","BIUTL7",316,0)
 ;---> Piece:       2   3   4   5   6   7   8   9   10  11
"RTN","BIUTL7",317,0)
 S BIDATA=BIVTYPE_V_A_V_B_V_C_V_D_V_E_V_F_V_G_V_I_V_J_V_K
"RTN","BIUTL7",318,0)
 ;---> NOTE: Y will be pc 25 (not 24) because BIRPC6 feeds CPT Import to pc 24.
"RTN","BIUTL7",319,0)
 ;---> Add pieces 27-29.
"RTN","BIUTL7",320,0)
 ;---> Add piece 30.
"RTN","BIUTL7",321,0)
 ;---> Piece:     12  13  14  15  16  17  18  19  20  21  22  23 24 25  26 27  28   29   30
"RTN","BIUTL7",322,0)
 S BIDATA=BIDATA_V_L_V_M_V_N_V_O_V_P_V_Q_V_R_V_S_V_T_V_W_V_X_V_Z_V_V_Y_V_H_V_V_EE_V_QQ_V_LL
"RTN","BIUTL7",323,0)
 ;
"RTN","BIUTL7",324,0)
 ;**********
"RTN","BIUTL7",325,0)
 ;
"RTN","BIUTL7",326,0)
 ;---> Call RPC to save visit to PCC Files.
"RTN","BIUTL7",327,0)
 D ADDEDIT^BIRPC3(.BIERR,BIDATA)
"RTN","BIUTL7",328,0)
 ;
"RTN","BIUTL7",329,0)
 ;---> If an error is passed back, display it.
"RTN","BIUTL7",330,0)
 S BIERR=$P(BIERR,BI31,2)
"RTN","BIUTL7",331,0)
 D:BIERR]""
"RTN","BIUTL7",332,0)
 .W !!," * ",BIERR,!?3,"NO Changes made! (Visit NOT added/edited.)"
"RTN","BIUTL7",333,0)
 .D DIRZ^BIUTL3()
"RTN","BIUTL7",334,0)
 ;
"RTN","BIUTL7",335,0)
 Q
"RTN","BIUTL7",336,0)
 ;
"RTN","BIUTL7",337,0)
 ;
"RTN","BIUTL7",338,0)
 ;----------
"RTN","BIUTL7",339,0)
SAVCONTR(BI,BIERR) ;EP
"RTN","BIUTL7",340,0)
 ;---> Called by BIPATCO2 to save data after exiting Screenman Form
"RTN","BIUTL7",341,0)
 ;---> BI FORM-CONTRAINDICATION ADD/EDIT.
"RTN","BIUTL7",342,0)
 ;---> Parameters:
"RTN","BIUTL7",343,0)
 ;     1 - BI    (req) Local array of data elements for this contra.
"RTN","BIUTL7",344,0)
 ;     1 - BIERR (ret) Text of Error Code if any, otherwise null.
"RTN","BIUTL7",345,0)
 ;
"RTN","BIUTL7",346,0)
 N BI31 S BI31=$C(31)_$C(31)
"RTN","BIUTL7",347,0)
 N A,B,C,D,N,V S V="|"
"RTN","BIUTL7",348,0)
 ;
"RTN","BIUTL7",349,0)
 S A=$G(BI("A"))      ;Patient DFN.
"RTN","BIUTL7",350,0)
 S B=$G(BI("B"))      ;Vaccine IEN (^AUTTIMM).
"RTN","BIUTL7",351,0)
 S C=$G(BI("C"))      ;Contra Reason IEN (^BICONT).
"RTN","BIUTL7",352,0)
 S D=$G(BI("D"))      ;Date Noted.
"RTN","BIUTL7",353,0)
 S N=$G(BI("N"))      ;If this was an Edit, N=1 (otherwise null/0).
"RTN","BIUTL7",354,0)
 ;
"RTN","BIUTL7",355,0)
 D ADDCONT^BIRPC4(.BIERR,A_V_B_V_C_V_D_V_N)
"RTN","BIUTL7",356,0)
 ;
"RTN","BIUTL7",357,0)
 ;---> If an error is passed back, display it.
"RTN","BIUTL7",358,0)
 S BIERR=$P(BIERR,BI31,2)
"RTN","BIUTL7",359,0)
 D:BIERR]""
"RTN","BIUTL7",360,0)
 .W !!," * ",BIERR,!?3,"Contraindication NOT added!" D DIRZ^BIUTL3()
"RTN","BIUTL7",361,0)
 ;
"RTN","BIUTL7",362,0)
 Q
"RTN","BIUTL7",363,0)
 ;
"RTN","BIUTL7",364,0)
 ;
"RTN","BIUTL7",365,0)
 ;----------
"RTN","BIUTL7",366,0)
LDCONTR ;EP
"RTN","BIUTL7",367,0)
 ;---> Code to load Contraindication data for ScreenMan Edit form.
"RTN","BIUTL7",368,0)
 ;---> Called by Pre Action of Block BI BLK-CONTRAINDICATION ADD
"RTN","BIUTL7",369,0)
 ;---> of Form BI FORM-CONTRAIND ADD/EDIT
"RTN","BIUTL7",370,0)
 ;
"RTN","BIUTL7",371,0)
 ;
"RTN","BIUTL7",372,0)
 Q:'$G(BIDFN)
"RTN","BIUTL7",373,0)
 Q:'$G(BI("N"))
"RTN","BIUTL7",374,0)
 ;
"RTN","BIUTL7",375,0)
 ;---> Load Vaccine Name.
"RTN","BIUTL7",376,0)
 I $G(BI("B"))]"" D PUT^DDSVALF(1,,,BI("B"),"I")
"RTN","BIUTL7",377,0)
 ;
"RTN","BIUTL7",378,0)
 ;---> Make Vaccine Name uneditable.
"RTN","BIUTL7",379,0)
 D UNED^DDSUTL(1,,,1)
"RTN","BIUTL7",380,0)
 ;
"RTN","BIUTL7",381,0)
 ;---> Load Reaspm.
"RTN","BIUTL7",382,0)
 I $G(BI("C"))]"" D PUT^DDSVALF(4,,,BI("C"),"E")
"RTN","BIUTL7",383,0)
 ;
"RTN","BIUTL7",384,0)
 ;---> Load Date.
"RTN","BIUTL7",385,0)
 I $G(BI("D"))]"" D PUT^DDSVALF(5,,,BI("D"),"E")
"RTN","BIUTL7",386,0)
 ;
"RTN","BIUTL7",387,0)
 Q
"RTN","BIUTL7",388,0)
 ;
"RTN","BIUTL7",389,0)
 ;
"RTN","BIUTL7",390,0)
 ;----------
"RTN","BIUTL7",391,0)
LOADCAS ;EP
"RTN","BIUTL7",392,0)
 ;---> Code to load Case Data for a patient for ScreenMan Edit form.
"RTN","BIUTL7",393,0)
 ;---> Called by Pre Action of Block BI BLK-CASE DATE EDIT on
"RTN","BIUTL7",394,0)
 ;---> Form BI FORM-CASE DATA EDIT.
"RTN","BIUTL7",395,0)
 ;
"RTN","BIUTL7",396,0)
 Q:'$G(BIDFN)
"RTN","BIUTL7",397,0)
 ;
"RTN","BIUTL7",398,0)
 ;---> Load Patient's Case Manager or default Case Manager.
"RTN","BIUTL7",399,0)
 D
"RTN","BIUTL7",400,0)
 .I $G(BI("B"))]"" D PUT^DDSVALF(1,,,BI("B"),"E") Q
"RTN","BIUTL7",401,0)
 .Q:'$G(DUZ(2))
"RTN","BIUTL7",402,0)
 .N BIX S BIX=$$CMGRDEF^BIUTL2(DUZ(2))
"RTN","BIUTL7",403,0)
 .D:BIX PUT^DDSVALF(1,,,BIX,"I")
"RTN","BIUTL7",404,0)
 ;
"RTN","BIUTL7",405,0)
 ;---> Load Parent/Guardian.
"RTN","BIUTL7",406,0)
 I $G(BI("C"))]"" D PUT^DDSVALF(2,,,BI("C"),"E")
"RTN","BIUTL7",407,0)
 ;
"RTN","BIUTL7",408,0)
 ;---> Load Mother's HBsAG Status.
"RTN","BIUTL7",409,0)
 I $G(BI("D"))]"" D PUT^DDSVALF(7,,,BI("D"),"I")
"RTN","BIUTL7",410,0)
 ;
"RTN","BIUTL7",411,0)
 ;---> Load Date Patient became Inactive.
"RTN","BIUTL7",412,0)
 I $G(BI("E"))]"" D PUT^DDSVALF(4,,,BI("E"),"E")
"RTN","BIUTL7",413,0)
 ;
"RTN","BIUTL7",414,0)
 ;---> Load Reason for Inactive.
"RTN","BIUTL7",415,0)
 I $G(BI("F"))]"" D PUT^DDSVALF(5,,,BI("F"),"I")
"RTN","BIUTL7",416,0)
 ;
"RTN","BIUTL7",417,0)
 ;---> Load Other Info.
"RTN","BIUTL7",418,0)
 I $G(BI("G"))]"" D PUT^DDSVALF(3,,,BI("G"),"E")
"RTN","BIUTL7",419,0)
 ;
"RTN","BIUTL7",420,0)
 ;---> Load Forecast Influ/Pneumo.
"RTN","BIUTL7",421,0)
 I $G(BI("H"))]"" D PUT^DDSVALF(6,,,BI("H"),"I")
"RTN","BIUTL7",422,0)
 ;
"RTN","BIUTL7",423,0)
 ;---> Load Moved to/Tx Elsewhere.
"RTN","BIUTL7",424,0)
 I $G(BI("I"))]"" D PUT^DDSVALF(5.5,,,BI("I"),"E")
"RTN","BIUTL7",425,0)
 ;
"RTN","BIUTL7",426,0)
 ;---> Load Consent State Registry.
"RTN","BIUTL7",427,0)
 I $G(BI("K"))]"" D PUT^DDSVALF(8,,,BI("K"),"E")
"RTN","BIUTL7",428,0)
 Q
"RTN","BIUTL7",429,0)
 ;
"RTN","BIUTL7",430,0)
 ;
"RTN","BIUTL7",431,0)
 ;----------
"RTN","BIUTL7",432,0)
SAVCAS ;EP
"RTN","BIUTL7",433,0)
 ;---> Code to save Case Data exiting from Screenman.
"RTN","BIUTL7",434,0)
 ;---> Called by Post Save Action of Form BI FORM-CASE DATA EDIT.
"RTN","BIUTL7",435,0)
 ;
"RTN","BIUTL7",436,0)
 N BI31 S BI31=$C(31)_$C(31)
"RTN","BIUTL7",437,0)
 N A,B,C,D,DATA,E,F,G,H,I,J,K,U S U="^"
"RTN","BIUTL7",438,0)
 ;
"RTN","BIUTL7",439,0)
 S A=$G(BI("A"))      ;Patient DFN.
"RTN","BIUTL7",440,0)
 S B=$G(BI("B"))      ;Case Manager's name, text.
"RTN","BIUTL7",441,0)
 S C=$G(BI("C"))      ;Parent or Guardian, text.
"RTN","BIUTL7",442,0)
 S D=$G(BI("D"))      ;Mother's HBsAG Status (P,N,A,U).
"RTN","BIUTL7",443,0)
 S E=$G(BI("E"))      ;Date Pat became Inactive (ext format).
"RTN","BIUTL7",444,0)
 S F=$G(BI("F"))      ;Reason for Inactive.
"RTN","BIUTL7",445,0)
 S G=$G(BI("G"))      ;Other Info.
"RTN","BIUTL7",446,0)
 S H=$G(BI("H"))      ;Forecast Influ/Pneumo.
"RTN","BIUTL7",447,0)
 S I=$G(BI("I"))      ;Location Moved or Tx Elsewhere.
"RTN","BIUTL7",448,0)
 S K=$G(BI("K"))      ;State Registry Consent.
"RTN","BIUTL7",449,0)
 ;
"RTN","BIUTL7",450,0)
 I E]"" S J=$G(DUZ)   ;IEN of User who Inactivated this patient.
"RTN","BIUTL7",451,0)
 ;
"RTN","BIUTL7",452,0)
 S DATA=A_U_B_U_C_U_D_U_E_U_F_U_G_U_H_U_I_U_$G(J)_U_K
"RTN","BIUTL7",453,0)
 ;
"RTN","BIUTL7",454,0)
 ;---> Store edits to database.
"RTN","BIUTL7",455,0)
 D EDITCAS^BIRPC4(.BIERR,DATA)
"RTN","BIUTL7",456,0)
 ;
"RTN","BIUTL7",457,0)
 ;---> If an error is passed back, display it.
"RTN","BIUTL7",458,0)
 S BIERR=$P(BIERR,BI31,2)
"RTN","BIUTL7",459,0)
 D:BIERR]""
"RTN","BIUTL7",460,0)
 .W !!," * ",BIERR,!?3,"Edits to Patient Case Data not saved!"
"RTN","BIUTL7",461,0)
 .D DIRZ^BIUTL3()
"RTN","BIUTL7",462,0)
 ;
"RTN","BIUTL7",463,0)
 Q
"RTN","BIUTL8")
0^12^B65993934
"RTN","BIUTL8",1,0)
BIUTL8 ;IHS/CMI/MWR - UTIL: PATLKUP, PRTLST, ZGBL; MAY 10, 2010
"RTN","BIUTL8",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BIUTL8",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIUTL8",4,0)
 ;;  UTILITY: PATIENT LOOKUP, DUPTEST, PRINT LIST, K/ZGBL, KILLALL.
"RTN","BIUTL8",5,0)
 ;;           HFSPATH, IMMSVDIR.
"RTN","BIUTL8",6,0)
 ;;  PATCH 2: Correct 19yrs and older logic.  VFCSET+7
"RTN","BIUTL8",7,0)
 ;;  PATCH 3: Display Elig Code Local Text.  ELIGLAB+0
"RTN","BIUTL8",8,0)
 ;;  PATCH 8: Problem Dose changes to accommodate new forecaster.  PDSS+11
"RTN","BIUTL8",9,0)
 ;;  PATCH 9: Fix so that TAB key will not skip Eligibility.  ELIGLAB+10
"RTN","BIUTL8",10,0)
 ;;           Return the IP Address used for the TCH Forecaster.  IPTCH
"RTN","BIUTL8",11,0)
 ;;           Add default of V01 (Ineligible) for patients 19 and over.  VFCSET+14
"RTN","BIUTL8",12,0)
 ;;  PATCH 10: Screen code for PPD Lot Number in Lot Number File.  LOTSCRS+0
"RTN","BIUTL8",13,0)
 ;
"RTN","BIUTL8",14,0)
 ;
"RTN","BIUTL8",15,0)
 ;----------
"RTN","BIUTL8",16,0)
PATLKUP(BIDFN,BIADD,DUZ2,BIPOP) ;EP
"RTN","BIUTL8",17,0)
 ;---> BI Patient Lookup.
"RTN","BIUTL8",18,0)
 ;---> Parameters:
"RTN","BIUTL8",19,0)
 ;     1 - BIDFN       (ret) Patient DFN or -1 if failed.
"RTN","BIUTL8",20,0)
 ;     2 - BIADD       (opt) ="ADD" If ADD capability during lookup.
"RTN","BIUTL8",21,0)
 ;     3 - DUZ2=DUZ(2) (opt) If not set, will=User's DUZ(2).
"RTN","BIUTL8",22,0)
 ;     4 - BIPOP       (ret) BIPOP=1 If DTOUT or DUOUT.
"RTN","BIUTL8",23,0)
 ;
"RTN","BIUTL8",24,0)
 ;---> Example: D PATLKUP^BIUTL8(.BIDFN)
"RTN","BIUTL8",25,0)
 ;              D PATLKUP^BIUTL8(.BIDFN,"ADD") - May ADD Patient to IMM
"RTN","BIUTL8",26,0)
 ;
"RTN","BIUTL8",27,0)
 N DFN,DIC,X,Y
"RTN","BIUTL8",28,0)
 S (BIDFN,BIPOP)=0 D SETVARS^BIUTL5
"RTN","BIUTL8",29,0)
 S:$G(DUZ2)]"" DUZ(2)=DUZ2
"RTN","BIUTL8",30,0)
 S DIC="^AUPNPAT(",DIC(0)="AEMQ"
"RTN","BIUTL8",31,0)
 S DIC("A")="   Select Patient Name or Chart#: "
"RTN","BIUTL8",32,0)
 D ^DIC
"RTN","BIUTL8",33,0)
 I $D(DUOUT)!($D(DTOUT)) S BIPOP=1 Q
"RTN","BIUTL8",34,0)
 S BIDFN=+Y
"RTN","BIUTL8",35,0)
 ;---> Lookup unsuccessful or aborted.
"RTN","BIUTL8",36,0)
 Q:Y<0
"RTN","BIUTL8",37,0)
 ;
"RTN","BIUTL8",38,0)
 ;---> If Patient does not exist in BI PATIENT File, add.
"RTN","BIUTL8",39,0)
 I '$D(^BIP(BIDFN,0)) D  Q
"RTN","BIUTL8",40,0)
 .;
"RTN","BIUTL8",41,0)
 .;---> If patient is deceased, add as Inactive, Deceased, and quit.
"RTN","BIUTL8",42,0)
 .I $$DECEASED^BIUTL1(BIDFN) D ADDPAT^BIPATE(BIDFN,DUZ(2),,$G(DT),"d") Q
"RTN","BIUTL8",43,0)
 .N BIERR
"RTN","BIUTL8",44,0)
 .;
"RTN","BIUTL8",45,0)
 .;---> If patient is over 18, or if user does not have BIZ EDIT PATIENTS Key,
"RTN","BIUTL8",46,0)
 .;---> then add as Inactive, "Never Activated," and quit.
"RTN","BIUTL8",47,0)
 .I ($$AGE^BIUTL1(BIDFN,1)>18)!($G(BIADD)'="ADD") D  Q
"RTN","BIUTL8",48,0)
 ..D ADDPAT^BIPATE(BIDFN,DUZ(2),.BIERR,$G(DT),"n")
"RTN","BIUTL8",49,0)
 ..I $G(BIERR)]"" W !!?3,BIERR D DIRZ^BIUTL3() S BIPOP=1
"RTN","BIUTL8",50,0)
 .;
"RTN","BIUTL8",51,0)
 .;---> User may edit.
"RTN","BIUTL8",52,0)
 .W !!?3,$$NAME^BIUTL1(BIDFN)
"RTN","BIUTL8",53,0)
 .W " is being added to the Immunization Database",!,"for the first time."
"RTN","BIUTL8",54,0)
 .W !!?3,"Should this patient be added as Active or Inactive?"
"RTN","BIUTL8",55,0)
 .N DIR
"RTN","BIUTL8",56,0)
 .S DIR("?")="     Enter A for Active or I for Inactive."
"RTN","BIUTL8",57,0)
 .S DIR(0)="SM^A:Active;I:Inactive"
"RTN","BIUTL8",58,0)
 .S DIR("A")="   Enter A (Active) or I (Inactive)"
"RTN","BIUTL8",59,0)
 .S DIR("B")="A"
"RTN","BIUTL8",60,0)
 .;S DIR("B")=$S($$AGE^BIUTL1(BIDFN,1)<19:"A",1:"I")
"RTN","BIUTL8",61,0)
 .D ^DIR W !
"RTN","BIUTL8",62,0)
 .I $D(DIRUT) S BIPOP=1 Q
"RTN","BIUTL8",63,0)
 .N BINACT S BINACT=$S(Y="I":$G(DT),1:"")
"RTN","BIUTL8",64,0)
 .N BINACTR S BINACTR=$S(BINACT:"n",1:"")
"RTN","BIUTL8",65,0)
 .D ADDPAT^BIPATE(BIDFN,DUZ(2),.BIERR,BINACT,BINACTR)
"RTN","BIUTL8",66,0)
 .I $G(BIERR)]"" W !!?3,BIERR D DIRZ^BIUTL3() S BIPOP=1
"RTN","BIUTL8",67,0)
 ;
"RTN","BIUTL8",68,0)
 ;
"RTN","BIUTL8",69,0)
 ;---> If this Patient is already in the Imm Database and <36 months
"RTN","BIUTL8",70,0)
 ;---> but is Inactive, query.
"RTN","BIUTL8",71,0)
 Q:$$AGE^BIUTL1(BIDFN,2,$G(DT))>35
"RTN","BIUTL8",72,0)
 ;Q:'$$INACT^BIUTL1(BIDFN)   ;vvv83
"RTN","BIUTL8",73,0)
 Q:($$INACT^BIUTL1(BIDFN)="")
"RTN","BIUTL8",74,0)
 Q:($G(BIADD)'="ADD")
"RTN","BIUTL8",75,0)
 ;
"RTN","BIUTL8",76,0)
 W !!?3,"This patient is less than 36 months old and ",$$SEX^BIUTL1(BIDFN,3)
"RTN","BIUTL8",77,0)
 W !?3,"Immunization Status is INACTIVE."
"RTN","BIUTL8",78,0)
 W !!?3,"Should this patient's Status be changed to ACTIVE?",!
"RTN","BIUTL8",79,0)
 N DIR
"RTN","BIUTL8",80,0)
 S DIR(0)="YA",DIR("A")="   Enter Yes or No: "
"RTN","BIUTL8",81,0)
 S DIR("?",1)="     Enter YES to change this patient's Status to Active."
"RTN","BIUTL8",82,0)
 S DIR("?")="     Enter No to leave it Inactive."
"RTN","BIUTL8",83,0)
 D ^DIR W !
"RTN","BIUTL8",84,0)
 D:Y=1
"RTN","BIUTL8",85,0)
 .N BIFLD,BIERR S BIFLD(.08)="",BIFLD(.16)=""
"RTN","BIUTL8",86,0)
 .D FDIE^BIFMAN(9002084,BIDFN,.BIFLD,.BIERR,1)
"RTN","BIUTL8",87,0)
 .I $G(BIERR)]"" W !!?3,BIERR D DIRZ^BIUTL3() S BIPOP=1
"RTN","BIUTL8",88,0)
 Q
"RTN","BIUTL8",89,0)
 ;
"RTN","BIUTL8",90,0)
 ;
"RTN","BIUTL8",91,0)
 ;----------
"RTN","BIUTL8",92,0)
VFCSET ;EP
"RTN","BIUTL8",93,0)
 ;---> Load Vaccine Eligibility.  Called by LOADVIS^BIUTL7.
"RTN","BIUTL8",94,0)
 ;---> If Patient Ben Type is 01 (Am Indian/AK Native), set VFC default=4.
"RTN","BIUTL8",95,0)
 ;
"RTN","BIUTL8",96,0)
 Q:$G(BI("P"))]""
"RTN","BIUTL8",97,0)
 Q:'$G(BIDFN)
"RTN","BIUTL8",98,0)
 Q:$$BENTYP^BIUTL11(BIDFN,2)'="01"
"RTN","BIUTL8",99,0)
 ;
"RTN","BIUTL8",100,0)
 ;********** PATCH 2, v8.5, MAY 15,2012, IHS/CMI/MWR
"RTN","BIUTL8",101,0)
 ;--->Correct 19yrs and older logic.
"RTN","BIUTL8",102,0)
 N BIDATE,X,Y S X=$P($G(BI("E"))," ")
"RTN","BIUTL8",103,0)
 D ^%DT S BIDATE=Y
"RTN","BIUTL8",104,0)
 Q:'BIDATE
"RTN","BIUTL8",105,0)
 ;
"RTN","BIUTL8",106,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL8",107,0)
 ;---> Add default of V01 (Ineligible) for patients 19 and over.
"RTN","BIUTL8",108,0)
 ;
"RTN","BIUTL8",109,0)
 ;--> If patient was less than 19yrs set default=V01 and quit.
"RTN","BIUTL8",110,0)
 ;Q:($$AGE^BIUTL1(BIDFN,1,BIDATE)>18)
"RTN","BIUTL8",111,0)
 I ($$AGE^BIUTL1(BIDFN,1,BIDATE)<19) S BI("P")=4 Q
"RTN","BIUTL8",112,0)
 ;---> Otherwise patient is adult, set default="V01".
"RTN","BIUTL8",113,0)
 S BI("P")=1
"RTN","BIUTL8",114,0)
 ;
"RTN","BIUTL8",115,0)
 ;********** 9/2012: CHANGE HERE TO MAKE DEFAULT CONDITIONAL UPON ACTIVE STATUS.
"RTN","BIUTL8",116,0)
 Q
"RTN","BIUTL8",117,0)
 ;
"RTN","BIUTL8",118,0)
 ;
"RTN","BIUTL8",119,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIUTL8",120,0)
 ;---> Display Elig Code Label Text.
"RTN","BIUTL8",121,0)
 ;----------
"RTN","BIUTL8",122,0)
ELIGLAB(X) ;EP
"RTN","BIUTL8",123,0)
 ;---> Called by Post Action field of Field 10.5 on BI FORM-IMM VISIT ADD/EDIT.
"RTN","BIUTL8",124,0)
 ;---> Display Elibigility Code Local Text besind Elig Code.
"RTN","BIUTL8",125,0)
 ;---> Parameters:
"RTN","BIUTL8",126,0)
 ;     1 - X (req) IEN of Elig Code in ^BIELIG.
"RTN","BIUTL8",127,0)
 ;
"RTN","BIUTL8",128,0)
 Q:'$G(X)
"RTN","BIUTL8",129,0)
 N Y S Y=$G(^BIELIG(+X,0))
"RTN","BIUTL8",130,0)
 Q:(Y="")
"RTN","BIUTL8",131,0)
 ;
"RTN","BIUTL8",132,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL8",133,0)
 ;---> Fix so that TAB key will not skip Eligibility.
"RTN","BIUTL8",134,0)
 ;D PUT^DDSVALF(10.6,,,$P(Y,U)_" - "_$P(Y,U,4))
"RTN","BIUTL8",135,0)
 D PUT^DDSVALF(10.6,,," - "_$P(Y,U,4))
"RTN","BIUTL8",136,0)
 Q
"RTN","BIUTL8",137,0)
 ;**********
"RTN","BIUTL8",138,0)
 ;
"RTN","BIUTL8",139,0)
 ;----------
"RTN","BIUTL8",140,0)
DUPTEST(BIERR,BIDATA,BIOIEN) ;EP
"RTN","BIUTL8",141,0)
 ;---> Test to be sure a duplicate Immunization  or Skin Test
"RTN","BIUTL8",142,0)
 ;---> is not being added.
"RTN","BIUTL8",143,0)
 ;---> Parameters:
"RTN","BIUTL8",144,0)
 ;     1 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIUTL8",145,0)
 ;     2 - BIDATA (req) String of data for the Visit to be added.
"RTN","BIUTL8",146,0)
 ;     3 - BIOIEN (opt) IEN of V IMM or V SKIN being edited (if
"RTN","BIUTL8",147,0)
 ;                      not new).
"RTN","BIUTL8",148,0)
 ;
"RTN","BIUTL8",149,0)
 ;---> Pieces of BIDATA:
"RTN","BIUTL8",150,0)
 ;     -----------------
"RTN","BIUTL8",151,0)
 ;     1 - A  (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIUTL8",152,0)
 ;     2 - B  (req) DFN of patient.
"RTN","BIUTL8",153,0)
 ;     3 - C  (req) Vaccine or Skin Test .01 pointer.
"RTN","BIUTL8",154,0)
 ;     6 - D  (req) Date of Visit.
"RTN","BIUTL8",155,0)
 ;
"RTN","BIUTL8",156,0)
 N A,B,BI31,C,D,V,X S BI31=$C(31)_$C(31),V="|",X=""
"RTN","BIUTL8",157,0)
 S A=$P(BIDATA,V,1)
"RTN","BIUTL8",158,0)
 S B=$P(BIDATA,V,2) Q:'B
"RTN","BIUTL8",159,0)
 S C=$P(BIDATA,V,3) Q:'C
"RTN","BIUTL8",160,0)
 S D=9999999-$P($P(BIDATA,V,6),".") Q:'D
"RTN","BIUTL8",161,0)
 ;
"RTN","BIUTL8",162,0)
 ;---> Check for duplicate visit.
"RTN","BIUTL8",163,0)
 D
"RTN","BIUTL8",164,0)
 .;---> If this is a new Immunization or Skin Test,
"RTN","BIUTL8",165,0)
 .;---> and there exists a duplicate, report the error.
"RTN","BIUTL8",166,0)
 .I '$G(BIOIEN),A="I",$D(^AUPNVIMM("AA",B,C,D)) S X=423 Q
"RTN","BIUTL8",167,0)
 .I '$G(BIOIEN),A="S",$D(^AUPNVSK("AA",B,C,D)) S X=424 Q
"RTN","BIUTL8",168,0)
 .;
"RTN","BIUTL8",169,0)
 .;---> If the existing xref is not that of the edited visit,
"RTN","BIUTL8",170,0)
 .;---> and there exists a duplicate, report the error.
"RTN","BIUTL8",171,0)
 .;---> For an Immunization.
"RTN","BIUTL8",172,0)
 .I A="I" D  Q
"RTN","BIUTL8",173,0)
 ..N N S N=0
"RTN","BIUTL8",174,0)
 ..F  S N=$O(^AUPNVIMM("AA",B,C,D,N)) Q:'N  I N,N'=BIOIEN S X=423
"RTN","BIUTL8",175,0)
 .;
"RTN","BIUTL8",176,0)
 .;---> For a Skin Test.
"RTN","BIUTL8",177,0)
 .I A="S" D  Q
"RTN","BIUTL8",178,0)
 ..N N S N=0
"RTN","BIUTL8",179,0)
 ..F  S N=$O(^AUPNVSK("AA",B,C,D,N)) Q:'N  I N,N'=BIOIEN S X=424
"RTN","BIUTL8",180,0)
 ;
"RTN","BIUTL8",181,0)
 I X D ERRCD^BIUTL2(X,.BIERR) S BIERR=BI31_BIERR
"RTN","BIUTL8",182,0)
 Q
"RTN","BIUTL8",183,0)
 ;
"RTN","BIUTL8",184,0)
 ;
"RTN","BIUTL8",185,0)
 ;----------
"RTN","BIUTL8",186,0)
PRTLST(BITNOD) ;EP
"RTN","BIUTL8",187,0)
 ;---> Print Listman list instead of displaying it.
"RTN","BIUTL8",188,0)
 ;---> Parameters:
"RTN","BIUTL8",189,0)
 ;     1 - BITNOD (req) Node in ^TMP global where list is stored.
"RTN","BIUTL8",190,0)
 ;
"RTN","BIUTL8",191,0)
 ;---> Variables:
"RTN","BIUTL8",192,0)
 ;     1 - VALMHDR (req) Array containing header code.
"RTN","BIUTL8",193,0)
 ;
"RTN","BIUTL8",194,0)
 N BICRT S BICRT=$S(($E(IOST)="C")!(IOST["BROWSER"):1,1:0)
"RTN","BIUTL8",195,0)
 N BIPAGE,BIPOP S BIPAGE=0,BIPOP=0
"RTN","BIUTL8",196,0)
 N BI31 S BI31=$C(31)_$C(31)
"RTN","BIUTL8",197,0)
 U IO
"RTN","BIUTL8",198,0)
 ;---> To eliminate control chars from printouts.
"RTN","BIUTL8",199,0)
 I BICRT D FULL^VALM1 W @IOF
"RTN","BIUTL8",200,0)
 D PHEADER(.BIPAGE)
"RTN","BIUTL8",201,0)
 ;
"RTN","BIUTL8",202,0)
 ;---> Loop through ^TMP, writing lines of report.
"RTN","BIUTL8",203,0)
 N N S N=0
"RTN","BIUTL8",204,0)
 F  S N=$O(^TMP(BITNOD,$J,N)) Q:'N  D  Q:BIPOP
"RTN","BIUTL8",205,0)
 .N BITEXT S BITEXT=^TMP(BITNOD,$J,N,0)
"RTN","BIUTL8",206,0)
 .;---> Set BIN=number of lines in this record (=number of $C(30)'s).
"RTN","BIUTL8",207,0)
 .N BIN S BIN=$P(BITEXT,BI31,2)
"RTN","BIUTL8",208,0)
 .S BIN=$L(BIN,$C(30))-1
"RTN","BIUTL8",209,0)
 .;
"RTN","BIUTL8",210,0)
 .;---> If this is not the very first line, and if this record
"RTN","BIUTL8",211,0)
 .;---> won't fit on the bottom of this page, do formfeed and header.
"RTN","BIUTL8",212,0)
 .I N>1 I $Y+BIN+3>IOSL D  Q:BIPOP  W @IOF D PHEADER(.BIPAGE)
"RTN","BIUTL8",213,0)
 ..D:BICRT DIRZ^BIUTL3(.BIPOP)
"RTN","BIUTL8",214,0)
 .;
"RTN","BIUTL8",215,0)
 .W !,$P(BITEXT,BI31)
"RTN","BIUTL8",216,0)
 ;
"RTN","BIUTL8",217,0)
 W:'BICRT @IOF D:(BICRT&('BIPOP)) DIRZ^BIUTL3()
"RTN","BIUTL8",218,0)
 D ^%ZISC
"RTN","BIUTL8",219,0)
 Q
"RTN","BIUTL8",220,0)
 ;
"RTN","BIUTL8",221,0)
 ;
"RTN","BIUTL8",222,0)
 ;----------
"RTN","BIUTL8",223,0)
PHEADER(BIPAGE) ;EP
"RTN","BIUTL8",224,0)
 ;---> Print header for PRTLST above.
"RTN","BIUTL8",225,0)
 ;---> Parameters:
"RTN","BIUTL8",226,0)
 ;     1 - BIPAGE (req) Last page# printed.
"RTN","BIUTL8",227,0)
 ;
"RTN","BIUTL8",228,0)
 S:'$G(BIPAGE) BIPAGE=0 S BIPAGE=BIPAGE+1
"RTN","BIUTL8",229,0)
 N N S N=0
"RTN","BIUTL8",230,0)
 F  S N=$O(VALMHDR(N)) Q:'N  D
"RTN","BIUTL8",231,0)
 .;---> If this is line 2 of the header, append page#.
"RTN","BIUTL8",232,0)
 .I N=2 S $E(VALMHDR(2),70,79)=" page "_BIPAGE
"RTN","BIUTL8",233,0)
 .W !,VALMHDR(N)
"RTN","BIUTL8",234,0)
 W !,$$SP^BIUTL5(79,"=")
"RTN","BIUTL8",235,0)
 Q
"RTN","BIUTL8",236,0)
 ;
"RTN","BIUTL8",237,0)
 ;
"RTN","BIUTL8",238,0)
 ;----------
"RTN","BIUTL8",239,0)
KGBL(BIGBL) ;EP
"RTN","BIUTL8",240,0)
 ;---> Kill a global.  Global should include leading "^".
"RTN","BIUTL8",241,0)
 ;---> Parameters:
"RTN","BIUTL8",242,0)
 ;     1 - BIGBL  (req) Global to be zeroed out (must include "^").
"RTN","BIUTL8",243,0)
 ;
"RTN","BIUTL8",244,0)
 S:BIGBL["(" BIGBL=$P(BIGBL,"(")
"RTN","BIUTL8",245,0)
 F  S BIGBL=$Q(@BIGBL) Q:BIGBL=""  K @BIGBL
"RTN","BIUTL8",246,0)
 Q
"RTN","BIUTL8",247,0)
 ;
"RTN","BIUTL8",248,0)
 ;
"RTN","BIUTL8",249,0)
 ;----------
"RTN","BIUTL8",250,0)
ZGBL(BIGBL) ;EP
"RTN","BIUTL8",251,0)
 ;---> Zero out (delete ALL DATA) in a Fileman file.
"RTN","BIUTL8",252,0)
 ;---> Parameters:
"RTN","BIUTL8",253,0)
 ;     1 - BIGBL  (req) Global to be zeroed out.
"RTN","BIUTL8",254,0)
 ;
"RTN","BIUTL8",255,0)
 Q:$G(BIGBL)=""
"RTN","BIUTL8",256,0)
 N N,X S U="^"
"RTN","BIUTL8",257,0)
 S:$E(BIGBL)'=U BIGBL=U_BIGBL
"RTN","BIUTL8",258,0)
 S:BIGBL["(" BIGBL=$P(BIGBL,"(")
"RTN","BIUTL8",259,0)
 Q:'$D(@(BIGBL_"(0)"))
"RTN","BIUTL8",260,0)
 S N=-1,X=$P(@(BIGBL_"(0)"),U,1,2)
"RTN","BIUTL8",261,0)
 F  S N=$O(@(BIGBL_"("""_N_""")")) Q:N=""  K @(BIGBL_"("""_N_""")")
"RTN","BIUTL8",262,0)
 S @(BIGBL_"(0)")=X
"RTN","BIUTL8",263,0)
 Q
"RTN","BIUTL8",264,0)
 ;
"RTN","BIUTL8",265,0)
 ;
"RTN","BIUTL8",266,0)
 ;----------
"RTN","BIUTL8",267,0)
KILLALL(BIGLOBS) ;EP
"RTN","BIUTL8",268,0)
 ;---> Clean up local variables.
"RTN","BIUTL8",269,0)
 ;---> Parameters:
"RTN","BIUTL8",270,0)
 ;     1 - BIGLOBS  (opt) If BIGLOBS=1 kill temp globals too.
"RTN","BIUTL8",271,0)
 ;
"RTN","BIUTL8",272,0)
 ;---> XB call to kill local variables.
"RTN","BIUTL8",273,0)
 D EN^XBVK("BI")
"RTN","BIUTL8",274,0)
 D EN^XBVK("DI")
"RTN","BIUTL8",275,0)
 ;
"RTN","BIUTL8",276,0)
 ;---> FILEMAN KILLS.
"RTN","BIUTL8",277,0)
 D DKILLS^BIFMAN
"RTN","BIUTL8",278,0)
 D CLEAN^DILF
"RTN","BIUTL8",279,0)
 K I,M,N,X,Y,Z,ZTRTN,ZTSAVE
"RTN","BIUTL8",280,0)
 ;
"RTN","BIUTL8",281,0)
 Q:'$G(BIGLOBS)
"RTN","BIUTL8",282,0)
 ;---> Clean up temp globals.
"RTN","BIUTL8",283,0)
 K ^BITMP($J)
"RTN","BIUTL8",284,0)
 ;
"RTN","BIUTL8",285,0)
 Q
"RTN","BIUTL8",286,0)
 ;
"RTN","BIUTL8",287,0)
 ;---> Other ways:
"RTN","BIUTL8",288,0)
 ;---> MSM
"RTN","BIUTL8",289,0)
 ;S X="BI" F  S X=$O(@X) Q:$E(X,1,2)'="BI"  K @X
"RTN","BIUTL8",290,0)
 ;S X="DI" F  S X=$O(@X) Q:$E(X,1,2)'="BI"  K @X
"RTN","BIUTL8",291,0)
 ;---> DSM
"RTN","BIUTL8",292,0)
 ;S X="BI" F  S X=$ZSORT(@X) Q:$E(X,1,2)'="BI"  K @X
"RTN","BIUTL8",293,0)
 ;S X="DI" F  S X=$ZSORT(@X) Q:$E(X,1,2)'="BI"  K @X
"RTN","BIUTL8",294,0)
 Q
"RTN","BIUTL8",295,0)
 ;
"RTN","BIUTL8",296,0)
 ;
"RTN","BIUTL8",297,0)
 ;----------
"RTN","BIUTL8",298,0)
HFSPATH(DUZ2) ;EP
"RTN","BIUTL8",299,0)
 ;---> Return the Host File Path (directory) as set in the
"RTN","BIUTL8",300,0)
 ;---> in the BI SITE PARAMETERS File.
"RTN","BIUTL8",301,0)
 ;---> Parameters:
"RTN","BIUTL8",302,0)
 ;     1 - DUZ2  (opt) User's DUZ(2), otherwise IEN of Site in
"RTN","BIUTL8",303,0)
 ;                     RPMS SITE PARAMETERS File.
"RTN","BIUTL8",304,0)
 ;
"RTN","BIUTL8",305,0)
 S:'$G(DUZ2) DUZ2=$P($G(^AUTTSITE(1,0)),"^")
"RTN","BIUTL8",306,0)
 Q $P($G(^BISITE(+DUZ2,0)),"^",14)
"RTN","BIUTL8",307,0)
 ;
"RTN","BIUTL8",308,0)
 ;
"RTN","BIUTL8",309,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIUTL8",310,0)
 ;---> IP Address for TCH Forecaster.
"RTN","BIUTL8",311,0)
 ;----------
"RTN","BIUTL8",312,0)
IPTCH(DUZ2) ;EP
"RTN","BIUTL8",313,0)
 ;---> Return the IP Address used for the TCH Forecaster
"RTN","BIUTL8",314,0)
 ;---> in the BI SITE PARAMETERS File.
"RTN","BIUTL8",315,0)
 ;---> Parameters:
"RTN","BIUTL8",316,0)
 ;     1 - DUZ2  (opt) User's DUZ(2), otherwise IEN of Site in
"RTN","BIUTL8",317,0)
 ;                     RPMS SITE PARAMETERS File.
"RTN","BIUTL8",318,0)
 ;
"RTN","BIUTL8",319,0)
 S:'$G(DUZ2) DUZ2=$P($G(^AUTTSITE(1,0)),"^")
"RTN","BIUTL8",320,0)
 N BIIP S BIIP=$P($G(^BISITE(+DUZ2,0)),"^",30)
"RTN","BIUTL8",321,0)
 S:'BIIP BIIP="127.0.0.1"
"RTN","BIUTL8",322,0)
 Q BIIP
"RTN","BIUTL8",323,0)
 ;**********
"RTN","BIUTL8",324,0)
 ;
"RTN","BIUTL8",325,0)
 ;----------
"RTN","BIUTL8",326,0)
IMMSVDIR(DUZ2) ;EP
"RTN","BIUTL8",327,0)
 ;---> Return the MSM Home Directory as set in the
"RTN","BIUTL8",328,0)
 ;---> in the BI SITE PARAMETERS File.
"RTN","BIUTL8",329,0)
 ;---> Parameters:
"RTN","BIUTL8",330,0)
 ;     1 - DUZ2  (opt) User's DUZ(2), otherwise IEN of Site in
"RTN","BIUTL8",331,0)
 ;                     RPMS SITE PARAMETERS File.
"RTN","BIUTL8",332,0)
 ;
"RTN","BIUTL8",333,0)
 S:'$G(DUZ2) DUZ2=$P($G(^AUTTSITE(1,0)),"^")
"RTN","BIUTL8",334,0)
 Q $P($G(^BISITE(+DUZ2,0)),"^",18)
"RTN","BIUTL8",335,0)
 ;
"RTN","BIUTL8",336,0)
 ;
"RTN","BIUTL8",337,0)
 ;----------
"RTN","BIUTL8",338,0)
PDSS(BIVIEN,BICOMP,BIPDSS) ;EP
"RTN","BIUTL8",339,0)
 ;---> Return 1 if this V Imm IEN is contained in the ImmServe
"RTN","BIUTL8",340,0)
 ;---> Problem Dose IEN string; return 0 if not.
"RTN","BIUTL8",341,0)
 ;---> Parameters:
"RTN","BIUTL8",342,0)
 ;     1 - BIVIEN (req) Visit IEN of this immunization.
"RTN","BIUTL8",343,0)
 ;     2 - BICOMP (req) Vaccine Component CVX Code.
"RTN","BIUTL8",344,0)
 ;     2 - BIPDSS (req) String of ImmServe Problem Dose IENs.
"RTN","BIUTL8",345,0)
 ;
"RTN","BIUTL8",346,0)
 Q:'$G(BIVIEN) 0
"RTN","BIUTL8",347,0)
 Q:'$G(BICOMP) 0
"RTN","BIUTL8",348,0)
 Q:'$D(BIPDSS) 0
"RTN","BIUTL8",349,0)
 ;********** PATCH 8, v8.5, MAR 15,2014, IHS/CMI/MWR
"RTN","BIUTL8",350,0)
 ;---> Concat leading zero if single digit.
"RTN","BIUTL8",351,0)
 ;I $L(BICOMP)=1 S BICOMP="0"_BICOMP
"RTN","BIUTL8",352,0)
 N I,X,Y,Z S X=0
"RTN","BIUTL8",353,0)
 ;
"RTN","BIUTL8",354,0)
 ;---> Ignore component CVX for now.
"RTN","BIUTL8",355,0)
 S Y=BIVIEN_"%"_BICOMP
"RTN","BIUTL8",356,0)
 F I=1:1 S Z=$P(BIPDSS,U,I) Q:Z=""  I Y=Z S X=1 Q
"RTN","BIUTL8",357,0)
 ;---> Just check for V Imm IEN.
"RTN","BIUTL8",358,0)
 ;F I=1:1 S Z=$P(BIPDSS,U,I) Q:Z=""  I BIVIEN=Z S X=1 Q
"RTN","BIUTL8",359,0)
 ;**********
"RTN","BIUTL8",360,0)
 ;
"RTN","BIUTL8",361,0)
 Q X
"RTN","BIUTL8",362,0)
 ;
"RTN","BIUTL8",363,0)
 ;
"RTN","BIUTL8",364,0)
 ;----------
"RTN","BIUTL8",365,0)
DOVER(X,Z) ;EP
"RTN","BIUTL8",366,0)
 ;---> Return text of Dose Override Code.
"RTN","BIUTL8",367,0)
 ;---> Parameters:
"RTN","BIUTL8",368,0)
 ;     1 - X (req) Code for Dose Override text.
"RTN","BIUTL8",369,0)
 ;     2 - Z (opt) If Z=1 return Short form (remove "INVALID--" from text).
"RTN","BIUTL8",370,0)
 ;
"RTN","BIUTL8",371,0)
 Q:'$G(X) ""
"RTN","BIUTL8",372,0)
 Q:$G(Z) $P($P($P($G(^DD(9000010.11,.08,0)),X_":",2),";"),"--",2)
"RTN","BIUTL8",373,0)
 Q $P($P($G(^DD(9000010.11,.08,0)),X_":",2),";")
"RTN","BIUTL8",374,0)
 ;
"RTN","BIUTL8",375,0)
 ;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BIUTL8",376,0)
 ;---> Screen code for PPD Lot Number in Lot Number File.
"RTN","BIUTL8",377,0)
 ;----------
"RTN","BIUTL8",378,0)
LOTSCRS ;EP
"RTN","BIUTL8",379,0)
 ;---> Set Screen for Lot Number selection in Screen field of
"RTN","BIUTL8",380,0)
 ;---> "Form Only Field Parameters" of the Form BI FORM-SKIN VISIT ADD/EDIT
"RTN","BIUTL8",381,0)
 ;---> when selecting Lot Number.
"RTN","BIUTL8",382,0)
 ;---> Screen: If this Lot Number is Active, AND if the Skin Test selected is
"RTN","BIUTL8",383,0)
 ;--->         PPD, AND if EITHER [it has no specific Location] OR its Facility
"RTN","BIUTL8",384,0)
 ;--->         matches the user's Facility/Location (DUZ(2))].
"RTN","BIUTL8",385,0)
 ;
"RTN","BIUTL8",386,0)
 ;S DIR("S")="I 0"
"RTN","BIUTL8",387,0)
 S DIR("S")="I $P(^"_"(0),U,3)=0,+$G(BI(""B""))=2,$D(^AUTTIML(""C"",203,Y))"
"RTN","BIUTL8",388,0)
 S DIR("S")=DIR("S")_",(('$P($G(^AUTTIML(Y,0)),U,14))!($P($G(^AUTTIML(Y,0)),U,14)=$G(DUZ(2))))"
"RTN","BIUTL8",389,0)
 Q
"RTN","BIUTL8",390,0)
 ;
"RTN","BIUTL8",391,0)
 ;---> Next line: Concat to avoid suspected naked ref.
"RTN","BIUTL8",392,0)
 ;S DIR("S")="I $P(^"_"(0),U,3)=0,($G(BI(""B""))=""""!$D(^AUTTIML(""C"",+$G(BI(""B"")),Y)))"
"RTN","BIUTL8",393,0)
 ;S DIR("S")=DIR("S")_",(('$P($G(^AUTTIML(Y,0)),U,14))!($P($G(^AUTTIML(Y,0)),U,14)=$G(DUZ(2))))"
"RTN","BIUTL8",394,0)
 Q
"RTN","BIUTL8",395,0)
 ;**********
"RTN","BIVISIT")
0^11^B113888353
"RTN","BIVISIT",1,0)
BIVISIT ;IHS/CMI/MWR - ADD/EDIT IMM/SKIN VISITS.; MAY 10, 2010
"RTN","BIVISIT",2,0)
 ;;8.5;IMMUNIZATION;**10**;MAY 30,2015
"RTN","BIVISIT",3,0)
 ;;* MICHAEL REMILLARD, DDS * CIMARRON MEDICAL INFORMATICS, FOR IHS *
"RTN","BIVISIT",4,0)
 ;;  CODE TO ADD V IMMUNIZATION AND V SKIN TEST VISITS.  CALLED BY BIRPC3.
"RTN","BIVISIT",5,0)
 ;;  PATCH 5: Added BINOM parameter to ADDEDIT P.E.P. for Visit Selection Menu. ADDV+0
"RTN","BIVISIT",6,0)
 ;;           Added Admin Note, piece 27.  PARSE+36,+66, ADDV+16, VFILE+13,+184
"RTN","BIVISIT",7,0)
 ;;  PATCH 9: Added save of Admin Date and VIS Presented Date.  VFILE+200
"RTN","BIVISIT",8,0)
 ;;           If >19yrs on date of immunization and Elig="", set Elig-V01.  VFILE+188
"RTN","BIVISIT",9,0)
 ;;  PATCH 10: Added save of Skin Test Lot Number.  VFILE+143
"RTN","BIVISIT",10,0)
 ;
"RTN","BIVISIT",11,0)
 ;
"RTN","BIVISIT",12,0)
 ;----------
"RTN","BIVISIT",13,0)
PARSE(Y,Z) ;EP
"RTN","BIVISIT",14,0)
 ;---> Parse out passed Visit and V File data into local variables.
"RTN","BIVISIT",15,0)
 ;---> Parameters:
"RTN","BIVISIT",16,0)
 ;     1 - Y (req) String of data for the Visit to be added.
"RTN","BIVISIT",17,0)
 ;     2 - Z (opt) If Z=1 do NOT set BIVSIT (call from VFILE below must
"RTN","BIVISIT",18,0)
 ;                 preserve new Visit IEN sent to it).
"RTN","BIVISIT",19,0)
 ;
"RTN","BIVISIT",20,0)
 ;---> Pieces of Y delimited by "|":
"RTN","BIVISIT",21,0)
 ;     -----------------------------
"RTN","BIVISIT",22,0)
 ;     1 - BIVTYPE (req) "I"=Immunization Visit, "S"=Skin Text Visit.
"RTN","BIVISIT",23,0)
 ;     2 - BIDFN   (req) DFN of patient.
"RTN","BIVISIT",24,0)
 ;     3 - BIPTR   (req) Vaccine or Skin Test .01 pointer.
"RTN","BIVISIT",25,0)
 ;     4 - BIDOSE  (opt) Dose# number for this Immunization.
"RTN","BIVISIT",26,0)
 ;     5 - BILOT   (opt) Lot Number IEN for this Immunization.
"RTN","BIVISIT",27,0)
 ;     6 - BIDATE  (req) Date.Time of Visit.
"RTN","BIVISIT",28,0)
 ;     7 - BILOC   (req) Location of encounter IEN.
"RTN","BIVISIT",29,0)
 ;     8 - BIOLOC  (opt) Other Location of encounter.
"RTN","BIVISIT",30,0)
 ;     9 - BICAT   (req) Category: A (Ambul), I (Inpat), E (Event/Hist)
"RTN","BIVISIT",31,0)
 ;    10 - BIVSIT  (opt) Visit IEN.
"RTN","BIVISIT",32,0)
 ;    11 - BIOIEN  (opt) Old V File IEN (for edits).
"RTN","BIVISIT",33,0)
 ;    12 - BIRES   (req) Skin Test Result: P,N,D,O.
"RTN","BIVISIT",34,0)
 ;    13 - BIREA   (req) Skin Test Reading: 0-40.
"RTN","BIVISIT",35,0)
 ;    14 - BIDTR   (req) Skin Test Date Read.
"RTN","BIVISIT",36,0)
 ;    15 - BIREC   (opt) Vaccine Reaction.
"RTN","BIVISIT",37,0)
 ;    16 - BIVFC   (opt) VFC Eligibility.  vvv83
"RTN","BIVISIT",38,0)
 ;    17 - BIVISD  (opt) Release/Revision Date of VIS (YYYMMDD).
"RTN","BIVISIT",39,0)
 ;    18 - BIPROV  (opt) IEN of Provider of Immunization/Skin Test.
"RTN","BIVISIT",40,0)
 ;    19 - BIOVRD  (opt) Dose Override.
"RTN","BIVISIT",41,0)
 ;    20 - BIINJS  (opt) Injection Site.
"RTN","BIVISIT",42,0)
 ;    21 - BIVOL   (opt) Volume.
"RTN","BIVISIT",43,0)
 ;    22 - BIREDR  (opt) IEN of Reader of Skin Test.
"RTN","BIVISIT",44,0)
 ;    23 - BISITE  (opt) Passed DUZ(2) for Site Parameters.
"RTN","BIVISIT",45,0)
 ;    24 - BICCPT  (opt) If created from CPT ^DD BICCPT=1 or IEN; otherwise=""
"RTN","BIVISIT",46,0)
 ;                       (called from BIRPC6
"RTN","BIVISIT",47,0)
 ;    25 - BIMPRT  (opt) If =1 it was imported.
"RTN","BIVISIT",48,0)
 ;    26 - BINDC   (opt) NDC Code IEN pointer to file #9002084.95.
"RTN","BIVISIT",49,0)
 ;    27 - BIANOT  (opt) Administrative Note (<161 chars).
"RTN","BIVISIT",50,0)
 ;
"RTN","BIVISIT",51,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIVISIT",52,0)
 ;---> Add Admin Date and VIS Presented Date to data being saved.
"RTN","BIVISIT",53,0)
 ;    28 - BIADMIN (opt) Admin Date (Date shot admin'd to patient.
"RTN","BIVISIT",54,0)
 ;    29 - BIVPRES (opt) Date VIS Presented to Patient.
"RTN","BIVISIT",55,0)
 ;
"RTN","BIVISIT",56,0)
 ;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI/MWR
"RTN","BIVISIT",57,0)
 ;    30 - BILOTSK (opt) Skin Test Lot Number.
"RTN","BIVISIT",58,0)
 ;
"RTN","BIVISIT",59,0)
 N V S V="|"
"RTN","BIVISIT",60,0)
 ;
"RTN","BIVISIT",61,0)
 S BIVTYPE=$P(Y,V,1)
"RTN","BIVISIT",62,0)
 S BIDFN=$P(Y,V,2)
"RTN","BIVISIT",63,0)
 S BIPTR=$P(Y,V,3)
"RTN","BIVISIT",64,0)
 S BIDOSE=$P(Y,V,4)
"RTN","BIVISIT",65,0)
 S BILOT=$P(Y,V,5)
"RTN","BIVISIT",66,0)
 S BIDATE=$P(Y,V,6) S:$P(BIDATE,".",2)="" BIDATE=BIDATE_".12"
"RTN","BIVISIT",67,0)
 S BILOC=$P(Y,V,7)
"RTN","BIVISIT",68,0)
 S BIOLOC=$P(Y,V,8)
"RTN","BIVISIT",69,0)
 S BICAT=$P(Y,V,9)
"RTN","BIVISIT",70,0)
 S:'$G(Z) BIVSIT=$P(Y,V,10)
"RTN","BIVISIT",71,0)
 S BIOIEN=$P(Y,V,11)
"RTN","BIVISIT",72,0)
 S BIRES=$P(Y,V,12)
"RTN","BIVISIT",73,0)
 S BIREA=$P(Y,V,13)
"RTN","BIVISIT",74,0)
 S BIDTR=$P(Y,V,14) S:BIDTR<1 BIDTR=""
"RTN","BIVISIT",75,0)
 S BIREC=$P(Y,V,15)
"RTN","BIVISIT",76,0)
 S BIVFC=$P(Y,V,16)
"RTN","BIVISIT",77,0)
 S BIVISD=$P(Y,V,17)
"RTN","BIVISIT",78,0)
 S BIPROV=$P(Y,V,18)
"RTN","BIVISIT",79,0)
 S BIOVRD=$P(Y,V,19)
"RTN","BIVISIT",80,0)
 S BIINJS=$P(Y,V,20)
"RTN","BIVISIT",81,0)
 S BIVOL=$P(Y,V,21)
"RTN","BIVISIT",82,0)
 S BIREDR=$P(Y,V,22)
"RTN","BIVISIT",83,0)
 S BISITE=$P(Y,V,23)
"RTN","BIVISIT",84,0)
 S BICCPT=$P(Y,V,24)
"RTN","BIVISIT",85,0)
 S BIMPRT=$P(Y,V,25)
"RTN","BIVISIT",86,0)
 S BINDC=$P(Y,V,26)
"RTN","BIVISIT",87,0)
 S BIANOT=$P(Y,V,27)
"RTN","BIVISIT",88,0)
 S BIADMIN=$P(Y,V,28)
"RTN","BIVISIT",89,0)
 S BIVPRES=$P(Y,V,29)
"RTN","BIVISIT",90,0)
 S BILOTSK=$P(Y,V,30)
"RTN","BIVISIT",91,0)
 ;**********
"RTN","BIVISIT",92,0)
 Q
"RTN","BIVISIT",93,0)
 ;
"RTN","BIVISIT",94,0)
 ;
"RTN","BIVISIT",95,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIVISIT",96,0)
 ;---> Added BINOM parameter to control Visit Menu display.
"RTN","BIVISIT",97,0)
 ;----------
"RTN","BIVISIT",98,0)
ADDV(BIERR,BIDATA,BIOIEN,BINOM) ;EP
"RTN","BIVISIT",99,0)
 ;---> Add a Visit (if necessary) and V FILE entry for this patient.
"RTN","BIVISIT",100,0)
 ;---> Called exclusively by ^BIRPC3.
"RTN","BIVISIT",101,0)
 ;---> Parameters:
"RTN","BIVISIT",102,0)
 ;     1 - BIERR  (ret) 1^Text of Error Code if any, otherwise null.
"RTN","BIVISIT",103,0)
 ;     2 - BIDATA (req) String of data for the Visit to be added.
"RTN","BIVISIT",104,0)
 ;                      See BIDATA definition at linelabel PARSE (above).
"RTN","BIVISIT",105,0)
 ;     3 - BIOIEN (opt) IEN of V IMM or V SKIN being edited (if
"RTN","BIVISIT",106,0)
 ;                      not new).
"RTN","BIVISIT",107,0)
 ;     4 - BINOM  (opt) 0=Allow display of Visit Selection Menu if site
"RTN","BIVISIT",108,0)
 ;                       parameter is set. 1=No display (for export).
"RTN","BIVISIT",109,0)
 ;
"RTN","BIVISIT",110,0)
 I BIDATA="" D ERRCD^BIUTL2(437,.BIERR) S BIERR="1^"_BIERR Q
"RTN","BIVISIT",111,0)
 ;
"RTN","BIVISIT",112,0)
 N BIVTYPE,BIDFN,BIPTR,BIDOSE,BILOT,BIDATE,BILOC,BIOLOC,BICAT,BIVSIT
"RTN","BIVISIT",113,0)
 N BIOIEN,BIRES,BIREA,BIDTR,BIREC,BIVISD,BIPROV,BIOVRD,BIINJS,BIVOL
"RTN","BIVISIT",114,0)
 N BIREDR,BISITE,BICCPT,BIMPRT,BIANOT,BILOTSK
"RTN","BIVISIT",115,0)
 ;
"RTN","BIVISIT",116,0)
 ;---> See BIDATA definition at linelabel PARSE.
"RTN","BIVISIT",117,0)
 D PARSE(BIDATA)
"RTN","BIVISIT",118,0)
 ;
"RTN","BIVISIT",119,0)
 N APCDALVR,APCDANE,AUPNTALK,BITEST,DLAYGO,X
"RTN","BIVISIT",120,0)
 S BIERR=0
"RTN","BIVISIT",121,0)
 ;
"RTN","BIVISIT",122,0)
 ;---> Set BITEST=1 To display VISIT and V IMM pointers after sets.
"RTN","BIVISIT",123,0)
 ;---> NOTE: This will write directly to IO.  Should be turned OFF
"RTN","BIVISIT",124,0)
 ;---> (BITEST=0) when not testing in M Programmer mode.
"RTN","BIVISIT",125,0)
 S BITEST=0
"RTN","BIVISIT",126,0)
 ;
"RTN","BIVISIT",127,0)
 ;---> If this is an edit, check or set BIVSIT=IEN of Parent Visit.
"RTN","BIVISIT",128,0)
 D:$G(BIOIEN)
"RTN","BIVISIT",129,0)
 .I (BIVTYPE'="I"&(BIVTYPE'="S")) D  Q
"RTN","BIVISIT",130,0)
 ..D ERRCD^BIUTL2(410,.BIERR) S BIERR="1^"_BIERR
"RTN","BIVISIT",131,0)
 .;
"RTN","BIVISIT",132,0)
 .;---> Quit if valid Visit IEN passed.
"RTN","BIVISIT",133,0)
 .Q:$G(^AUPNVSIT(+$G(BIVSIT),0))
"RTN","BIVISIT",134,0)
 .;
"RTN","BIVISIT",135,0)
 .;---> Get Visit IEN from V File entry (and set in BIDATA).
"RTN","BIVISIT",136,0)
 .N BIGBL S BIGBL=$S(BIVTYPE="I":"^AUPNVIMM(",1:"^AUPNVSK(")
"RTN","BIVISIT",137,0)
 .S BIGBL=BIGBL_BIOIEN_",0)"
"RTN","BIVISIT",138,0)
 .;---> Get IEN of VISIT.
"RTN","BIVISIT",139,0)
 .S BIVSIT=$P($G(@BIGBL),U,3)
"RTN","BIVISIT",140,0)
 Q:BIERR
"RTN","BIVISIT",141,0)
 ;
"RTN","BIVISIT",142,0)
 ;---> Create or edit Visit if necessary.
"RTN","BIVISIT",143,0)
 ;---> NOTE: BIVSIT, even if sent, might come backed changed (due to
"RTN","BIVISIT",144,0)
 ;---> change in Date, Category, etc.)
"RTN","BIVISIT",145,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIVISIT",146,0)
 ;---> Added BINOM parameter to control Visit Menu display.
"RTN","BIVISIT",147,0)
 S:($G(BINOM)="") BINOM=0
"RTN","BIVISIT",148,0)
 D VISIT^BIVISIT1(BIDFN,BIDATE,BICAT,BILOC,BIOLOC,BISITE,.BIVSIT,.BIERR,BINOM)
"RTN","BIVISIT",149,0)
 ;**********
"RTN","BIVISIT",150,0)
 Q:BIERR
"RTN","BIVISIT",151,0)
 ;
"RTN","BIVISIT",152,0)
 ;---> Create V FILE entry.
"RTN","BIVISIT",153,0)
 D VFILE($G(BIVSIT),BIDATA,.BIERR)
"RTN","BIVISIT",154,0)
 Q:BIERR
"RTN","BIVISIT",155,0)
 ;
"RTN","BIVISIT",156,0)
 ;---> If this was a mod to an existing Visit, update VISIT Field .13.
"RTN","BIVISIT",157,0)
 D:($G(BIOIEN)&($G(BIVSIT)))
"RTN","BIVISIT",158,0)
 .N AUPNVSIT,DA,DIE,DLAYGO
"RTN","BIVISIT",159,0)
 .S AUPNVSIT=BIVSIT,DLAYGO=9000010
"RTN","BIVISIT",160,0)
 .D MOD^AUPNVSIT
"RTN","BIVISIT",161,0)
 ;
"RTN","BIVISIT",162,0)
 Q
"RTN","BIVISIT",163,0)
 ;
"RTN","BIVISIT",164,0)
 ;
"RTN","BIVISIT",165,0)
 ;----------
"RTN","BIVISIT",166,0)
VFILE(BIVSIT,BIDATA,BIERR) ;EP
"RTN","BIVISIT",167,0)
 ;---> Add (create) V IMMUNIZATION or V SKIN TEST entry for this Visit.
"RTN","BIVISIT",168,0)
 ;---> Parameters:
"RTN","BIVISIT",169,0)
 ;     1 - BIVSIT (req) IEN of Parent Visit.
"RTN","BIVISIT",170,0)
 ;     2 - BIDATA (req) String of data for the Visit to be added.
"RTN","BIVISIT",171,0)
 ;                      See BIDATA definition at linelabel PARSE.
"RTN","BIVISIT",172,0)
 ;     3 - BIERR  (ret) Text of Error Code if any, otherwise null.
"RTN","BIVISIT",173,0)
 ;
"RTN","BIVISIT",174,0)
 ;
"RTN","BIVISIT",175,0)
 I BIDATA="" D ERRCD^BIUTL2(437,.BIERR) S BIERR="1^"_BIERR Q
"RTN","BIVISIT",176,0)
 ;
"RTN","BIVISIT",177,0)
 N BIVTYPE,BIDFN,BIPTR,BIDOSE,BILOT,BIDATE,BILOC,BIOLOC,BICAT
"RTN","BIVISIT",178,0)
 N BIOIEN,BIRES,BIREA,BIDTR,BIREC,BIVISD,BIPROV,BIOVRD,BIINJS,BIVOL
"RTN","BIVISIT",179,0)
 N BIREDR,BISITE,BICCPT,BIMPRT,BIANOT,BILOTSK
"RTN","BIVISIT",180,0)
 ;
"RTN","BIVISIT",181,0)
 ;---> See BIDATA definition at linelabel PARSE (above).
"RTN","BIVISIT",182,0)
 D PARSE(BIDATA,1)
"RTN","BIVISIT",183,0)
 ;
"RTN","BIVISIT",184,0)
 ;---> Fields in V IMMUNIZATION File are as follows:
"RTN","BIVISIT",185,0)
 ;
"RTN","BIVISIT",186,0)
 ;       .01 APCDTIMM  Pointer to IMMUNIZATION File (Vaccine)
"RTN","BIVISIT",187,0)
 ;       .02 APCDPAT   Patient
"RTN","BIVISIT",188,0)
 ;       .03 APCDVSIT  IEN of Visit
"RTN","BIVISIT",189,0)
 ;       .04 APCDTSER  Dose# (Series#)
"RTN","BIVISIT",190,0)
 ;       .05 APCDTLOT  Lot# IEN, Pointer to IMMUNIZATION LOT File
"RTN","BIVISIT",191,0)
 ;       .06 APCDTREC  Reaction
"RTN","BIVISIT",192,0)
 ;
"RTN","BIVISIT",193,0)
 ;       This will no longer be used:
"RTN","BIVISIT",194,0)
 ;       .07 APCDTCON  Contraindication (Stored in ^BIP.)
"RTN","BIVISIT",195,0)
 ;
"RTN","BIVISIT",196,0)
 ;       .12 APCDTVSD  VIS Date (Lori will put in a future template.)
"RTN","BIVISIT",197,0)
 ;      1204 APCDTEPR  Immunization Provider
"RTN","BIVISIT",198,0)
 ;
"RTN","BIVISIT",199,0)
 ;---> Fields in V SKIN TEST File are as follows:
"RTN","BIVISIT",200,0)
 ;
"RTN","BIVISIT",201,0)
 ;       .01 APCDTSK   Pointer to IMMUNIZATION File
"RTN","BIVISIT",202,0)
 ;       .02 APCDPAT   Patient
"RTN","BIVISIT",203,0)
 ;       .03 APCDVSIT  IEN of Visit
"RTN","BIVISIT",204,0)
 ;       .04 APCDTRES  Result
"RTN","BIVISIT",205,0)
 ;       .05 APCDTREA  Reading
"RTN","BIVISIT",206,0)
 ;       .06 APCDTDR   Date read
"RTN","BIVISIT",207,0)
 ;      1204 APCDTEPR  Skin Test Provider
"RTN","BIVISIT",208,0)
 ;
"RTN","BIVISIT",209,0)
 ;---> Check that a Parent VISIT exists.
"RTN","BIVISIT",210,0)
 I '$D(^AUPNVSIT(+$G(BIVSIT),0)) D  Q
"RTN","BIVISIT",211,0)
 .D ERRCD^BIUTL2(432,.BIERR) S BIERR="1^"_BIERR
"RTN","BIVISIT",212,0)
 ;
"RTN","BIVISIT",213,0)
 N APCDALVR
"RTN","BIVISIT",214,0)
 ;
"RTN","BIVISIT",215,0)
 ;---> Set Visit pointer.
"RTN","BIVISIT",216,0)
 S APCDALVR("APCDVSIT")=BIVSIT
"RTN","BIVISIT",217,0)
 ;
"RTN","BIVISIT",218,0)
 ;---> Set Patient.
"RTN","BIVISIT",219,0)
 S APCDALVR("APCDPAT")=BIDFN
"RTN","BIVISIT",220,0)
 ;
"RTN","BIVISIT",221,0)
 ;
"RTN","BIVISIT",222,0)
 ;
"RTN","BIVISIT",223,0)
 ;---> * * * If this is an IMMUNIZATION, set APCD array for Immunizations. * * *
"RTN","BIVISIT",224,0)
 ;
"RTN","BIVISIT",225,0)
 I BIVTYPE="I" D
"RTN","BIVISIT",226,0)
 .;
"RTN","BIVISIT",227,0)
 .;---> Set permission override for this file.
"RTN","BIVISIT",228,0)
 .S DLAYGO=9000010.11
"RTN","BIVISIT",229,0)
 .;
"RTN","BIVISIT",230,0)
 .;---> Immunization/vaccine name.
"RTN","BIVISIT",231,0)
 .S APCDALVR("APCDTIMM")="`"_BIPTR
"RTN","BIVISIT",232,0)
 .;
"RTN","BIVISIT",233,0)
 .;---> Dose# for this immunization.
"RTN","BIVISIT",234,0)
 .;S:'$G(BIDOSE) BIDOSE=""
"RTN","BIVISIT",235,0)
 .;S APCDALVR("APCDTSER")=BIDOSE
"RTN","BIVISIT",236,0)
 .;
"RTN","BIVISIT",237,0)
 .;---> Lot Number IEN for this immunization.
"RTN","BIVISIT",238,0)
 .S:'$G(BILOT) BILOT=""
"RTN","BIVISIT",239,0)
 .;---> Lot Number passed to PCC more reliably if prepend "`".
"RTN","BIVISIT",240,0)
 .;---> Imm v8.5: Handle Lot Number below
"RTN","BIVISIT",241,0)
 .;S:BILOT BILOT="`"_BILOT
"RTN","BIVISIT",242,0)
 .;S APCDALVR("APCDTLOT")=BILOT
"RTN","BIVISIT",243,0)
 .;
"RTN","BIVISIT",244,0)
 .;---> Reaction to this vaccine on this Visit.
"RTN","BIVISIT",245,0)
 .S:'$G(BIREC) BIREC=""
"RTN","BIVISIT",246,0)
 .S APCDALVR("APCDTREC")=BIREC
"RTN","BIVISIT",247,0)
 .;
"RTN","BIVISIT",248,0)
 .;---> Immunization Provider ("Shot giver").
"RTN","BIVISIT",249,0)
 .S:$G(BIPROV) APCDALVR("APCDTEPR")="`"_BIPROV
"RTN","BIVISIT",250,0)
 .;
"RTN","BIVISIT",251,0)
 .;---> User who last edited this Immunization.
"RTN","BIVISIT",252,0)
 .S:$G(DUZ) APCDALVR("APCDTULU")="`"_DUZ
"RTN","BIVISIT",253,0)
 .;
"RTN","BIVISIT",254,0)
 .;---> Template to add encounter to V IMMUNIZATION File.
"RTN","BIVISIT",255,0)
 .S APCDALVR("APCDATMP")="[APCDALVR 9000010.11 (ADD)]"
"RTN","BIVISIT",256,0)
 ;
"RTN","BIVISIT",257,0)
 ;
"RTN","BIVISIT",258,0)
 ;
"RTN","BIVISIT",259,0)
 ;---> * * * If this is a SKIN TEST, set APCD array for Skin Tests.  * * *
"RTN","BIVISIT",260,0)
 ;
"RTN","BIVISIT",261,0)
 I BIVTYPE="S" D
"RTN","BIVISIT",262,0)
 .;
"RTN","BIVISIT",263,0)
 .;---> Set permission override for this file.
"RTN","BIVISIT",264,0)
 .S DLAYGO=9000010.12
"RTN","BIVISIT",265,0)
 .;
"RTN","BIVISIT",266,0)
 .;---> Skin Test name.
"RTN","BIVISIT",267,0)
 .S APCDALVR("APCDTSK")="`"_BIPTR
"RTN","BIVISIT",268,0)
 .;
"RTN","BIVISIT",269,0)
 .;---> Skin Test Result.
"RTN","BIVISIT",270,0)
 .S APCDALVR("APCDTRES")=BIRES
"RTN","BIVISIT",271,0)
 .;
"RTN","BIVISIT",272,0)
 .;---> Skin Test Reading (mm).
"RTN","BIVISIT",273,0)
 .S APCDALVR("APCDTREA")=BIREA
"RTN","BIVISIT",274,0)
 .;
"RTN","BIVISIT",275,0)
 .;---> Skin Test Date Read.
"RTN","BIVISIT",276,0)
 .S APCDALVR("APCDTDR")=BIDTR
"RTN","BIVISIT",277,0)
 .;
"RTN","BIVISIT",278,0)
 .;---> Skin Test Provider (Person who administered the test).
"RTN","BIVISIT",279,0)
 .S:$G(BIPROV) APCDALVR("APCDTEPR")="`"_BIPROV
"RTN","BIVISIT",280,0)
 .;
"RTN","BIVISIT",281,0)
 .;---> Template to add encounter to V SKIN TEST File.
"RTN","BIVISIT",282,0)
 .S APCDALVR("APCDATMP")="[APCDALVR 9000010.12 (ADD)]"
"RTN","BIVISIT",283,0)
 ;
"RTN","BIVISIT",284,0)
 ;
"RTN","BIVISIT",285,0)
 ;---> * * *  CALL TO APCDALVR.  * * *
"RTN","BIVISIT",286,0)
 D EN^APCDALVR
"RTN","BIVISIT",287,0)
 D:$G(BITEST) DISPLAY2^BIPCC
"RTN","BIVISIT",288,0)
 ;
"RTN","BIVISIT",289,0)
 ;---> Quit if a V File entry was not created.
"RTN","BIVISIT",290,0)
 I '$G(APCDALVR("APCDADFN"))!($D(APCDALVR("APCDAFLG"))) D  Q
"RTN","BIVISIT",291,0)
 .I BIVTYPE="I" D ERRCD^BIUTL2(402,.BIERR) S BIERR="1^"_BIERR Q
"RTN","BIVISIT",292,0)
 .I BIVTYPE="S" D ERRCD^BIUTL2(413,.BIERR) S BIERR="1^"_BIERR
"RTN","BIVISIT",293,0)
 ;
"RTN","BIVISIT",294,0)
 ;Returns:  APCDADFN - IEN of V IMMUNIZATION File entry.
"RTN","BIVISIT",295,0)
 ;          APCDAFLG - =2 If FAILED to create a V FILE entry.
"RTN","BIVISIT",296,0)
 ;
"RTN","BIVISIT",297,0)
 ;
"RTN","BIVISIT",298,0)
 ;---> Save IEN of V IMMUNIZATION just created.
"RTN","BIVISIT",299,0)
 N BIADFN S BIADFN=APCDALVR("APCDADFN")
"RTN","BIVISIT",300,0)
 ;
"RTN","BIVISIT",301,0)
 ;
"RTN","BIVISIT",302,0)
 ;---> ADD OTHER V SKIN TEST FIELDS:
"RTN","BIVISIT",303,0)
 ;---> If this is a Skin Test, add Skin Test Reader and Quit.
"RTN","BIVISIT",304,0)
 I BIVTYPE="S" D  Q
"RTN","BIVISIT",305,0)
 .;---> Store Additional data.
"RTN","BIVISIT",306,0)
 .N BIFLD
"RTN","BIVISIT",307,0)
 .S BIFLD(.08)=BIREDR,BIFLD(.09)=BIINJS,BIFLD(.11)=BIVOL
"RTN","BIVISIT",308,0)
 .;
"RTN","BIVISIT",309,0)
 .;********** PATCH 10, v8.5, MAY 30,2015, IHS/CMI
"RTN","BIVISIT",310,0)
 .;---> BILOTSK (opt) Skin Test Lot Number.
"RTN","BIVISIT",311,0)
 .S BIFLD(.14)=BILOTSK
"RTN","BIVISIT",312,0)
 .;
"RTN","BIVISIT",313,0)
 .;---> Set DATE/TIME LAST MODIFIED, per Lori Butcher, 5/26/12
"RTN","BIVISIT",314,0)
 .S:$G(BIOIEN) BIFLD(1218)=$$NOW^XLFDT
"RTN","BIVISIT",315,0)
 .;
"RTN","BIVISIT",316,0)
 .D FDIE^BIFMAN(9000010.12,BIADFN,.BIFLD,.BIERR)
"RTN","BIVISIT",317,0)
 .I BIERR=1 D ERRCD^BIUTL2(421,.BIERR) S BIERR="1^"_BIERR
"RTN","BIVISIT",318,0)
 .;
"RTN","BIVISIT",319,0)
 .;---> If Skin Test is a PPD and result is Positive, add Contraindication
"RTN","BIVISIT",320,0)
 .;---> to further TST-PPD tests.
"RTN","BIVISIT",321,0)
 .I $$SKNAME^BIUTL6($G(BIPTR))="PPD",$E($G(BIRES))="P" D
"RTN","BIVISIT",322,0)
 ..;---> Set date equal to either Date Read, or Date of Visit, or Today.
"RTN","BIVISIT",323,0)
 ..N BIDTC S BIDTC=$S($G(BIDTR):BIDTR,$G(BIDATE):$P(BIDATE,"."),1:$G(DT))
"RTN","BIVISIT",324,0)
 ..S BIDATA=BIDFN_"|"_203_"|"_17_"|"_BIDTC
"RTN","BIVISIT",325,0)
 ..D ADDCONT^BIRPC4(,BIDATA)
"RTN","BIVISIT",326,0)
 ;
"RTN","BIVISIT",327,0)
 ;
"RTN","BIVISIT",328,0)
 ;---> ADD OTHER V IMMUNIZATION FIELDS:
"RTN","BIVISIT",329,0)
 ;---> Quit if this is not an Immunization.
"RTN","BIVISIT",330,0)
 Q:BIVTYPE'="I"
"RTN","BIVISIT",331,0)
 ;
"RTN","BIVISIT",332,0)
 ;---> Add VIS, Dose Override, Injection Site and Volume data.
"RTN","BIVISIT",333,0)
 ;---> Build DR string.
"RTN","BIVISIT",334,0)
 ;
"RTN","BIVISIT",335,0)
 S:(BIVISD<1) BIVISD="@" S:BIOVRD="" BIOVRD="@"
"RTN","BIVISIT",336,0)
 ;
"RTN","BIVISIT",337,0)
 S:BIINJS="" BIINJS="@" S:BIVOL="" BIVOL="@"
"RTN","BIVISIT",338,0)
 S:BILOT="" BIILOT="@" S:BINDC="" BINDC="@"
"RTN","BIVISIT",339,0)
 ;
"RTN","BIVISIT",340,0)
 ;---> Store Additional data.
"RTN","BIVISIT",341,0)
 N BIFLD
"RTN","BIVISIT",342,0)
 S BIFLD(.05)=BILOT
"RTN","BIVISIT",343,0)
 S BIFLD(.08)=BIOVRD,BIFLD(.09)=BIINJS
"RTN","BIVISIT",344,0)
 S BIFLD(.11)=BIVOL,BIFLD(.12)=BIVISD,BIFLD(.13)=BICCPT
"RTN","BIVISIT",345,0)
 ;
"RTN","BIVISIT",346,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIVISIT",347,0)
 ;---> If patient is 19yrs or older at the time of the immunization,
"RTN","BIVISIT",348,0)
 ;---> and Eligibility is null, set Eligibility=V01.
"RTN","BIVISIT",349,0)
 D
"RTN","BIVISIT",350,0)
 .Q:(BIVFC]"")
"RTN","BIVISIT",351,0)
 .N BIAGDT S BIAGDT=$S($G(BIADMIN):BIADMIN,1:BIDATE)
"RTN","BIVISIT",352,0)
 .I $$AGE^BIUTL1(BIDFN,1,BIAGDT)>18 S BIVFC=$O(^BIELIG("B","V01",0))
"RTN","BIVISIT",353,0)
 ;**********
"RTN","BIVISIT",354,0)
 ;
"RTN","BIVISIT",355,0)
 S BIFLD(.14)=BIVFC
"RTN","BIVISIT",356,0)
 S BIFLD(.15)=$S(BIMPRT>0:2,1:"")
"RTN","BIVISIT",357,0)
 S BIFLD(.16)=BINDC
"RTN","BIVISIT",358,0)
 ;********** PATCH 5, v8.5, JUL 01,2013, IHS/CMI/MWR
"RTN","BIVISIT",359,0)
 ;---> Added Admin Note, piece 27.
"RTN","BIVISIT",360,0)
 S:($G(BIANOT)]"") BIFLD(1)=BIANOT
"RTN","BIVISIT",361,0)
 ;**********
"RTN","BIVISIT",362,0)
 ;
"RTN","BIVISIT",363,0)
 ;********** PATCH 3, v8.5, SEP 10,2012, IHS/CMI/MWR
"RTN","BIVISIT",364,0)
 ;---> Set DATE/TIME LAST MODIFIED, per Lori Butcher, 5/26/12
"RTN","BIVISIT",365,0)
 S:$G(BIOIEN) BIFLD(1218)=$$NOW^XLFDT
"RTN","BIVISIT",366,0)
 ;**********
"RTN","BIVISIT",367,0)
 ;
"RTN","BIVISIT",368,0)
 ;********** PATCH 9, v8.5, OCT 01,2014, IHS/CMI/MWR
"RTN","BIVISIT",369,0)
 ;---> Add Admin Date and VIS Presented Date to data being saved.
"RTN","BIVISIT",370,0)
 ;    28 - BIADMIN  Admin Date (Date shot admin'd to patient.
"RTN","BIVISIT",371,0)
 ;    29 - BIVPRES  Date VIS Presented to Patient.
"RTN","BIVISIT",372,0)
 ;
"RTN","BIVISIT",373,0)
 S BIFLD(1201)=BIADMIN
"RTN","BIVISIT",374,0)
 S BIFLD(.17)=BIVPRES
"RTN","BIVISIT",375,0)
 ;**********
"RTN","BIVISIT",376,0)
 ;
"RTN","BIVISIT",377,0)
 D FDIE^BIFMAN(9000010.11,BIADFN,.BIFLD,.BIERR)
"RTN","BIVISIT",378,0)
 I BIERR=1 D  Q
"RTN","BIVISIT",379,0)
 .D ERRCD^BIUTL2(421,.BIERR) S BIERR="1^"_BIERR
"RTN","BIVISIT",380,0)
 ;
"RTN","BIVISIT",381,0)
 ;
"RTN","BIVISIT",382,0)
 ;---> If there was an anaphylactic reaction to this vaccine,
"RTN","BIVISIT",383,0)
 ;---> add it as a contraindication for this patient.
"RTN","BIVISIT",384,0)
 D:BIREC=9
"RTN","BIVISIT",385,0)
 .Q:'$G(BIDFN)  Q:'$G(BIPTR)  Q:'$G(BIDATE)
"RTN","BIVISIT",386,0)
 .N BIREAS S BIREAS=$O(^BICONT("B","Anaphylaxis",0))
"RTN","BIVISIT",387,0)
 .Q:'BIREAS
"RTN","BIVISIT",388,0)
 .;
"RTN","BIVISIT",389,0)
 .N BIADD,N,V S N=0,BIADD=1,V="|"
"RTN","BIVISIT",390,0)
 .;---> Loop through patient's existing contraindications.
"RTN","BIVISIT",391,0)
 .F  S N=$O(^BIPC("B",BIDFN,N)) Q:'N  Q:'BIADD  D
"RTN","BIVISIT",392,0)
 ..N X S X=$G(^BIPC(N,0))
"RTN","BIVISIT",393,0)
 ..Q:'X
"RTN","BIVISIT",394,0)
 ..;---> Quit (BIADD=0) if this contra/reason/date already exists.
"RTN","BIVISIT",395,0)
 ..I $P(X,U,2)=BIPTR&($P(X,U,3)=BIREAS)&($P(X,U,4)=BIDATE) S BIADD=0
"RTN","BIVISIT",396,0)
 .Q:'BIADD
"RTN","BIVISIT",397,0)
 .;
"RTN","BIVISIT",398,0)
 .D ADDCONT^BIRPC4(.BIERR,BIDFN_V_BIPTR_V_BIREAS_V_BIDATE)
"RTN","BIVISIT",399,0)
 .I $G(BIERR)]"" S BIERR="1^"_BIERR
"RTN","BIVISIT",400,0)
 ;
"RTN","BIVISIT",401,0)
 ;---> Now trigger New Immunization Trigger Event.
"RTN","BIVISIT",402,0)
 D TRIGADD
"RTN","BIVISIT",403,0)
 Q
"RTN","BIVISIT",404,0)
 ;
"RTN","BIVISIT",405,0)
 ;
"RTN","BIVISIT",406,0)
 ;----------
"RTN","BIVISIT",407,0)
TRIGADD ;EP
"RTN","BIVISIT",408,0)
 ;---> Immunization Added Trigger Event call to Protocol File.
"RTN","BIVISIT",409,0)
 D TRIGADD^BIVISIT2
"RTN","BIVISIT",410,0)
 Q
"RTN","BIVISIT",411,0)
 ;
"RTN","BIVISIT",412,0)
 ;
"RTN","BIVISIT",413,0)
 ;----------
"RTN","BIVISIT",414,0)
VFILE1 ;EP
"RTN","BIVISIT",415,0)
 ;---> Add (create) V IMMUNIZATION from ^DD of V CPT.
"RTN","BIVISIT",416,0)
 ;---> Called from EN^XBNEW, from CPTIMM^BIRPC6
"RTN","BIVISIT",417,0)
 ;---> Local Variables:
"RTN","BIVISIT",418,0)
 ;     1 - BIVSIT (req) IEN of Parent Visit.
"RTN","BIVISIT",419,0)
 ;     2 - BIDATA (req) String of data for the Visit to be added.
"RTN","BIVISIT",420,0)
 ;                      See BIDATA definition at linelabel PARSE.
"RTN","BIVISIT",421,0)
 ;
"RTN","BIVISIT",422,0)
 Q:'$G(BIVSIT)  Q:'$D(BIDATA)
"RTN","BIVISIT",423,0)
 D VFILE(BIVSIT,BIDATA)
"RTN","BIVISIT",424,0)
 Q
"RTN","BIVISIT",425,0)
 ;
"RTN","BIVISIT",426,0)
 ;
"RTN","BIVISIT",427,0)
 ;----------
"RTN","BIVISIT",428,0)
IMPORT(APCDALVR) ;PEP - Code to flag V Imm as "Imported."
"RTN","BIVISIT",429,0)
 ;---> Code for Tom Love to flag entry as Imported From Outside Registry.
"RTN","BIVISIT",430,0)
 ;---> Parameters:
"RTN","BIVISIT",431,0)
 ;     1 - APCDALVR (req) Array returned from call to EN^APCDALVR.
"RTN","BIVISIT",432,0)
 ;                   APCDALVR("APCDADFN") - IEN of V IMMUNIZATION File entry.
"RTN","BIVISIT",433,0)
 ;                   APCDALVR("APCDAFLG") - =2 If FAILED to create a V FILE entry.
"RTN","BIVISIT",434,0)
 ;
"RTN","BIVISIT",435,0)
 Q:($G(APCDALVR("APCDAFLG")))
"RTN","BIVISIT",436,0)
 Q:('$G(APCDALVR("APCDADFN")))
"RTN","BIVISIT",437,0)
 N BIADFN S BIADFN=APCDALVR("APCDADFN")
"RTN","BIVISIT",438,0)
 ;
"RTN","BIVISIT",439,0)
 ;---> Add Import From Outside.
"RTN","BIVISIT",440,0)
 N BIFLD S BIFLD(.15)=1
"RTN","BIVISIT",441,0)
 D FDIE^BIFMAN(9000010.11,BIADFN,.BIFLD,.BIERR)
"RTN","BIVISIT",442,0)
 Q
"VER")
8.0^22.0
"^DD",9000010.12,9000010.12,.14,0)
LOT NUMBER^P9999999.41'^AUTTIML(^0;14^Q
"^DD",9000010.12,9000010.12,.14,"DT")
3150406
**END**
**END**
