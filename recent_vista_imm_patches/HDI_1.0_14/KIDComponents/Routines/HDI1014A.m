HDI1014A ;SLC/AJB - PATCH 14 POST INSTALL;01/05/2015
 ;;1.0;HEALTH DATA & INFORMATICS;**14**;Feb 22, 2005
 ;
POST ;
 N DOMAIN,HDIMSG,HDDOM,HDISDFFS
 I +$$PATCH^XPDUTL("HDI*1.0*14") D CLEAN
 S DOMAIN="IMMUNIZATIONS"
 I '+$$UPDTDOM^HDISVCUT(DOMAIN) D PSTHALT Q  ;Adds Domain
 I '+$$GETIEN^HDISVF09("IMMUNIZATIONS",.HDDOM) D PSTHALT Q
 I '+HDDOM D PSTHALT Q
 ; set fields
 S HDISDFFS(920)=".01"
 S HDISDFFS(920.1)=".01"
 S HDISDFFS(920.2)=".01"
 S HDISDFFS(920.3)=".01"
 S HDISDFFS(920.4)=".01"
 S HDISDFFS(920.5)=".01"
 S HDISDFFS(9999999.04)=".01"
 S HDISDFFS(9999999.14)=".01"
 S HDISDFFS(9999999.28)=".01"
 S HDIMSG(1)=" "
 S HDIMSG(2)=" "
 S HDIMSG(3)="Post-Installation (POST^HDI1014A) will now be run"
 S HDIMSG(4)=" "
 S HDIMSG(5)=" "
 D MES^XPDUTL(.HDIMSG) K HDIMSG
 ;Updates HDIS FILE/FIELD file
 I '+$$ADDDFFS^HDISVF09(HDDOM,.HDISDFFS) D PSTHALT
 I '$$VUID^HDISVCUT("IMM","HDI1014B") D PSTHALT
 Q
PSTHALT ;Print post-install halted text
 N HDIMSG
 S HDIMSG(1)=" "
 S HDIMSG(2)="*****"
 S HDIMSG(3)="***** Post-installation has been halted"
 S HDIMSG(4)="***** Please contact Enterprise VistA Support"
 S HDIMSG(5)="*****"
 S HDIMSG(6)=" "
 D MES^XPDUTL(.HDIMSG)
 Q
CLEAN ; Remove entries in 7115.1 and 7115.6 for re-installations as needed
 N HDIFILES
 S HDIFILES(920)=".01"
 S HDIFILES(920.1)=".01"
 S HDIFILES(920.2)=".01"
 S HDIFILES(920.3)=".01"
 S HDIFILES(920.4)=".01"
 S HDIFILES(920.5)=".01"
 S HDIFILES(9999999.04)=".01"
 S HDIFILES(9999999.14)=".01"
 S HDIFILES(9999999.28)=".01"
 S HDIFILES="" F  S HDIFILES=$O(HDIFILES(HDIFILES)) Q:'+HDIFILES  D
 . N IEN S IEN="",IEN=$O(^HDIS(7115.6,"B",HDIFILES_"~.01",IEN)) I +IEN D
 . . N DA,DIK S DA=IEN,DIK="^HDIS(7115.6," D ^DIK
 ;
 S HDIFILES="",HDIFILES=$O(^HDIS(7115.1,"B","IMMUNIZATIONS",HDIFILES)) I +HDIFILES D
 . N DA,DIK S DA=HDIFILES,DIK="^HDIS(7115.1," D ^DIK
 Q
